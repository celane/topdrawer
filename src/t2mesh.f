C        MORTRAN 2.79 (BRACKETED KEYWORD MACROS OF 09/28/81)          
      BLOCK DATA T2_MESH_DATA
      INTEGER IHSIZE,NPSTOR
      REAL TOLR
      PARAMETER (IHSIZE=2000)
      PARAMETER (TOLR=0.001)
      PARAMETER (NPSTOR=30)
      INTEGER IBOLD,IB,IBT,MAJMIN,MAJMAX,MINMIN,MINMAX,MAJSTP,MINSTP ,MI
     *NMN,MINMX,MAJMN,MAJMX ,MAJAX,MINAX,IFREE,IHBTOP(2),ITXTOP(2),LEFT,
     *IRIGHT,IPASS
      INTEGER*2 IHFWD(IHSIZE), IHBACK(IHSIZE)
      LOGICAL LFREE,VFLG,LVANISH
      REAL ROTCOS,ROTSIN,PNT12(2,2),XX(2,4) ,BUFR(NPSTOR),HORXY(2,IHSIZE
     *),VANISH_PNT(2)
      COMMON /T2MSHC/ MAJMIN,MAJMAX,MINMIN,MINMAX,MAJSTP,MINSTP ,MINMN,M
     *INMX,MAJMN,MAJMX ,MAJAX,MINAX,IB,IFREE,IHBTOP,ROTCOS,ROTSIN ,PNT12
     *,XX,IBT,VFLG,LEFT,IRIGHT ,ITXTOP,IBOLD,LFREE ,BUFR,HORXY ,IHFWD,IH
     *BACK,IPASS,LVANISH,VANISH_PNT
      END
      REAL FUNCTION T2XMSH(I)
      COMMON /T2FLGC/ FLAGS(200), LTRAP,LHANDL,LSYERR,LSCREV
      LOGICAL FLAGS, LTRAP,LHANDL,LSYERR,LSCREV(3)
      INTEGER RELFLAG 
      PARAMETER (RELFLAG=151)
      INTEGER IWINLEV 
      INTEGER NWINLEV , MAX_FILL 
      PARAMETER (NWINLEV =4)
      PARAMETER (MAX_FILL=4)
      REAL GRDSYM, GRDSIZ, DATDAT(2,8), H2STAT(12), TITLIN(4), TITFA
     *C(4), TITLOC(4), TITMAR(4), TITLMX(4), TIKFAC, TITINX, TITX1, TIT
     *Y1, TITX, TITY, TITZ, TITSIZ, TITCON(5), REVLEV, REDUCE(5), XFR
     *M12(12), XFRM13(12), XFRM14(12), XFRM23(12), XFRM24(12), XFRM34(6
     *), XVARSX(20), CIRSIZ(2,3), ASIZE, AFLARE, SMSZDF, ORAXES(3), EY
     *EDIR(3), VUEDIR(3), VUECEN(3), VERTCL(3), EYESEP, SCRD, SCRZ, EYE
     *DIS, EYEPNT(3), XYPART(2, 2), BARSIZ(3), BARBRK(3), TIKSIZ(3), XY
     *ZBAS(3), TTHETA, TPHI, FRELBL(4), PATRN(20,30), SCLPRM(10,3), WI
     *NDOW(4), SCREEN(2), SYMBOL, NOSYMB, FACTXY(19), LBLSIZ, SYMSIZ, X
     *YZLIM(3,2), WORLD(3), RADRMX, RADRMN, RADAMN, RADANG, RADX0, RADY
     *0, XUNUSD(6), AXANG(3), REDFAC, DSCAL, PATSZ, MARGIN(4), PSCR(2
     *), OREAL, OCPU, CSCRD, DATPTS, ERRPTS, DATXMN, DATXMX, DATYMN, DA
     *TYMX, DATZMN, DATZMX, DATSUM, ERRSUM, DATAVE, ERRAVE, DATCEN, ERR
     *CEN, DATSTD, ERRSTD, WINREL(2,2,NWINLEV),WINABS(2,2,NWINLEV),WINL
     *IM(2,2), FMARKER(3,8), SYDIR(3), GRDIR(3), EXYZLIM(3,2), DSLOPE(2
     *,2)
      REAL PLOT_EXTENT(2,2),FILL_ANGLE(MAX_FILL),FILL_WIDTH(MAX_FILL)
      INTEGER FILL_INDEX, FILL_TEX(MAX_FILL), N_LINES(6)
      EQUIVALENCE (DATDAT, DATPTS)
      INTEGER MAXREP
      PARAMETER (MAXREP=5)
      INTEGER IPATRN, NPATRN(30), NXYLIM(3,2), NPLOTS, NCSETS, NCCOL, N
     *CROW, IYEAR, IMONTH, IDAY, ISIGFG, ITXPRI, ITXSEC, ITITDT(3), L
     *ENCRD, IPROP, IHTEX, IBLINK, IERASE, ITCNTR, IUNUSD, NXYZ1(3), 
     *NXYZ2(3), LBLFMT(3), LBLCHR(3), NDIMNS(3), IBLKTP, IDIMNS, NMES
     *H0, NMESH1, NMESH2, MESH1, MESH2, MESH3, MESH2D, MESHN(3), NMESHN(
     *2), NFIELD, IFIELD(19), NINCR, NPOINT, IVARBL(19), IVPTR(19), I_
     *VORDER(19,2), LINEAR(4), NONLIN(4), MXECHO, LINES, MAXLNS, USRK
     *BD, USRSCR, PLTFIL, LINWID, LINCOL, LINTEX, ICPOIN(3), IREPCT(MA
     *XREP), LEVREP, GRDTYP, GRDTEX, OUTTEX, IAXTEX, TITEX, LETSET, LAB
     *TEX, TICTEX, SHADOWTYP,SHADOWTEX, NXYZDEF1(10), NXYZDEF2(10), IF
     *ILE_CASE ,MAX_SUBST
      INTEGER MAX_CYCLE
      PARAMETER (MAX_CYCLE=20)
      INTEGER N_CYCLE, ITX_CYCLE(MAX_CYCLE)
      REAL SYM_CYCLE(MAX_CYCLE)
      EQUIVALENCE (NMESH1,NMESHN)
      EQUIVALENCE (MESH1,MESHN)
      INTEGER IBUFFR(400)
      REAL BUFFER(400)
      INTEGER NCHSAVE 
      PARAMETER (NCHSAVE=2*512) 
      INTEGER*4 ICHSAVE(NCHSAVE)
      INTEGER*4 IVRPTR(15)
      CHARACTER*512 OUTSTR,C_FILE, C_NAME, C_SELECT
      CHARACTER C_TIT_ESCAPE*1,C_TIT_SUBSTITUTE*2
      INTEGER N_FILE, N_NAME, N_SELECT
      CHARACTER*8 PXNAME
      CHARACTER*64 INPFMT
      LOGICAL LTDATA, OUTSID(4)
      COMMON /T2COM/ PXNAME, REDUCE, TITX, TITY ,XFRM12, XFRM13, XFRM1
     *4, XFRM23 ,XFRM24, XFRM34 ,XVARSX ,TITSIZ, GRDSYM, GRDSIZ, CIRS
     *IZ, ASIZE, AFLARE ,SMSZDF, ORAXES, EYEDIR, VUEDIR, VUECEN ,VERTC
     *L, EYESEP, SCRD, SCRZ, EYEDIS, EYEPNT ,XYPART, BARSIZ, TIKSIZ, XY
     *ZBAS, TTHETA ,TPHI, FRELBL, IPATRN, NPATRN, PATRN ,SCLPRM, WINDO
     *W, SCREEN, SYMBOL, NOSYMB ,FACTXY, LBLSIZ, SYMSIZ, XYZLIM, WORLD 
     *,RADRMX, RADRMN, RADAMN, RADANG, RADX0, RADY0, XUNUSD ,USRKBD, U
     *SRSCR, PLTFIL ,ITITDT, LENCRD ,INPFMT, GRDTYP, LINWID, LINCOL, L
     *INTEX, TITCON, ITCNTR ,IUNUSD, NXYZ1, NXYZ2 ,LBLCHR, NDIMNS, IBL
     *KTP, IDIMNS ,NMESH1, NMESH2, MESH1, MESH2, MESH3, NFIELD ,IFIELD
     *, NINCR ,IVARBL, IVRPTR ,LINEAR, NONLIN ,NPOINT, LETSET ,MXECH
     *O, LINES, MAXLNS ,AXANG, MESH2D, REDFAC, GRDTEX, OUTTEX, IAXTEX, 
     *TITEX, DSCAL ,OUTSTR, IPROP, IHTEX, IBLINK, IERASE, LABTEX, TICTE
     *X, NXYLIM, PATSZ ,MARGIN, PSCR, ITXPRI, ITXSEC, OREAL, OCPU, CSCR
     *D, OUTSID ,TITLIN, TITINX, TITZ, TITX1, TITY1, LTDATA, NPLOTS, RE
     *VLEV ,LBLFMT, IYEAR, IMONTH, IDAY, ISIGFG ,DATPTS, ERRPTS, DATXM
     *N, DATXMX, DATYMN, DATYMX, DATZMN, DATZMX ,DATSUM, ERRSUM, DATAVE
     *, ERRAVE, DATCEN, ERRCEN, DATSTD, ERRSTD ,NCSETS, NCCOL, NCROW, F
     *MARKER, H2STAT, TITFAC, TITLOC, TITMAR ,TIKFAC, IWINLEV, WINREL, 
     *WINABS, WINLIM ,ICPOIN, LEVREP, IREPCT, SYDIR, GRDIR, NMESH0, EXY
     *ZLIM, IVPTR ,TITLMX, NXYZDEF1, NXYZDEF2, IFILE_CASE, N_CYCLE, ITX
     *_CYCLE ,SYM_CYCLE, PLOT_EXTENT, FILL_ANGLE, FILL_WIDTH, FILL_TEX 
     *,FILL_INDEX ,N_LINES ,DSLOPE ,MAX_SUBST, BARBRK ,I_VORDER,SHADOW
     *TYP,SHADOWTEX
      COMMON /T2SCRT/ BUFFER, IBUFFR, N_FILE,N_NAME,N_SELECT, ICHSAVE
      COMMON /T2_CHAR/ C_TIT_ESCAPE,C_TIT_SUBSTITUTE
      COMMON /T2_SCRT/ C_FILE, C_NAME, C_SELECT
      INTEGER JOUFIL, ERRFIL, OUTFIL, DBGFIL, INPFIL, NINMAX
      PARAMETER (NINMAX=20)
      INTEGER NINP(NINMAX)
      COMMON /T2TRBK/NINP, JOUFIL, ERRFIL, OUTFIL, DBGFIL, INPFIL
      CHARACTER*512 STRNG, STJOU
      LOGICAL LTOKEN
      REAL FLOTNG
      INTEGER INTERP, KEYORD, NSTRNG, MAXSTR, NSTJOU, LSTJOU, NTOKEN
      INTEGER*4 INTEG
      COMMON /TOKENC/ INTERP, INTEG, FLOTNG, KEYORD, NSTRNG, MAXSTR, ST
     *RNG, NSTJOU, LSTJOU, STJOU, LTOKEN, NTOKEN
      REAL HNONE
      INTEGER LISTPT,NPTMAX,NDSETS
      REAL DATBUF(10248)
      COMMON /T2XPNT/ LISTPT,NPTMAX,NDSETS,DATBUF
      DATA HNONE /-666.666/
      IF (I .ge. 1 .and. I.lt.NMESH1) THEN
      T2XMSH=DATBUF(IVRPTR(8)+I*NMESH0)
      ELSE
      T2XMSH=HNONE
      ENDIF
      END
      REAL FUNCTION T2YMSH(I)
      COMMON /T2FLGC/ FLAGS(200), LTRAP,LHANDL,LSYERR,LSCREV
      LOGICAL FLAGS, LTRAP,LHANDL,LSYERR,LSCREV(3)
      INTEGER RELFLAG 
      PARAMETER (RELFLAG=151)
      INTEGER IWINLEV 
      INTEGER NWINLEV , MAX_FILL 
      PARAMETER (NWINLEV =4)
      PARAMETER (MAX_FILL=4)
      REAL GRDSYM, GRDSIZ, DATDAT(2,8), H2STAT(12), TITLIN(4), TITFA
     *C(4), TITLOC(4), TITMAR(4), TITLMX(4), TIKFAC, TITINX, TITX1, TIT
     *Y1, TITX, TITY, TITZ, TITSIZ, TITCON(5), REVLEV, REDUCE(5), XFR
     *M12(12), XFRM13(12), XFRM14(12), XFRM23(12), XFRM24(12), XFRM34(6
     *), XVARSX(20), CIRSIZ(2,3), ASIZE, AFLARE, SMSZDF, ORAXES(3), EY
     *EDIR(3), VUEDIR(3), VUECEN(3), VERTCL(3), EYESEP, SCRD, SCRZ, EYE
     *DIS, EYEPNT(3), XYPART(2, 2), BARSIZ(3), BARBRK(3), TIKSIZ(3), XY
     *ZBAS(3), TTHETA, TPHI, FRELBL(4), PATRN(20,30), SCLPRM(10,3), WI
     *NDOW(4), SCREEN(2), SYMBOL, NOSYMB, FACTXY(19), LBLSIZ, SYMSIZ, X
     *YZLIM(3,2), WORLD(3), RADRMX, RADRMN, RADAMN, RADANG, RADX0, RADY
     *0, XUNUSD(6), AXANG(3), REDFAC, DSCAL, PATSZ, MARGIN(4), PSCR(2
     *), OREAL, OCPU, CSCRD, DATPTS, ERRPTS, DATXMN, DATXMX, DATYMN, DA
     *TYMX, DATZMN, DATZMX, DATSUM, ERRSUM, DATAVE, ERRAVE, DATCEN, ERR
     *CEN, DATSTD, ERRSTD, WINREL(2,2,NWINLEV),WINABS(2,2,NWINLEV),WINL
     *IM(2,2), FMARKER(3,8), SYDIR(3), GRDIR(3), EXYZLIM(3,2), DSLOPE(2
     *,2)
      REAL PLOT_EXTENT(2,2),FILL_ANGLE(MAX_FILL),FILL_WIDTH(MAX_FILL)
      INTEGER FILL_INDEX, FILL_TEX(MAX_FILL), N_LINES(6)
      EQUIVALENCE (DATDAT, DATPTS)
      INTEGER MAXREP
      PARAMETER (MAXREP=5)
      INTEGER IPATRN, NPATRN(30), NXYLIM(3,2), NPLOTS, NCSETS, NCCOL, N
     *CROW, IYEAR, IMONTH, IDAY, ISIGFG, ITXPRI, ITXSEC, ITITDT(3), L
     *ENCRD, IPROP, IHTEX, IBLINK, IERASE, ITCNTR, IUNUSD, NXYZ1(3), 
     *NXYZ2(3), LBLFMT(3), LBLCHR(3), NDIMNS(3), IBLKTP, IDIMNS, NMES
     *H0, NMESH1, NMESH2, MESH1, MESH2, MESH3, MESH2D, MESHN(3), NMESHN(
     *2), NFIELD, IFIELD(19), NINCR, NPOINT, IVARBL(19), IVPTR(19), I_
     *VORDER(19,2), LINEAR(4), NONLIN(4), MXECHO, LINES, MAXLNS, USRK
     *BD, USRSCR, PLTFIL, LINWID, LINCOL, LINTEX, ICPOIN(3), IREPCT(MA
     *XREP), LEVREP, GRDTYP, GRDTEX, OUTTEX, IAXTEX, TITEX, LETSET, LAB
     *TEX, TICTEX, SHADOWTYP,SHADOWTEX, NXYZDEF1(10), NXYZDEF2(10), IF
     *ILE_CASE ,MAX_SUBST
      INTEGER MAX_CYCLE
      PARAMETER (MAX_CYCLE=20)
      INTEGER N_CYCLE, ITX_CYCLE(MAX_CYCLE)
      REAL SYM_CYCLE(MAX_CYCLE)
      EQUIVALENCE (NMESH1,NMESHN)
      EQUIVALENCE (MESH1,MESHN)
      INTEGER IBUFFR(400)
      REAL BUFFER(400)
      INTEGER NCHSAVE 
      PARAMETER (NCHSAVE=2*512) 
      INTEGER*4 ICHSAVE(NCHSAVE)
      INTEGER*4 IVRPTR(15)
      CHARACTER*512 OUTSTR,C_FILE, C_NAME, C_SELECT
      CHARACTER C_TIT_ESCAPE*1,C_TIT_SUBSTITUTE*2
      INTEGER N_FILE, N_NAME, N_SELECT
      CHARACTER*8 PXNAME
      CHARACTER*64 INPFMT
      LOGICAL LTDATA, OUTSID(4)
      COMMON /T2COM/ PXNAME, REDUCE, TITX, TITY ,XFRM12, XFRM13, XFRM1
     *4, XFRM23 ,XFRM24, XFRM34 ,XVARSX ,TITSIZ, GRDSYM, GRDSIZ, CIRS
     *IZ, ASIZE, AFLARE ,SMSZDF, ORAXES, EYEDIR, VUEDIR, VUECEN ,VERTC
     *L, EYESEP, SCRD, SCRZ, EYEDIS, EYEPNT ,XYPART, BARSIZ, TIKSIZ, XY
     *ZBAS, TTHETA ,TPHI, FRELBL, IPATRN, NPATRN, PATRN ,SCLPRM, WINDO
     *W, SCREEN, SYMBOL, NOSYMB ,FACTXY, LBLSIZ, SYMSIZ, XYZLIM, WORLD 
     *,RADRMX, RADRMN, RADAMN, RADANG, RADX0, RADY0, XUNUSD ,USRKBD, U
     *SRSCR, PLTFIL ,ITITDT, LENCRD ,INPFMT, GRDTYP, LINWID, LINCOL, L
     *INTEX, TITCON, ITCNTR ,IUNUSD, NXYZ1, NXYZ2 ,LBLCHR, NDIMNS, IBL
     *KTP, IDIMNS ,NMESH1, NMESH2, MESH1, MESH2, MESH3, NFIELD ,IFIELD
     *, NINCR ,IVARBL, IVRPTR ,LINEAR, NONLIN ,NPOINT, LETSET ,MXECH
     *O, LINES, MAXLNS ,AXANG, MESH2D, REDFAC, GRDTEX, OUTTEX, IAXTEX, 
     *TITEX, DSCAL ,OUTSTR, IPROP, IHTEX, IBLINK, IERASE, LABTEX, TICTE
     *X, NXYLIM, PATSZ ,MARGIN, PSCR, ITXPRI, ITXSEC, OREAL, OCPU, CSCR
     *D, OUTSID ,TITLIN, TITINX, TITZ, TITX1, TITY1, LTDATA, NPLOTS, RE
     *VLEV ,LBLFMT, IYEAR, IMONTH, IDAY, ISIGFG ,DATPTS, ERRPTS, DATXM
     *N, DATXMX, DATYMN, DATYMX, DATZMN, DATZMX ,DATSUM, ERRSUM, DATAVE
     *, ERRAVE, DATCEN, ERRCEN, DATSTD, ERRSTD ,NCSETS, NCCOL, NCROW, F
     *MARKER, H2STAT, TITFAC, TITLOC, TITMAR ,TIKFAC, IWINLEV, WINREL, 
     *WINABS, WINLIM ,ICPOIN, LEVREP, IREPCT, SYDIR, GRDIR, NMESH0, EXY
     *ZLIM, IVPTR ,TITLMX, NXYZDEF1, NXYZDEF2, IFILE_CASE, N_CYCLE, ITX
     *_CYCLE ,SYM_CYCLE, PLOT_EXTENT, FILL_ANGLE, FILL_WIDTH, FILL_TEX 
     *,FILL_INDEX ,N_LINES ,DSLOPE ,MAX_SUBST, BARBRK ,I_VORDER,SHADOW
     *TYP,SHADOWTEX
      COMMON /T2SCRT/ BUFFER, IBUFFR, N_FILE,N_NAME,N_SELECT, ICHSAVE
      COMMON /T2_CHAR/ C_TIT_ESCAPE,C_TIT_SUBSTITUTE
      COMMON /T2_SCRT/ C_FILE, C_NAME, C_SELECT
      INTEGER JOUFIL, ERRFIL, OUTFIL, DBGFIL, INPFIL, NINMAX
      PARAMETER (NINMAX=20)
      INTEGER NINP(NINMAX)
      COMMON /T2TRBK/NINP, JOUFIL, ERRFIL, OUTFIL, DBGFIL, INPFIL
      CHARACTER*512 STRNG, STJOU
      LOGICAL LTOKEN
      REAL FLOTNG
      INTEGER INTERP, KEYORD, NSTRNG, MAXSTR, NSTJOU, LSTJOU, NTOKEN
      INTEGER*4 INTEG
      COMMON /TOKENC/ INTERP, INTEG, FLOTNG, KEYORD, NSTRNG, MAXSTR, ST
     *RNG, NSTJOU, LSTJOU, STJOU, LTOKEN, NTOKEN
      REAL HNONE
      INTEGER LISTPT,NPTMAX,NDSETS
      REAL DATBUF(10248)
      COMMON /T2XPNT/ LISTPT,NPTMAX,NDSETS,DATBUF
      DATA HNONE /-666.666/
      IF (I .ge. 1 .and. I.lt.NMESH2) THEN
      T2YMSH=DATBUF(IVRPTR(8)+I*NMESH0*NMESH1)
      ELSE
      T2YMSH=HNONE
      ENDIF
      END
      REAL FUNCTION T2ZMSH(IX,IY)
      COMMON /T2FLGC/ FLAGS(200), LTRAP,LHANDL,LSYERR,LSCREV
      LOGICAL FLAGS, LTRAP,LHANDL,LSYERR,LSCREV(3)
      INTEGER RELFLAG 
      PARAMETER (RELFLAG=151)
      INTEGER IWINLEV 
      INTEGER NWINLEV , MAX_FILL 
      PARAMETER (NWINLEV =4)
      PARAMETER (MAX_FILL=4)
      REAL GRDSYM, GRDSIZ, DATDAT(2,8), H2STAT(12), TITLIN(4), TITFA
     *C(4), TITLOC(4), TITMAR(4), TITLMX(4), TIKFAC, TITINX, TITX1, TIT
     *Y1, TITX, TITY, TITZ, TITSIZ, TITCON(5), REVLEV, REDUCE(5), XFR
     *M12(12), XFRM13(12), XFRM14(12), XFRM23(12), XFRM24(12), XFRM34(6
     *), XVARSX(20), CIRSIZ(2,3), ASIZE, AFLARE, SMSZDF, ORAXES(3), EY
     *EDIR(3), VUEDIR(3), VUECEN(3), VERTCL(3), EYESEP, SCRD, SCRZ, EYE
     *DIS, EYEPNT(3), XYPART(2, 2), BARSIZ(3), BARBRK(3), TIKSIZ(3), XY
     *ZBAS(3), TTHETA, TPHI, FRELBL(4), PATRN(20,30), SCLPRM(10,3), WI
     *NDOW(4), SCREEN(2), SYMBOL, NOSYMB, FACTXY(19), LBLSIZ, SYMSIZ, X
     *YZLIM(3,2), WORLD(3), RADRMX, RADRMN, RADAMN, RADANG, RADX0, RADY
     *0, XUNUSD(6), AXANG(3), REDFAC, DSCAL, PATSZ, MARGIN(4), PSCR(2
     *), OREAL, OCPU, CSCRD, DATPTS, ERRPTS, DATXMN, DATXMX, DATYMN, DA
     *TYMX, DATZMN, DATZMX, DATSUM, ERRSUM, DATAVE, ERRAVE, DATCEN, ERR
     *CEN, DATSTD, ERRSTD, WINREL(2,2,NWINLEV),WINABS(2,2,NWINLEV),WINL
     *IM(2,2), FMARKER(3,8), SYDIR(3), GRDIR(3), EXYZLIM(3,2), DSLOPE(2
     *,2)
      REAL PLOT_EXTENT(2,2),FILL_ANGLE(MAX_FILL),FILL_WIDTH(MAX_FILL)
      INTEGER FILL_INDEX, FILL_TEX(MAX_FILL), N_LINES(6)
      EQUIVALENCE (DATDAT, DATPTS)
      INTEGER MAXREP
      PARAMETER (MAXREP=5)
      INTEGER IPATRN, NPATRN(30), NXYLIM(3,2), NPLOTS, NCSETS, NCCOL, N
     *CROW, IYEAR, IMONTH, IDAY, ISIGFG, ITXPRI, ITXSEC, ITITDT(3), L
     *ENCRD, IPROP, IHTEX, IBLINK, IERASE, ITCNTR, IUNUSD, NXYZ1(3), 
     *NXYZ2(3), LBLFMT(3), LBLCHR(3), NDIMNS(3), IBLKTP, IDIMNS, NMES
     *H0, NMESH1, NMESH2, MESH1, MESH2, MESH3, MESH2D, MESHN(3), NMESHN(
     *2), NFIELD, IFIELD(19), NINCR, NPOINT, IVARBL(19), IVPTR(19), I_
     *VORDER(19,2), LINEAR(4), NONLIN(4), MXECHO, LINES, MAXLNS, USRK
     *BD, USRSCR, PLTFIL, LINWID, LINCOL, LINTEX, ICPOIN(3), IREPCT(MA
     *XREP), LEVREP, GRDTYP, GRDTEX, OUTTEX, IAXTEX, TITEX, LETSET, LAB
     *TEX, TICTEX, SHADOWTYP,SHADOWTEX, NXYZDEF1(10), NXYZDEF2(10), IF
     *ILE_CASE ,MAX_SUBST
      INTEGER MAX_CYCLE
      PARAMETER (MAX_CYCLE=20)
      INTEGER N_CYCLE, ITX_CYCLE(MAX_CYCLE)
      REAL SYM_CYCLE(MAX_CYCLE)
      EQUIVALENCE (NMESH1,NMESHN)
      EQUIVALENCE (MESH1,MESHN)
      INTEGER IBUFFR(400)
      REAL BUFFER(400)
      INTEGER NCHSAVE 
      PARAMETER (NCHSAVE=2*512) 
      INTEGER*4 ICHSAVE(NCHSAVE)
      INTEGER*4 IVRPTR(15)
      CHARACTER*512 OUTSTR,C_FILE, C_NAME, C_SELECT
      CHARACTER C_TIT_ESCAPE*1,C_TIT_SUBSTITUTE*2
      INTEGER N_FILE, N_NAME, N_SELECT
      CHARACTER*8 PXNAME
      CHARACTER*64 INPFMT
      LOGICAL LTDATA, OUTSID(4)
      COMMON /T2COM/ PXNAME, REDUCE, TITX, TITY ,XFRM12, XFRM13, XFRM1
     *4, XFRM23 ,XFRM24, XFRM34 ,XVARSX ,TITSIZ, GRDSYM, GRDSIZ, CIRS
     *IZ, ASIZE, AFLARE ,SMSZDF, ORAXES, EYEDIR, VUEDIR, VUECEN ,VERTC
     *L, EYESEP, SCRD, SCRZ, EYEDIS, EYEPNT ,XYPART, BARSIZ, TIKSIZ, XY
     *ZBAS, TTHETA ,TPHI, FRELBL, IPATRN, NPATRN, PATRN ,SCLPRM, WINDO
     *W, SCREEN, SYMBOL, NOSYMB ,FACTXY, LBLSIZ, SYMSIZ, XYZLIM, WORLD 
     *,RADRMX, RADRMN, RADAMN, RADANG, RADX0, RADY0, XUNUSD ,USRKBD, U
     *SRSCR, PLTFIL ,ITITDT, LENCRD ,INPFMT, GRDTYP, LINWID, LINCOL, L
     *INTEX, TITCON, ITCNTR ,IUNUSD, NXYZ1, NXYZ2 ,LBLCHR, NDIMNS, IBL
     *KTP, IDIMNS ,NMESH1, NMESH2, MESH1, MESH2, MESH3, NFIELD ,IFIELD
     *, NINCR ,IVARBL, IVRPTR ,LINEAR, NONLIN ,NPOINT, LETSET ,MXECH
     *O, LINES, MAXLNS ,AXANG, MESH2D, REDFAC, GRDTEX, OUTTEX, IAXTEX, 
     *TITEX, DSCAL ,OUTSTR, IPROP, IHTEX, IBLINK, IERASE, LABTEX, TICTE
     *X, NXYLIM, PATSZ ,MARGIN, PSCR, ITXPRI, ITXSEC, OREAL, OCPU, CSCR
     *D, OUTSID ,TITLIN, TITINX, TITZ, TITX1, TITY1, LTDATA, NPLOTS, RE
     *VLEV ,LBLFMT, IYEAR, IMONTH, IDAY, ISIGFG ,DATPTS, ERRPTS, DATXM
     *N, DATXMX, DATYMN, DATYMX, DATZMN, DATZMX ,DATSUM, ERRSUM, DATAVE
     *, ERRAVE, DATCEN, ERRCEN, DATSTD, ERRSTD ,NCSETS, NCCOL, NCROW, F
     *MARKER, H2STAT, TITFAC, TITLOC, TITMAR ,TIKFAC, IWINLEV, WINREL, 
     *WINABS, WINLIM ,ICPOIN, LEVREP, IREPCT, SYDIR, GRDIR, NMESH0, EXY
     *ZLIM, IVPTR ,TITLMX, NXYZDEF1, NXYZDEF2, IFILE_CASE, N_CYCLE, ITX
     *_CYCLE ,SYM_CYCLE, PLOT_EXTENT, FILL_ANGLE, FILL_WIDTH, FILL_TEX 
     *,FILL_INDEX ,N_LINES ,DSLOPE ,MAX_SUBST, BARBRK ,I_VORDER,SHADOW
     *TYP,SHADOWTEX
      COMMON /T2SCRT/ BUFFER, IBUFFR, N_FILE,N_NAME,N_SELECT, ICHSAVE
      COMMON /T2_CHAR/ C_TIT_ESCAPE,C_TIT_SUBSTITUTE
      COMMON /T2_SCRT/ C_FILE, C_NAME, C_SELECT
      INTEGER JOUFIL, ERRFIL, OUTFIL, DBGFIL, INPFIL, NINMAX
      PARAMETER (NINMAX=20)
      INTEGER NINP(NINMAX)
      COMMON /T2TRBK/NINP, JOUFIL, ERRFIL, OUTFIL, DBGFIL, INPFIL
      CHARACTER*512 STRNG, STJOU
      LOGICAL LTOKEN
      REAL FLOTNG
      INTEGER INTERP, KEYORD, NSTRNG, MAXSTR, NSTJOU, LSTJOU, NTOKEN
      INTEGER*4 INTEG
      COMMON /TOKENC/ INTERP, INTEG, FLOTNG, KEYORD, NSTRNG, MAXSTR, ST
     *RNG, NSTJOU, LSTJOU, STJOU, LTOKEN, NTOKEN
      REAL HNONE
      INTEGER LISTPT,NPTMAX,NDSETS
      REAL DATBUF(10248)
      COMMON /T2XPNT/ LISTPT,NPTMAX,NDSETS,DATBUF
      DATA HNONE /-666.666/
      IF (IX .ge. 1 .and. IX.lt.NMESH1 .and. IY .ge. 1 .and. IY.lt.NMESH
     *2) THEN
      T2ZMSH=DATBUF(IVRPTR(8)+(IX+IY*NMESH1)*NMESH0)
      ELSE
      T2ZMSH=HNONE
      ENDIF
      END
      SUBROUTINE T23SMS(NSET)
      IMPLICIT NONE
      COMMON /T2FLGC/ FLAGS(200), LTRAP,LHANDL,LSYERR,LSCREV
      LOGICAL FLAGS, LTRAP,LHANDL,LSYERR,LSCREV(3)
      INTEGER RELFLAG 
      PARAMETER (RELFLAG=151)
      INTEGER IWINLEV 
      INTEGER NWINLEV , MAX_FILL 
      PARAMETER (NWINLEV =4)
      PARAMETER (MAX_FILL=4)
      REAL GRDSYM, GRDSIZ, DATDAT(2,8), H2STAT(12), TITLIN(4), TITFA
     *C(4), TITLOC(4), TITMAR(4), TITLMX(4), TIKFAC, TITINX, TITX1, TIT
     *Y1, TITX, TITY, TITZ, TITSIZ, TITCON(5), REVLEV, REDUCE(5), XFR
     *M12(12), XFRM13(12), XFRM14(12), XFRM23(12), XFRM24(12), XFRM34(6
     *), XVARSX(20), CIRSIZ(2,3), ASIZE, AFLARE, SMSZDF, ORAXES(3), EY
     *EDIR(3), VUEDIR(3), VUECEN(3), VERTCL(3), EYESEP, SCRD, SCRZ, EYE
     *DIS, EYEPNT(3), XYPART(2, 2), BARSIZ(3), BARBRK(3), TIKSIZ(3), XY
     *ZBAS(3), TTHETA, TPHI, FRELBL(4), PATRN(20,30), SCLPRM(10,3), WI
     *NDOW(4), SCREEN(2), SYMBOL, NOSYMB, FACTXY(19), LBLSIZ, SYMSIZ, X
     *YZLIM(3,2), WORLD(3), RADRMX, RADRMN, RADAMN, RADANG, RADX0, RADY
     *0, XUNUSD(6), AXANG(3), REDFAC, DSCAL, PATSZ, MARGIN(4), PSCR(2
     *), OREAL, OCPU, CSCRD, DATPTS, ERRPTS, DATXMN, DATXMX, DATYMN, DA
     *TYMX, DATZMN, DATZMX, DATSUM, ERRSUM, DATAVE, ERRAVE, DATCEN, ERR
     *CEN, DATSTD, ERRSTD, WINREL(2,2,NWINLEV),WINABS(2,2,NWINLEV),WINL
     *IM(2,2), FMARKER(3,8), SYDIR(3), GRDIR(3), EXYZLIM(3,2), DSLOPE(2
     *,2)
      REAL PLOT_EXTENT(2,2),FILL_ANGLE(MAX_FILL),FILL_WIDTH(MAX_FILL)
      INTEGER FILL_INDEX, FILL_TEX(MAX_FILL), N_LINES(6)
      EQUIVALENCE (DATDAT, DATPTS)
      INTEGER MAXREP
      PARAMETER (MAXREP=5)
      INTEGER IPATRN, NPATRN(30), NXYLIM(3,2), NPLOTS, NCSETS, NCCOL, N
     *CROW, IYEAR, IMONTH, IDAY, ISIGFG, ITXPRI, ITXSEC, ITITDT(3), L
     *ENCRD, IPROP, IHTEX, IBLINK, IERASE, ITCNTR, IUNUSD, NXYZ1(3), 
     *NXYZ2(3), LBLFMT(3), LBLCHR(3), NDIMNS(3), IBLKTP, IDIMNS, NMES
     *H0, NMESH1, NMESH2, MESH1, MESH2, MESH3, MESH2D, MESHN(3), NMESHN(
     *2), NFIELD, IFIELD(19), NINCR, NPOINT, IVARBL(19), IVPTR(19), I_
     *VORDER(19,2), LINEAR(4), NONLIN(4), MXECHO, LINES, MAXLNS, USRK
     *BD, USRSCR, PLTFIL, LINWID, LINCOL, LINTEX, ICPOIN(3), IREPCT(MA
     *XREP), LEVREP, GRDTYP, GRDTEX, OUTTEX, IAXTEX, TITEX, LETSET, LAB
     *TEX, TICTEX, SHADOWTYP,SHADOWTEX, NXYZDEF1(10), NXYZDEF2(10), IF
     *ILE_CASE ,MAX_SUBST
      INTEGER MAX_CYCLE
      PARAMETER (MAX_CYCLE=20)
      INTEGER N_CYCLE, ITX_CYCLE(MAX_CYCLE)
      REAL SYM_CYCLE(MAX_CYCLE)
      EQUIVALENCE (NMESH1,NMESHN)
      EQUIVALENCE (MESH1,MESHN)
      INTEGER IBUFFR(400)
      REAL BUFFER(400)
      INTEGER NCHSAVE 
      PARAMETER (NCHSAVE=2*512) 
      INTEGER*4 ICHSAVE(NCHSAVE)
      INTEGER*4 IVRPTR(15)
      CHARACTER*512 OUTSTR,C_FILE, C_NAME, C_SELECT
      CHARACTER C_TIT_ESCAPE*1,C_TIT_SUBSTITUTE*2
      INTEGER N_FILE, N_NAME, N_SELECT
      CHARACTER*8 PXNAME
      CHARACTER*64 INPFMT
      LOGICAL LTDATA, OUTSID(4)
      COMMON /T2COM/ PXNAME, REDUCE, TITX, TITY ,XFRM12, XFRM13, XFRM1
     *4, XFRM23 ,XFRM24, XFRM34 ,XVARSX ,TITSIZ, GRDSYM, GRDSIZ, CIRS
     *IZ, ASIZE, AFLARE ,SMSZDF, ORAXES, EYEDIR, VUEDIR, VUECEN ,VERTC
     *L, EYESEP, SCRD, SCRZ, EYEDIS, EYEPNT ,XYPART, BARSIZ, TIKSIZ, XY
     *ZBAS, TTHETA ,TPHI, FRELBL, IPATRN, NPATRN, PATRN ,SCLPRM, WINDO
     *W, SCREEN, SYMBOL, NOSYMB ,FACTXY, LBLSIZ, SYMSIZ, XYZLIM, WORLD 
     *,RADRMX, RADRMN, RADAMN, RADANG, RADX0, RADY0, XUNUSD ,USRKBD, U
     *SRSCR, PLTFIL ,ITITDT, LENCRD ,INPFMT, GRDTYP, LINWID, LINCOL, L
     *INTEX, TITCON, ITCNTR ,IUNUSD, NXYZ1, NXYZ2 ,LBLCHR, NDIMNS, IBL
     *KTP, IDIMNS ,NMESH1, NMESH2, MESH1, MESH2, MESH3, NFIELD ,IFIELD
     *, NINCR ,IVARBL, IVRPTR ,LINEAR, NONLIN ,NPOINT, LETSET ,MXECH
     *O, LINES, MAXLNS ,AXANG, MESH2D, REDFAC, GRDTEX, OUTTEX, IAXTEX, 
     *TITEX, DSCAL ,OUTSTR, IPROP, IHTEX, IBLINK, IERASE, LABTEX, TICTE
     *X, NXYLIM, PATSZ ,MARGIN, PSCR, ITXPRI, ITXSEC, OREAL, OCPU, CSCR
     *D, OUTSID ,TITLIN, TITINX, TITZ, TITX1, TITY1, LTDATA, NPLOTS, RE
     *VLEV ,LBLFMT, IYEAR, IMONTH, IDAY, ISIGFG ,DATPTS, ERRPTS, DATXM
     *N, DATXMX, DATYMN, DATYMX, DATZMN, DATZMX ,DATSUM, ERRSUM, DATAVE
     *, ERRAVE, DATCEN, ERRCEN, DATSTD, ERRSTD ,NCSETS, NCCOL, NCROW, F
     *MARKER, H2STAT, TITFAC, TITLOC, TITMAR ,TIKFAC, IWINLEV, WINREL, 
     *WINABS, WINLIM ,ICPOIN, LEVREP, IREPCT, SYDIR, GRDIR, NMESH0, EXY
     *ZLIM, IVPTR ,TITLMX, NXYZDEF1, NXYZDEF2, IFILE_CASE, N_CYCLE, ITX
     *_CYCLE ,SYM_CYCLE, PLOT_EXTENT, FILL_ANGLE, FILL_WIDTH, FILL_TEX 
     *,FILL_INDEX ,N_LINES ,DSLOPE ,MAX_SUBST, BARBRK ,I_VORDER,SHADOW
     *TYP,SHADOWTEX
      COMMON /T2SCRT/ BUFFER, IBUFFR, N_FILE,N_NAME,N_SELECT, ICHSAVE
      COMMON /T2_CHAR/ C_TIT_ESCAPE,C_TIT_SUBSTITUTE
      COMMON /T2_SCRT/ C_FILE, C_NAME, C_SELECT
      INTEGER JOUFIL, ERRFIL, OUTFIL, DBGFIL, INPFIL, NINMAX
      PARAMETER (NINMAX=20)
      INTEGER NINP(NINMAX)
      COMMON /T2TRBK/NINP, JOUFIL, ERRFIL, OUTFIL, DBGFIL, INPFIL
      CHARACTER*512 STRNG, STJOU
      LOGICAL LTOKEN
      REAL FLOTNG
      INTEGER INTERP, KEYORD, NSTRNG, MAXSTR, NSTJOU, LSTJOU, NTOKEN
      INTEGER*4 INTEG
      COMMON /TOKENC/ INTERP, INTEG, FLOTNG, KEYORD, NSTRNG, MAXSTR, ST
     *RNG, NSTJOU, LSTJOU, STJOU, LTOKEN, NTOKEN
      REAL HNONE
      INTEGER NSET,I
      DATA HNONE /-666.666/
      I=NSET
      IF (I.lt.6.or.I.gt.14.or.MOD(I,4).eq.0)I=1+2*4
      MESHN(2)=I/4
      MESHN(1)=MOD(I,4)
      MESHN(3)=6-MESHN(1)-MESHN(2)
      END
      SUBROUTINE T23TLM(ARRAY,NDIM0,NDIM1,NDIM2,TLIM,N1,N2,N3,N4)
      IMPLICIT NONE
      REAL HNONE
      INTEGER I,IM,NDIM0,NDIM1,NDIM2,N1,N2,N3,N4,MM(3)
      REAL ARRAY(NDIM0,NDIM1,NDIM2+1)
      REAL T,TLIM(3,2),T2MSHX,T2MSHY,XBEG,XEND,XMIN,XMAX
      DATA HNONE /-666.666/
      I=NINT(ARRAY(1,1,1))
      IF (I.lt.6.or.I.gt.14.or.MOD(I,4).eq.0)I=1+2*4
      MM(2)=I/4
      MM(1)=MOD(I,4)
      MM(3)=6-MM(1)-MM(2)
      IF (N1.eq.0) N1=1
      IF (N2.eq.0) N2=NDIM1-1
      IF (N3.eq.0) N3=1
      IF (N4.eq.0) N4=NDIM2-1
      IF (TLIM(1,1).eq.HNONE) RETURN
      XBEG=T2MSHX(ARRAY,NDIM0,NDIM1,NDIM2,0)
      XEND=T2MSHX(ARRAY,NDIM0,NDIM1,NDIM2,NDIM1)
      XMIN=TLIM(MM(1),1)
      XMAX=TLIM(MM(1),2)
      T=SIGN(1.0,XEND-XBEG)
      N1=1
      N2=NDIM1-1
      T=SIGN(1.0,XEND-XBEG)
      IF ((XMIN-XBEG)*T.ge.0 .and. (XMIN-XEND)*T.ge.0) N1=NDIM1
      IF ((XMAX-XBEG)*T.le.0 .and. (XMAX-XEND)*T.le.0) N2=1
      DO 10011 I=1,NDIM1
      XEND=T2MSHX(ARRAY,NDIM0,NDIM1,NDIM2,I+1)
      IF ((XMIN-XBEG)*T.ge.0 .and. (XMIN-XEND)*T.lt.0)N1=I
      IF ((XMAX-XBEG)*T.gt.0 .and. (XMAX-XEND)*T.le.0)N2=I
      XBEG=XEND
10011 CONTINUE
10012 CONTINUE
      XBEG=T2MSHY(ARRAY,NDIM0,NDIM1,NDIM2,0)
      XEND=T2MSHY(ARRAY,NDIM0,NDIM1,NDIM2,NDIM2)
      XMIN=TLIM(MM(2),1)
      XMAX=TLIM(MM(2),2)
      T=SIGN(1.0,XEND-XBEG)
      N3=1
      N4=NDIM2-1
      T=SIGN(1.0,XEND-XBEG)
      IF ((XMIN-XBEG)*T.ge.0 .and. (XMIN-XEND)*T.ge.0) N3=NDIM2
      IF ((XMAX-XBEG)*T.le.0 .and. (XMAX-XEND)*T.le.0) N4=1
      DO 10021 I=1,NDIM2
      XEND=T2MSHY(ARRAY,NDIM0,NDIM1,NDIM2,I+1)
      IF ((XMIN-XBEG)*T.ge.0 .and. (XMIN-XEND)*T.lt.0)N3=I
      IF ((XMAX-XBEG)*T.gt.0 .and. (XMAX-XEND)*T.le.0)N4=I
      XBEG=XEND
10021 CONTINUE
10022 CONTINUE
      END
      SUBROUTINE T23LIM(ARRAY,NDIM0,NDIM1,NDIM2)
      IMPLICIT NONE
      INTEGER NDIM0,NDIM1,NDIM2
      REAL ARRAY(NDIM0,NDIM1,NDIM2+1)
      LOGICAL LFLAG(2)
      INTEGER IFLAG(2)
      INTEGER I,I1,I2,IXYZ,IXXXXX,J,MM(3),NM(3),NLIM(3,2)
      INTEGER IZFLAG
      REAL EXTREM(2),T,T2MSHX,T2MSHY
      COMMON /T2FLGC/ FLAGS(200), LTRAP,LHANDL,LSYERR,LSCREV
      LOGICAL FLAGS, LTRAP,LHANDL,LSYERR,LSCREV(3)
      INTEGER RELFLAG 
      PARAMETER (RELFLAG=151)
      INTEGER IWINLEV 
      INTEGER NWINLEV , MAX_FILL 
      PARAMETER (NWINLEV =4)
      PARAMETER (MAX_FILL=4)
      REAL GRDSYM, GRDSIZ, DATDAT(2,8), H2STAT(12), TITLIN(4), TITFA
     *C(4), TITLOC(4), TITMAR(4), TITLMX(4), TIKFAC, TITINX, TITX1, TIT
     *Y1, TITX, TITY, TITZ, TITSIZ, TITCON(5), REVLEV, REDUCE(5), XFR
     *M12(12), XFRM13(12), XFRM14(12), XFRM23(12), XFRM24(12), XFRM34(6
     *), XVARSX(20), CIRSIZ(2,3), ASIZE, AFLARE, SMSZDF, ORAXES(3), EY
     *EDIR(3), VUEDIR(3), VUECEN(3), VERTCL(3), EYESEP, SCRD, SCRZ, EYE
     *DIS, EYEPNT(3), XYPART(2, 2), BARSIZ(3), BARBRK(3), TIKSIZ(3), XY
     *ZBAS(3), TTHETA, TPHI, FRELBL(4), PATRN(20,30), SCLPRM(10,3), WI
     *NDOW(4), SCREEN(2), SYMBOL, NOSYMB, FACTXY(19), LBLSIZ, SYMSIZ, X
     *YZLIM(3,2), WORLD(3), RADRMX, RADRMN, RADAMN, RADANG, RADX0, RADY
     *0, XUNUSD(6), AXANG(3), REDFAC, DSCAL, PATSZ, MARGIN(4), PSCR(2
     *), OREAL, OCPU, CSCRD, DATPTS, ERRPTS, DATXMN, DATXMX, DATYMN, DA
     *TYMX, DATZMN, DATZMX, DATSUM, ERRSUM, DATAVE, ERRAVE, DATCEN, ERR
     *CEN, DATSTD, ERRSTD, WINREL(2,2,NWINLEV),WINABS(2,2,NWINLEV),WINL
     *IM(2,2), FMARKER(3,8), SYDIR(3), GRDIR(3), EXYZLIM(3,2), DSLOPE(2
     *,2)
      REAL PLOT_EXTENT(2,2),FILL_ANGLE(MAX_FILL),FILL_WIDTH(MAX_FILL)
      INTEGER FILL_INDEX, FILL_TEX(MAX_FILL), N_LINES(6)
      EQUIVALENCE (DATDAT, DATPTS)
      INTEGER MAXREP
      PARAMETER (MAXREP=5)
      INTEGER IPATRN, NPATRN(30), NXYLIM(3,2), NPLOTS, NCSETS, NCCOL, N
     *CROW, IYEAR, IMONTH, IDAY, ISIGFG, ITXPRI, ITXSEC, ITITDT(3), L
     *ENCRD, IPROP, IHTEX, IBLINK, IERASE, ITCNTR, IUNUSD, NXYZ1(3), 
     *NXYZ2(3), LBLFMT(3), LBLCHR(3), NDIMNS(3), IBLKTP, IDIMNS, NMES
     *H0, NMESH1, NMESH2, MESH1, MESH2, MESH3, MESH2D, MESHN(3), NMESHN(
     *2), NFIELD, IFIELD(19), NINCR, NPOINT, IVARBL(19), IVPTR(19), I_
     *VORDER(19,2), LINEAR(4), NONLIN(4), MXECHO, LINES, MAXLNS, USRK
     *BD, USRSCR, PLTFIL, LINWID, LINCOL, LINTEX, ICPOIN(3), IREPCT(MA
     *XREP), LEVREP, GRDTYP, GRDTEX, OUTTEX, IAXTEX, TITEX, LETSET, LAB
     *TEX, TICTEX, SHADOWTYP,SHADOWTEX, NXYZDEF1(10), NXYZDEF2(10), IF
     *ILE_CASE ,MAX_SUBST
      INTEGER MAX_CYCLE
      PARAMETER (MAX_CYCLE=20)
      INTEGER N_CYCLE, ITX_CYCLE(MAX_CYCLE)
      REAL SYM_CYCLE(MAX_CYCLE)
      EQUIVALENCE (NMESH1,NMESHN)
      EQUIVALENCE (MESH1,MESHN)
      INTEGER IBUFFR(400)
      REAL BUFFER(400)
      INTEGER NCHSAVE 
      PARAMETER (NCHSAVE=2*512) 
      INTEGER*4 ICHSAVE(NCHSAVE)
      INTEGER*4 IVRPTR(15)
      CHARACTER*512 OUTSTR,C_FILE, C_NAME, C_SELECT
      CHARACTER C_TIT_ESCAPE*1,C_TIT_SUBSTITUTE*2
      INTEGER N_FILE, N_NAME, N_SELECT
      CHARACTER*8 PXNAME
      CHARACTER*64 INPFMT
      LOGICAL LTDATA, OUTSID(4)
      COMMON /T2COM/ PXNAME, REDUCE, TITX, TITY ,XFRM12, XFRM13, XFRM1
     *4, XFRM23 ,XFRM24, XFRM34 ,XVARSX ,TITSIZ, GRDSYM, GRDSIZ, CIRS
     *IZ, ASIZE, AFLARE ,SMSZDF, ORAXES, EYEDIR, VUEDIR, VUECEN ,VERTC
     *L, EYESEP, SCRD, SCRZ, EYEDIS, EYEPNT ,XYPART, BARSIZ, TIKSIZ, XY
     *ZBAS, TTHETA ,TPHI, FRELBL, IPATRN, NPATRN, PATRN ,SCLPRM, WINDO
     *W, SCREEN, SYMBOL, NOSYMB ,FACTXY, LBLSIZ, SYMSIZ, XYZLIM, WORLD 
     *,RADRMX, RADRMN, RADAMN, RADANG, RADX0, RADY0, XUNUSD ,USRKBD, U
     *SRSCR, PLTFIL ,ITITDT, LENCRD ,INPFMT, GRDTYP, LINWID, LINCOL, L
     *INTEX, TITCON, ITCNTR ,IUNUSD, NXYZ1, NXYZ2 ,LBLCHR, NDIMNS, IBL
     *KTP, IDIMNS ,NMESH1, NMESH2, MESH1, MESH2, MESH3, NFIELD ,IFIELD
     *, NINCR ,IVARBL, IVRPTR ,LINEAR, NONLIN ,NPOINT, LETSET ,MXECH
     *O, LINES, MAXLNS ,AXANG, MESH2D, REDFAC, GRDTEX, OUTTEX, IAXTEX, 
     *TITEX, DSCAL ,OUTSTR, IPROP, IHTEX, IBLINK, IERASE, LABTEX, TICTE
     *X, NXYLIM, PATSZ ,MARGIN, PSCR, ITXPRI, ITXSEC, OREAL, OCPU, CSCR
     *D, OUTSID ,TITLIN, TITINX, TITZ, TITX1, TITY1, LTDATA, NPLOTS, RE
     *VLEV ,LBLFMT, IYEAR, IMONTH, IDAY, ISIGFG ,DATPTS, ERRPTS, DATXM
     *N, DATXMX, DATYMN, DATYMX, DATZMN, DATZMX ,DATSUM, ERRSUM, DATAVE
     *, ERRAVE, DATCEN, ERRCEN, DATSTD, ERRSTD ,NCSETS, NCCOL, NCROW, F
     *MARKER, H2STAT, TITFAC, TITLOC, TITMAR ,TIKFAC, IWINLEV, WINREL, 
     *WINABS, WINLIM ,ICPOIN, LEVREP, IREPCT, SYDIR, GRDIR, NMESH0, EXY
     *ZLIM, IVPTR ,TITLMX, NXYZDEF1, NXYZDEF2, IFILE_CASE, N_CYCLE, ITX
     *_CYCLE ,SYM_CYCLE, PLOT_EXTENT, FILL_ANGLE, FILL_WIDTH, FILL_TEX 
     *,FILL_INDEX ,N_LINES ,DSLOPE ,MAX_SUBST, BARBRK ,I_VORDER,SHADOW
     *TYP,SHADOWTEX
      COMMON /T2SCRT/ BUFFER, IBUFFR, N_FILE,N_NAME,N_SELECT, ICHSAVE
      COMMON /T2_CHAR/ C_TIT_ESCAPE,C_TIT_SUBSTITUTE
      COMMON /T2_SCRT/ C_FILE, C_NAME, C_SELECT
      INTEGER JOUFIL, ERRFIL, OUTFIL, DBGFIL, INPFIL, NINMAX
      PARAMETER (NINMAX=20)
      INTEGER NINP(NINMAX)
      COMMON /T2TRBK/NINP, JOUFIL, ERRFIL, OUTFIL, DBGFIL, INPFIL
      CHARACTER*512 STRNG, STJOU
      LOGICAL LTOKEN
      REAL FLOTNG
      INTEGER INTERP, KEYORD, NSTRNG, MAXSTR, NSTJOU, LSTJOU, NTOKEN
      INTEGER*4 INTEG
      COMMON /TOKENC/ INTERP, INTEG, FLOTNG, KEYORD, NSTRNG, MAXSTR, ST
     *RNG, NSTJOU, LSTJOU, STJOU, LTOKEN, NTOKEN
      LOGICAL DFLAGS(200),DSCREV(3)
      COMMON /T2FLGD/DFLAGS,DSCREV
      REAL DTITLIN(4), DTITFAC(4), DTITMAR(4)
      INTEGER DGRDTYP, DGRDTEX, DOUTTEX, IDAXTEX, DTITEX, DSHADOWTYP,DS
     *HADOWTEX, IFLDDF(19), NDDIMNS, IDTXPRI, IDTXSEC, LINCLF, LINTXF,
     * LINWDF, DNONLN(3), DNXYZ1(3), DNXYZ2(3), DLABTEX, DTICTEX, DNPAT
     *RN(30), DLBLCHR(3), ND_CYCLE, IDTX_CYCLE(MAX_CYCLE)
      REAL DSYM_CYCLE(MAX_CYCLE)
      REAL DTITSIZ, DGRDSYM, DGRDSIZ, DCIRSIZ(2,3), DASIZE, DAFLARE, D
     *SMSZDF, DORAXES(3), DEYEDIR(3), DVUEDIR(3), DVUECEN(3), DVERTCL(3
     *), DEYESEP, DSCRD, DSCRZ, DEYEDIS, DEYEPNT(3), DBARSIZ(3), DBARBR
     *K(3), DTIKSIZ(3), DXYZBS(3), DTTHETA, DTPHI, DFRELBL(4), DPATRN(2
     *0,30), DSCLPRM(10,3), DWINDOW(4), DSCREEN(2), DSYMBOL, DNOSYMB, 
     *DAXANG(3), DLBLSIZ, DSYMSIZ, DXYZLIM(3,2), DFACTXY(19), DRADANG,
     * DDSCAL, DPATSZ, DTITINX, DTIKFAC, DSYDIR(3), DGRDIR(3)
      COMMON /T2COMD/ DTITSIZ, DGRDSYM, DGRDSIZ, DCIRSIZ, DASIZE, DAFLA
     *RE, DSMSZDF, DORAXES, DEYEDIR, DVUEDIR, DVUECEN, DVERTCL, DEYESE
     *P, DSCRD, DSCRZ, DEYEDIS, DEYEPNT, DBARSIZ, DTIKSIZ, DXYZBS, DTTH
     *ETA, DTPHI, DFRELBL, DNPATRN, DPATRN, DSCLPRM, DWINDOW, DSCREEN,
     * DSYMBOL, DNOSYMB, DAXANG, DLBLSIZ, DSYMSIZ, DXYZLIM, DGRDTYP, D
     *FACTXY, IFLDDF, NDDIMNS, DGRDTEX, DOUTTEX, IDAXTEX, DTITEX, DRADA
     *NG, DDSCAL, DNONLN, DNXYZ1, DNXYZ2, LINCLF, LINTXF, LINWDF, DLABT
     *EX, DTICTEX, DPATSZ, IDTXPRI, IDTXSEC, DTITLIN, DTITINX, DLBLCHR,
     * DTITFAC, DTITMAR, DTIKFAC, DSYDIR, DGRDIR, ND_CYCLE, IDTX_CYCLE,
     * DSYM_CYCLE, DBARBRK,  DSHADOWTYP,DSHADOWTEX
      REAL HNONE
      DATA HNONE /-666.666/
      LFLAG(1)=.true.
      DO 10031 I=5,10
      FLAGS(I)=FLAGS(I).OR.FLAGS(I+60).or.DFLAGS(I+60)
      FLAGS(I+60)=.false.
      LFLAG(1)=LFLAG(1).and.FLAGS(I)
10031 CONTINUE
10032 CONTINUE
      IF (LFLAG(1)) goto 10040
      NM(1)=NDIM1
      NM(2)=NDIM2
      NM(3)=0
      I=NINT(MOD(ARRAY(1,1,1),16.))
      MM(1)=MOD(I,4)
      MM(2)=I/4
      IF( .NOT. (MM(1).ge.1 .and. MM(1).le.3 .and. MM(1).ne.MM(2) .and. 
     *MM(2).ge.1 .and. MM(2).le.3) ) THEN
      MM(1)=1
      MM(2)=2
      ENDIF
      MM(3)=6-MM(1)-MM(2)
      IZFLAG=-2
      IF (MESH2D.ne.MM(3) .and. .not.FLAGS(56)) IZFLAG=-1
      IF ((MESH2D.eq.MM(1).or.MESH2D.eq.MM(2)) .and.NDIMNS(1).eq.2) THEN
     *
      MM(3)=2
      IF (MESH2D.eq.MM(2)) THEN
      MM(1)=1
      MM(2)=3
      ELSE
      MM(1)=3
      MM(2)=1
      ENDIF
      ENDIF
      DO 10051 J=1,3
      IXYZ=MM(J)
      DO 10061 I=1,2
      EXTREM(I)=0
      NLIM(J,I)=1+(I-1)*(NM(J)-2)
      IF (NXYLIM(J,I) .gt.0) NLIM(J,I)=MIN(NXYLIM(J,I),NM(J)-1)
      IF (J.eq.1) THEN
      EXTREM(I)=T2MSHX(ARRAY,NDIM0,NDIM1,NDIM2,NLIM(J,I)+(I-1))
      ELSEIF(J.eq.2) THEN
      EXTREM(I)=T2MSHY(ARRAY,NDIM0,NDIM1,NDIM2,NLIM(J,I)+(I-1))
      ENDIF
10061 CONTINUE
10062 CONTINUE
      T=EXTREM(1)
      EXTREM(1)=MIN(T,EXTREM(2))
      EXTREM(2)=MAX(T,EXTREM(2))
      DO 10071 I=1,2
      LFLAG(I)=.not.FLAGS(2*IXYZ+2+1)
      IF (LFLAG(I)) THEN
      IFLAG(I)=-3
      IF (J.eq.3) IFLAG(I)=IZFLAG
      ELSE
      IFLAG(I)=1
      EXTREM(I)=XYZLIM(IXYZ,I)
      ENDIF
10071 CONTINUE
10072 CONTINUE
10080 GOTO (10090,10100,10110),J
10090 CONTINUE
      CALL T2STL1(ARRAY(1,2,1),HNONE,HNONE,HNONE,1, NONLIN(IXYZ),IFLAG,E
     *XTREM,NDIM1,NLIM(1,1),NLIM(1,2),NDIM0)
      GOTO 10082
10100 CONTINUE
      CALL T2STL1(ARRAY(1,1,NLIM(2,1)+1), HNONE,HNONE,HNONE,NLIM(2,2)-NL
     *IM(2,1)+1, NONLIN(IXYZ),IFLAG,EXTREM,NDIM1,1,1,NDIM0)
      GOTO 10082
10110 CONTINUE
      CALL T2STL1(ARRAY(1,2,NLIM(2,1)+1), HNONE,HNONE,HNONE,NLIM(2,2)-NL
     *IM(2,1)+1, NONLIN(IXYZ),IFLAG,EXTREM,NDIM1,NLIM(1,1),NLIM(1,2),NDI
     *M0)
      GOTO 10082
10082 CONTINUE
      DO 10121 I=1,2
      IF (LFLAG(I)) XYZLIM(IXYZ,I)=EXTREM(I)
10121 CONTINUE
10122 CONTINUE
10051 CONTINUE
10052 CONTINUE
      DO 10131 I=5,10
      FLAGS(I)=.TRUE.
10131 CONTINUE
10132 CONTINUE
10040 CONTINUE
      EXYZLIM(1,1)=HNONE
      DO 10141 I=1,2
      DO 10151 J=1,3
      NXYLIM(J,I)=0
10151 CONTINUE
10152 CONTINUE
10141 CONTINUE
10142 CONTINUE
      END
      SUBROUTINE TD3HST(ARRAY,NDIM1,NDIM2,IXYZ,ITXTUR,DXYZ,N1,N2,N3,N4)
      IMPLICIT NONE
      COMMON /T2FLGC/ FLAGS(200), LTRAP,LHANDL,LSYERR,LSCREV
      LOGICAL FLAGS, LTRAP,LHANDL,LSYERR,LSCREV(3)
      INTEGER RELFLAG 
      PARAMETER (RELFLAG=151)
      INTEGER IWINLEV 
      INTEGER NWINLEV , MAX_FILL 
      PARAMETER (NWINLEV =4)
      PARAMETER (MAX_FILL=4)
      REAL GRDSYM, GRDSIZ, DATDAT(2,8), H2STAT(12), TITLIN(4), TITFA
     *C(4), TITLOC(4), TITMAR(4), TITLMX(4), TIKFAC, TITINX, TITX1, TIT
     *Y1, TITX, TITY, TITZ, TITSIZ, TITCON(5), REVLEV, REDUCE(5), XFR
     *M12(12), XFRM13(12), XFRM14(12), XFRM23(12), XFRM24(12), XFRM34(6
     *), XVARSX(20), CIRSIZ(2,3), ASIZE, AFLARE, SMSZDF, ORAXES(3), EY
     *EDIR(3), VUEDIR(3), VUECEN(3), VERTCL(3), EYESEP, SCRD, SCRZ, EYE
     *DIS, EYEPNT(3), XYPART(2, 2), BARSIZ(3), BARBRK(3), TIKSIZ(3), XY
     *ZBAS(3), TTHETA, TPHI, FRELBL(4), PATRN(20,30), SCLPRM(10,3), WI
     *NDOW(4), SCREEN(2), SYMBOL, NOSYMB, FACTXY(19), LBLSIZ, SYMSIZ, X
     *YZLIM(3,2), WORLD(3), RADRMX, RADRMN, RADAMN, RADANG, RADX0, RADY
     *0, XUNUSD(6), AXANG(3), REDFAC, DSCAL, PATSZ, MARGIN(4), PSCR(2
     *), OREAL, OCPU, CSCRD, DATPTS, ERRPTS, DATXMN, DATXMX, DATYMN, DA
     *TYMX, DATZMN, DATZMX, DATSUM, ERRSUM, DATAVE, ERRAVE, DATCEN, ERR
     *CEN, DATSTD, ERRSTD, WINREL(2,2,NWINLEV),WINABS(2,2,NWINLEV),WINL
     *IM(2,2), FMARKER(3,8), SYDIR(3), GRDIR(3), EXYZLIM(3,2), DSLOPE(2
     *,2)
      REAL PLOT_EXTENT(2,2),FILL_ANGLE(MAX_FILL),FILL_WIDTH(MAX_FILL)
      INTEGER FILL_INDEX, FILL_TEX(MAX_FILL), N_LINES(6)
      EQUIVALENCE (DATDAT, DATPTS)
      INTEGER MAXREP
      PARAMETER (MAXREP=5)
      INTEGER IPATRN, NPATRN(30), NXYLIM(3,2), NPLOTS, NCSETS, NCCOL, N
     *CROW, IYEAR, IMONTH, IDAY, ISIGFG, ITXPRI, ITXSEC, ITITDT(3), L
     *ENCRD, IPROP, IHTEX, IBLINK, IERASE, ITCNTR, IUNUSD, NXYZ1(3), 
     *NXYZ2(3), LBLFMT(3), LBLCHR(3), NDIMNS(3), IBLKTP, IDIMNS, NMES
     *H0, NMESH1, NMESH2, MESH1, MESH2, MESH3, MESH2D, MESHN(3), NMESHN(
     *2), NFIELD, IFIELD(19), NINCR, NPOINT, IVARBL(19), IVPTR(19), I_
     *VORDER(19,2), LINEAR(4), NONLIN(4), MXECHO, LINES, MAXLNS, USRK
     *BD, USRSCR, PLTFIL, LINWID, LINCOL, LINTEX, ICPOIN(3), IREPCT(MA
     *XREP), LEVREP, GRDTYP, GRDTEX, OUTTEX, IAXTEX, TITEX, LETSET, LAB
     *TEX, TICTEX, SHADOWTYP,SHADOWTEX, NXYZDEF1(10), NXYZDEF2(10), IF
     *ILE_CASE ,MAX_SUBST
      INTEGER MAX_CYCLE
      PARAMETER (MAX_CYCLE=20)
      INTEGER N_CYCLE, ITX_CYCLE(MAX_CYCLE)
      REAL SYM_CYCLE(MAX_CYCLE)
      EQUIVALENCE (NMESH1,NMESHN)
      EQUIVALENCE (MESH1,MESHN)
      INTEGER IBUFFR(400)
      REAL BUFFER(400)
      INTEGER NCHSAVE 
      PARAMETER (NCHSAVE=2*512) 
      INTEGER*4 ICHSAVE(NCHSAVE)
      INTEGER*4 IVRPTR(15)
      CHARACTER*512 OUTSTR,C_FILE, C_NAME, C_SELECT
      CHARACTER C_TIT_ESCAPE*1,C_TIT_SUBSTITUTE*2
      INTEGER N_FILE, N_NAME, N_SELECT
      CHARACTER*8 PXNAME
      CHARACTER*64 INPFMT
      LOGICAL LTDATA, OUTSID(4)
      COMMON /T2COM/ PXNAME, REDUCE, TITX, TITY ,XFRM12, XFRM13, XFRM1
     *4, XFRM23 ,XFRM24, XFRM34 ,XVARSX ,TITSIZ, GRDSYM, GRDSIZ, CIRS
     *IZ, ASIZE, AFLARE ,SMSZDF, ORAXES, EYEDIR, VUEDIR, VUECEN ,VERTC
     *L, EYESEP, SCRD, SCRZ, EYEDIS, EYEPNT ,XYPART, BARSIZ, TIKSIZ, XY
     *ZBAS, TTHETA ,TPHI, FRELBL, IPATRN, NPATRN, PATRN ,SCLPRM, WINDO
     *W, SCREEN, SYMBOL, NOSYMB ,FACTXY, LBLSIZ, SYMSIZ, XYZLIM, WORLD 
     *,RADRMX, RADRMN, RADAMN, RADANG, RADX0, RADY0, XUNUSD ,USRKBD, U
     *SRSCR, PLTFIL ,ITITDT, LENCRD ,INPFMT, GRDTYP, LINWID, LINCOL, L
     *INTEX, TITCON, ITCNTR ,IUNUSD, NXYZ1, NXYZ2 ,LBLCHR, NDIMNS, IBL
     *KTP, IDIMNS ,NMESH1, NMESH2, MESH1, MESH2, MESH3, NFIELD ,IFIELD
     *, NINCR ,IVARBL, IVRPTR ,LINEAR, NONLIN ,NPOINT, LETSET ,MXECH
     *O, LINES, MAXLNS ,AXANG, MESH2D, REDFAC, GRDTEX, OUTTEX, IAXTEX, 
     *TITEX, DSCAL ,OUTSTR, IPROP, IHTEX, IBLINK, IERASE, LABTEX, TICTE
     *X, NXYLIM, PATSZ ,MARGIN, PSCR, ITXPRI, ITXSEC, OREAL, OCPU, CSCR
     *D, OUTSID ,TITLIN, TITINX, TITZ, TITX1, TITY1, LTDATA, NPLOTS, RE
     *VLEV ,LBLFMT, IYEAR, IMONTH, IDAY, ISIGFG ,DATPTS, ERRPTS, DATXM
     *N, DATXMX, DATYMN, DATYMX, DATZMN, DATZMX ,DATSUM, ERRSUM, DATAVE
     *, ERRAVE, DATCEN, ERRCEN, DATSTD, ERRSTD ,NCSETS, NCCOL, NCROW, F
     *MARKER, H2STAT, TITFAC, TITLOC, TITMAR ,TIKFAC, IWINLEV, WINREL, 
     *WINABS, WINLIM ,ICPOIN, LEVREP, IREPCT, SYDIR, GRDIR, NMESH0, EXY
     *ZLIM, IVPTR ,TITLMX, NXYZDEF1, NXYZDEF2, IFILE_CASE, N_CYCLE, ITX
     *_CYCLE ,SYM_CYCLE, PLOT_EXTENT, FILL_ANGLE, FILL_WIDTH, FILL_TEX 
     *,FILL_INDEX ,N_LINES ,DSLOPE ,MAX_SUBST, BARBRK ,I_VORDER,SHADOW
     *TYP,SHADOWTEX
      COMMON /T2SCRT/ BUFFER, IBUFFR, N_FILE,N_NAME,N_SELECT, ICHSAVE
      COMMON /T2_CHAR/ C_TIT_ESCAPE,C_TIT_SUBSTITUTE
      COMMON /T2_SCRT/ C_FILE, C_NAME, C_SELECT
      INTEGER JOUFIL, ERRFIL, OUTFIL, DBGFIL, INPFIL, NINMAX
      PARAMETER (NINMAX=20)
      INTEGER NINP(NINMAX)
      COMMON /T2TRBK/NINP, JOUFIL, ERRFIL, OUTFIL, DBGFIL, INPFIL
      CHARACTER*512 STRNG, STJOU
      LOGICAL LTOKEN
      REAL FLOTNG
      INTEGER INTERP, KEYORD, NSTRNG, MAXSTR, NSTJOU, LSTJOU, NTOKEN
      INTEGER*4 INTEG
      COMMON /TOKENC/ INTERP, INTEG, FLOTNG, KEYORD, NSTRNG, MAXSTR, ST
     *RNG, NSTJOU, LSTJOU, STJOU, LTOKEN, NTOKEN
      INTEGER NDIM0 
      PARAMETER (NDIM0=1)
      INTEGER NDIM1,NDIM2,IXYZ,ITXTUR,N1,N2,N3,N4
      REAL ARRAY(NDIM0,NDIM1,NDIM2+1),DXYZ,DDXYZ
      INTEGER I,IPNT,JXYZ,JTXTUR,J1,J2,J3,J4
      INTEGER NERR,NARG
      DATA NERR/0/,NARG/0/
      CALL NOARG(NARG)
      IF (NARG.LT.3 .OR. NARG.GT.10) THEN
      NERR=NERR+1
      CALL T2ERRA(NERR,NARG)
      RETURN
      ENDIF
      I=NINT(MOD(ARRAY(1,1,1),16.))
      MESH1=MOD(I,4)
      MESH2=I/4
      IF( MESH1.ge.1 .and. MESH1.le.3 .and. MESH1.ne.MESH2 .and. MESH2.g
     *e.1 .and. MESH2.le.3 ) THEN
      MESH3=6-MESH1-MESH2
      ELSE
      MESH1=1
      MESH2=2
      MESH3=3
      ENDIF
      JXYZ=0
      JTXTUR=0
      DDXYZ=0
      J3=0
      J4=0
      J1=0
      J2=0
      IF (NARG.ge.4) JXYZ=IXYZ
      IF (NARG.ge.5) JTXTUR=ITXTUR
      IF (NARG.ge.6) DDXYZ=DXYZ
      IF (NARG.ge.7) J1=N1
      IF (NARG.ge.8) J2=N2
      IF (NARG.ge.9) J3=N3
      IF (NARG.ge.10) J4=N4
      CALL T23HST(ARRAY,1,NDIM1,NDIM2,JXYZ,JTXTUR,DDXYZ,J1,J3,J2,J4)
      END
      SUBROUTINE TD3JIN(ARRAY,NDIM1,NDIM2,IXYZ,ITXTUR,N1,N2,N3,N4)
      IMPLICIT NONE
      COMMON /T2FLGC/ FLAGS(200), LTRAP,LHANDL,LSYERR,LSCREV
      LOGICAL FLAGS, LTRAP,LHANDL,LSYERR,LSCREV(3)
      INTEGER RELFLAG 
      PARAMETER (RELFLAG=151)
      INTEGER IWINLEV 
      INTEGER NWINLEV , MAX_FILL 
      PARAMETER (NWINLEV =4)
      PARAMETER (MAX_FILL=4)
      REAL GRDSYM, GRDSIZ, DATDAT(2,8), H2STAT(12), TITLIN(4), TITFA
     *C(4), TITLOC(4), TITMAR(4), TITLMX(4), TIKFAC, TITINX, TITX1, TIT
     *Y1, TITX, TITY, TITZ, TITSIZ, TITCON(5), REVLEV, REDUCE(5), XFR
     *M12(12), XFRM13(12), XFRM14(12), XFRM23(12), XFRM24(12), XFRM34(6
     *), XVARSX(20), CIRSIZ(2,3), ASIZE, AFLARE, SMSZDF, ORAXES(3), EY
     *EDIR(3), VUEDIR(3), VUECEN(3), VERTCL(3), EYESEP, SCRD, SCRZ, EYE
     *DIS, EYEPNT(3), XYPART(2, 2), BARSIZ(3), BARBRK(3), TIKSIZ(3), XY
     *ZBAS(3), TTHETA, TPHI, FRELBL(4), PATRN(20,30), SCLPRM(10,3), WI
     *NDOW(4), SCREEN(2), SYMBOL, NOSYMB, FACTXY(19), LBLSIZ, SYMSIZ, X
     *YZLIM(3,2), WORLD(3), RADRMX, RADRMN, RADAMN, RADANG, RADX0, RADY
     *0, XUNUSD(6), AXANG(3), REDFAC, DSCAL, PATSZ, MARGIN(4), PSCR(2
     *), OREAL, OCPU, CSCRD, DATPTS, ERRPTS, DATXMN, DATXMX, DATYMN, DA
     *TYMX, DATZMN, DATZMX, DATSUM, ERRSUM, DATAVE, ERRAVE, DATCEN, ERR
     *CEN, DATSTD, ERRSTD, WINREL(2,2,NWINLEV),WINABS(2,2,NWINLEV),WINL
     *IM(2,2), FMARKER(3,8), SYDIR(3), GRDIR(3), EXYZLIM(3,2), DSLOPE(2
     *,2)
      REAL PLOT_EXTENT(2,2),FILL_ANGLE(MAX_FILL),FILL_WIDTH(MAX_FILL)
      INTEGER FILL_INDEX, FILL_TEX(MAX_FILL), N_LINES(6)
      EQUIVALENCE (DATDAT, DATPTS)
      INTEGER MAXREP
      PARAMETER (MAXREP=5)
      INTEGER IPATRN, NPATRN(30), NXYLIM(3,2), NPLOTS, NCSETS, NCCOL, N
     *CROW, IYEAR, IMONTH, IDAY, ISIGFG, ITXPRI, ITXSEC, ITITDT(3), L
     *ENCRD, IPROP, IHTEX, IBLINK, IERASE, ITCNTR, IUNUSD, NXYZ1(3), 
     *NXYZ2(3), LBLFMT(3), LBLCHR(3), NDIMNS(3), IBLKTP, IDIMNS, NMES
     *H0, NMESH1, NMESH2, MESH1, MESH2, MESH3, MESH2D, MESHN(3), NMESHN(
     *2), NFIELD, IFIELD(19), NINCR, NPOINT, IVARBL(19), IVPTR(19), I_
     *VORDER(19,2), LINEAR(4), NONLIN(4), MXECHO, LINES, MAXLNS, USRK
     *BD, USRSCR, PLTFIL, LINWID, LINCOL, LINTEX, ICPOIN(3), IREPCT(MA
     *XREP), LEVREP, GRDTYP, GRDTEX, OUTTEX, IAXTEX, TITEX, LETSET, LAB
     *TEX, TICTEX, SHADOWTYP,SHADOWTEX, NXYZDEF1(10), NXYZDEF2(10), IF
     *ILE_CASE ,MAX_SUBST
      INTEGER MAX_CYCLE
      PARAMETER (MAX_CYCLE=20)
      INTEGER N_CYCLE, ITX_CYCLE(MAX_CYCLE)
      REAL SYM_CYCLE(MAX_CYCLE)
      EQUIVALENCE (NMESH1,NMESHN)
      EQUIVALENCE (MESH1,MESHN)
      INTEGER IBUFFR(400)
      REAL BUFFER(400)
      INTEGER NCHSAVE 
      PARAMETER (NCHSAVE=2*512) 
      INTEGER*4 ICHSAVE(NCHSAVE)
      INTEGER*4 IVRPTR(15)
      CHARACTER*512 OUTSTR,C_FILE, C_NAME, C_SELECT
      CHARACTER C_TIT_ESCAPE*1,C_TIT_SUBSTITUTE*2
      INTEGER N_FILE, N_NAME, N_SELECT
      CHARACTER*8 PXNAME
      CHARACTER*64 INPFMT
      LOGICAL LTDATA, OUTSID(4)
      COMMON /T2COM/ PXNAME, REDUCE, TITX, TITY ,XFRM12, XFRM13, XFRM1
     *4, XFRM23 ,XFRM24, XFRM34 ,XVARSX ,TITSIZ, GRDSYM, GRDSIZ, CIRS
     *IZ, ASIZE, AFLARE ,SMSZDF, ORAXES, EYEDIR, VUEDIR, VUECEN ,VERTC
     *L, EYESEP, SCRD, SCRZ, EYEDIS, EYEPNT ,XYPART, BARSIZ, TIKSIZ, XY
     *ZBAS, TTHETA ,TPHI, FRELBL, IPATRN, NPATRN, PATRN ,SCLPRM, WINDO
     *W, SCREEN, SYMBOL, NOSYMB ,FACTXY, LBLSIZ, SYMSIZ, XYZLIM, WORLD 
     *,RADRMX, RADRMN, RADAMN, RADANG, RADX0, RADY0, XUNUSD ,USRKBD, U
     *SRSCR, PLTFIL ,ITITDT, LENCRD ,INPFMT, GRDTYP, LINWID, LINCOL, L
     *INTEX, TITCON, ITCNTR ,IUNUSD, NXYZ1, NXYZ2 ,LBLCHR, NDIMNS, IBL
     *KTP, IDIMNS ,NMESH1, NMESH2, MESH1, MESH2, MESH3, NFIELD ,IFIELD
     *, NINCR ,IVARBL, IVRPTR ,LINEAR, NONLIN ,NPOINT, LETSET ,MXECH
     *O, LINES, MAXLNS ,AXANG, MESH2D, REDFAC, GRDTEX, OUTTEX, IAXTEX, 
     *TITEX, DSCAL ,OUTSTR, IPROP, IHTEX, IBLINK, IERASE, LABTEX, TICTE
     *X, NXYLIM, PATSZ ,MARGIN, PSCR, ITXPRI, ITXSEC, OREAL, OCPU, CSCR
     *D, OUTSID ,TITLIN, TITINX, TITZ, TITX1, TITY1, LTDATA, NPLOTS, RE
     *VLEV ,LBLFMT, IYEAR, IMONTH, IDAY, ISIGFG ,DATPTS, ERRPTS, DATXM
     *N, DATXMX, DATYMN, DATYMX, DATZMN, DATZMX ,DATSUM, ERRSUM, DATAVE
     *, ERRAVE, DATCEN, ERRCEN, DATSTD, ERRSTD ,NCSETS, NCCOL, NCROW, F
     *MARKER, H2STAT, TITFAC, TITLOC, TITMAR ,TIKFAC, IWINLEV, WINREL, 
     *WINABS, WINLIM ,ICPOIN, LEVREP, IREPCT, SYDIR, GRDIR, NMESH0, EXY
     *ZLIM, IVPTR ,TITLMX, NXYZDEF1, NXYZDEF2, IFILE_CASE, N_CYCLE, ITX
     *_CYCLE ,SYM_CYCLE, PLOT_EXTENT, FILL_ANGLE, FILL_WIDTH, FILL_TEX 
     *,FILL_INDEX ,N_LINES ,DSLOPE ,MAX_SUBST, BARBRK ,I_VORDER,SHADOW
     *TYP,SHADOWTEX
      COMMON /T2SCRT/ BUFFER, IBUFFR, N_FILE,N_NAME,N_SELECT, ICHSAVE
      COMMON /T2_CHAR/ C_TIT_ESCAPE,C_TIT_SUBSTITUTE
      COMMON /T2_SCRT/ C_FILE, C_NAME, C_SELECT
      INTEGER JOUFIL, ERRFIL, OUTFIL, DBGFIL, INPFIL, NINMAX
      PARAMETER (NINMAX=20)
      INTEGER NINP(NINMAX)
      COMMON /T2TRBK/NINP, JOUFIL, ERRFIL, OUTFIL, DBGFIL, INPFIL
      CHARACTER*512 STRNG, STJOU
      LOGICAL LTOKEN
      REAL FLOTNG
      INTEGER INTERP, KEYORD, NSTRNG, MAXSTR, NSTJOU, LSTJOU, NTOKEN
      INTEGER*4 INTEG
      COMMON /TOKENC/ INTERP, INTEG, FLOTNG, KEYORD, NSTRNG, MAXSTR, ST
     *RNG, NSTJOU, LSTJOU, STJOU, LTOKEN, NTOKEN
      INTEGER NDIM0 
      PARAMETER (NDIM0=1)
      INTEGER NDIM1,NDIM2,IXYZ,ITXTUR,N1,N2,N3,N4
      REAL ARRAY(NDIM0,NDIM1,NDIM2+1)
      INTEGER I,IPNT,JXYZ,JTXTUR,J1,J2,J3,J4
      INTEGER NERR,NARG
      DATA NERR/0/,NARG/0/
      CALL NOARG(NARG)
      IF (NARG.LT.3 .OR. NARG.GT.9) THEN
      NERR=NERR+1
      CALL T2ERRA(NERR,NARG)
      RETURN
      ENDIF
      I=NINT(MOD(ARRAY(1,1,1),16.))
      MESH1=MOD(I,4)
      MESH2=I/4
      IF( MESH1.ge.1 .and. MESH1.le.3 .and. MESH1.ne.MESH2 .and. MESH2.g
     *e.1 .and. MESH2.le.3 ) THEN
      MESH3=6-MESH1-MESH2
      ELSE
      MESH1=1
      MESH2=2
      MESH3=3
      ENDIF
      JXYZ=0
      JTXTUR=0
      J1=1
      J2=0
      J3=0
      J4=0
      IF (NARG.ge.4) JXYZ=IXYZ
      IF (NARG.ge.5) JTXTUR=ITXTUR
      IF (NARG.ge.6) J1=N1
      IF (NARG.ge.7) J2=N2
      IF (NARG.ge.8) J3=N3
      IF (NARG.ge.9) J4=N4
      CALL T23JIN(ARRAY,1,NDIM1,NDIM2,JXYZ,JTXTUR,J1,J3,J2,J4)
      END
      SUBROUTINE T2_READ_MESH(INFOIN,CARDIN)
      INTEGER INFOIN(10)
      CHARACTER*(*) CARDIN
      COMMON /T2FLGC/ FLAGS(200), LTRAP,LHANDL,LSYERR,LSCREV
      LOGICAL FLAGS, LTRAP,LHANDL,LSYERR,LSCREV(3)
      INTEGER RELFLAG 
      PARAMETER (RELFLAG=151)
      INTEGER IWINLEV 
      INTEGER NWINLEV , MAX_FILL 
      PARAMETER (NWINLEV =4)
      PARAMETER (MAX_FILL=4)
      REAL GRDSYM, GRDSIZ, DATDAT(2,8), H2STAT(12), TITLIN(4), TITFA
     *C(4), TITLOC(4), TITMAR(4), TITLMX(4), TIKFAC, TITINX, TITX1, TIT
     *Y1, TITX, TITY, TITZ, TITSIZ, TITCON(5), REVLEV, REDUCE(5), XFR
     *M12(12), XFRM13(12), XFRM14(12), XFRM23(12), XFRM24(12), XFRM34(6
     *), XVARSX(20), CIRSIZ(2,3), ASIZE, AFLARE, SMSZDF, ORAXES(3), EY
     *EDIR(3), VUEDIR(3), VUECEN(3), VERTCL(3), EYESEP, SCRD, SCRZ, EYE
     *DIS, EYEPNT(3), XYPART(2, 2), BARSIZ(3), BARBRK(3), TIKSIZ(3), XY
     *ZBAS(3), TTHETA, TPHI, FRELBL(4), PATRN(20,30), SCLPRM(10,3), WI
     *NDOW(4), SCREEN(2), SYMBOL, NOSYMB, FACTXY(19), LBLSIZ, SYMSIZ, X
     *YZLIM(3,2), WORLD(3), RADRMX, RADRMN, RADAMN, RADANG, RADX0, RADY
     *0, XUNUSD(6), AXANG(3), REDFAC, DSCAL, PATSZ, MARGIN(4), PSCR(2
     *), OREAL, OCPU, CSCRD, DATPTS, ERRPTS, DATXMN, DATXMX, DATYMN, DA
     *TYMX, DATZMN, DATZMX, DATSUM, ERRSUM, DATAVE, ERRAVE, DATCEN, ERR
     *CEN, DATSTD, ERRSTD, WINREL(2,2,NWINLEV),WINABS(2,2,NWINLEV),WINL
     *IM(2,2), FMARKER(3,8), SYDIR(3), GRDIR(3), EXYZLIM(3,2), DSLOPE(2
     *,2)
      REAL PLOT_EXTENT(2,2),FILL_ANGLE(MAX_FILL),FILL_WIDTH(MAX_FILL)
      INTEGER FILL_INDEX, FILL_TEX(MAX_FILL), N_LINES(6)
      EQUIVALENCE (DATDAT, DATPTS)
      INTEGER MAXREP
      PARAMETER (MAXREP=5)
      INTEGER IPATRN, NPATRN(30), NXYLIM(3,2), NPLOTS, NCSETS, NCCOL, N
     *CROW, IYEAR, IMONTH, IDAY, ISIGFG, ITXPRI, ITXSEC, ITITDT(3), L
     *ENCRD, IPROP, IHTEX, IBLINK, IERASE, ITCNTR, IUNUSD, NXYZ1(3), 
     *NXYZ2(3), LBLFMT(3), LBLCHR(3), NDIMNS(3), IBLKTP, IDIMNS, NMES
     *H0, NMESH1, NMESH2, MESH1, MESH2, MESH3, MESH2D, MESHN(3), NMESHN(
     *2), NFIELD, IFIELD(19), NINCR, NPOINT, IVARBL(19), IVPTR(19), I_
     *VORDER(19,2), LINEAR(4), NONLIN(4), MXECHO, LINES, MAXLNS, USRK
     *BD, USRSCR, PLTFIL, LINWID, LINCOL, LINTEX, ICPOIN(3), IREPCT(MA
     *XREP), LEVREP, GRDTYP, GRDTEX, OUTTEX, IAXTEX, TITEX, LETSET, LAB
     *TEX, TICTEX, SHADOWTYP,SHADOWTEX, NXYZDEF1(10), NXYZDEF2(10), IF
     *ILE_CASE ,MAX_SUBST
      INTEGER MAX_CYCLE
      PARAMETER (MAX_CYCLE=20)
      INTEGER N_CYCLE, ITX_CYCLE(MAX_CYCLE)
      REAL SYM_CYCLE(MAX_CYCLE)
      EQUIVALENCE (NMESH1,NMESHN)
      EQUIVALENCE (MESH1,MESHN)
      INTEGER IBUFFR(400)
      REAL BUFFER(400)
      INTEGER NCHSAVE 
      PARAMETER (NCHSAVE=2*512) 
      INTEGER*4 ICHSAVE(NCHSAVE)
      INTEGER*4 IVRPTR(15)
      CHARACTER*512 OUTSTR,C_FILE, C_NAME, C_SELECT
      CHARACTER C_TIT_ESCAPE*1,C_TIT_SUBSTITUTE*2
      INTEGER N_FILE, N_NAME, N_SELECT
      CHARACTER*8 PXNAME
      CHARACTER*64 INPFMT
      LOGICAL LTDATA, OUTSID(4)
      COMMON /T2COM/ PXNAME, REDUCE, TITX, TITY ,XFRM12, XFRM13, XFRM1
     *4, XFRM23 ,XFRM24, XFRM34 ,XVARSX ,TITSIZ, GRDSYM, GRDSIZ, CIRS
     *IZ, ASIZE, AFLARE ,SMSZDF, ORAXES, EYEDIR, VUEDIR, VUECEN ,VERTC
     *L, EYESEP, SCRD, SCRZ, EYEDIS, EYEPNT ,XYPART, BARSIZ, TIKSIZ, XY
     *ZBAS, TTHETA ,TPHI, FRELBL, IPATRN, NPATRN, PATRN ,SCLPRM, WINDO
     *W, SCREEN, SYMBOL, NOSYMB ,FACTXY, LBLSIZ, SYMSIZ, XYZLIM, WORLD 
     *,RADRMX, RADRMN, RADAMN, RADANG, RADX0, RADY0, XUNUSD ,USRKBD, U
     *SRSCR, PLTFIL ,ITITDT, LENCRD ,INPFMT, GRDTYP, LINWID, LINCOL, L
     *INTEX, TITCON, ITCNTR ,IUNUSD, NXYZ1, NXYZ2 ,LBLCHR, NDIMNS, IBL
     *KTP, IDIMNS ,NMESH1, NMESH2, MESH1, MESH2, MESH3, NFIELD ,IFIELD
     *, NINCR ,IVARBL, IVRPTR ,LINEAR, NONLIN ,NPOINT, LETSET ,MXECH
     *O, LINES, MAXLNS ,AXANG, MESH2D, REDFAC, GRDTEX, OUTTEX, IAXTEX, 
     *TITEX, DSCAL ,OUTSTR, IPROP, IHTEX, IBLINK, IERASE, LABTEX, TICTE
     *X, NXYLIM, PATSZ ,MARGIN, PSCR, ITXPRI, ITXSEC, OREAL, OCPU, CSCR
     *D, OUTSID ,TITLIN, TITINX, TITZ, TITX1, TITY1, LTDATA, NPLOTS, RE
     *VLEV ,LBLFMT, IYEAR, IMONTH, IDAY, ISIGFG ,DATPTS, ERRPTS, DATXM
     *N, DATXMX, DATYMN, DATYMX, DATZMN, DATZMX ,DATSUM, ERRSUM, DATAVE
     *, ERRAVE, DATCEN, ERRCEN, DATSTD, ERRSTD ,NCSETS, NCCOL, NCROW, F
     *MARKER, H2STAT, TITFAC, TITLOC, TITMAR ,TIKFAC, IWINLEV, WINREL, 
     *WINABS, WINLIM ,ICPOIN, LEVREP, IREPCT, SYDIR, GRDIR, NMESH0, EXY
     *ZLIM, IVPTR ,TITLMX, NXYZDEF1, NXYZDEF2, IFILE_CASE, N_CYCLE, ITX
     *_CYCLE ,SYM_CYCLE, PLOT_EXTENT, FILL_ANGLE, FILL_WIDTH, FILL_TEX 
     *,FILL_INDEX ,N_LINES ,DSLOPE ,MAX_SUBST, BARBRK ,I_VORDER,SHADOW
     *TYP,SHADOWTEX
      COMMON /T2SCRT/ BUFFER, IBUFFR, N_FILE,N_NAME,N_SELECT, ICHSAVE
      COMMON /T2_CHAR/ C_TIT_ESCAPE,C_TIT_SUBSTITUTE
      COMMON /T2_SCRT/ C_FILE, C_NAME, C_SELECT
      INTEGER JOUFIL, ERRFIL, OUTFIL, DBGFIL, INPFIL, NINMAX
      PARAMETER (NINMAX=20)
      INTEGER NINP(NINMAX)
      COMMON /T2TRBK/NINP, JOUFIL, ERRFIL, OUTFIL, DBGFIL, INPFIL
      CHARACTER*512 STRNG, STJOU
      LOGICAL LTOKEN
      REAL FLOTNG
      INTEGER INTERP, KEYORD, NSTRNG, MAXSTR, NSTJOU, LSTJOU, NTOKEN
      INTEGER*4 INTEG
      COMMON /TOKENC/ INTERP, INTEG, FLOTNG, KEYORD, NSTRNG, MAXSTR, ST
     *RNG, NSTJOU, LSTJOU, STJOU, LTOKEN, NTOKEN
      INTEGER LISTPT,NPTMAX,NDSETS
      REAL DATBUF(10248)
      COMMON /T2XPNT/ LISTPT,NPTMAX,NDSETS,DATBUF
      LOGICAL LOVER , LERROR , LAPPEN , LMBIN 
      INTEGER ITOKEN
      INTEGER*4 IPNT,ITEMP,ITEMP1,IREPT1,IREP2
      EQUIVALENCE (IPNT,IVRPTR(9)),(ITEMP,IVRPTR(10)),(ITEMP1,IVRPTR(11)
     *)
      REAL WIDTH,WIDTH1,DEPTH,DEPTH1,DEPTH2
      REAL DBIN(4),PARM(4)
      CHARACTER*1 XYZHOL(3)
      LOGICAL T2_VIRT,DMMY
      DATA XYZHOL/'X','Y','Z'/
      LOVER=.false.
      LMBIN=.FALSE.
      NMESH0=1
      NMESH1=0
      NMESH2=0
      WIDTH=0
      WIDTH1=0
      DEPTH=0
      DEPTH1=0
      DEPTH2=0
      DO 10161 I=1,4
      DBIN(I)=0
10161 CONTINUE
10162 CONTINUE
      LERROR=.false.
      ITOKEN=1
      LAPPEN=(.not. FLAGS(28) .and. REVLEV.lt.3)
      N_NAME=1
      C_NAME=' '
10171 CONTINUE
      CALL TOKEN(INFOIN,CARDIN, 'NAME:-4:S,BINS:-1,FOR:0,X:1,Y:2,Z:3,WIT
     *H:0,ERRORS:-2:Y,APPEND:-3:Y,;')
      ITOKEN=ITOKEN+1
      IF (INTERP.EQ.1) THEN
      ITOKEN=0
      CALL T2JOUR
      CALL TOKRED(INFOIN,CARDIN,LENCRD,INPFIL,INPFMT)
      IF ((INFOIN(1).LT.0)) GOTO 10180
      IF (OUTFIL.gt.0) CALL T2ERR(INFOIN,CARDIN,' ',6)
      GOTO 10171
      ELSEIF (INTERP.EQ.2) THEN
      IF (INTEG.eq.-1) LMBIN=.true.
      IF (INTEG.eq.-2) LERROR=LTOKEN
      IF (INTEG.eq.-3) LAPPEN=LTOKEN
      IF (INTEG.eq.-4) THEN
      N_NAME=MAX(NSTRNG,1)
      C_NAME=STRNG(:N_NAME)
      ENDIF
      IF(INTEG.LE.0)GOTO 10171
      MESH1=INTEG
      ELSE
      CALL T2ERR(INFOIN,CARDIN,' ',5)
      GOTO 10190
      ENDIF
10172 CONTINUE
      I=MESH1
      IF (.not.LAPPEN) CALL T2PNTR
      IF (LERROR) NMESH0=2
      MESH1=I
      IBLKTP=2
      IPNT=IVRPTR(12)
C     IF (IPNT+10.ge.NPTMAX) CALL T2_VIRT(250)
      IF (IPNT+10.ge.NPTMAX) DMMY=T2_VIRT(250)	! for unix-fortran
      IF (IPNT+10.le.NPTMAX) THEN
      DATBUF(IPNT)=2.0E35
      IPNT=IPNT+1
      ISTR=MIN((N_NAME+4-1)/4,100)
      DATBUF(IPNT)=7+ISTR
      IPNT=IPNT+1
      DATBUF(IPNT)=0
      IPNT=IPNT+1
      DATBUF(IPNT)=ISTR
      READ(C_NAME(:N_NAME),10200)(DATBUF(K),K=IPNT+1,IPNT+ISTR)
      IPNT=IPNT+ISTR+1
10200 FORMAT(100A4)
      DO 10211 I=1,2+NMESH0
      IPNT=IPNT+1
      DATBUF(IPNT)=0
10211 CONTINUE
10212 CONTINUE
      ENDIF
      IVRPTR(8)=IPNT-NMESH0+1
      IREPT1=0
10221 CONTINUE
      IF (LTRAP) GOTO 10190
      IF (IREPT1.le.0) THEN
      CALL TOKEN(INFOIN,CARDIN, 'ENDBINS:1,FROM,TO,BY,N,STEP,NUMBER,WIDT
     *H,;')
      ITOKEN=ITOKEN+1
      ELSE
      IREPT1=IREPT1-1
      FLOTNG=PARM(1)
      PARM(1)=FLOTNG+PARM(3)
      ENDIF
      IF (INTERP.eq.2) THEN
      IF (INTEG.eq.1) GOTO 10230
      INFOIN(9)=-1
      ITOKEN=ITOKEN-1
      CALL T2FTBY(INFOIN,CARDIN,PARM,0)
      IF (.not. FLAGS(23)) THEN
      IREPT1=NINT(PARM(4))
      INTERP=4
      ENDIF
      GOTO 10221
      ELSEIF (INTERP.EQ.3 .OR. INTERP.EQ.4.or.INTERP.eq.7) THEN
C     IF (IPNT+10.ge.NPTMAX) CALL T2_VIRT(2*(IPNT-IVRPTR(8)))
      IF (IPNT+10.ge.NPTMAX) DMMY=T2_VIRT(2*(IPNT-IVRPTR(8))) ! for unix-frtran
      WIDTH=(FLOTNG-DBIN(2))/2.
      IF (NMESH1.le.0) THEN
      DBIN(1)=FLOTNG
      ELSEIF(IPNT .lt. NPTMAX) THEN
      IPNT=IPNT+1
      IF (LMBIN) THEN
      DATBUF(IPNT)=DBIN(2)+WIDTH
      ELSE
      DATBUF(IPNT)=DBIN(2)
      ENDIF
      IF (NMESH0.eq.2.and.IPNT.lt.NPTMAX) THEN
      IPNT=IPNT+1
      DATBUF(IPNT)=WIDTH
      ENDIF
      IF (NMESH1.eq.1) WIDTH1=WIDTH
      IF (WIDTH1*WIDTH.le.0) THEN
      WRITE(OUTSTR,10240)XYZHOL(MESH1)
      CALL T2ERR(INFOIN,CARDIN,OUTSTR,4)
10240 FORMAT ('*** ERROR ***',A1,' Point out of order')
      ENDIF
      ENDIF
      NMESH1=NMESH1+1
      DBIN(2)=FLOTNG
      GOTO 10221
      ELSEIF (INTERP.EQ.1) THEN
      ITOKEN=0
      CALL T2JOUR
      CALL TOKRED(INFOIN,CARDIN,LENCRD,INPFIL,INPFMT)
      IF ((INFOIN(1).LT.0)) GOTO 10180
      IF (OUTFIL.gt.0) CALL T2ERR(INFOIN,CARDIN,' ',6)
      GOTO 10221
      ENDIF
10222 CONTINUE
      INFOIN(9)=-1
      ITOKEN=ITOKEN-1
10230 CONTINUE
      IF (IPNT.lt.NPTMAX.and. .not. LMBIN)THEN
      IPNT=IPNT+1
      DATBUF(IPNT)=DBIN(2)
      IF (NMESH0.eq.2.and.IPNT.lt.NPTMAX) THEN
      IPNT=IPNT+1
      DATBUF(IPNT)=WIDTH
      ENDIF
      ENDIF
      NMESH1=IPNT-IVRPTR(8)+1
      ITEMP= 2 147 483 647
      ITEMP1=ITEMP
10251 CONTINUE
      IF (IPNT+4*NMESH0.le.NPTMAX) THEN
      NMESH2=NMESH2+1
      ENDIF
10261 CONTINUE
      CALL TOKEN(INFOIN,CARDIN,'ENDBINS:-1,FOR,X:1,Y:2,Z:3,;')
      ITOKEN=ITOKEN+1
      IF (INTERP.EQ.1) THEN
      ITOKEN=0
      CALL T2JOUR
      CALL TOKRED(INFOIN,CARDIN,LENCRD,INPFIL,INPFMT)
      IF ((INFOIN(1).LT.0)) GOTO 10180
      IF (OUTFIL.gt.0) CALL T2ERR(INFOIN,CARDIN,' ',6)
      GOTO 10261
      ENDIF
      IF(INTERP.EQ.2 .AND. INTEG.EQ.0)GOTO 10261
      IF (INTERP.eq.2 .and. INTEG.eq.0) GOTO 10180
10262 CONTINUE
      IF (NMESH2.EQ.1) THEN
      IF (INTERP.EQ.2) THEN
      MESH2=INTEG
      IF (MESH1.EQ.MESH2) THEN
      MESH2=MOD(MESH1,3)+1
      WRITE(OUTSTR,10270)XYZHOL(MESH1),XYZHOL(MESH2)
      CALL T2ERR(INFOIN,CARDIN,OUTSTR,4)
10270 FORMAT ('*** ERROR ***',A1, ' used already. ',A1,' assumed. ')
      ENDIF
      ELSE
      CALL T2ERR(INFOIN,CARDIN,' ',5)
      GOTO 10190
      ENDIF
      ELSE
      IF (INTERP.NE.2 .OR. MESH2.NE.INTEG) THEN
      GOTO 10252
      ENDIF
      ENDIF
C     IF (IPNT+NMESH0*(NMESH1+4).gt.NPTMAX) CALL T2_VIRT(NMESH0*NMESH1*M
C    *AX(10,NMESH2/2))
      IF (IPNT+NMESH0*(NMESH1+4).gt.NPTMAX) DMMY=T2_VIRT(NMESH0*NMESH1*M
     *AX(10,NMESH2/2))					! for unix-fortran
10281 CONTINUE
      CALL TOKEN(INFOIN,CARDIN,'ENDBINS;')
      ITOKEN=ITOKEN+1
      IF (INTERP.EQ.1) THEN
      ITOKEN=0
      CALL T2JOUR
      CALL TOKRED(INFOIN,CARDIN,LENCRD,INPFIL,INPFMT)
      IF ((INFOIN(1).LT.0)) GOTO 10180
      IF (OUTFIL.gt.0) CALL T2ERR(INFOIN,CARDIN,' ',6)
      GOTO 10281
      ELSEIF (INTERP.EQ.3 .OR. INTERP.EQ.4.or.INTERP.eq.7) THEN
      DEPTH=(FLOTNG-DBIN(4))/2.
      IF(NMESH2.eq.1) THEN
      DBIN(4)=FLOTNG
      DBIN(3)=FLOTNG
      ELSEIF (IPNT+4*NMESH0.le.NPTMAX) THEN
      DBIN(4)=FLOTNG
      ITEMP1=ITEMP
      DEPTH2=DEPTH
      IF(NMESH2.eq.2) DEPTH1=DEPTH
      IF(DEPTH1*DEPTH.le.0) THEN
      WRITE(OUTSTR,10290)XYZHOL(MESH2)
      CALL T2ERR(INFOIN,CARDIN,OUTSTR,4)
10290 FORMAT ('*** ERROR ***',A1,' Point out of order')
      ENDIF
      IF (ITEMP.lt.NPTMAX) THEN
      IF (NMESH0.eq.2) DATBUF(ITEMP+1)=DEPTH
      IF (LMBIN)DATBUF(ITEMP)=DEPTH+DATBUF(ITEMP)
      ENDIF
      ENDIF
      IPNT=IPNT+1
      ITEMP=IPNT
      IF (IPNT .lt. NPTMAX) DATBUF(IPNT)=FLOTNG
      IF (NMESH0.eq.2) IPNT=IPNT+1
      ELSE
      GOTO 10180
      ENDIF
10282 CONTINUE
10301 CONTINUE
      CALL TOKEN(INFOIN,CARDIN,'ENDBINS:0,X:1,Y:2,Z:3,;')
      ITOKEN=ITOKEN+1
      IF (INTERP.EQ.1) THEN
      ITOKEN=0
      CALL T2JOUR
      CALL TOKRED(INFOIN,CARDIN,LENCRD,INPFIL,INPFMT)
      IF ((INFOIN(1).LT.0)) GOTO 10180
      IF (OUTFIL.gt.0) CALL T2ERR(INFOIN,CARDIN,' ',6)
      GOTO 10301
      ELSEIF (INTERP.eq.2.and.INTEG.gt.0) THEN
      IF (NMESH2.EQ.1) THEN
      MESH3=INTEG
      I=6-MESH1-MESH2
      IF (MESH3.NE.I) THEN
      WRITE(OUTSTR,10310)XYZHOL(MESH3),XYZHOL(I)
      CALL T2ERR(INFOIN,CARDIN,OUTSTR,4)
10310 FORMAT ('*** ERROR ***',A1,' used already. ',A1,' assumed. ')
      MESH3=I
      ENDIF
      ELSEIF (MESH3.NE.INTEG) THEN
      CALL T2ERR(INFOIN,CARDIN,' ',5)
      ENDIF
      ELSE
      IPNT=IPNT-NMESH0
      GOTO 10180
      ENDIF
10302 CONTINUE
      IREPT1=0
      DO 10321 I=NMESH0+1,NMESH1
      IF (LTRAP) GOTO 10190
10331 CONTINUE
      FLOTNG=0
      IF (IREPT1.le.0) THEN
      IF (LERROR .or. MOD(I,NMESH0).eq.0) THEN
      CALL TOKEN(INFOIN,CARDIN, 'SKIP:2,FROM,TO,BY,N,STEP,NUMBER,WIDTH,E
     *RRORS:1:Y,;')
      ITOKEN=ITOKEN+1
      ELSE
      FLOTNG=0
      ENDIF
      ELSE
      IREPT1=IREPT1-1
      IF (MOD(I,NMESH0).eq.0) THEN
      FLOTNG=PARM(1)
      PARM(1)=FLOTNG+PARM(3)
      ENDIF
      ENDIF
      IF (INTERP.EQ.1) THEN
      ITOKEN=0
      CALL T2JOUR
      CALL TOKRED(INFOIN,CARDIN,LENCRD,INPFIL,INPFMT)
      IF ((INFOIN(1).LT.0)) GOTO 10180
      IF (OUTFIL.gt.0) CALL T2ERR(INFOIN,CARDIN,' ',6)
      GOTO 10331
      ELSEIF (INTERP.NE.3 .AND. INTERP.NE.4) THEN
      FLOTNG=0
      IF (INTERP.eq.2) THEN
      IF (INTEG.eq.0) THEN
      INFOIN(9)=-1
      ITOKEN=ITOKEN-1
      PARM(4)=(NMESH1-I+1)/NMESH0
      CALL T2FTBY(INFOIN,CARDIN,PARM,8)
      IF (.not. FLAGS(23)) THEN
      IREPT1=NINT(PARM(4))*NMESH0
      INTERP=4
      GOTO 10331
      ENDIF
      ELSEIF (INTEG.eq.2) THEN
      IREPT1=NMESH1-I+1
      PARM(1)=0
      PARM(3)=0
      INTERP=4
      ELSEIF (INTEG.eq.1) THEN
      LERROR=LTOKEN.and.NMESH0.eq.2
      GOTO 10331
      ENDIF
      ELSEIF (I.EQ.NMESH1) THEN
      INFOIN(9)=-1
      ITOKEN=ITOKEN-1
      WRITE(OUTSTR,10340)XYZHOL(MESH3),XYZHOL(MESH2),DBIN(4)
      CALL T2ERR(INFOIN,CARDIN,OUTSTR,4)
10340 FORMAT ('*** ERROR *** Not enough ',A1, '-values for ',A1,'=',G12.
     *5)
      ENDIF
      ENDIF
10332 CONTINUE
      IPNT=IPNT+1
      IF(IPNT .le. NPTMAX) DATBUF(IPNT)=FLOTNG
10321 CONTINUE
10322 CONTINUE
      DO 10351 I=1,99999
      CALL TOKEN(INFOIN,CARDIN,';')
      ITOKEN=ITOKEN+1
      IF (INTERP.EQ.1) THEN
      ITOKEN=0
      CALL T2JOUR
      CALL TOKRED(INFOIN,CARDIN,LENCRD,INPFIL,INPFMT)
      IF ((INFOIN(1).LT.0)) GOTO 10180
      IF (OUTFIL.gt.0) CALL T2ERR(INFOIN,CARDIN,' ',6)
      GOTO 10351
      ENDIF
      IF(INTERP.GT.4)GOTO 10352
      IF (I.EQ.1) THEN
      WRITE(OUTSTR,10360)XYZHOL(MESH3),XYZHOL(MESH2),DBIN(4)
      CALL T2ERR(INFOIN,CARDIN,OUTSTR,4)
10360 FORMAT ('*** ERROR *** Extra ',A1,'-values ignored for ', A1,'=',G
     *12.5)
      ENDIF
10351 CONTINUE
10352 CONTINUE
      INFOIN(9)=-1
      ITOKEN=ITOKEN-1
      GOTO 10251
10252 CONTINUE
10180 CONTINUE
      IF (INTERP.ne.2) THEN
      IF (ITOKEN.eq.1) THEN
      INFOIN(9)=1
      NSTJOU=0
      ELSE
      CALL T2ERR(INFOIN,CARDIN,' ',5)
      ENDIF
      ENDIF
      IF (IPNT+4*NMESH0.ge.NPTMAX) THEN
      CALL T2ERR(0,' ',('*** ERROR *** Mesh data exceeds maximum storage
     *'),3)
      IF (ITEMP1.gt.NPTMAX) goto 10190
      IPNT=ITEMP1-1
      ELSEIF(ITEMP.lt.IPNT) THEN
      IF (LMBIN) DATBUF(ITEMP)=DATBUF(ITEMP)+DEPTH2
      IF (NMESH0.eq.2) DATBUF(ITEMP+1)=DEPTH
      ENDIF
      IF (.not. LMBIN) THEN
      DBIN(1)=DBIN(1)-WIDTH1
      DBIN(2)=DBIN(2)+WIDTH
      DBIN(3)=DBIN(3)-DEPTH1
      DBIN(4)=DBIN(4)+DEPTH2
      ENDIF
      DO 10371 I=1,4
      DO 10381 J=1,NMESH0
      IPNT=IPNT+1
      IF(IPNT .le. NPTMAX) DATBUF(IPNT)=DBIN(I)
10381 CONTINUE
10382 CONTINUE
10371 CONTINUE
10372 CONTINUE
      NMESH1=NMESH1/NMESH0
      IPNT=IPNT+1
      IF (IPNT.ne.IVRPTR(8)+NMESH0*(NMESH1*NMESH2+4) .or. MESH1+MESH2+ME
     *SH3.ne.6 .or. NMESH1.lt.2 .or. NMESH2.lt.2 ) THEN
      CALL T2ERR(0,' ',('*** ERROR *** bad mesh'),3)
      ELSE
      NDSETS=NDSETS+1
      I=IVRPTR(8)
      DATBUF(I-ISTR-5)=IPNT-I+7+ISTR
      DATBUF(I-3)=NMESH0
      DATBUF(I-2)=NMESH1
      DATBUF(I-1)=NMESH2
      DATBUF(I)=MESH1+MESH2*4
      IVRPTR(12)=IPNT
      NPOINT=NPOINT+(NMESH1-1)*(NMESH2-1)
      ENDIF
10190 CONTINUE
      END
      SUBROUTINE T23PLT(ARRAY,NDIM0,NDIM1,NDIM2,IXYZ,SYM, ITXTUR,SYSIZ,T
     *LIM,N1,N2,N3,N4)
      IMPLICIT NONE
      CHARACTER*2 SYTITL
      INTEGER NDIM0,NDIM1,NDIM2,IXYZ,ITXTUR,N1,N2,N3,N4
      REAL ARRAY(NDIM0,NDIM1,NDIM2+1),SYM,SYSIZ,SYM1
      INTEGER IXMIN,IXMAX,IYMIN,IYMAX,IX,IY,ILOOP,IDUM,ICYCLE
      INTEGER I,J,ISEED,NBINS,ITXSAV
      LOGICAL LLOG
      REAL XYZ(3),XY(2),TLIM(3,2),XYZ2(3,2),XY2(2,2),XUP(3,3),XYZW(3)
      REAL X1,Y1,Z1,X2,Y2,Z2,XSIZE,YSIZE,SYNEW
      REAL XMIN,XMAX,YMIN,YMAX,ZMIN,ZMAX,ZDIFF,ZDIST,WIDTH,DEPTH,FAC
      REAL T2MSHX,T2MSHY
      REAL RAN
C     EQUIVALENCE (XYZ2(1,1),X1),(XYZ2(2,1),Y1),(XYZ2(3,1),Z1)  ! Bug ?
C     EQUIVALENCE (XYZ2(1,2),X2),(XYZ2(2,2),Y2),(XYZ2(3,2),Z2)
      LOGICAL LTEST,LOVER,LRAN,LLIMIT,LSIZE,LDOT,LCYCLE
      COMMON /T2FLGC/ FLAGS(200), LTRAP,LHANDL,LSYERR,LSCREV
      LOGICAL FLAGS, LTRAP,LHANDL,LSYERR,LSCREV(3)
      INTEGER RELFLAG 
      PARAMETER (RELFLAG=151)
      INTEGER IWINLEV 
      INTEGER NWINLEV , MAX_FILL 
      PARAMETER (NWINLEV =4)
      PARAMETER (MAX_FILL=4)
      REAL GRDSYM, GRDSIZ, DATDAT(2,8), H2STAT(12), TITLIN(4), TITFA
     *C(4), TITLOC(4), TITMAR(4), TITLMX(4), TIKFAC, TITINX, TITX1, TIT
     *Y1, TITX, TITY, TITZ, TITSIZ, TITCON(5), REVLEV, REDUCE(5), XFR
     *M12(12), XFRM13(12), XFRM14(12), XFRM23(12), XFRM24(12), XFRM34(6
     *), XVARSX(20), CIRSIZ(2,3), ASIZE, AFLARE, SMSZDF, ORAXES(3), EY
     *EDIR(3), VUEDIR(3), VUECEN(3), VERTCL(3), EYESEP, SCRD, SCRZ, EYE
     *DIS, EYEPNT(3), XYPART(2, 2), BARSIZ(3), BARBRK(3), TIKSIZ(3), XY
     *ZBAS(3), TTHETA, TPHI, FRELBL(4), PATRN(20,30), SCLPRM(10,3), WI
     *NDOW(4), SCREEN(2), SYMBOL, NOSYMB, FACTXY(19), LBLSIZ, SYMSIZ, X
     *YZLIM(3,2), WORLD(3), RADRMX, RADRMN, RADAMN, RADANG, RADX0, RADY
     *0, XUNUSD(6), AXANG(3), REDFAC, DSCAL, PATSZ, MARGIN(4), PSCR(2
     *), OREAL, OCPU, CSCRD, DATPTS, ERRPTS, DATXMN, DATXMX, DATYMN, DA
     *TYMX, DATZMN, DATZMX, DATSUM, ERRSUM, DATAVE, ERRAVE, DATCEN, ERR
     *CEN, DATSTD, ERRSTD, WINREL(2,2,NWINLEV),WINABS(2,2,NWINLEV),WINL
     *IM(2,2), FMARKER(3,8), SYDIR(3), GRDIR(3), EXYZLIM(3,2), DSLOPE(2
     *,2)
      REAL PLOT_EXTENT(2,2),FILL_ANGLE(MAX_FILL),FILL_WIDTH(MAX_FILL)
      INTEGER FILL_INDEX, FILL_TEX(MAX_FILL), N_LINES(6)
      EQUIVALENCE (DATDAT, DATPTS)
      INTEGER MAXREP
      PARAMETER (MAXREP=5)
      INTEGER IPATRN, NPATRN(30), NXYLIM(3,2), NPLOTS, NCSETS, NCCOL, N
     *CROW, IYEAR, IMONTH, IDAY, ISIGFG, ITXPRI, ITXSEC, ITITDT(3), L
     *ENCRD, IPROP, IHTEX, IBLINK, IERASE, ITCNTR, IUNUSD, NXYZ1(3), 
     *NXYZ2(3), LBLFMT(3), LBLCHR(3), NDIMNS(3), IBLKTP, IDIMNS, NMES
     *H0, NMESH1, NMESH2, MESH1, MESH2, MESH3, MESH2D, MESHN(3), NMESHN(
     *2), NFIELD, IFIELD(19), NINCR, NPOINT, IVARBL(19), IVPTR(19), I_
     *VORDER(19,2), LINEAR(4), NONLIN(4), MXECHO, LINES, MAXLNS, USRK
     *BD, USRSCR, PLTFIL, LINWID, LINCOL, LINTEX, ICPOIN(3), IREPCT(MA
     *XREP), LEVREP, GRDTYP, GRDTEX, OUTTEX, IAXTEX, TITEX, LETSET, LAB
     *TEX, TICTEX, SHADOWTYP,SHADOWTEX, NXYZDEF1(10), NXYZDEF2(10), IF
     *ILE_CASE ,MAX_SUBST
      INTEGER MAX_CYCLE
      PARAMETER (MAX_CYCLE=20)
      INTEGER N_CYCLE, ITX_CYCLE(MAX_CYCLE)
      REAL SYM_CYCLE(MAX_CYCLE)
      EQUIVALENCE (NMESH1,NMESHN)
      EQUIVALENCE (MESH1,MESHN)
      INTEGER IBUFFR(400)
      REAL BUFFER(400)
      INTEGER NCHSAVE 
      PARAMETER (NCHSAVE=2*512) 
      INTEGER*4 ICHSAVE(NCHSAVE)
      INTEGER*4 IVRPTR(15)
      CHARACTER*512 OUTSTR,C_FILE, C_NAME, C_SELECT
      CHARACTER C_TIT_ESCAPE*1,C_TIT_SUBSTITUTE*2
      INTEGER N_FILE, N_NAME, N_SELECT
      CHARACTER*8 PXNAME
      CHARACTER*64 INPFMT
      LOGICAL LTDATA, OUTSID(4)
      COMMON /T2COM/ PXNAME, REDUCE, TITX, TITY ,XFRM12, XFRM13, XFRM1
     *4, XFRM23 ,XFRM24, XFRM34 ,XVARSX ,TITSIZ, GRDSYM, GRDSIZ, CIRS
     *IZ, ASIZE, AFLARE ,SMSZDF, ORAXES, EYEDIR, VUEDIR, VUECEN ,VERTC
     *L, EYESEP, SCRD, SCRZ, EYEDIS, EYEPNT ,XYPART, BARSIZ, TIKSIZ, XY
     *ZBAS, TTHETA ,TPHI, FRELBL, IPATRN, NPATRN, PATRN ,SCLPRM, WINDO
     *W, SCREEN, SYMBOL, NOSYMB ,FACTXY, LBLSIZ, SYMSIZ, XYZLIM, WORLD 
     *,RADRMX, RADRMN, RADAMN, RADANG, RADX0, RADY0, XUNUSD ,USRKBD, U
     *SRSCR, PLTFIL ,ITITDT, LENCRD ,INPFMT, GRDTYP, LINWID, LINCOL, L
     *INTEX, TITCON, ITCNTR ,IUNUSD, NXYZ1, NXYZ2 ,LBLCHR, NDIMNS, IBL
     *KTP, IDIMNS ,NMESH1, NMESH2, MESH1, MESH2, MESH3, NFIELD ,IFIELD
     *, NINCR ,IVARBL, IVRPTR ,LINEAR, NONLIN ,NPOINT, LETSET ,MXECH
     *O, LINES, MAXLNS ,AXANG, MESH2D, REDFAC, GRDTEX, OUTTEX, IAXTEX, 
     *TITEX, DSCAL ,OUTSTR, IPROP, IHTEX, IBLINK, IERASE, LABTEX, TICTE
     *X, NXYLIM, PATSZ ,MARGIN, PSCR, ITXPRI, ITXSEC, OREAL, OCPU, CSCR
     *D, OUTSID ,TITLIN, TITINX, TITZ, TITX1, TITY1, LTDATA, NPLOTS, RE
     *VLEV ,LBLFMT, IYEAR, IMONTH, IDAY, ISIGFG ,DATPTS, ERRPTS, DATXM
     *N, DATXMX, DATYMN, DATYMX, DATZMN, DATZMX ,DATSUM, ERRSUM, DATAVE
     *, ERRAVE, DATCEN, ERRCEN, DATSTD, ERRSTD ,NCSETS, NCCOL, NCROW, F
     *MARKER, H2STAT, TITFAC, TITLOC, TITMAR ,TIKFAC, IWINLEV, WINREL, 
     *WINABS, WINLIM ,ICPOIN, LEVREP, IREPCT, SYDIR, GRDIR, NMESH0, EXY
     *ZLIM, IVPTR ,TITLMX, NXYZDEF1, NXYZDEF2, IFILE_CASE, N_CYCLE, ITX
     *_CYCLE ,SYM_CYCLE, PLOT_EXTENT, FILL_ANGLE, FILL_WIDTH, FILL_TEX 
     *,FILL_INDEX ,N_LINES ,DSLOPE ,MAX_SUBST, BARBRK ,I_VORDER,SHADOW
     *TYP,SHADOWTEX
      COMMON /T2SCRT/ BUFFER, IBUFFR, N_FILE,N_NAME,N_SELECT, ICHSAVE
      COMMON /T2_CHAR/ C_TIT_ESCAPE,C_TIT_SUBSTITUTE
      COMMON /T2_SCRT/ C_FILE, C_NAME, C_SELECT
      INTEGER JOUFIL, ERRFIL, OUTFIL, DBGFIL, INPFIL, NINMAX
      PARAMETER (NINMAX=20)
      INTEGER NINP(NINMAX)
      COMMON /T2TRBK/NINP, JOUFIL, ERRFIL, OUTFIL, DBGFIL, INPFIL
      CHARACTER*512 STRNG, STJOU
      LOGICAL LTOKEN
      REAL FLOTNG
      INTEGER INTERP, KEYORD, NSTRNG, MAXSTR, NSTJOU, LSTJOU, NTOKEN
      INTEGER*4 INTEG
      COMMON /TOKENC/ INTERP, INTEG, FLOTNG, KEYORD, NSTRNG, MAXSTR, ST
     *RNG, NSTJOU, LSTJOU, STJOU, LTOKEN, NTOKEN
      INTEGER IAND
      REAL HNONE
      DATA HNONE /-666.666/
      IF (.NOT.FLAGS(75)) THEN
      I=2*MESH3+3
      LTEST=FLAGS(I).or.FLAGS(60+I)
      FLAGS(56)=NDIMNS(1).eq.3
      CALL T23LIM(ARRAY,NDIM0,NDIM1,NDIM2)
      IF(.not. LTEST .and. NONLIN(MESH3).eq.-1 .and. XYZLIM(MESH3,1).gt.
     *0)THEN
      FLAGS(I)=.true.
      XYZLIM(MESH3,1)=0.0
      ENDIF
      ENDIF
      CALL T2AXES
      IF (.not.FLAGS(75)) RETURN
      FLAGS(28) = .TRUE.
      LRAN=IAND(ITXTUR,1).eq.0
      LSIZE=IAND(ITXTUR,2).eq.0
      LLIMIT=TLIM(1,1) .ne. HNONE
      LCYCLE=IAND(ITXTUR,4).ne.0
      XMIN=T2MSHX(ARRAY,NDIM0,NDIM1,NDIM2,1)
      XMAX=T2MSHX(ARRAY,NDIM0,NDIM1,NDIM2,NDIM1)
      YMIN=T2MSHY(ARRAY,NDIM0,NDIM1,NDIM2,1)
      YMAX=T2MSHY(ARRAY,NDIM0,NDIM1,NDIM2,NDIM2)
      ZMIN=XYZLIM(MESH3,1)
      ZMAX=XYZLIM(MESH3,2)
      LLOG=NONLIN(MESH3).eq.-2 .or. NONLIN(MESH3).eq.-3
      NBINS=((NDIM1-1)*(NDIM2-1))
      ZDIFF=ZMAX-ZMIN
      IF (LLOG.and.ZMIN.ne.0.and.ZMAX.ne.0) ZDIFF=ALOG10(ABS(ZMAX))-ALOG
     *10(ABS(ZMIN))
      IF (ZDIFF.eq.0) ZDIFF=1.0
      ZDIST=1.0
      SYM1=SYM
      CALL SYMTXT(SYM,SYTITL)
      LDOT=SYTITL.eq.'  '
      IF (FLAGS(56) .and. SYDIR(2).ge.0) THEN
      CALL T2GTDR(1.0,SYDIR,XUP)
      ELSE
      XUP(1,1)=HNONE
      ENDIF
      IF(IXYZ .gt. 0) THEN
      IF(ZDIFF.gt.0) ZDIST=IXYZ/ZDIFF
      ELSEIF(IXYZ .eq. -1) THEN
      ZDIST=1.0
      ELSE
      IF(ZDIFF.lt. 1.0) ZDIST=2.0/ZDIFF
      IF(ZDIFF.gt.10.) THEN
      ZDIST=10./ZDIFF
      ENDIF
      ENDIF
      WIDTH=(XMAX-XMIN)/(NDIM1-1)
      DEPTH=(YMAX-YMIN)/(NDIM2-1)
      IF(WIDTH*DEPTH.ne.0) ZDIST=ZDIST/(WIDTH*DEPTH)
      CALL TXSCIS(2)
      IF (FLAGS(122)) CALL TXXMT
      CALL T2CWTS(ITXTUR,ITXSAV)
      CALL TXSDEF
      IF (SYSIZ.ne.0) THEN
      SYNEW=SYSIZ
      ELSE
      SYNEW=SYMSIZ
      ENDIF
      IXMIN=2
      IXMAX=NDIM1
      IYMIN=2
      IYMAX=NDIM2
      IF(N1.gt.0) IXMIN=MIN(NDIM1,N1+1)
      IF(N2.gt.0) IXMAX=MIN(NDIM1,N2+1)
      IF(N3.gt.0) IYMIN=MIN(NDIM2,N3+1)
      IF(N4.gt.0) IYMAX=MIN(NDIM2,N4+1)
      XMIN=T2MSHX(ARRAY,NDIM0,NDIM1,NDIM2,IXMIN-1)
      YMIN=T2MSHY(ARRAY,NDIM0,NDIM1,NDIM2,IYMIN-1)
      ISEED=31415925
      IF (LSIZE.AND.SYSIZ.EQ.0) THEN
      Y2=YMIN
      X2=XMIN
      XSIZE=0
      YSIZE=0
      DO 10391 IX=IXMIN,IXMAX
      X1=X2
      X2=T2MSHX(ARRAY,NDIM0,NDIM1,NDIM2,IX)
      XSIZE=MAX(XSIZE,ABS(X2-X1))
10391 CONTINUE
10392 CONTINUE
      DO 10401 IY=IYMIN,IYMAX
      Y1=Y2
      Y2=T2MSHY(ARRAY,NDIM0,NDIM1,NDIM2,IY)
      YSIZE=MAX(YSIZE,ABS(Y2-Y1))
10401 CONTINUE
10402 CONTINUE
      XYZ2(MESH1,1)=XMIN
      XYZ2(MESH2,1)=YMIN
      XYZ2(MESH3,1)=ZMIN
      XYZ2(MESH1,2)=XMIN+XSIZE
      XYZ2(MESH2,2)=YMIN+YSIZE
      XYZ2(MESH3,2)=ZMIN
      CALL T2XFRM(3,2,XYZ2,NONLIN,XFRM13,2,XY2)
      XSIZE=MIN(ABS(XY2(1,2)-XY2(1,1)),ABS(XY2(2,2)-XY2(2,1)))
      IF (.not.FLAGS(56).and.XSIZE.gt.0) SYNEW=XSIZE*10
      ENDIF
      Y2=YMIN
      DO 10411 IY=IYMIN,IYMAX
      Y1=Y2
      Y2=T2MSHY(ARRAY,NDIM0,NDIM1,NDIM2,IY)
      DEPTH=Y2-Y1
      X2=XMIN
      FAC=1
      IF(LLIMIT .or. (Y1.GE.TLIM(MESH2,1) .and. Y2.LE.TLIM(MESH2,2))) TH
     *EN
      DO 10421 IX=IXMIN,IXMAX
      IF (FLAGS(126)) CALL TXXMT
      X1=X2
      X2=T2MSHX(ARRAY,NDIM0,NDIM1,NDIM2,IX)
      WIDTH=X2-X1
      IF (LTRAP) GOTO 10430
      IF(LLIMIT .or. (X1.GE.TLIM(MESH1,1) .and. X2.LE.TLIM(MESH1,2))) TH
     *EN
      Z1=ARRAY(1,IX,IY)
      Z2=Z1
      IF( (Z1.GT.ZMIN .or. .not.(LRAN.or.LSIZE)) .and. (LLIMIT .or. (Z1.
     *GE.TLIM(MESH3,1).and.Z1.LE.TLIM(MESH3,2)))) THEN
      Z1=MIN(MAX(Z1,ZMIN),ZMAX)
      IF (LSIZE .or. LRAN .or. LCYCLE) THEN
      IF (LLOG) THEN
      IF( Z1 .ne. 0) THEN
      Z1=ALOG10(ABS(Z1))-ALOG10(ABS(ZMIN))
      ELSE
      Z1=0
      ENDIF
      ELSE
      Z1=Z1-ZMIN
      ENDIF
      IF (LSIZE) THEN
      FAC=(Z1)/(ZDIFF)
      ENDIF
      IF (LCYCLE) THEN
      ICYCLE=N_CYCLE*(Z1/ZDIFF)+1
      ICYCLE=MAX(MIN(N_CYCLE,ICYCLE),1)
      CALL T2CWTS(ITX_CYCLE(ICYCLE),IDUM)
      CALL T2CWTS(ITXTUR,IDUM)
      CALL TXSDEF
      IF (SYM .eq. 0) THEN
      SYM1=SYM_CYCLE(ICYCLE)
      CALL SYMTXT(SYM,SYTITL)
      LDOT=SYTITL.eq.'  '
      ENDIF
      ENDIF
      ENDIF
      IF (XUP(1,1) .ne. HNONE) THEN
      DO 10441 J=1,3
      XUP(J,3)=XUP(J,1)*SYNEW*FAC
10441 CONTINUE
10442 CONTINUE
      ENDIF
      XYZ(MESH3)=ARRAY(1,IX,IY)
      IF(LRAN) THEN
      IF(IXYZ.ne.-1) THEN
      ILOOP=ZDIST*Z1*WIDTH*DEPTH+0.99999
      ELSE
      ILOOP=NINT(Z1)
      ENDIF
      ILOOP=MAX(1,ILOOP)
      IF (LDOT.and..not.FLAGS(56).and..not.FLAGS(27)) THEN
      XYZ2(MESH1,1)=X1   ! modified for correct x-y order
      XYZ2(MESH2,1)=Y1
      XYZ2(MESH1,2)=X2
      XYZ2(MESH2,2)=Y2
      CALL T2XFRM(3,2,XYZ2,NONLIN,XFRM14,2,XY2)
      CALL TXRDOT(XY2(1,1),XY2(2,1),XY2(1,2),XY2(2,2),ILOOP)
      ELSE
      DO 10451 I=1,ILOOP
      XYZ(MESH1)=X1+WIDTH*RAN(ISEED)
      XYZ(MESH2)=Y1+DEPTH*RAN(ISEED)
      IF (XUP(1,1) .ne. HNONE) THEN
      CALL T2XFRM(3,1,XYZ,NONLIN,XFRM12,3,XYZW)
      CALL TX3TXT(XYZW,XUP(1,3),XUP(1,2), SYTITL(1:1),SYTITL(2:2),0)
      ELSE
      CALL T2XFRM(3,1,XYZ,NONLIN,XFRM14,2,XY)
      CALL TXTSYM(XY(1),XY(2),SYM1,SYNEW*FAC)
      ENDIF
      IF (LTRAP) GOTO 10430
10451 CONTINUE
10452 CONTINUE
      ENDIF
      ELSE
      XYZ(MESH1)=(X1+X2)/2
      XYZ(MESH2)=(Y1+Y2)/2
      XYZ(MESH3)=ARRAY(1,IX,IY)
      IF (XUP(1,1) .ne. HNONE) THEN
      CALL T2XFRM(3,1,XYZ,NONLIN,XFRM12,3,XYZW)
      CALL TX3TXT(XYZW,XUP(1,3),XUP(1,2), SYTITL(1:1),SYTITL(2:2),0)
      ELSE
      CALL T2XFRM(3,1,XYZ,NONLIN,XFRM14,2,XY)
      CALL TXTSYM(XY(1),XY(2),SYM1,SYNEW*FAC)
      ENDIF
      ENDIF
      ENDIF
      ENDIF
10421 CONTINUE
10422 CONTINUE
      ENDIF
10411 CONTINUE
10412 CONTINUE
10430 CONTINUE
      IF (FLAGS(122).or.FLAGS(126)) CALL TXXMT
      CALL T2CWTS(ITXSAV,IDUM)
      CALL TXSCIS(1)
      CALL T2TCKS(8)
      END
      SUBROUTINE T23HST(ARRAY,NDIM0,NDIM1,NDIM2,IXYZ,ITXTUR,DXYZ,N1,N3,N
     *2,N4)
      INTEGER NDIM0,NDIM1,NDIM2,IXYZ
      REAL ARRAY(NDIM0,NDIM1,NDIM2+1)
      REAL DXYZ(3)
      COMMON /T2FLGC/ FLAGS(200), LTRAP,LHANDL,LSYERR,LSCREV
      LOGICAL FLAGS, LTRAP,LHANDL,LSYERR,LSCREV(3)
      INTEGER RELFLAG 
      PARAMETER (RELFLAG=151)
      INTEGER IWINLEV 
      INTEGER NWINLEV , MAX_FILL 
      PARAMETER (NWINLEV =4)
      PARAMETER (MAX_FILL=4)
      REAL GRDSYM, GRDSIZ, DATDAT(2,8), H2STAT(12), TITLIN(4), TITFA
     *C(4), TITLOC(4), TITMAR(4), TITLMX(4), TIKFAC, TITINX, TITX1, TIT
     *Y1, TITX, TITY, TITZ, TITSIZ, TITCON(5), REVLEV, REDUCE(5), XFR
     *M12(12), XFRM13(12), XFRM14(12), XFRM23(12), XFRM24(12), XFRM34(6
     *), XVARSX(20), CIRSIZ(2,3), ASIZE, AFLARE, SMSZDF, ORAXES(3), EY
     *EDIR(3), VUEDIR(3), VUECEN(3), VERTCL(3), EYESEP, SCRD, SCRZ, EYE
     *DIS, EYEPNT(3), XYPART(2, 2), BARSIZ(3), BARBRK(3), TIKSIZ(3), XY
     *ZBAS(3), TTHETA, TPHI, FRELBL(4), PATRN(20,30), SCLPRM(10,3), WI
     *NDOW(4), SCREEN(2), SYMBOL, NOSYMB, FACTXY(19), LBLSIZ, SYMSIZ, X
     *YZLIM(3,2), WORLD(3), RADRMX, RADRMN, RADAMN, RADANG, RADX0, RADY
     *0, XUNUSD(6), AXANG(3), REDFAC, DSCAL, PATSZ, MARGIN(4), PSCR(2
     *), OREAL, OCPU, CSCRD, DATPTS, ERRPTS, DATXMN, DATXMX, DATYMN, DA
     *TYMX, DATZMN, DATZMX, DATSUM, ERRSUM, DATAVE, ERRAVE, DATCEN, ERR
     *CEN, DATSTD, ERRSTD, WINREL(2,2,NWINLEV),WINABS(2,2,NWINLEV),WINL
     *IM(2,2), FMARKER(3,8), SYDIR(3), GRDIR(3), EXYZLIM(3,2), DSLOPE(2
     *,2)
      REAL PLOT_EXTENT(2,2),FILL_ANGLE(MAX_FILL),FILL_WIDTH(MAX_FILL)
      INTEGER FILL_INDEX, FILL_TEX(MAX_FILL), N_LINES(6)
      EQUIVALENCE (DATDAT, DATPTS)
      INTEGER MAXREP
      PARAMETER (MAXREP=5)
      INTEGER IPATRN, NPATRN(30), NXYLIM(3,2), NPLOTS, NCSETS, NCCOL, N
     *CROW, IYEAR, IMONTH, IDAY, ISIGFG, ITXPRI, ITXSEC, ITITDT(3), L
     *ENCRD, IPROP, IHTEX, IBLINK, IERASE, ITCNTR, IUNUSD, NXYZ1(3), 
     *NXYZ2(3), LBLFMT(3), LBLCHR(3), NDIMNS(3), IBLKTP, IDIMNS, NMES
     *H0, NMESH1, NMESH2, MESH1, MESH2, MESH3, MESH2D, MESHN(3), NMESHN(
     *2), NFIELD, IFIELD(19), NINCR, NPOINT, IVARBL(19), IVPTR(19), I_
     *VORDER(19,2), LINEAR(4), NONLIN(4), MXECHO, LINES, MAXLNS, USRK
     *BD, USRSCR, PLTFIL, LINWID, LINCOL, LINTEX, ICPOIN(3), IREPCT(MA
     *XREP), LEVREP, GRDTYP, GRDTEX, OUTTEX, IAXTEX, TITEX, LETSET, LAB
     *TEX, TICTEX, SHADOWTYP,SHADOWTEX, NXYZDEF1(10), NXYZDEF2(10), IF
     *ILE_CASE ,MAX_SUBST
      INTEGER MAX_CYCLE
      PARAMETER (MAX_CYCLE=20)
      INTEGER N_CYCLE, ITX_CYCLE(MAX_CYCLE)
      REAL SYM_CYCLE(MAX_CYCLE)
      EQUIVALENCE (NMESH1,NMESHN)
      EQUIVALENCE (MESH1,MESHN)
      INTEGER IBUFFR(400)
      REAL BUFFER(400)
      INTEGER NCHSAVE 
      PARAMETER (NCHSAVE=2*512) 
      INTEGER*4 ICHSAVE(NCHSAVE)
      INTEGER*4 IVRPTR(15)
      CHARACTER*512 OUTSTR,C_FILE, C_NAME, C_SELECT
      CHARACTER C_TIT_ESCAPE*1,C_TIT_SUBSTITUTE*2
      INTEGER N_FILE, N_NAME, N_SELECT
      CHARACTER*8 PXNAME
      CHARACTER*64 INPFMT
      LOGICAL LTDATA, OUTSID(4)
      COMMON /T2COM/ PXNAME, REDUCE, TITX, TITY ,XFRM12, XFRM13, XFRM1
     *4, XFRM23 ,XFRM24, XFRM34 ,XVARSX ,TITSIZ, GRDSYM, GRDSIZ, CIRS
     *IZ, ASIZE, AFLARE ,SMSZDF, ORAXES, EYEDIR, VUEDIR, VUECEN ,VERTC
     *L, EYESEP, SCRD, SCRZ, EYEDIS, EYEPNT ,XYPART, BARSIZ, TIKSIZ, XY
     *ZBAS, TTHETA ,TPHI, FRELBL, IPATRN, NPATRN, PATRN ,SCLPRM, WINDO
     *W, SCREEN, SYMBOL, NOSYMB ,FACTXY, LBLSIZ, SYMSIZ, XYZLIM, WORLD 
     *,RADRMX, RADRMN, RADAMN, RADANG, RADX0, RADY0, XUNUSD ,USRKBD, U
     *SRSCR, PLTFIL ,ITITDT, LENCRD ,INPFMT, GRDTYP, LINWID, LINCOL, L
     *INTEX, TITCON, ITCNTR ,IUNUSD, NXYZ1, NXYZ2 ,LBLCHR, NDIMNS, IBL
     *KTP, IDIMNS ,NMESH1, NMESH2, MESH1, MESH2, MESH3, NFIELD ,IFIELD
     *, NINCR ,IVARBL, IVRPTR ,LINEAR, NONLIN ,NPOINT, LETSET ,MXECH
     *O, LINES, MAXLNS ,AXANG, MESH2D, REDFAC, GRDTEX, OUTTEX, IAXTEX, 
     *TITEX, DSCAL ,OUTSTR, IPROP, IHTEX, IBLINK, IERASE, LABTEX, TICTE
     *X, NXYLIM, PATSZ ,MARGIN, PSCR, ITXPRI, ITXSEC, OREAL, OCPU, CSCR
     *D, OUTSID ,TITLIN, TITINX, TITZ, TITX1, TITY1, LTDATA, NPLOTS, RE
     *VLEV ,LBLFMT, IYEAR, IMONTH, IDAY, ISIGFG ,DATPTS, ERRPTS, DATXM
     *N, DATXMX, DATYMN, DATYMX, DATZMN, DATZMX ,DATSUM, ERRSUM, DATAVE
     *, ERRAVE, DATCEN, ERRCEN, DATSTD, ERRSTD ,NCSETS, NCCOL, NCROW, F
     *MARKER, H2STAT, TITFAC, TITLOC, TITMAR ,TIKFAC, IWINLEV, WINREL, 
     *WINABS, WINLIM ,ICPOIN, LEVREP, IREPCT, SYDIR, GRDIR, NMESH0, EXY
     *ZLIM, IVPTR ,TITLMX, NXYZDEF1, NXYZDEF2, IFILE_CASE, N_CYCLE, ITX
     *_CYCLE ,SYM_CYCLE, PLOT_EXTENT, FILL_ANGLE, FILL_WIDTH, FILL_TEX 
     *,FILL_INDEX ,N_LINES ,DSLOPE ,MAX_SUBST, BARBRK ,I_VORDER,SHADOW
     *TYP,SHADOWTEX
      COMMON /T2SCRT/ BUFFER, IBUFFR, N_FILE,N_NAME,N_SELECT, ICHSAVE
      COMMON /T2_CHAR/ C_TIT_ESCAPE,C_TIT_SUBSTITUTE
      COMMON /T2_SCRT/ C_FILE, C_NAME, C_SELECT
      INTEGER JOUFIL, ERRFIL, OUTFIL, DBGFIL, INPFIL, NINMAX
      PARAMETER (NINMAX=20)
      INTEGER NINP(NINMAX)
      COMMON /T2TRBK/NINP, JOUFIL, ERRFIL, OUTFIL, DBGFIL, INPFIL
      CHARACTER*512 STRNG, STJOU
      LOGICAL LTOKEN
      REAL FLOTNG
      INTEGER INTERP, KEYORD, NSTRNG, MAXSTR, NSTJOU, LSTJOU, NTOKEN
      INTEGER*4 INTEG
      COMMON /TOKENC/ INTERP, INTEG, FLOTNG, KEYORD, NSTRNG, MAXSTR, ST
     *RNG, NSTJOU, LSTJOU, STJOU, LTOKEN, NTOKEN
      INTEGER IHSIZE,NPSTOR
      REAL TOLR
      PARAMETER (IHSIZE=2000)
      PARAMETER (TOLR=0.001)
      PARAMETER (NPSTOR=30)
      INTEGER IBOLD,IB,IBT,MAJMIN,MAJMAX,MINMIN,MINMAX,MAJSTP,MINSTP ,MI
     *NMN,MINMX,MAJMN,MAJMX ,MAJAX,MINAX,IFREE,IHBTOP(2),ITXTOP(2),LEFT,
     *IRIGHT,IPASS
      INTEGER*2 IHFWD(IHSIZE), IHBACK(IHSIZE)
      LOGICAL LFREE,VFLG,LVANISH
      REAL ROTCOS,ROTSIN,PNT12(2,2),XX(2,4) ,BUFR(NPSTOR),HORXY(2,IHSIZE
     *),VANISH_PNT(2)
      COMMON /T2MSHC/ MAJMIN,MAJMAX,MINMIN,MINMAX,MAJSTP,MINSTP ,MINMN,M
     *INMX,MAJMN,MAJMX ,MAJAX,MINAX,IB,IFREE,IHBTOP,ROTCOS,ROTSIN ,PNT12
     *,XX,IBT,VFLG,LEFT,IRIGHT ,ITXTOP,IBOLD,LFREE ,BUFR,HORXY ,IHFWD,IH
     *BACK,IPASS,LVANISH,VANISH_PNT
      EXTERNAL T2_MESH_DATA
      REAL XYZ(3,20), XY(2,20), ZD(4)
      REAL Z0,Z1,Z2,ZMIN,ZMAX,X0,X1,X2,Y0,Y1,Y2
      INTEGER NB
      INTEGER ID(4)
      INTEGER NXYZ 
      PARAMETER (NXYZ=16)
      LOGICAL LMESH, LGRID, LCYCLE, LXYZ(NXYZ) , LTEST 
      EQUIVALENCE (LGRID,LXYZ(13))
      IF (.NOT.FLAGS(75)) THEN
      I=2*MESH3+3
      LTEST=FLAGS(I).or.FLAGS(60+I)
      FLAGS(56)=NDIMNS(1).ne.2
      CALL T23LIM(ARRAY,NDIM0,NDIM1,NDIM2)
      IF(.not. LTEST .and. NONLIN(MESH3).eq.-1 .and. XYZLIM(MESH3,1).gt.
     *0)THEN
      FLAGS(I)=.true.
      XYZLIM(MESH3,1)=0.0
      ENDIF
      ENDIF
      CALL T2AXES
      IF (FLAGS(122)) CALL TXXMT
      IF (FLAGS(75)) THEN
      CALL T2_MESH_SETUP(ARRAY,NDIM0,NDIM1,NDIM2,N1,N2,N3,N4)
      CALL T2CWTS(ITXTUR,ITXTOP(1))
      CALL T2CWTS(0,ITXTOP(2))
      CALL TXSDEF
      J=1
      DO 10461 I=1,3
      LXYZ(MESHN(I))=IAND(IXYZ,J).ne.0
      J=j*2
10461 CONTINUE
10462 CONTINUE
      DO 10471 I=4,NXYZ
      LXYZ(I)=IAND(IXYZ,J).ne.0
      J=j*2
10471 CONTINUE
10472 CONTINUE
      IF (LGRID) THEN
      CALL T2STCK(NONLIN(MESH3), XYZLIM(MESH3,1),XYZLIM(MESH3,2), NXYZ1(
     *MESH3),NXYZ2(MESH3), SCLPRM(1,MESH3), 400/2, NB,BUFFER(1),IBUFFR(1
     *))
      J=0
      DO 10481 I=1,NB
      IF (IBUFFR(I) .gt. 0) THEN
      J=J+1
      BUFFER(J)=BUFFER(I)
      ENDIF
10481 CONTINUE
10482 CONTINUE
      NB=J
      ENDIF
      IF (LXYZ(5)) THEN
      IDRAW=2
      ISAVE=0
      IDSAV=2
      ELSE
      IDRAW=6
      ISAVE=5
      IDSAV=7
      ENDIF
      MINFR=IDSAV
      MAJFR=IDSAV
      IF (LXYZ(6)) THEN
      IF (.not.LXYZ(MINAX)) MINFR=4
      IF (.not.LXYZ(MAJAX)) MAJFR=4
      ENDIF
      IF (LXYZ(4)) MINFR=IAND(MINFR,NOT(3))
      IF (.not.LXYZ(MAJAX) .and. LXYZ(MINAX)) THEN
      I=MINAX
      MINAX=MAJAX
      MAJAX=I
      I=MINMIN
      MINMIN=MAJMIN
      MAJMIN=I
      I=MINMAX
      MINMAX=MAJMAX
      MAJMAX=I
      I=MINMN
      MINMN=MAJMN
      MAJMN=I
      I=MINMX
      MINMX=MAJMX
      MAJMX=I
      I=MINSTP
      MINSTP=MAJSTP
      MAJSTP=I
      LXYZ(MINAX)=.false.
      LXYZ(MAJAX)=.true.
      ENDIF
      DEPTH=0.
      LMESH=MINAX.eq.MESH1
      I=0
      IF(MAJMIN.gt.MAJMAX) I=1
      J=0
      IF(MINMIN.gt.MINMAX) J=1
      XMIN=T2MSHY(ARRAY,NDIM0,NDIM1,NDIM2,1)
      YMIN=T2MSHX(ARRAY,NDIM0,NDIM1,NDIM2,1)
      IXOFF=0
      IYOFF=0
      IF (MAJMIN.eq.2) IXOFF=-1
      IF (MINMIN.eq.2) IYOFF=-1
      MAJSAV=MAJMIN
      MAJMIN=MAJMN
      MINMIN=MINMN
      MAJMAX=MAJMX
      MINMAX=MINMX
      IF (LMESH) THEN
      XMIN=T2MSHY(ARRAY,NDIM0,NDIM1,NDIM2,MAJMIN+IXOFF)
      IF (LXYZ(4)) THEN
      YMIN=ARRAY(1,MINMIN,1)
      ELSE
      YMIN=T2MSHX(ARRAY,NDIM0,NDIM1,NDIM2,MINMIN+IYOFF)
      ENDIF
      ELSE
      XMIN=T2MSHX(ARRAY,NDIM0,NDIM1,NDIM2,MAJMIN+IXOFF)
      IF (LXYZ(4)) THEN
      YMIN=ARRAY(1,1,MINMIN)
      ELSE
      YMIN=T2MSHY(ARRAY,NDIM0,NDIM1,NDIM2,MINMIN+IYOFF)
      ENDIF
      ENDIF
      IXOFF=-1-IXOFF
      IYOFF=-1-IYOFF
      ZMIN=XYZLIM(MESH3,1)
      DO 10491 I=1,10
      XYZ(MINAX,I)=YMIN
      XYZ(MAJAX,I)=XMIN
      XYZ(MESH3,I)=ZMIN
10491 CONTINUE
10492 CONTINUE
      Y1=YMIN
      DO 10501 MINOR=MINMIN,MINMAX,MINSTP
      XYZ(MINAX,1)=Y1
      IF (LMESH) THEN
      Z1=ARRAY(1,MINOR,MAJMIN)
      IF (LXYZ(4)) THEN
      Y1=ARRAY(1,MINOR,1)
      ELSE
      Y1=T2MSHX(ARRAY,NDIM0,NDIM1,NDIM2,MINOR+IYOFF)
      ENDIF
      ELSE
      Z1=ARRAY(1,MAJMIN,MINOR)
      IF (LXYZ(4)) THEN
      Y1=ARRAY(1,1,MINOR)
      ELSE
      Y1=T2MSHY(ARRAY,NDIM0,NDIM1,NDIM2,MINOR+IYOFF)
      ENDIF
      ENDIF
      XYZ(MINAX,2)=Y1
      CALL T2XFRM(3,2,XYZ,NONLIN,XFRM14,2,XY)
      I=MINFR
      IF (Z1.ne.ZMIN) I=IDSAV
      CALL T2_MESH_DRAW(XY,2,I)
10501 CONTINUE
10502 CONTINUE
      DO 10511 I=1,2
      XYZ(MINAX,I)=YMIN
10511 CONTINUE
10512 CONTINUE
      X1=XMIN
      DO 10521 MAJOR=MAJMIN,MAJMAX,MAJSTP
      XYZ(MAJAX,1)=X1
      IF (LMESH) THEN
      X1=T2MSHY(ARRAY,NDIM0,NDIM1,NDIM2,MAJOR+IXOFF)
      Z1=ARRAY(1,MINMIN,MAJOR)
      ELSE
      X1=T2MSHX(ARRAY,NDIM0,NDIM1,NDIM2,MAJOR+IXOFF)
      Z1=ARRAY(1,MAJOR,MINMIN)
      ENDIF
      XYZ(MAJAX,2)=X1
      CALL T2XFRM(3,2,XYZ,NONLIN,XFRM14,2,XY)
      I=MAJFR
      IF (Z1.ne.ZMIN) I=IDSAV
      CALL T2_MESH_DRAW(XY,2,I)
10521 CONTINUE
10522 CONTINUE
      IF (.not. LXYZ(5)) THEN
      ENDIF
      Y2=YMIN
      Y1=Y2
      DO 10531 MINOR=MINMIN,MINMAX, MINSTP
      Y0=Y1
      Y1=Y2
      IF (LMESH) THEN
      IF(LXYZ(4)) THEN
      IF(MINOR.ne.MINMAX) Y2=ARRAY(1,MINOR+MINSTP,1)
      ELSE
      Y2=T2MSHX(ARRAY,NDIM0,NDIM1,NDIM2,MINOR+IYOFF)
      ENDIF
      ELSE
      IF(LXYZ(4)) THEN
      IF(MINOR.ne.MINMAX) Y2=ARRAY(1,1,MINOR+MINSTP)
      ELSE
      Y2=T2MSHY(ARRAY,NDIM0,NDIM1,NDIM2,MINOR+IYOFF)
      ENDIF
      ENDIF
      DEPTH=Y2-Y1
      DO 10541 I=1,10
      XYZ(MINAX,I)=Y1 
      XYZ(MESH3,I)=ZMIN
10541 CONTINUE
10542 CONTINUE
      IF (LMESH) THEN
      X2=T2MSHY(ARRAY,NDIM0,NDIM1,NDIM2,MAJSAV+IXOFF)
      ELSE
      X2=T2MSHX(ARRAY,NDIM0,NDIM1,NDIM2,MAJSAV+IXOFF)
      ENDIF
      IF (MINOR.eq.MINMIN.or.LXYZ(4)) THEN
      X2=XMIN
      X1=XMIN
      Z1=ZMIN
      DO 10551 MAJOR=MAJMIN,MAJMAX+MAJSTP, MAJSTP
      IF (LTRAP) GOTO 10560
      X0=X1
      X1=X2
      Z0=Z1
      IF(MAJOR .eq. MAJMAX+MAJSTP) THEN
      Z1=ZMIN
      X2=XMIN
      ELSE
      IF (LMESH) THEN
      X2=T2MSHY(ARRAY,NDIM0,NDIM1,NDIM2,MAJOR+IXOFF)
      Z1=ARRAY(1,MINOR,MAJOR)
      ELSE
      X2=T2MSHX(ARRAY,NDIM0,NDIM1,NDIM2,MAJOR+IXOFF)
      Z1=ARRAY(1,MAJOR,MINOR)
      ENDIF
      WIDTH=X2-X1
      ENDIF
      XYZ(MAJAX,1)=X1
      XYZ(MAJAX,2)=X1
      XYZ(MAJAX,3)=X1
      XYZ(MAJAX,4)=X2
      XYZ(MESH3,1)=Z0
      XYZ(MESH3,2)=Z1
      IF (LXYZ(MESH3)) THEN
      XYZ(MESH3,1)=MIN(ZMIN,Z1,Z0)
      XYZ(MESH3,2)=MAX(ZMIN,Z1,Z0)
      ENDIF
      IF(XYZ(MESH3,1) .ne. XYZ(MESH3,2)) THEN
      CALL T2XFRM(3,2,XYZ,NONLIN,XFRM14,2,XY)
      CALL T2_MESH_DRAW(XY,2,IDRAW)
      ENDIF
      IF (LXYZ(4).and..not.LXYZ(6)) THEN
      XYZ(MAJAX,3)=X1
      XYZ(MAJAX,4)=X2
      CALL T2XFRM(3,2,XYZ(1,3),NONLIN,XFRM14,2,XY)
      CALL T2_MESH_DRAW(XY,2,IDRAW)
      ENDIF
10551 CONTINUE
10552 CONTINUE
      ENDIF
      DO 10571 I=1,10
      XYZ(MESH3,I)=ZMIN
10571 CONTINUE
10572 CONTINUE
      X1=XMIN
      X2=XMIN
      Z1=ZMIN
      Z8=ZMIN
      IDONE=1
      JDONE=1
      DO 10581 MAJOR=MAJMIN,MAJMAX, MAJSTP
      IF (LTRAP) GOTO 10560
      X0=X1
      X1=X2
      Z0=Z1
      Z7=Z8
      IF (LMESH) THEN
      X2=T2MSHY(ARRAY,NDIM0,NDIM1,NDIM2,MAJOR+IXOFF)
      IF(MINOR.ne.MINMIN)Z8=ARRAY(1,MINOR-MINSTP,MAJOR)
      Z1=ARRAY(1,MINOR,MAJOR)
      ELSE
      X2=T2MSHX(ARRAY,NDIM0,NDIM1,NDIM2,MAJOR+IXOFF)
      IF(MINOR.ne.MINMIN)Z8=ARRAY(1,MAJOR,MINOR-MINSTP)
      Z1=ARRAY(1,MAJOR,MINOR)
      ENDIF
      WIDTH=X2-X1
      XYZ(MAJAX,1)=X1
      XYZ(MAJAX,2)=X1
      XYZ(MAJAX,3)=X2
      XYZ(MESH3,1)=Z0
      XYZ(MESH3,2)=Z1
      XYZ(MESH3,3)=Z1
      IDONE1=1
      JDONE1=1
      IF(Z1.ne.Z0.or.Z0.ne.Z8.or.LXYZ(4)) THEN
      IF(LXYZ(MINAX+6).and.Z1.ne.Z8) CALL T2_MESH_FILL(X1,Y1,Z8,WIDTH,0.
     *,Z1-Z8,IXYZ,DXYZ)
      IF (LGRID) THEN
      CALL T2_MESH_GRID(X1,Y1,Z8,WIDTH,0.,Z1-Z8,BUFFER,NB)
      ENDIF
      IDONE1=2
      JDONE1=2
      IF(Z0.ne.Z1)IDONE1=1
      IF(Z1.ne.Z8.or.LXYZ(4))JDONE1=3
      J=JDONE1-IDONE1+1
      IF(J.gt.1) THEN
      I=IDONE1
      CALL T2XFRM(3,J,XYZ(1,I),NONLIN,XFRM14,2,XY(1,I))
      IF(LXYZ(4))THEN
      CALL T2_MESH_DRAW(XY(1,I),J,IDRAW)
      ELSEIF(JDONE1.eq.3) THEN
      CALL T2_MESH_DRAW(XY(1,2),2,IDRAW)
      ENDIF
      ENDIF
      ENDIF
      IF (IDONE.ne.JDONE) THEN
      CALL T2_MESH_DRAW(XY(1,IDONE+5),JDONE-IDONE+1,ISAVE)
      ENDIF
      IDONE=IDONE1
      JDONE=JDONE1
      DO 10591 I=1,3
      DO 10601 J=1,2
      XY(J,I+5)=XY(J,I)
10601 CONTINUE
10602 CONTINUE
10591 CONTINUE
10592 CONTINUE
10581 CONTINUE
10582 CONTINUE
      IF (LXYZ(4).and.ZMIN.ne.Z1) THEN
      XYZ(MAJAX,1)=X2
      XYZ(MAJAX,2)=X2
      XYZ(MESH3,1)=Z1
      XYZ(MESH3,2)=ZMIN
      CALL T2XFRM(3,J,XYZ,NONLIN,XFRM14,2,XY)
      CALL T2_MESH_DRAW(XY,2,IDRAW)
      ENDIF
      IF (IDONE.ne.JDONE) THEN
      CALL T2_MESH_DRAW(XY(1,IDONE+5),JDONE-IDONE+1,ISAVE)
      ENDIF
      IF (LXYZ(4).and.ZMIN.ne.Z1) CALL T2_MESH_DRAW(XY,2,ISAVE)
      DO 10611 I=1,2
      XYZ(MINAX,I)=Y2
      XYZ(MINAX,I+3)=Y2
10611 CONTINUE
10612 CONTINUE
      DO 10621 I=1,10
      XYZ(MAJAX,I)=XMIN
      XYZ(MESH3,I)=ZMIN
10621 CONTINUE
10622 CONTINUE
      CALL T2XFRM(3,6,XYZ,NONLIN,XFRM14,2,XY)
      IF(.not.LXYZ(4).or.MINAX.ne.MINMAX) CALL T2_MESH_DRAW(XY(1,5),2,MI
     *NFR)
      IF(.not.LXYZ(4))THEN
      X1=XMIN
      X2=XMIN
      Z9=ZMIN
      Z1=ZMIN
      IF (LMESH) THEN
      Z2=ARRAY(1,MINOR,MAJMIN)
      ELSE
      Z2=ARRAY(1,MAJMIN,MINOR)
      ENDIF
      DO 10631 MAJOR=MAJMIN,MAJMAX+MAJSTP, MAJSTP
      IF (LTRAP) GOTO 10560
      X0=X1
      X1=X2
      Z0=Z1
      Z1=Z2
      Z8=Z9
      Z2=ZMIN
      Z9=ZMIN
      IF (MAJOR .ne. MAJMAX+MAJSTP) THEN
      IF (LMESH) THEN
      X2=T2MSHY(ARRAY,NDIM0,NDIM1,NDIM2,MAJOR+IXOFF)
      IF(MINOR.ne.MINMAX)Z9=ARRAY(1,MINOR+MINSTP,MAJOR)
      IF(MAJOR.ne.MAJMAX)Z2=ARRAY(1,MINOR,MAJOR+MAJSTP)
      ELSE
      X2=T2MSHX(ARRAY,NDIM0,NDIM1,NDIM2,MAJOR+IXOFF)
      IF(MINOR.ne.MINMAX)Z9=ARRAY(1,MAJOR,MINOR+MINSTP)
      IF(MAJOR.ne.MAJMAX)Z2=ARRAY(1,MAJOR+MAJSTP,MINOR)
      ENDIF
      WIDTH=X2-X1
      ELSE
      X2=X2+WIDTH
      ENDIF
      DO 10641 I=1,4
      XYZ(MAJAX,I)=X1
10641 CONTINUE
10642 CONTINUE
      XYZ(MAJAX,5)=X2
      XYZ(MAJAX,6)=X2
      ID(1)=1
      ID(2)=2
      ID(3)=2
      ID(4)=1
      ZD(1)=Z0
      ZD(2)=Z1
      ZD(3)=Z8
      ZD(4)=Z9
      DO 10651 I=1,3
      TEMP=ZD(I)
      K=ID(I)
      DO 10661 J=I,4
      IF(TEMP.gt.ZD(J))THEN
      TEMP =ZD(J)
      K=ID(J)
      ZD(J)=ZD(I)
      ID(J)=ID(I)
      ZD(I)=TEMP 
      ID(I)=K
      ENDIF
10661 CONTINUE
10662 CONTINUE
10651 CONTINUE
10652 CONTINUE
      IF(LXYZ(MESH3).or.ID(1).eq.ID(2)) THEN
      XYZ(MESH3,1)=ZD(1)
      XYZ(MESH3,2)=ZD(4)
      IF(XYZ(MESH3,1).ne.XYZ(MESH3,2)) THEN
      CALL T2XFRM(3,2,XYZ,NONLIN,XFRM14,2,XY(1,8))
      CALL T2_MESH_DRAW(XY(1,8),2,IDRAW)
      ENDIF
      ELSE
      DO 10671 I=1,3,2
      XYZ(MESH3,1)=ZD(I)
      XYZ(MESH3,2)=ZD(I+1)
      IF(XYZ(MESH3,1).ne.XYZ(MESH3,2)) THEN
      CALL T2XFRM(3,2,XYZ,NONLIN,XFRM14,2,XY(1,8))
      CALL T2_MESH_DRAW(XY(1,8),2,IDRAW)
      ENDIF
10671 CONTINUE
10672 CONTINUE
      ENDIF
      XYZ(MESH3,1)=Z0
      DO 10681 I=2,6
      XYZ(MESH3,I)=Z1
10681 CONTINUE
10682 CONTINUE
      CALL T2XFRM(3,3,XYZ(1,4),NONLIN,XFRM14,2,XY(1,4))
      IF(Z0.ne.Z1) THEN
      IF(LXYZ(MAJAX+6)) CALL T2_MESH_FILL(X1,Y1,Z0,0.,DEPTH,Z1-Z0,IXYZ,D
     *XYZ)
      IF (LGRID) THEN
      CALL T2_MESH_GRID(X1,Y1,Z0,0.,DEPTH,Z1-Z0,BUFFER,NB)
      ENDIF
      DO 10691 I=1,2
      XY(I,2)=XY(I,4)
10691 CONTINUE
10692 CONTINUE
      CALL T2XFRM(3,3,XYZ(1,1),NONLIN,XFRM14,2,XY(1,1))
      CALL T2_MESH_DRAW(XY(1,2),2,IDSAV)
      CALL T2_MESH_DRAW(XY(1,1),2,ISAVE)
      ENDIF
      IF(MAJOR .ne. MAJMAX+MAJSTP) THEN
      J=5
      I=5
      IF (Z1.ne.Z9.or.LXYZ(MAJAX).or. (MINOR.eq.minmax.and..not.LXYZ(6))
     *) J=4
      IF (Z1.ne.Z2.or.LXYZ(MINAX).or. (MAJOR.eq.MAJMAX.and..not.LXYZ(6))
     *) I=6
      I=I-J+1
      IF(LXYZ(MESH3+6)) CALL T2_MESH_FILL(X1,Y1,Z1,WIDTH,DEPTH,0.,IXYZ,D
     *XYZ)
      IF(I.gt.1) CALL T2_MESH_DRAW(XY(1,J),I,IDRAW)
      CALL T2_MESH_DRAW(XY(1,4),3,ISAVE)
      ENDIF
10631 CONTINUE
10632 CONTINUE
      ENDIF
10531 CONTINUE
10532 CONTINUE
      CALL T2_MESH_FLUSH
10560 CONTINUE
      IF (FLAGS(122)) CALL TXXMT
      CALL T2CWTS(ITXTOP(1),IDUM)
      CALL TXSCIS(1)
      ITXTOP(1)=0
      ITXTOP(2)=0
      ENDIF
      CALL T2TCKS(8)
      END
      SUBROUTINE T23JIN(ARRAY,NDIM0,NDIM1,NDIM2,IXYZ,ITXTUR,N1,N3,N2,N4)
     *
      INTEGER NDIM0,NDIM1,NDIM2,IXYZ
      REAL ARRAY(NDIM0,NDIM1,NDIM2+1)
      COMMON /T2FLGC/ FLAGS(200), LTRAP,LHANDL,LSYERR,LSCREV
      LOGICAL FLAGS, LTRAP,LHANDL,LSYERR,LSCREV(3)
      INTEGER RELFLAG 
      PARAMETER (RELFLAG=151)
      INTEGER IWINLEV 
      INTEGER NWINLEV , MAX_FILL 
      PARAMETER (NWINLEV =4)
      PARAMETER (MAX_FILL=4)
      REAL GRDSYM, GRDSIZ, DATDAT(2,8), H2STAT(12), TITLIN(4), TITFA
     *C(4), TITLOC(4), TITMAR(4), TITLMX(4), TIKFAC, TITINX, TITX1, TIT
     *Y1, TITX, TITY, TITZ, TITSIZ, TITCON(5), REVLEV, REDUCE(5), XFR
     *M12(12), XFRM13(12), XFRM14(12), XFRM23(12), XFRM24(12), XFRM34(6
     *), XVARSX(20), CIRSIZ(2,3), ASIZE, AFLARE, SMSZDF, ORAXES(3), EY
     *EDIR(3), VUEDIR(3), VUECEN(3), VERTCL(3), EYESEP, SCRD, SCRZ, EYE
     *DIS, EYEPNT(3), XYPART(2, 2), BARSIZ(3), BARBRK(3), TIKSIZ(3), XY
     *ZBAS(3), TTHETA, TPHI, FRELBL(4), PATRN(20,30), SCLPRM(10,3), WI
     *NDOW(4), SCREEN(2), SYMBOL, NOSYMB, FACTXY(19), LBLSIZ, SYMSIZ, X
     *YZLIM(3,2), WORLD(3), RADRMX, RADRMN, RADAMN, RADANG, RADX0, RADY
     *0, XUNUSD(6), AXANG(3), REDFAC, DSCAL, PATSZ, MARGIN(4), PSCR(2
     *), OREAL, OCPU, CSCRD, DATPTS, ERRPTS, DATXMN, DATXMX, DATYMN, DA
     *TYMX, DATZMN, DATZMX, DATSUM, ERRSUM, DATAVE, ERRAVE, DATCEN, ERR
     *CEN, DATSTD, ERRSTD, WINREL(2,2,NWINLEV),WINABS(2,2,NWINLEV),WINL
     *IM(2,2), FMARKER(3,8), SYDIR(3), GRDIR(3), EXYZLIM(3,2), DSLOPE(2
     *,2)
      REAL PLOT_EXTENT(2,2),FILL_ANGLE(MAX_FILL),FILL_WIDTH(MAX_FILL)
      INTEGER FILL_INDEX, FILL_TEX(MAX_FILL), N_LINES(6)
      EQUIVALENCE (DATDAT, DATPTS)
      INTEGER MAXREP
      PARAMETER (MAXREP=5)
      INTEGER IPATRN, NPATRN(30), NXYLIM(3,2), NPLOTS, NCSETS, NCCOL, N
     *CROW, IYEAR, IMONTH, IDAY, ISIGFG, ITXPRI, ITXSEC, ITITDT(3), L
     *ENCRD, IPROP, IHTEX, IBLINK, IERASE, ITCNTR, IUNUSD, NXYZ1(3), 
     *NXYZ2(3), LBLFMT(3), LBLCHR(3), NDIMNS(3), IBLKTP, IDIMNS, NMES
     *H0, NMESH1, NMESH2, MESH1, MESH2, MESH3, MESH2D, MESHN(3), NMESHN(
     *2), NFIELD, IFIELD(19), NINCR, NPOINT, IVARBL(19), IVPTR(19), I_
     *VORDER(19,2), LINEAR(4), NONLIN(4), MXECHO, LINES, MAXLNS, USRK
     *BD, USRSCR, PLTFIL, LINWID, LINCOL, LINTEX, ICPOIN(3), IREPCT(MA
     *XREP), LEVREP, GRDTYP, GRDTEX, OUTTEX, IAXTEX, TITEX, LETSET, LAB
     *TEX, TICTEX, SHADOWTYP,SHADOWTEX, NXYZDEF1(10), NXYZDEF2(10), IF
     *ILE_CASE ,MAX_SUBST
      INTEGER MAX_CYCLE
      PARAMETER (MAX_CYCLE=20)
      INTEGER N_CYCLE, ITX_CYCLE(MAX_CYCLE)
      REAL SYM_CYCLE(MAX_CYCLE)
      EQUIVALENCE (NMESH1,NMESHN)
      EQUIVALENCE (MESH1,MESHN)
      INTEGER IBUFFR(400)
      REAL BUFFER(400)
      INTEGER NCHSAVE 
      PARAMETER (NCHSAVE=2*512) 
      INTEGER*4 ICHSAVE(NCHSAVE)
      INTEGER*4 IVRPTR(15)
      CHARACTER*512 OUTSTR,C_FILE, C_NAME, C_SELECT
      CHARACTER C_TIT_ESCAPE*1,C_TIT_SUBSTITUTE*2
      INTEGER N_FILE, N_NAME, N_SELECT
      CHARACTER*8 PXNAME
      CHARACTER*64 INPFMT
      LOGICAL LTDATA, OUTSID(4)
      COMMON /T2COM/ PXNAME, REDUCE, TITX, TITY ,XFRM12, XFRM13, XFRM1
     *4, XFRM23 ,XFRM24, XFRM34 ,XVARSX ,TITSIZ, GRDSYM, GRDSIZ, CIRS
     *IZ, ASIZE, AFLARE ,SMSZDF, ORAXES, EYEDIR, VUEDIR, VUECEN ,VERTC
     *L, EYESEP, SCRD, SCRZ, EYEDIS, EYEPNT ,XYPART, BARSIZ, TIKSIZ, XY
     *ZBAS, TTHETA ,TPHI, FRELBL, IPATRN, NPATRN, PATRN ,SCLPRM, WINDO
     *W, SCREEN, SYMBOL, NOSYMB ,FACTXY, LBLSIZ, SYMSIZ, XYZLIM, WORLD 
     *,RADRMX, RADRMN, RADAMN, RADANG, RADX0, RADY0, XUNUSD ,USRKBD, U
     *SRSCR, PLTFIL ,ITITDT, LENCRD ,INPFMT, GRDTYP, LINWID, LINCOL, L
     *INTEX, TITCON, ITCNTR ,IUNUSD, NXYZ1, NXYZ2 ,LBLCHR, NDIMNS, IBL
     *KTP, IDIMNS ,NMESH1, NMESH2, MESH1, MESH2, MESH3, NFIELD ,IFIELD
     *, NINCR ,IVARBL, IVRPTR ,LINEAR, NONLIN ,NPOINT, LETSET ,MXECH
     *O, LINES, MAXLNS ,AXANG, MESH2D, REDFAC, GRDTEX, OUTTEX, IAXTEX, 
     *TITEX, DSCAL ,OUTSTR, IPROP, IHTEX, IBLINK, IERASE, LABTEX, TICTE
     *X, NXYLIM, PATSZ ,MARGIN, PSCR, ITXPRI, ITXSEC, OREAL, OCPU, CSCR
     *D, OUTSID ,TITLIN, TITINX, TITZ, TITX1, TITY1, LTDATA, NPLOTS, RE
     *VLEV ,LBLFMT, IYEAR, IMONTH, IDAY, ISIGFG ,DATPTS, ERRPTS, DATXM
     *N, DATXMX, DATYMN, DATYMX, DATZMN, DATZMX ,DATSUM, ERRSUM, DATAVE
     *, ERRAVE, DATCEN, ERRCEN, DATSTD, ERRSTD ,NCSETS, NCCOL, NCROW, F
     *MARKER, H2STAT, TITFAC, TITLOC, TITMAR ,TIKFAC, IWINLEV, WINREL, 
     *WINABS, WINLIM ,ICPOIN, LEVREP, IREPCT, SYDIR, GRDIR, NMESH0, EXY
     *ZLIM, IVPTR ,TITLMX, NXYZDEF1, NXYZDEF2, IFILE_CASE, N_CYCLE, ITX
     *_CYCLE ,SYM_CYCLE, PLOT_EXTENT, FILL_ANGLE, FILL_WIDTH, FILL_TEX 
     *,FILL_INDEX ,N_LINES ,DSLOPE ,MAX_SUBST, BARBRK ,I_VORDER,SHADOW
     *TYP,SHADOWTEX
      COMMON /T2SCRT/ BUFFER, IBUFFR, N_FILE,N_NAME,N_SELECT, ICHSAVE
      COMMON /T2_CHAR/ C_TIT_ESCAPE,C_TIT_SUBSTITUTE
      COMMON /T2_SCRT/ C_FILE, C_NAME, C_SELECT
      INTEGER JOUFIL, ERRFIL, OUTFIL, DBGFIL, INPFIL, NINMAX
      PARAMETER (NINMAX=20)
      INTEGER NINP(NINMAX)
      COMMON /T2TRBK/NINP, JOUFIL, ERRFIL, OUTFIL, DBGFIL, INPFIL
      CHARACTER*512 STRNG, STJOU
      LOGICAL LTOKEN
      REAL FLOTNG
      INTEGER INTERP, KEYORD, NSTRNG, MAXSTR, NSTJOU, LSTJOU, NTOKEN
      INTEGER*4 INTEG
      COMMON /TOKENC/ INTERP, INTEG, FLOTNG, KEYORD, NSTRNG, MAXSTR, ST
     *RNG, NSTJOU, LSTJOU, STJOU, LTOKEN, NTOKEN
      INTEGER IHSIZE,NPSTOR
      REAL TOLR
      PARAMETER (IHSIZE=2000)
      PARAMETER (TOLR=0.001)
      PARAMETER (NPSTOR=30)
      INTEGER IBOLD,IB,IBT,MAJMIN,MAJMAX,MINMIN,MINMAX,MAJSTP,MINSTP ,MI
     *NMN,MINMX,MAJMN,MAJMX ,MAJAX,MINAX,IFREE,IHBTOP(2),ITXTOP(2),LEFT,
     *IRIGHT,IPASS
      INTEGER*2 IHFWD(IHSIZE), IHBACK(IHSIZE)
      LOGICAL LFREE,VFLG,LVANISH
      REAL ROTCOS,ROTSIN,PNT12(2,2),XX(2,4) ,BUFR(NPSTOR),HORXY(2,IHSIZE
     *),VANISH_PNT(2)
      COMMON /T2MSHC/ MAJMIN,MAJMAX,MINMIN,MINMAX,MAJSTP,MINSTP ,MINMN,M
     *INMX,MAJMN,MAJMX ,MAJAX,MINAX,IB,IFREE,IHBTOP,ROTCOS,ROTSIN ,PNT12
     *,XX,IBT,VFLG,LEFT,IRIGHT ,ITXTOP,IBOLD,LFREE ,BUFR,HORXY ,IHFWD,IH
     *BACK,IPASS,LVANISH,VANISH_PNT
      EXTERNAL T2_MESH_DATA
      LOGICAL LERROR , LCROSS 
      REAL XYZ(3,4), XYZE(3,2), XYE(2,2), XY(2,4)
      REAL DZ,X1,Y1
      INTEGER I,J,MINOR,MAJOR,JXYZ,NMIN,IMIND,IMIND1,IMIND2,IMIND3
      IF (.not. FLAGS(75)) FLAGS(56)=NDIMNS(1).ne.2
      CALL T23LIM(ARRAY,NDIM0,NDIM1,NDIM2)
      CALL T2AXES
      IF (FLAGS(122)) CALL TXXMT
      IF (FLAGS(75)) THEN
      CALL T2_MESH_SETUP(ARRAY,NDIM0,NDIM1,NDIM2,N1,N2,N3,N4)
      CALL T2CWTS(ITXTUR,ITXTOP(1))
      CALL T2CWTS(0,ITXTOP(2))
      CALL TXSDEF
      JXYZ=IAND(IXYZ,3)
      IF (JXYZ.gt.0) JXYZ=MESHN(JXYZ)
      LERROR=IAND(IXYZ,64).ne.0 .and. NDIM0.eq.2
      LCROSS=JXYZ.ne.MAJAX .and. JXYZ.ne.MINAX
      IF (.not.LCROSS .and. IAND(IXYZ,32).eq.0) CALL T2_MESH_HORIZ(ARRAY
     *,NDIM0,NDIM1,NDIM2,0.)
      MAJMIN=MAJMN
      MAJMAX=MAJMX
      MINMIN=MINMN
      MINMAX=MINMX
      IF (JXYZ.EQ.MINAX) THEN
      I=MINAX
      MINAX=MAJAX
      MAJAX=I
      I=MINMIN
      MINMIN=MAJMIN
      MAJMIN=I
      I=MINMAX
      MINMAX=MAJMAX
      MAJMAX=I
      I=MINSTP
      MINSTP=MAJSTP
      MAJSTP=I
      ENDIF
      IF (IAND(IXYZ,16).ne.0) THEN
      IMIND1=2
      IMIND2=2
      IMIND3=2
      ELSE
      IMIND1=3
      IMIND2=7
      IMIND3=3
      ENDIF
      NMAX=2
      IF (MINAX.EQ.MESH1) THEN
      DO 10701 MINOR=MINMIN,MINMAX ,MINSTP
      IMIND=IMIND1
      XYZ(MINAX,3)=Y1
      Y1=ARRAY(1,MINOR,1)
      DO 10711 I=1,2
      XYZ(MINAX,I)=Y1
10711 CONTINUE
10712 CONTINUE
      XYZ(MAJAX,2)=ARRAY(1,1,MAJMIN)
      XYZ(MAJAX,3)=ARRAY(1,1,MAJMIN)
      NMIN=2
      DO 10721 MAJOR=MAJMIN,MAJMAX ,MAJSTP
      IF (LTRAP) GOTO 10730
      XY(1,1)=XY(1,2)
      XY(2,1)=XY(2,2)
      X1=ARRAY(1,1,MAJOR)
      XYZ(MAJAX,2)=X1
      XYZ(MESH3,2)=ARRAY(1,MINOR,MAJOR)
      IF (NMAX.eq.3) THEN
      XYZ(MAJAX,3)=X1
      XYZ(MESH3,3)=ARRAY(1,MINOR-MINSTP,MAJOR)
      ENDIF
      CALL T2XFRM(3,NMAX-NMIN+1,XYZ(1,2),NONLIN,XFRM14,2,XY(1,2))
      IF (NMIN.ne.NMAX) CALL T2_MESH_DRAW(XY(1,NMIN),NMAX-NMIN+1,IMIND)
      NMIN=1
      IMIND=IMIND3
      IF (LERROR) THEN
      DZ=ARRAY(2,MINOR,MAJOR)
      DO 10741 I=1,2
      DO 10751 J=1,3
      XYZE(J,I)=XYZ(J,2)
10751 CONTINUE
10752 CONTINUE
      XYZE(MESH3,I)=XYZE(MESH3,I)+DZ
      DZ=-DZ
10741 CONTINUE
10742 CONTINUE
      CALL T2XFRM(3,2,XYZE,NONLIN,XFRM14,2,XYE)
      CALL T2_MESH_DRAW(XYE,2,IMIND)
      ENDIF
10721 CONTINUE
10722 CONTINUE
      IMIND3=IMIND2
      IF (LCROSS) NMAX=3
10701 CONTINUE
10702 CONTINUE
      ELSE
      DO 10761 MINOR=MINMIN,MINMAX ,MINSTP
      IMIND=IMIND1
      XYZ(MINAX,3)=Y1
      Y1=ARRAY(1,1,MINOR)
      DO 10771 I=1,2
      XYZ(MINAX,I)=Y1
10771 CONTINUE
10772 CONTINUE
      XYZ(MAJAX,2)=ARRAY(1,MAJMIN,1)
      XYZ(MAJAX,3)=ARRAY(1,MAJMIN,1)
      NMIN=2
      DO 10781 MAJOR=MAJMIN,MAJMAX ,MAJSTP
      IF (LTRAP) GOTO 10730
      XY(1,1)=XY(1,2)
      XY(2,1)=XY(2,2)
      X1=ARRAY(1,MAJOR,1)
      XYZ(MAJAX,2)=X1
      XYZ(MESH3,2)=ARRAY(1,MAJOR,MINOR)
      IF (NMAX.eq.3) THEN
      XYZ(MAJAX,3)=X1
      XYZ(MESH3,3)=ARRAY(1,MAJOR,MINOR-MINSTP)
      ENDIF
      CALL T2XFRM(3,NMAX-NMIN+1,XYZ(1,2),NONLIN,XFRM14,2,XY(1,2))
      IF (NMIN.ne.NMAX) CALL T2_MESH_DRAW(XY(1,NMIN),NMAX-NMIN+1,IMIND)
      NMIN=1
      IMIND=IMIND3
      IF (LERROR) THEN
      DZ=ARRAY(2,MAJOR,MINOR)
      DO 10791 I=1,2
      DO 10801 J=1,3
      XYZE(J,I)=XYZ(J,2)
10801 CONTINUE
10802 CONTINUE
      XYZE(MESH3,I)=XYZE(MESH3,I)+DZ
      DZ=-DZ
10791 CONTINUE
10792 CONTINUE
      CALL T2XFRM(3,2,XYZE,NONLIN,XFRM14,2,XYE)
      CALL T2_MESH_DRAW(XYE,2,IMIND)
      ENDIF
10781 CONTINUE
10782 CONTINUE
      IMIND3=IMIND2
      IF (LCROSS) NMAX=3
10761 CONTINUE
10762 CONTINUE
      ENDIF
      CALL T2_MESH_FLUSH
10730 CONTINUE
      IF (FLAGS(122)) CALL TXXMT
      CALL T2CWTS(ITXTOP(1),IDUM)
      CALL TXSCIS(1)
      ITXTOP(1)=0
      ITXTOP(2)=0
      ENDIF
      CALL T2TCKS(8)
      END
      SUBROUTINE T2_MESH_SETUP(ARRAY,NDIM0,NDIM1,NDIM2,N1,N2,N3,N4)
      IMPLICIT NONE
      INTEGER NDIM0,NDIM1,NDIM2,N1,N2,N3,N4
      REAL ARRAY(NDIM0,NDIM1,NDIM2)
      COMMON /T2FLGC/ FLAGS(200), LTRAP,LHANDL,LSYERR,LSCREV
      LOGICAL FLAGS, LTRAP,LHANDL,LSYERR,LSCREV(3)
      INTEGER RELFLAG 
      PARAMETER (RELFLAG=151)
      INTEGER IWINLEV 
      INTEGER NWINLEV , MAX_FILL 
      PARAMETER (NWINLEV =4)
      PARAMETER (MAX_FILL=4)
      REAL GRDSYM, GRDSIZ, DATDAT(2,8), H2STAT(12), TITLIN(4), TITFA
     *C(4), TITLOC(4), TITMAR(4), TITLMX(4), TIKFAC, TITINX, TITX1, TIT
     *Y1, TITX, TITY, TITZ, TITSIZ, TITCON(5), REVLEV, REDUCE(5), XFR
     *M12(12), XFRM13(12), XFRM14(12), XFRM23(12), XFRM24(12), XFRM34(6
     *), XVARSX(20), CIRSIZ(2,3), ASIZE, AFLARE, SMSZDF, ORAXES(3), EY
     *EDIR(3), VUEDIR(3), VUECEN(3), VERTCL(3), EYESEP, SCRD, SCRZ, EYE
     *DIS, EYEPNT(3), XYPART(2, 2), BARSIZ(3), BARBRK(3), TIKSIZ(3), XY
     *ZBAS(3), TTHETA, TPHI, FRELBL(4), PATRN(20,30), SCLPRM(10,3), WI
     *NDOW(4), SCREEN(2), SYMBOL, NOSYMB, FACTXY(19), LBLSIZ, SYMSIZ, X
     *YZLIM(3,2), WORLD(3), RADRMX, RADRMN, RADAMN, RADANG, RADX0, RADY
     *0, XUNUSD(6), AXANG(3), REDFAC, DSCAL, PATSZ, MARGIN(4), PSCR(2
     *), OREAL, OCPU, CSCRD, DATPTS, ERRPTS, DATXMN, DATXMX, DATYMN, DA
     *TYMX, DATZMN, DATZMX, DATSUM, ERRSUM, DATAVE, ERRAVE, DATCEN, ERR
     *CEN, DATSTD, ERRSTD, WINREL(2,2,NWINLEV),WINABS(2,2,NWINLEV),WINL
     *IM(2,2), FMARKER(3,8), SYDIR(3), GRDIR(3), EXYZLIM(3,2), DSLOPE(2
     *,2)
      REAL PLOT_EXTENT(2,2),FILL_ANGLE(MAX_FILL),FILL_WIDTH(MAX_FILL)
      INTEGER FILL_INDEX, FILL_TEX(MAX_FILL), N_LINES(6)
      EQUIVALENCE (DATDAT, DATPTS)
      INTEGER MAXREP
      PARAMETER (MAXREP=5)
      INTEGER IPATRN, NPATRN(30), NXYLIM(3,2), NPLOTS, NCSETS, NCCOL, N
     *CROW, IYEAR, IMONTH, IDAY, ISIGFG, ITXPRI, ITXSEC, ITITDT(3), L
     *ENCRD, IPROP, IHTEX, IBLINK, IERASE, ITCNTR, IUNUSD, NXYZ1(3), 
     *NXYZ2(3), LBLFMT(3), LBLCHR(3), NDIMNS(3), IBLKTP, IDIMNS, NMES
     *H0, NMESH1, NMESH2, MESH1, MESH2, MESH3, MESH2D, MESHN(3), NMESHN(
     *2), NFIELD, IFIELD(19), NINCR, NPOINT, IVARBL(19), IVPTR(19), I_
     *VORDER(19,2), LINEAR(4), NONLIN(4), MXECHO, LINES, MAXLNS, USRK
     *BD, USRSCR, PLTFIL, LINWID, LINCOL, LINTEX, ICPOIN(3), IREPCT(MA
     *XREP), LEVREP, GRDTYP, GRDTEX, OUTTEX, IAXTEX, TITEX, LETSET, LAB
     *TEX, TICTEX, SHADOWTYP,SHADOWTEX, NXYZDEF1(10), NXYZDEF2(10), IF
     *ILE_CASE ,MAX_SUBST
      INTEGER MAX_CYCLE
      PARAMETER (MAX_CYCLE=20)
      INTEGER N_CYCLE, ITX_CYCLE(MAX_CYCLE)
      REAL SYM_CYCLE(MAX_CYCLE)
      EQUIVALENCE (NMESH1,NMESHN)
      EQUIVALENCE (MESH1,MESHN)
      INTEGER IBUFFR(400)
      REAL BUFFER(400)
      INTEGER NCHSAVE 
      PARAMETER (NCHSAVE=2*512) 
      INTEGER*4 ICHSAVE(NCHSAVE)
      INTEGER*4 IVRPTR(15)
      CHARACTER*512 OUTSTR,C_FILE, C_NAME, C_SELECT
      CHARACTER C_TIT_ESCAPE*1,C_TIT_SUBSTITUTE*2
      INTEGER N_FILE, N_NAME, N_SELECT
      CHARACTER*8 PXNAME
      CHARACTER*64 INPFMT
      LOGICAL LTDATA, OUTSID(4)
      COMMON /T2COM/ PXNAME, REDUCE, TITX, TITY ,XFRM12, XFRM13, XFRM1
     *4, XFRM23 ,XFRM24, XFRM34 ,XVARSX ,TITSIZ, GRDSYM, GRDSIZ, CIRS
     *IZ, ASIZE, AFLARE ,SMSZDF, ORAXES, EYEDIR, VUEDIR, VUECEN ,VERTC
     *L, EYESEP, SCRD, SCRZ, EYEDIS, EYEPNT ,XYPART, BARSIZ, TIKSIZ, XY
     *ZBAS, TTHETA ,TPHI, FRELBL, IPATRN, NPATRN, PATRN ,SCLPRM, WINDO
     *W, SCREEN, SYMBOL, NOSYMB ,FACTXY, LBLSIZ, SYMSIZ, XYZLIM, WORLD 
     *,RADRMX, RADRMN, RADAMN, RADANG, RADX0, RADY0, XUNUSD ,USRKBD, U
     *SRSCR, PLTFIL ,ITITDT, LENCRD ,INPFMT, GRDTYP, LINWID, LINCOL, L
     *INTEX, TITCON, ITCNTR ,IUNUSD, NXYZ1, NXYZ2 ,LBLCHR, NDIMNS, IBL
     *KTP, IDIMNS ,NMESH1, NMESH2, MESH1, MESH2, MESH3, NFIELD ,IFIELD
     *, NINCR ,IVARBL, IVRPTR ,LINEAR, NONLIN ,NPOINT, LETSET ,MXECH
     *O, LINES, MAXLNS ,AXANG, MESH2D, REDFAC, GRDTEX, OUTTEX, IAXTEX, 
     *TITEX, DSCAL ,OUTSTR, IPROP, IHTEX, IBLINK, IERASE, LABTEX, TICTE
     *X, NXYLIM, PATSZ ,MARGIN, PSCR, ITXPRI, ITXSEC, OREAL, OCPU, CSCR
     *D, OUTSID ,TITLIN, TITINX, TITZ, TITX1, TITY1, LTDATA, NPLOTS, RE
     *VLEV ,LBLFMT, IYEAR, IMONTH, IDAY, ISIGFG ,DATPTS, ERRPTS, DATXM
     *N, DATXMX, DATYMN, DATYMX, DATZMN, DATZMX ,DATSUM, ERRSUM, DATAVE
     *, ERRAVE, DATCEN, ERRCEN, DATSTD, ERRSTD ,NCSETS, NCCOL, NCROW, F
     *MARKER, H2STAT, TITFAC, TITLOC, TITMAR ,TIKFAC, IWINLEV, WINREL, 
     *WINABS, WINLIM ,ICPOIN, LEVREP, IREPCT, SYDIR, GRDIR, NMESH0, EXY
     *ZLIM, IVPTR ,TITLMX, NXYZDEF1, NXYZDEF2, IFILE_CASE, N_CYCLE, ITX
     *_CYCLE ,SYM_CYCLE, PLOT_EXTENT, FILL_ANGLE, FILL_WIDTH, FILL_TEX 
     *,FILL_INDEX ,N_LINES ,DSLOPE ,MAX_SUBST, BARBRK ,I_VORDER,SHADOW
     *TYP,SHADOWTEX
      COMMON /T2SCRT/ BUFFER, IBUFFR, N_FILE,N_NAME,N_SELECT, ICHSAVE
      COMMON /T2_CHAR/ C_TIT_ESCAPE,C_TIT_SUBSTITUTE
      COMMON /T2_SCRT/ C_FILE, C_NAME, C_SELECT
      INTEGER JOUFIL, ERRFIL, OUTFIL, DBGFIL, INPFIL, NINMAX
      PARAMETER (NINMAX=20)
      INTEGER NINP(NINMAX)
      COMMON /T2TRBK/NINP, JOUFIL, ERRFIL, OUTFIL, DBGFIL, INPFIL
      CHARACTER*512 STRNG, STJOU
      LOGICAL LTOKEN
      REAL FLOTNG
      INTEGER INTERP, KEYORD, NSTRNG, MAXSTR, NSTJOU, LSTJOU, NTOKEN
      INTEGER*4 INTEG
      COMMON /TOKENC/ INTERP, INTEG, FLOTNG, KEYORD, NSTRNG, MAXSTR, ST
     *RNG, NSTJOU, LSTJOU, STJOU, LTOKEN, NTOKEN
      INTEGER IHSIZE,NPSTOR
      REAL TOLR
      PARAMETER (IHSIZE=2000)
      PARAMETER (TOLR=0.001)
      PARAMETER (NPSTOR=30)
      INTEGER IBOLD,IB,IBT,MAJMIN,MAJMAX,MINMIN,MINMAX,MAJSTP,MINSTP ,MI
     *NMN,MINMX,MAJMN,MAJMX ,MAJAX,MINAX,IFREE,IHBTOP(2),ITXTOP(2),LEFT,
     *IRIGHT,IPASS
      INTEGER*2 IHFWD(IHSIZE), IHBACK(IHSIZE)
      LOGICAL LFREE,VFLG,LVANISH
      REAL ROTCOS,ROTSIN,PNT12(2,2),XX(2,4) ,BUFR(NPSTOR),HORXY(2,IHSIZE
     *),VANISH_PNT(2)
      COMMON /T2MSHC/ MAJMIN,MAJMAX,MINMIN,MINMAX,MAJSTP,MINSTP ,MINMN,M
     *INMX,MAJMN,MAJMX ,MAJAX,MINAX,IB,IFREE,IHBTOP,ROTCOS,ROTSIN ,PNT12
     *,XX,IBT,VFLG,LEFT,IRIGHT ,ITXTOP,IBOLD,LFREE ,BUFR,HORXY ,IHFWD,IH
     *BACK,IPASS,LVANISH,VANISH_PNT
      EXTERNAL T2_MESH_DATA
      REAL XYZ(3,4),XY(2,4),XYZ2(3,4)
      REAL XBAR,YBAR,DX,DY,XE,YE,Z1,Z2,SQ
      INTEGER J1,J2,J3,J4
      IB=0
      IBOLD=-1
      FLAGS(28) = .TRUE.
      CALL TXSCIS(2)
      XYZ(MESH1,1)=ARRAY(1,2,1)
      XYZ(MESH2,1)=ARRAY(1,1,2)
      XYZ(MESH3,1)=ARRAY(1,2,2)
      XYZ(MESH1,2)=ARRAY(1,NDIM1,1)
      XYZ(MESH2,2)=ARRAY(1,1,2)
      XYZ(MESH3,2)=ARRAY(1,NDIM1,2)
      XYZ(MESH1,3)=ARRAY(1,2,1)
      XYZ(MESH2,3)=ARRAY(1,1,NDIM2)
      XYZ(MESH3,3)=ARRAY(1,2,NDIM2)
      XYZ(MESH1,4)=ARRAY(1,NDIM1,1)
      XYZ(MESH2,4)=ARRAY(1,1,NDIM2)
      XYZ(MESH3,4)=ARRAY(1,NDIM1,NDIM2)
      CALL T2XFRM(3,4,XYZ,NONLIN,XFRM12,3,XYZ2)
      XBAR = 0.5*(XYZ2(MESH1,4)+XYZ2(MESH1,1))
      YBAR = 0.5*(XYZ2(MESH2,4)+XYZ2(MESH2,1))
      DX = XYZ2(MESH1,4) - XYZ2(MESH1,1)
      DY = XYZ2(MESH2,4) - XYZ2(MESH2,1)
      XE = EYEPNT(MESH1) - XBAR
      YE = EYEPNT(MESH2) - YBAR
      Z1 = XE*DY - YE*DX
      Z2 = XE*DY + YE*DX
      MAJMIN=2
      MAJMAX=2
      MINMIN=2
      MINMAX=2
      MAJMN=2
      MAJMX=2
      MINMN=2
      MINMX=2
      J1=2
      J2=2
      J3=NDIM1
      J4=NDIM2
      IF(N1.gt.0) J1=MIN(NDIM1,N1+1)
      IF(N2.gt.0) J2=MIN(NDIM2,N2+1)
      IF(N3.gt.0) J3=MIN(NDIM1,N3+1)
      IF(N4.gt.0) J4=MIN(NDIM2,N4+1)
      IF (Z1*Z2.GE.0.) THEN
      MAJAX = MESH2
      MINAX = MESH1
      IF ((XE-XBAR)*(XYZ2(MESH1,1)-XBAR).GE.0.) THEN
      MINMAX=NDIM1
      MINMN=J1
      MINMX=J3
      ELSE
      MINMIN=NDIM1
      MINMN=J3
      MINMX=J1
      ENDIF
      IF ((YE-YBAR)*(XYZ2(MESH2,1)-YBAR).GE.0.) THEN
      MAJMAX=NDIM2
      MAJMN=J2
      MAJMX=J4
      ELSE
      MAJMIN=NDIM2
      MAJMN=J4
      MAJMX=J2
      ENDIF
      ELSE
      MAJAX = MESH1
      MINAX = MESH2
      IF ((XE-XBAR)*(XYZ2(MESH1,1)-XBAR).GE.0.) THEN
      MAJMAX=NDIM1
      MAJMN=J1
      MAJMX=J3
      ELSE
      MAJMIN=NDIM1
      MAJMN=J3
      MAJMX=J1
      ENDIF
      IF ((YE-YBAR)*(XYZ2(MESH2,1)-YBAR).GE.0.) THEN
      MINMAX=NDIM2
      MINMN=J2
      MINMX=J4
      ELSE
      MINMIN=NDIM2
      MINMN=J4
      MINMX=J2
      ENDIF
      ENDIF
      MAJSTP = ISIGN(1,MAJMAX-MAJMIN)
      MINSTP = ISIGN(1,MINMAX-MINMIN)
      XBAR=(ARRAY(1,2,1)+ARRAY(1,NDIM1,1))/2
      YBAR=(ARRAY(1,1,2)+ARRAY(1,1,NDIM2))/2
      XYZ(MESH1,1)=XBAR
      XYZ(MESH1,2)=XBAR
      XYZ(MESH2,1)=YBAR
      XYZ(MESH2,2)=YBAR
      XYZ(MESH3,1)=XYZLIM(MESH3,1)
      XYZ(MESH3,2)=XYZLIM(MESH3,2)
      CALL T2XFRM(3,2,XYZ,NONLIN,XFRM14,2,XY)
      ROTSIN=XY(1,2)-XY(1,1)
      ROTCOS=XY(2,2)-XY(2,1)
      SQ=ROTCOS**2+ROTSIN**2
      IF (SQ.NE.0.) THEN
      SQ=SQRT(SQ)
      ROTCOS=ROTCOS/SQ
      ROTSIN=ROTSIN/SQ
      ELSE
      ROTCOS=1
      ROTSIN=0
      ENDIF
      CALL T2_MESH_INIT
      END
      SUBROUTINE T2MSHJIN(X,Y,Z,ISK,NP,IHIDE)
      REAL HNONE
      INTEGER ISK,NP,IHIDE
      REAL X(ISK,*),Y(ISK,NP),Z(ISK,NP)
      INTEGER I,J
      REAL XYZ(3),XY(2,2)
      LOGICAL ZEXIST
      DATA HNONE /-666.666/
      ZEXIST=Z(1,1).ne.HNONE
      XYZ(3)=0
      DO 10811 I=1,NP
      XYZ(1)=X(1,I)
      XYZ(2)=Y(1,I)
      IF (ZEXIST) XYZ(3)=Z(1,I)
      CALL T2XFRM(3,2,XYZ,NONLIN,XFRM14,2,XY(1,2))
      IF (I.gt.1) CALL T2_MESH_DRAW(XY,2,IHIDE)
      DO 10821 J=1,2
      XY(J,1)=XY(J,2)
10821 CONTINUE
10822 CONTINUE
10811 CONTINUE
10812 CONTINUE
      END
      SUBROUTINE T2_MESH_INIT
      IMPLICIT NONE
      INTEGER I
      REAL BIG,TEMP
      INTEGER IHSIZE,NPSTOR
      REAL TOLR
      PARAMETER (IHSIZE=2000)
      PARAMETER (TOLR=0.001)
      PARAMETER (NPSTOR=30)
      INTEGER IBOLD,IB,IBT,MAJMIN,MAJMAX,MINMIN,MINMAX,MAJSTP,MINSTP ,MI
     *NMN,MINMX,MAJMN,MAJMX ,MAJAX,MINAX,IFREE,IHBTOP(2),ITXTOP(2),LEFT,
     *IRIGHT,IPASS
      INTEGER*2 IHFWD(IHSIZE), IHBACK(IHSIZE)
      LOGICAL LFREE,VFLG,LVANISH
      REAL ROTCOS,ROTSIN,PNT12(2,2),XX(2,4) ,BUFR(NPSTOR),HORXY(2,IHSIZE
     *),VANISH_PNT(2)
      COMMON /T2MSHC/ MAJMIN,MAJMAX,MINMIN,MINMAX,MAJSTP,MINSTP ,MINMN,M
     *INMX,MAJMN,MAJMX ,MAJAX,MINAX,IB,IFREE,IHBTOP,ROTCOS,ROTSIN ,PNT12
     *,XX,IBT,VFLG,LEFT,IRIGHT ,ITXTOP,IBOLD,LFREE ,BUFR,HORXY ,IHFWD,IH
     *BACK,IPASS,LVANISH,VANISH_PNT
      EXTERNAL T2_MESH_DATA
      COMMON /T2FLGC/ FLAGS(200), LTRAP,LHANDL,LSYERR,LSCREV
      LOGICAL FLAGS, LTRAP,LHANDL,LSYERR,LSCREV(3)
      INTEGER RELFLAG 
      PARAMETER (RELFLAG=151)
      INTEGER IWINLEV 
      INTEGER NWINLEV , MAX_FILL 
      PARAMETER (NWINLEV =4)
      PARAMETER (MAX_FILL=4)
      REAL GRDSYM, GRDSIZ, DATDAT(2,8), H2STAT(12), TITLIN(4), TITFA
     *C(4), TITLOC(4), TITMAR(4), TITLMX(4), TIKFAC, TITINX, TITX1, TIT
     *Y1, TITX, TITY, TITZ, TITSIZ, TITCON(5), REVLEV, REDUCE(5), XFR
     *M12(12), XFRM13(12), XFRM14(12), XFRM23(12), XFRM24(12), XFRM34(6
     *), XVARSX(20), CIRSIZ(2,3), ASIZE, AFLARE, SMSZDF, ORAXES(3), EY
     *EDIR(3), VUEDIR(3), VUECEN(3), VERTCL(3), EYESEP, SCRD, SCRZ, EYE
     *DIS, EYEPNT(3), XYPART(2, 2), BARSIZ(3), BARBRK(3), TIKSIZ(3), XY
     *ZBAS(3), TTHETA, TPHI, FRELBL(4), PATRN(20,30), SCLPRM(10,3), WI
     *NDOW(4), SCREEN(2), SYMBOL, NOSYMB, FACTXY(19), LBLSIZ, SYMSIZ, X
     *YZLIM(3,2), WORLD(3), RADRMX, RADRMN, RADAMN, RADANG, RADX0, RADY
     *0, XUNUSD(6), AXANG(3), REDFAC, DSCAL, PATSZ, MARGIN(4), PSCR(2
     *), OREAL, OCPU, CSCRD, DATPTS, ERRPTS, DATXMN, DATXMX, DATYMN, DA
     *TYMX, DATZMN, DATZMX, DATSUM, ERRSUM, DATAVE, ERRAVE, DATCEN, ERR
     *CEN, DATSTD, ERRSTD, WINREL(2,2,NWINLEV),WINABS(2,2,NWINLEV),WINL
     *IM(2,2), FMARKER(3,8), SYDIR(3), GRDIR(3), EXYZLIM(3,2), DSLOPE(2
     *,2)
      REAL PLOT_EXTENT(2,2),FILL_ANGLE(MAX_FILL),FILL_WIDTH(MAX_FILL)
      INTEGER FILL_INDEX, FILL_TEX(MAX_FILL), N_LINES(6)
      EQUIVALENCE (DATDAT, DATPTS)
      INTEGER MAXREP
      PARAMETER (MAXREP=5)
      INTEGER IPATRN, NPATRN(30), NXYLIM(3,2), NPLOTS, NCSETS, NCCOL, N
     *CROW, IYEAR, IMONTH, IDAY, ISIGFG, ITXPRI, ITXSEC, ITITDT(3), L
     *ENCRD, IPROP, IHTEX, IBLINK, IERASE, ITCNTR, IUNUSD, NXYZ1(3), 
     *NXYZ2(3), LBLFMT(3), LBLCHR(3), NDIMNS(3), IBLKTP, IDIMNS, NMES
     *H0, NMESH1, NMESH2, MESH1, MESH2, MESH3, MESH2D, MESHN(3), NMESHN(
     *2), NFIELD, IFIELD(19), NINCR, NPOINT, IVARBL(19), IVPTR(19), I_
     *VORDER(19,2), LINEAR(4), NONLIN(4), MXECHO, LINES, MAXLNS, USRK
     *BD, USRSCR, PLTFIL, LINWID, LINCOL, LINTEX, ICPOIN(3), IREPCT(MA
     *XREP), LEVREP, GRDTYP, GRDTEX, OUTTEX, IAXTEX, TITEX, LETSET, LAB
     *TEX, TICTEX, SHADOWTYP,SHADOWTEX, NXYZDEF1(10), NXYZDEF2(10), IF
     *ILE_CASE ,MAX_SUBST
      INTEGER MAX_CYCLE
      PARAMETER (MAX_CYCLE=20)
      INTEGER N_CYCLE, ITX_CYCLE(MAX_CYCLE)
      REAL SYM_CYCLE(MAX_CYCLE)
      EQUIVALENCE (NMESH1,NMESHN)
      EQUIVALENCE (MESH1,MESHN)
      INTEGER IBUFFR(400)
      REAL BUFFER(400)
      INTEGER NCHSAVE 
      PARAMETER (NCHSAVE=2*512) 
      INTEGER*4 ICHSAVE(NCHSAVE)
      INTEGER*4 IVRPTR(15)
      CHARACTER*512 OUTSTR,C_FILE, C_NAME, C_SELECT
      CHARACTER C_TIT_ESCAPE*1,C_TIT_SUBSTITUTE*2
      INTEGER N_FILE, N_NAME, N_SELECT
      CHARACTER*8 PXNAME
      CHARACTER*64 INPFMT
      LOGICAL LTDATA, OUTSID(4)
      COMMON /T2COM/ PXNAME, REDUCE, TITX, TITY ,XFRM12, XFRM13, XFRM1
     *4, XFRM23 ,XFRM24, XFRM34 ,XVARSX ,TITSIZ, GRDSYM, GRDSIZ, CIRS
     *IZ, ASIZE, AFLARE ,SMSZDF, ORAXES, EYEDIR, VUEDIR, VUECEN ,VERTC
     *L, EYESEP, SCRD, SCRZ, EYEDIS, EYEPNT ,XYPART, BARSIZ, TIKSIZ, XY
     *ZBAS, TTHETA ,TPHI, FRELBL, IPATRN, NPATRN, PATRN ,SCLPRM, WINDO
     *W, SCREEN, SYMBOL, NOSYMB ,FACTXY, LBLSIZ, SYMSIZ, XYZLIM, WORLD 
     *,RADRMX, RADRMN, RADAMN, RADANG, RADX0, RADY0, XUNUSD ,USRKBD, U
     *SRSCR, PLTFIL ,ITITDT, LENCRD ,INPFMT, GRDTYP, LINWID, LINCOL, L
     *INTEX, TITCON, ITCNTR ,IUNUSD, NXYZ1, NXYZ2 ,LBLCHR, NDIMNS, IBL
     *KTP, IDIMNS ,NMESH1, NMESH2, MESH1, MESH2, MESH3, NFIELD ,IFIELD
     *, NINCR ,IVARBL, IVRPTR ,LINEAR, NONLIN ,NPOINT, LETSET ,MXECH
     *O, LINES, MAXLNS ,AXANG, MESH2D, REDFAC, GRDTEX, OUTTEX, IAXTEX, 
     *TITEX, DSCAL ,OUTSTR, IPROP, IHTEX, IBLINK, IERASE, LABTEX, TICTE
     *X, NXYLIM, PATSZ ,MARGIN, PSCR, ITXPRI, ITXSEC, OREAL, OCPU, CSCR
     *D, OUTSID ,TITLIN, TITINX, TITZ, TITX1, TITY1, LTDATA, NPLOTS, RE
     *VLEV ,LBLFMT, IYEAR, IMONTH, IDAY, ISIGFG ,DATPTS, ERRPTS, DATXM
     *N, DATXMX, DATYMN, DATYMX, DATZMN, DATZMX ,DATSUM, ERRSUM, DATAVE
     *, ERRAVE, DATCEN, ERRCEN, DATSTD, ERRSTD ,NCSETS, NCCOL, NCROW, F
     *MARKER, H2STAT, TITFAC, TITLOC, TITMAR ,TIKFAC, IWINLEV, WINREL, 
     *WINABS, WINLIM ,ICPOIN, LEVREP, IREPCT, SYDIR, GRDIR, NMESH0, EXY
     *ZLIM, IVPTR ,TITLMX, NXYZDEF1, NXYZDEF2, IFILE_CASE, N_CYCLE, ITX
     *_CYCLE ,SYM_CYCLE, PLOT_EXTENT, FILL_ANGLE, FILL_WIDTH, FILL_TEX 
     *,FILL_INDEX ,N_LINES ,DSLOPE ,MAX_SUBST, BARBRK ,I_VORDER,SHADOW
     *TYP,SHADOWTEX
      COMMON /T2SCRT/ BUFFER, IBUFFR, N_FILE,N_NAME,N_SELECT, ICHSAVE
      COMMON /T2_CHAR/ C_TIT_ESCAPE,C_TIT_SUBSTITUTE
      COMMON /T2_SCRT/ C_FILE, C_NAME, C_SELECT
      INTEGER JOUFIL, ERRFIL, OUTFIL, DBGFIL, INPFIL, NINMAX
      PARAMETER (NINMAX=20)
      INTEGER NINP(NINMAX)
      COMMON /T2TRBK/NINP, JOUFIL, ERRFIL, OUTFIL, DBGFIL, INPFIL
      CHARACTER*512 STRNG, STJOU
      LOGICAL LTOKEN
      REAL FLOTNG
      INTEGER INTERP, KEYORD, NSTRNG, MAXSTR, NSTJOU, LSTJOU, NTOKEN
      INTEGER*4 INTEG
      COMMON /TOKENC/ INTERP, INTEG, FLOTNG, KEYORD, NSTRNG, MAXSTR, ST
     *RNG, NSTJOU, LSTJOU, STJOU, LTOKEN, NTOKEN
      DO 10831 I=1,IHSIZE
      IHFWD(I)=I+1
10831 CONTINUE
10832 CONTINUE
      IHFWD(IHSIZE)=0
      IFREE=5
      LFREE=.true.
      IPASS=0
      DO 10841 I=1,3,2
      IHFWD(I+1)=0
      IHBACK(I+1)=I
      IHBACK(I)=0
10841 CONTINUE
10842 CONTINUE
      IHBTOP(1)=2
      IHBTOP(2)=4
      BIG=-1.0E10
      TEMP=BIG
      DO 10851 I=1,4
      HORXY(1,I)=TEMP
      TEMP=-TEMP
      HORXY(2,I)=BIG
10851 CONTINUE
10852 CONTINUE
      ROTCOS=1
      ROTSIN=0
      LVANISH=.false.
      ITXTOP(1)=0
      ITXTOP(2)=0
      FLAGS(84)=.true.
      END
      REAL FUNCTION T2MSHX(ARRAY,NDIM0,NDIM1,NDIM2,I)
      IMPLICIT NONE
      INTEGER NDIM0,NDIM1,NDIM2,I,J,I1,I2,ISTP,ISAVE,IOFF
      REAL ARRAY(NDIM0,NDIM1,NDIM2+1)
      REAL DEPTH,T,T1,T2,T3
      LOGICAL LDEP
      DATA ISTP/1/
      IF (NDIM0 .eq.2) THEN
      T3=ARRAY(1,NDIM1,1)-ARRAY(1,2,1)
      IF (I.le.1) THEN
      T=ARRAY(1,2,1)-SIGN(ARRAY(2,2,1),T3)
      ELSEIF (I.ge.NDIM1) THEN
      T=ARRAY(1,NDIM1,1)+SIGN(ARRAY(2,NDIM1,1),T3)
      ELSE
      I2=I+1
      T1=ARRAY(1,I ,1)+SIGN(ARRAY(2,I ,1),T3)
      T2=ARRAY(1,I2,1)-SIGN(ARRAY(2,I2,1),T3)
      T=(T1+T2)/2
      ENDIF
      ELSE
      IF (I.le.1) THEN
      T=ARRAY(1,1,NDIM2+1)
      T2=ARRAY(1,2,NDIM2+1)
      T1=ARRAY(1,2,1)
      DEPTH=2*(T1-T)
      LDEP=DEPTH.eq.0 .or. T.eq.T2
      IF (LDEP .and. NDIM1.gt.2) THEN
      DEPTH=ARRAY(1,3,1)-T1
      T=T1-DEPTH/2
      ENDIF
      ISAVE=1
      ELSEIF (I.ge.NDIM1) THEN
      T=ARRAY(1,2,NDIM2+1)
      T2=ARRAY(1,1,NDIM2+1)
      T1=ARRAY(1,NDIM1,1)
      DEPTH=2*(T-T1)
      LDEP=DEPTH.eq.0 .or. T.eq.T2
      IF (LDEP .and. NDIM1.gt.2) THEN
      DEPTH=T1-ARRAY(1,NDIM1-1,1)
      T=T1+DEPTH/2
      ENDIF
      ISAVE=NDIM1
      ELSEIF (ISAVE.ne.I) THEN
      IF (LDEP) THEN
      T=(ARRAY(1,I,1)+ARRAY(1,I+1,1))/2
      ELSE
      ISTP=SIGN(ISTP,I-ISAVE)
      IOFF=(ISTP+1)/2
      DO 10861 J=ISAVE+IOFF,I-ISTP+IOFF,ISTP
      T=2*ARRAY(1,J,1)-T
10861 CONTINUE
10862 CONTINUE
      ENDIF
      ISAVE=I
      ENDIF
      ENDIF
      T2MSHX=T
      END
      REAL FUNCTION T2MSHY(ARRAY,NDIM0,NDIM1,NDIM2,I)
      INTEGER NDIM0,NDIM1,NDIM2,I,J,ISTP,ISAVE,IOFF
      REAL ARRAY(NDIM0,NDIM1,NDIM2+1)
      REAL DEPTH,T,T1,T2,T3
      LOGICAL LDEP
      DATA ISTP/1/
      IF (NDIM0 .eq.2) THEN
      T3=ARRAY(1,1,NDIM2)-ARRAY(1,1,2)
      IF (I.le.1) THEN
      T=ARRAY(1,1,2)-SIGN(ARRAY(2,1,2),T3)
      ELSEIF (I.ge.NDIM2) THEN
      T=ARRAY(1,1,NDIM2)+SIGN(ARRAY(2,1,NDIM2),T3)
      ELSE
      I2=I+1
      T1=ARRAY(1,1,I )+SIGN(ARRAY(2,1,I ),T3)
      T2=ARRAY(1,1,I2)-SIGN(ARRAY(2,1,I2),T3)
      T=(T1+T2)/2
      ENDIF
      ELSE
      IF (I.le.1) THEN
      T=ARRAY(1,3,NDIM2+1)
      T2=ARRAY(1,4,NDIM2+1)
      T1=ARRAY(1,1,2)
      DEPTH=2*(T1-T)
      LDEP=DEPTH.eq.0 .or. T.eq.T2
      IF (LDEP .and. NDIM2.gt.2) THEN
      DEPTH=ARRAY(1,1,3)-T1
      T=T1-DEPTH/2
      ENDIF
      ISAVE=1
      ELSEIF (I.ge.NDIM2) THEN
      T=ARRAY(1,4,NDIM2+1)
      T2=ARRAY(1,3,NDIM2+1)
      T1=ARRAY(1,1,NDIM2)
      DEPTH=2*(T-T1)
      LDEP=DEPTH.eq.0 .or. T.eq.T2
      IF (LDEP .and. NDIM2.gt.2) THEN
      DEPTH=T1-ARRAY(1,1,NDIM2-1)
      T=T1+DEPTH/2
      ENDIF
      ISAVE=NDIM2
      ELSEIF (ISAVE.ne.I) THEN
      IF (LDEP) THEN
      T=(ARRAY(1,1,I)+ARRAY(1,1,I+1))/2
      ELSE
      ISTP=SIGN(ISTP,I-ISAVE)
      IOFF=(ISTP+1)/2
      DO 10871 J=ISAVE+IOFF,I-ISTP+IOFF,ISTP
      T=2*ARRAY(1,1,J)-T
10871 CONTINUE
10872 CONTINUE
      ENDIF
      ISAVE=I
      ENDIF
      ENDIF
      T2MSHY=T
      END
      SUBROUTINE T2_MESH_DRAW(XYIN,N,INFLAG)
      INTEGER IFLAG,INFLAG,N
      REAL XYIN(2,*)
      COMMON /T2FLGC/ FLAGS(200), LTRAP,LHANDL,LSYERR,LSCREV
      LOGICAL FLAGS, LTRAP,LHANDL,LSYERR,LSCREV(3)
      INTEGER RELFLAG 
      PARAMETER (RELFLAG=151)
      INTEGER IHSIZE,NPSTOR
      REAL TOLR
      PARAMETER (IHSIZE=2000)
      PARAMETER (TOLR=0.001)
      PARAMETER (NPSTOR=30)
      INTEGER IBOLD,IB,IBT,MAJMIN,MAJMAX,MINMIN,MINMAX,MAJSTP,MINSTP ,MI
     *NMN,MINMX,MAJMN,MAJMX ,MAJAX,MINAX,IFREE,IHBTOP(2),ITXTOP(2),LEFT,
     *IRIGHT,IPASS
      INTEGER*2 IHFWD(IHSIZE), IHBACK(IHSIZE)
      LOGICAL LFREE,VFLG,LVANISH
      REAL ROTCOS,ROTSIN,PNT12(2,2),XX(2,4) ,BUFR(NPSTOR),HORXY(2,IHSIZE
     *),VANISH_PNT(2)
      COMMON /T2MSHC/ MAJMIN,MAJMAX,MINMIN,MINMAX,MAJSTP,MINSTP ,MINMN,M
     *INMX,MAJMN,MAJMX ,MAJAX,MINAX,IB,IFREE,IHBTOP,ROTCOS,ROTSIN ,PNT12
     *,XX,IBT,VFLG,LEFT,IRIGHT ,ITXTOP,IBOLD,LFREE ,BUFR,HORXY ,IHFWD,IH
     *BACK,IPASS,LVANISH,VANISH_PNT
      EXTERNAL T2_MESH_DATA
      REAL PNTV3(2,NPSTOR)
      LOGICAL VPNT(2,NPSTOR),LSAVE,LPLOT
      INTEGER I,J,K,IPP,NMAX, IVBACK, IVPLOT, IVSAVE
      IFLAG=IAND(INFLAG,7)
      IF (IFLAG .eq. 2) THEN
      CALL TXLINX(XYIN,N,LINTEX)
      RETURN
      ENDIF
      IF (IAND(IFLAG,3).eq.0) RETURN
      IVBACK=IAND(INFLAG,4)
      IVPLOT=IAND(INFLAG,2)
      IVSAVE=IAND(INFLAG,1)
      IF (.not. FLAGS(84)) THEN
      CALL T2_MESH_INIT
      ENDIF
      NMAX=MIN(N,NPSTOR)
      DO 10881 IPP=1,NMAX
      PNTV3(1,IPP)=ROTCOS*XYIN(1,IPP)-ROTSIN*XYIN(2,IPP)
      PNTV3(2,IPP)=ROTCOS*XYIN(2,IPP)+ROTSIN*XYIN(1,IPP)
10881 CONTINUE
10882 CONTINUE
      IF (IVBACK.ne.0) THEN
      LPLOT=.FALSE.
      LSAVE=.TRUE.
      IF (IVSAVE.ne.0 .and. NMAX.eq.2) THEN
      IVPLOT=-IVPLOT
      IVSAVE=0
      ENDIF
      IF (IVPLOT .eq. 0) IVSAVE=0
      ELSE
      LPLOT=IVPLOT.NE.0
      LSAVE=IVSAVE.ne.0
      IVPLOT=0
      IVSAVE=0
      ENDIF
      DO 10891 IPP=1,NMAX
      PNT12(1,1)=PNT12(1,2)
      PNT12(2,1)=PNT12(2,2)
      PNT12(1,2)=PNTV3(1,IPP)
      PNT12(2,2)=PNTV3(2,IPP)
      IF (IPP.gt.1) THEN
      IF (LPLOT) THEN
      DO 10901 I=1,2
      DO 10911 J=1,2
      XX(J,I)=PNT12(J,I)
10911 CONTINUE
10912 CONTINUE
10901 CONTINUE
10902 CONTINUE
      IBT=2
      CALL T2_MESH_DRAW_SEG(.false.)
      ENDIF
      IF (LSAVE) THEN
      DO 10921 IBT=1,2
      PNT12(2,1)=-PNT12(2,1)
      PNT12(2,2)=-PNT12(2,2)
      CALL T2_MESH_TEST_SEG(IVPLOT)
      VPNT(IBT,IPP)=VFLG
10921 CONTINUE
10922 CONTINUE
      ENDIF
      ENDIF
10891 CONTINUE
10892 CONTINUE
      IF (IVSAVE.ne.0) THEN
      DO 10931 IPP=1,NMAX
      PNT12(1,1)=PNT12(1,2)
      PNT12(2,1)=PNT12(2,2)
      PNT12(1,2)=PNTV3(1,IPP)
      PNT12(2,2)=PNTV3(2,IPP)
      IF (IPP.gt.1) THEN
      DO 10941 IBT=1,2
      PNT12(2,1)=-PNT12(2,1)
      PNT12(2,2)=-PNT12(2,2)
      IF (VPNT(IBT,IPP)) CALL T2_MESH_TEST_SEG(0)
10941 CONTINUE
10942 CONTINUE
      ENDIF
10931 CONTINUE
10932 CONTINUE
      ENDIF
      END
      SUBROUTINE T2_MESH_DRAW_SEG(LREV)
      COMMON /T2FLGC/ FLAGS(200), LTRAP,LHANDL,LSYERR,LSCREV
      LOGICAL FLAGS, LTRAP,LHANDL,LSYERR,LSCREV(3)
      INTEGER RELFLAG 
      PARAMETER (RELFLAG=151)
      INTEGER IWINLEV 
      INTEGER NWINLEV , MAX_FILL 
      PARAMETER (NWINLEV =4)
      PARAMETER (MAX_FILL=4)
      REAL GRDSYM, GRDSIZ, DATDAT(2,8), H2STAT(12), TITLIN(4), TITFA
     *C(4), TITLOC(4), TITMAR(4), TITLMX(4), TIKFAC, TITINX, TITX1, TIT
     *Y1, TITX, TITY, TITZ, TITSIZ, TITCON(5), REVLEV, REDUCE(5), XFR
     *M12(12), XFRM13(12), XFRM14(12), XFRM23(12), XFRM24(12), XFRM34(6
     *), XVARSX(20), CIRSIZ(2,3), ASIZE, AFLARE, SMSZDF, ORAXES(3), EY
     *EDIR(3), VUEDIR(3), VUECEN(3), VERTCL(3), EYESEP, SCRD, SCRZ, EYE
     *DIS, EYEPNT(3), XYPART(2, 2), BARSIZ(3), BARBRK(3), TIKSIZ(3), XY
     *ZBAS(3), TTHETA, TPHI, FRELBL(4), PATRN(20,30), SCLPRM(10,3), WI
     *NDOW(4), SCREEN(2), SYMBOL, NOSYMB, FACTXY(19), LBLSIZ, SYMSIZ, X
     *YZLIM(3,2), WORLD(3), RADRMX, RADRMN, RADAMN, RADANG, RADX0, RADY
     *0, XUNUSD(6), AXANG(3), REDFAC, DSCAL, PATSZ, MARGIN(4), PSCR(2
     *), OREAL, OCPU, CSCRD, DATPTS, ERRPTS, DATXMN, DATXMX, DATYMN, DA
     *TYMX, DATZMN, DATZMX, DATSUM, ERRSUM, DATAVE, ERRAVE, DATCEN, ERR
     *CEN, DATSTD, ERRSTD, WINREL(2,2,NWINLEV),WINABS(2,2,NWINLEV),WINL
     *IM(2,2), FMARKER(3,8), SYDIR(3), GRDIR(3), EXYZLIM(3,2), DSLOPE(2
     *,2)
      REAL PLOT_EXTENT(2,2),FILL_ANGLE(MAX_FILL),FILL_WIDTH(MAX_FILL)
      INTEGER FILL_INDEX, FILL_TEX(MAX_FILL), N_LINES(6)
      EQUIVALENCE (DATDAT, DATPTS)
      INTEGER MAXREP
      PARAMETER (MAXREP=5)
      INTEGER IPATRN, NPATRN(30), NXYLIM(3,2), NPLOTS, NCSETS, NCCOL, N
     *CROW, IYEAR, IMONTH, IDAY, ISIGFG, ITXPRI, ITXSEC, ITITDT(3), L
     *ENCRD, IPROP, IHTEX, IBLINK, IERASE, ITCNTR, IUNUSD, NXYZ1(3), 
     *NXYZ2(3), LBLFMT(3), LBLCHR(3), NDIMNS(3), IBLKTP, IDIMNS, NMES
     *H0, NMESH1, NMESH2, MESH1, MESH2, MESH3, MESH2D, MESHN(3), NMESHN(
     *2), NFIELD, IFIELD(19), NINCR, NPOINT, IVARBL(19), IVPTR(19), I_
     *VORDER(19,2), LINEAR(4), NONLIN(4), MXECHO, LINES, MAXLNS, USRK
     *BD, USRSCR, PLTFIL, LINWID, LINCOL, LINTEX, ICPOIN(3), IREPCT(MA
     *XREP), LEVREP, GRDTYP, GRDTEX, OUTTEX, IAXTEX, TITEX, LETSET, LAB
     *TEX, TICTEX, SHADOWTYP,SHADOWTEX, NXYZDEF1(10), NXYZDEF2(10), IF
     *ILE_CASE ,MAX_SUBST
      INTEGER MAX_CYCLE
      PARAMETER (MAX_CYCLE=20)
      INTEGER N_CYCLE, ITX_CYCLE(MAX_CYCLE)
      REAL SYM_CYCLE(MAX_CYCLE)
      EQUIVALENCE (NMESH1,NMESHN)
      EQUIVALENCE (MESH1,MESHN)
      INTEGER IBUFFR(400)
      REAL BUFFER(400)
      INTEGER NCHSAVE 
      PARAMETER (NCHSAVE=2*512) 
      INTEGER*4 ICHSAVE(NCHSAVE)
      INTEGER*4 IVRPTR(15)
      CHARACTER*512 OUTSTR,C_FILE, C_NAME, C_SELECT
      CHARACTER C_TIT_ESCAPE*1,C_TIT_SUBSTITUTE*2
      INTEGER N_FILE, N_NAME, N_SELECT
      CHARACTER*8 PXNAME
      CHARACTER*64 INPFMT
      LOGICAL LTDATA, OUTSID(4)
      COMMON /T2COM/ PXNAME, REDUCE, TITX, TITY ,XFRM12, XFRM13, XFRM1
     *4, XFRM23 ,XFRM24, XFRM34 ,XVARSX ,TITSIZ, GRDSYM, GRDSIZ, CIRS
     *IZ, ASIZE, AFLARE ,SMSZDF, ORAXES, EYEDIR, VUEDIR, VUECEN ,VERTC
     *L, EYESEP, SCRD, SCRZ, EYEDIS, EYEPNT ,XYPART, BARSIZ, TIKSIZ, XY
     *ZBAS, TTHETA ,TPHI, FRELBL, IPATRN, NPATRN, PATRN ,SCLPRM, WINDO
     *W, SCREEN, SYMBOL, NOSYMB ,FACTXY, LBLSIZ, SYMSIZ, XYZLIM, WORLD 
     *,RADRMX, RADRMN, RADAMN, RADANG, RADX0, RADY0, XUNUSD ,USRKBD, U
     *SRSCR, PLTFIL ,ITITDT, LENCRD ,INPFMT, GRDTYP, LINWID, LINCOL, L
     *INTEX, TITCON, ITCNTR ,IUNUSD, NXYZ1, NXYZ2 ,LBLCHR, NDIMNS, IBL
     *KTP, IDIMNS ,NMESH1, NMESH2, MESH1, MESH2, MESH3, NFIELD ,IFIELD
     *, NINCR ,IVARBL, IVRPTR ,LINEAR, NONLIN ,NPOINT, LETSET ,MXECH
     *O, LINES, MAXLNS ,AXANG, MESH2D, REDFAC, GRDTEX, OUTTEX, IAXTEX, 
     *TITEX, DSCAL ,OUTSTR, IPROP, IHTEX, IBLINK, IERASE, LABTEX, TICTE
     *X, NXYLIM, PATSZ ,MARGIN, PSCR, ITXPRI, ITXSEC, OREAL, OCPU, CSCR
     *D, OUTSID ,TITLIN, TITINX, TITZ, TITX1, TITY1, LTDATA, NPLOTS, RE
     *VLEV ,LBLFMT, IYEAR, IMONTH, IDAY, ISIGFG ,DATPTS, ERRPTS, DATXM
     *N, DATXMX, DATYMN, DATYMX, DATZMN, DATZMX ,DATSUM, ERRSUM, DATAVE
     *, ERRAVE, DATCEN, ERRCEN, DATSTD, ERRSTD ,NCSETS, NCCOL, NCROW, F
     *MARKER, H2STAT, TITFAC, TITLOC, TITMAR ,TIKFAC, IWINLEV, WINREL, 
     *WINABS, WINLIM ,ICPOIN, LEVREP, IREPCT, SYDIR, GRDIR, NMESH0, EXY
     *ZLIM, IVPTR ,TITLMX, NXYZDEF1, NXYZDEF2, IFILE_CASE, N_CYCLE, ITX
     *_CYCLE ,SYM_CYCLE, PLOT_EXTENT, FILL_ANGLE, FILL_WIDTH, FILL_TEX 
     *,FILL_INDEX ,N_LINES ,DSLOPE ,MAX_SUBST, BARBRK ,I_VORDER,SHADOW
     *TYP,SHADOWTEX
      COMMON /T2SCRT/ BUFFER, IBUFFR, N_FILE,N_NAME,N_SELECT, ICHSAVE
      COMMON /T2_CHAR/ C_TIT_ESCAPE,C_TIT_SUBSTITUTE
      COMMON /T2_SCRT/ C_FILE, C_NAME, C_SELECT
      INTEGER JOUFIL, ERRFIL, OUTFIL, DBGFIL, INPFIL, NINMAX
      PARAMETER (NINMAX=20)
      INTEGER NINP(NINMAX)
      COMMON /T2TRBK/NINP, JOUFIL, ERRFIL, OUTFIL, DBGFIL, INPFIL
      CHARACTER*512 STRNG, STJOU
      LOGICAL LTOKEN
      REAL FLOTNG
      INTEGER INTERP, KEYORD, NSTRNG, MAXSTR, NSTJOU, LSTJOU, NTOKEN
      INTEGER*4 INTEG
      COMMON /TOKENC/ INTERP, INTEG, FLOTNG, KEYORD, NSTRNG, MAXSTR, ST
     *RNG, NSTJOU, LSTJOU, STJOU, LTOKEN, NTOKEN
      INTEGER IHSIZE,NPSTOR
      REAL TOLR
      PARAMETER (IHSIZE=2000)
      PARAMETER (TOLR=0.001)
      PARAMETER (NPSTOR=30)
      INTEGER IBOLD,IB,IBT,MAJMIN,MAJMAX,MINMIN,MINMAX,MAJSTP,MINSTP ,MI
     *NMN,MINMX,MAJMN,MAJMX ,MAJAX,MINAX,IFREE,IHBTOP(2),ITXTOP(2),LEFT,
     *IRIGHT,IPASS
      INTEGER*2 IHFWD(IHSIZE), IHBACK(IHSIZE)
      LOGICAL LFREE,VFLG,LVANISH
      REAL ROTCOS,ROTSIN,PNT12(2,2),XX(2,4) ,BUFR(NPSTOR),HORXY(2,IHSIZE
     *),VANISH_PNT(2)
      COMMON /T2MSHC/ MAJMIN,MAJMAX,MINMIN,MINMAX,MAJSTP,MINSTP ,MINMN,M
     *INMX,MAJMN,MAJMX ,MAJAX,MINAX,IB,IFREE,IHBTOP,ROTCOS,ROTSIN ,PNT12
     *,XX,IBT,VFLG,LEFT,IRIGHT ,ITXTOP,IBOLD,LFREE ,BUFR,HORXY ,IHFWD,IH
     *BACK,IPASS,LVANISH,VANISH_PNT
      EXTERNAL T2_MESH_DATA
      LOGICAL LREV
      REAL X,Y
      IF (IB+4.GE.NPSTOR) THEN
      CALL TXLINX(BUFR,IB/2,LINTEX)
      IB=0
      ENDIF
      IF (LREV) THEN
      IMIN=2
      IMAX=1
      ELSE
      IMIN=1
      IMAX=2
      ENDIF
      X=XX(1,IMIN)
      Y=XX(2,IMIN)
      IF (IBT.EQ.1) Y=-Y
      IF (IB.gt.0) THEN
      IF (IBT.ne.IBOLD .or. ABS(OLDX-X).gt.TOLR .OR. ABS(OLDY-Y).gt.TOLR
     *) THEN
      IF (IB.GT.2) THEN
      CALL TXLINX(BUFR,IB/2,LINTEX)
      ENDIF
      IB=0
      ENDIF
      ENDIF
      IF (IBOLD.ne.IBT) THEN
      IF (ITXTOP(1).ne.ITXTOP(2)) THEN
      CALL T2CWTS(ITXTOP(IBT),IDUM)
      CALL TXSDEF
      ENDIF
      IBOLD=IBT
      ENDIF
      IF (IB.EQ.0) THEN
      BUFR(1)=ROTCOS*X + ROTSIN*Y
      BUFR(2)=ROTCOS*Y - ROTSIN*X
      IB=2
      ENDIF
      X=XX(1,IMAX)
      Y=XX(2,IMAX)
      IF (IBT.EQ.1) Y=-Y
      IF (IB.le.2 .or. ABS(OLDX-X).gt.TOLR .OR. ABS(OLDY-Y).gt.TOLR) THE
     *N
      IB=IB+1
      BUFR(IB)=ROTCOS*X +ROTSIN*Y
      IB=IB+1
      BUFR(IB)=ROTCOS*Y -ROTSIN*X
      OLDX=X
      OLDY=Y
      ENDIF
      END
      SUBROUTINE T2_MESH_TEST_SEG(IVPLOT)
      COMMON /T2FLGC/ FLAGS(200), LTRAP,LHANDL,LSYERR,LSCREV
      LOGICAL FLAGS, LTRAP,LHANDL,LSYERR,LSCREV(3)
      INTEGER RELFLAG 
      PARAMETER (RELFLAG=151)
      INTEGER IHSIZE,NPSTOR
      REAL TOLR
      PARAMETER (IHSIZE=2000)
      PARAMETER (TOLR=0.001)
      PARAMETER (NPSTOR=30)
      INTEGER IBOLD,IB,IBT,MAJMIN,MAJMAX,MINMIN,MINMAX,MAJSTP,MINSTP ,MI
     *NMN,MINMX,MAJMN,MAJMX ,MAJAX,MINAX,IFREE,IHBTOP(2),ITXTOP(2),LEFT,
     *IRIGHT,IPASS
      INTEGER*2 IHFWD(IHSIZE), IHBACK(IHSIZE)
      LOGICAL LFREE,VFLG,LVANISH
      REAL ROTCOS,ROTSIN,PNT12(2,2),XX(2,4) ,BUFR(NPSTOR),HORXY(2,IHSIZE
     *),VANISH_PNT(2)
      COMMON /T2MSHC/ MAJMIN,MAJMAX,MINMIN,MINMAX,MAJSTP,MINSTP ,MINMN,M
     *INMX,MAJMN,MAJMX ,MAJAX,MINAX,IB,IFREE,IHBTOP,ROTCOS,ROTSIN ,PNT12
     *,XX,IBT,VFLG,LEFT,IRIGHT ,ITXTOP,IBOLD,LFREE ,BUFR,HORXY ,IHFWD,IH
     *BACK,IPASS,LVANISH,VANISH_PNT
      EXTERNAL T2_MESH_DATA
      REAL BIG , NBIG
      PARAMETER ( BIG= 5.0E9)
      PARAMETER (NBIG=-5.0E9)
      LOGICAL LREV , LVERT
      REAL XYLIM(4)
      EQUIVALENCE (XX(1,1),X1),(XX(1,2),X2),(XX(2,1),Y1),(XX(2,2),Y2)
      EQUIVALENCE (XX(1,3),XMIN),(XX(1,4),XMAX),(XX(2,3),YMIN),(XX(2,4),
     *YMAX)
      DATA XYLIM/NBIG,BIG,NBIG,BIG/
      VFLG=.false.
      LREV=PNT12(1,2) .lt. PNT12(1,1)
      IF (LREV) THEN
      IMIN=2
      IMAX=1
      ELSE
      IMIN=1
      IMAX=2
      ENDIF
      XMIN=PNT12(1,IMIN)
      YMIN=PNT12(2,IMIN)
      XMAX=PNT12(1,IMAX)
      YMAX=PNT12(2,IMAX)
      IF (XMIN.lt.-BIG .or. XMAX.gt.BIG .or. MAX( ABS(YMIN),ABS(YMAX) ) 
     *.gt. BIG) THEN
      CALL TD2SCS(XYLIM,2,XX(1,3),XX(1,4),IHIT)
      IF (IHIT.eq.4) RETURN
      ENDIF
      DX=XMAX-XMIN
      TEMP=DX*.01
      TEMP=MIN(TEMP,TOLR/10)
      XMIN=XMIN+TEMP
      XMAX=XMAX-TEMP
      DX=XMAX-XMIN
      DY=YMAX-YMIN
      TEMP=DY*.01
      IF (ABS(TEMP).gt.TOLR/10) TEMP=SIGN(TOLR/10,TEMP)
      YMIN=YMIN+TEMP
      YMAX=YMAX+TEMP
      DY=YMAX-YMIN
      LVERT=DX.lt.TOLR
      IF (LVERT) THEN
      IF (IVPLOT.eq.0) RETURN
      XMIN=(XMIN+XMAX)/2
      XMAX=XMIN
      DX=0
      XS=0
      IF (YMIN.gt.YMAX) THEN
      TEMP=YMAX
      YMAX=YMIN
      YMIN=TEMP
      ENDIF
      ELSE
      XS=DY/DX
      ENDIF
      X1=XMIN
      Y1=YMIN
      X2=XMAX
      Y2=YMAX
      IRIGHT=IHBTOP(IBT)
      LEFT=IHBACK(IRIGHT)
10951 CONTINUE
      XL=HORXY(1,LEFT)
      IF(X1.gt.XL)GOTO 10952
      IRIGHT=LEFT
      LEFT=IHBACK(IRIGHT)
      GOTO 10951
10952 CONTINUE
10961 CONTINUE
10971 CONTINUE
      IF(X1.le.HORXY(1,IRIGHT))GOTO 10972
      LEFT=IRIGHT
      IRIGHT=IHFWD(LEFT)
      GOTO 10971
10972 CONTINUE
      XL1=HORXY(1,LEFT)
      YL1=HORXY(2,LEFT)
      XR1=HORXY(1,IRIGHT)
      YR1=HORXY(2,IRIGHT)
      IF (XR1.ne.XL1) THEN
      Y = (X1-XL1)*(YR1-YL1)/(XR1-XL1)+YL1
      IF (Y1.gt.Y) GOTO 10980
      ENDIF
10991 CONTINUE
      IF (XR1.ne.XL1) THEN
      IF (XMAX.le.XR1) THEN
      YT = (XMAX-XL1)*(YR1-YL1)/(XR1-XL1)+YL1
      IF(YMAX.gt.YT)GOTO 10992
      GOTO 11000
      ENDIF
      ELSE
      IF (LVERT) THEN
      Y1=MAX(YL1,YR1)
      IF (Y2.gt.Y1) GOTO 11010
      GOTO 11000
      ENDIF
      ENDIF
      Y = (XR1-XMAX)*XS+YMAX
      IF(Y.gt.YR1)GOTO 10992
      IF (XR1.ge.XMAX) GOTO 11000
      X1=XR1
      Y1=Y
      XL1=XR1
      YL1=YR1
      LEFT=IRIGHT
      IRIGHT = IHFWD(LEFT)
      XR1=HORXY(1,IRIGHT)
      YR1=HORXY(2,IRIGHT)
      GOTO 10991
10992 CONTINUE
      IF (LVERT) THEN
      Y1=Y
      GOTO 11010
      ELSE
      XL=XL1-XMIN
      YL=YL1-YMIN
      XLR = XR1-XL1
      YLR = YR1-YL1
      CLRDX = XLR*DY - DX*YLR
      IF (CLRDX.EQ.0.) GOTO 11000
      CLRXL = XLR*YL - XL*YLR
      FAC = CLRXL / CLRDX
      X1=XMIN+DX*FAC
      Y1=YMIN+DY*FAC
      X1=MAX(X1,XL1)
      ENDIF
10980 CONTINUE
      LEFT2=LEFT
      XL2=XL1
      YL2=YL1
      XR2=XR1
      YR2=YR1
11021 CONTINUE
      IF (XR2.ne.XL2 .and. XMAX.le.XR2) THEN
      Y = (XMAX-XL2)*(YR2-YL2)/(XR2-XL2)+YL2
      IF (YMAX.gt.Y) GOTO 11010
      GOTO 11022
      ENDIF
      Y = (XR2-XMAX)*XS+YMAX
      IF(Y.lt.YR2)GOTO 11022
      LEFT2=IRIGHT
      IRIGHT=IHFWD(IRIGHT)
      XL2=XR2
      YL2=YR2
      XR2=HORXY(1,IRIGHT)
      YR2=HORXY(2,IRIGHT)
      GOTO 11021
11022 CONTINUE
      XL=XL2-XMIN
      YL=YL2-YMIN
      XLR = XR2-XL2
      YLR = YR2-YL2
      CLRDX = XLR*DY - DX*YLR
      IF (CLRDX.EQ.0.) GOTO 11000
      CLRXL = XLR*YL - XL*YLR
      FAC = CLRXL/ CLRDX
      X2=XMIN+DX*FAC
      Y2=YMIN+DY*FAC
11010 CONTINUE
      IF (LVERT) THEN
      XL2=XL1
      YL2=YL1
      XR2=XR1
      YR2=YR1
      ENDIF
      X2=MAX(MAX(X1,X2),XL2)
      VFLG=.true.
      IF (IVPLOT.ne.0) CALL T2_MESH_DRAW_SEG(LREV)
      IF (.not.LVERT.and.IVPLOT.le.0 .and. ABS(X1-X2).ge.TOLR) THEN
      I=IHBACK(IRIGHT)
      IF (I.NE.LEFT) THEN
      IHFWD(I)=IFREE
      IFREE=IHFWD(LEFT)
      IHFWD(LEFT)=IRIGHT
      IHBACK(IRIGHT)=LEFT
      ENDIF
      IF (ABS(X1-XL1) .lt. TOLR) THEN
      IF (ABS(Y1-YL1).gt. TOLR) THEN
      I=IHBACK(LEFT)
      IF (I.ne.0) THEN
      TEMP=ABS(XL1-HORXY(1,I))
      ELSE
      TEMP=100
      ENDIF
      IF (TEMP .lt. TOLR) THEN
      HORXY(1,LEFT)=XL1
      HORXY(2,LEFT)=Y1+TOLR/5
      ELSE
      CALL T2_MESH_INSERT_NODES(LEFT,XL1,Y1+TOLR/5)
      ENDIF
      ENDIF
      ELSE
      Y=YL1+(X1-XL1)*(YR1-YL1)/(XR1-XL1)
      CALL T2_MESH_INSERT_NODES(LEFT,X1-TOLR/10,Y+TOLR/5)
      IF (ABS(Y-Y1).gt. TOLR) CALL T2_MESH_INSERT_NODES(LEFT,X1-TOLR/10,
     *Y1+TOLR/5)
      ENDIF
      IF (ABS(XR2-X2) .lt. TOLR) THEN
      IF (ABS(Y2-YR2).gt. TOLR) THEN
      I=IHFWD(IRIGHT)
      IF (I.ne.0) THEN
      TEMP=ABS(XR2-HORXY(1,I))
      ELSE
      TEMP=100
      ENDIF
      IF (TEMP .lt. TOLR) THEN
      HORXY(1,IRIGHT)=XR2
      HORXY(2,IRIGHT)=Y2+TOLR/5
      ELSE
      CALL T2_MESH_INSERT_NODES(LEFT,XR2,Y2+TOLR/5)
      ENDIF
      ENDIF
      ELSE
      Y=YL2+(X2-XL2)*(YR2-YL2)/(XR2-XL2)
      IF (ABS(Y-Y2).gt. TOLR) CALL T2_MESH_INSERT_NODES(LEFT,X2+TOLR/10,
     *Y2+TOLR/5)
      CALL T2_MESH_INSERT_NODES(LEFT,X2+TOLR/10,Y+TOLR/5)
      ENDIF
      ENDIF
      IRIGHT=IHFWD(LEFT)
      IF (XMAX-X2 .lt. TOLR) GOTO 11000
      X1=X2+TOLR/10
      Y1=XS*(X1-XMAX)+YMAX
      X2=XMAX
      Y2=YMAX
      GOTO 10961
10962 CONTINUE
11000 CONTINUE
      IHBTOP(IBT)=IRIGHT
      END
      SUBROUTINE T2_MESH_LIST_HORIZ
      IMPLICIT NONE
      COMMON /T2FLGC/ FLAGS(200), LTRAP,LHANDL,LSYERR,LSCREV
      LOGICAL FLAGS, LTRAP,LHANDL,LSYERR,LSCREV(3)
      INTEGER RELFLAG 
      PARAMETER (RELFLAG=151)
      INTEGER IHSIZE,NPSTOR
      REAL TOLR
      PARAMETER (IHSIZE=2000)
      PARAMETER (TOLR=0.001)
      PARAMETER (NPSTOR=30)
      INTEGER IBOLD,IB,IBT,MAJMIN,MAJMAX,MINMIN,MINMAX,MAJSTP,MINSTP ,MI
     *NMN,MINMX,MAJMN,MAJMX ,MAJAX,MINAX,IFREE,IHBTOP(2),ITXTOP(2),LEFT,
     *IRIGHT,IPASS
      INTEGER*2 IHFWD(IHSIZE), IHBACK(IHSIZE)
      LOGICAL LFREE,VFLG,LVANISH
      REAL ROTCOS,ROTSIN,PNT12(2,2),XX(2,4) ,BUFR(NPSTOR),HORXY(2,IHSIZE
     *),VANISH_PNT(2)
      COMMON /T2MSHC/ MAJMIN,MAJMAX,MINMIN,MINMAX,MAJSTP,MINSTP ,MINMN,M
     *INMX,MAJMN,MAJMX ,MAJAX,MINAX,IB,IFREE,IHBTOP,ROTCOS,ROTSIN ,PNT12
     *,XX,IBT,VFLG,LEFT,IRIGHT ,ITXTOP,IBOLD,LFREE ,BUFR,HORXY ,IHFWD,IH
     *BACK,IPASS,LVANISH,VANISH_PNT
      EXTERNAL T2_MESH_DATA
      INTEGER I,J,K,L
      REAL X,Y,TEMP
      WRITE(6,*) 'IHBTOP=     ',IHBTOP
      WRITE(6,*) 'Left, Right=',LEFT,IRIGHT
      DO 11051 I=1,2
      K=2*I-1
      X=-1.0E10
      L=0
      WRITE(6,*) '  Index,  Back, Forward,    X,     Y, DX,DY',I
      DO 11061 J=1,IHSIZE
      IF (LTRAP) RETURN
      IF(K.gt.IHSIZE.or.K.le.0)GOTO 11062
      IF (K.eq.LEFT) WRITE(6,*) ' Left ---'
      TEMP=HORXY(1,K)
      WRITE(6,*)K,IHBACK(K),IHFWD(K), HORXY(1,K),HORXY(2,K),TEMP-X
      IF (K.eq.IRIGHT) WRITE(6,*) ' Right ---'
      IF (TEMP.lt.X) WRITE(6,*)'BAD X ***'
      IF (L.ne. IHBACK(K)) WRITE(6,*)'Bad BACK ***'
      X=TEMP
      L=K
      K=IHFWD(K)
11061 CONTINUE
11062 CONTINUE
      IF (K.ne.0) WRITE(6,*) 'Error Index=',K
      IF (L.ne.2*I) WRITE(6,*) 'Bad final Index ***'
11051 CONTINUE
11052 CONTINUE
      END
      SUBROUTINE T2_MESH_LIST(STR)
      IMPLICIT NONE
      INTEGER I
      CHARACTER*(*) STR
      INTEGER IHSIZE,NPSTOR
      REAL TOLR
      PARAMETER (IHSIZE=2000)
      PARAMETER (TOLR=0.001)
      PARAMETER (NPSTOR=30)
      INTEGER IBOLD,IB,IBT,MAJMIN,MAJMAX,MINMIN,MINMAX,MAJSTP,MINSTP ,MI
     *NMN,MINMX,MAJMN,MAJMX ,MAJAX,MINAX,IFREE,IHBTOP(2),ITXTOP(2),LEFT,
     *IRIGHT,IPASS
      INTEGER*2 IHFWD(IHSIZE), IHBACK(IHSIZE)
      LOGICAL LFREE,VFLG,LVANISH
      REAL ROTCOS,ROTSIN,PNT12(2,2),XX(2,4) ,BUFR(NPSTOR),HORXY(2,IHSIZE
     *),VANISH_PNT(2)
      COMMON /T2MSHC/ MAJMIN,MAJMAX,MINMIN,MINMAX,MAJSTP,MINSTP ,MINMN,M
     *INMX,MAJMN,MAJMX ,MAJAX,MINAX,IB,IFREE,IHBTOP,ROTCOS,ROTSIN ,PNT12
     *,XX,IBT,VFLG,LEFT,IRIGHT ,ITXTOP,IBOLD,LFREE ,BUFR,HORXY ,IHFWD,IH
     *BACK,IPASS,LVANISH,VANISH_PNT
      EXTERNAL T2_MESH_DATA
      WRITE (6,*) STR,' Pass=',IPASS
      WRITE (6,*) 'X1,   Y1=  ',XX(1,1),XX(2,1)
      WRITE (6,*) 'X2,   Y2=  ',XX(1,2),XX(2,2)
      WRITE (6,*) 'XMIN, YMIN=',XX(1,3),XX(2,3)
      WRITE (6,*) 'XMAX, YMAX=',XX(1,4),XX(2,4)
      CALL T2_MESH_LIST_HORIZ
      I=0
      WRITE(6,*) 1/I
      END
      SUBROUTINE T2_MESH_FLUSH
      IMPLICIT NONE
      COMMON /T2FLGC/ FLAGS(200), LTRAP,LHANDL,LSYERR,LSCREV
      LOGICAL FLAGS, LTRAP,LHANDL,LSYERR,LSCREV(3)
      INTEGER RELFLAG 
      PARAMETER (RELFLAG=151)
      INTEGER IWINLEV 
      INTEGER NWINLEV , MAX_FILL 
      PARAMETER (NWINLEV =4)
      PARAMETER (MAX_FILL=4)
      REAL GRDSYM, GRDSIZ, DATDAT(2,8), H2STAT(12), TITLIN(4), TITFA
     *C(4), TITLOC(4), TITMAR(4), TITLMX(4), TIKFAC, TITINX, TITX1, TIT
     *Y1, TITX, TITY, TITZ, TITSIZ, TITCON(5), REVLEV, REDUCE(5), XFR
     *M12(12), XFRM13(12), XFRM14(12), XFRM23(12), XFRM24(12), XFRM34(6
     *), XVARSX(20), CIRSIZ(2,3), ASIZE, AFLARE, SMSZDF, ORAXES(3), EY
     *EDIR(3), VUEDIR(3), VUECEN(3), VERTCL(3), EYESEP, SCRD, SCRZ, EYE
     *DIS, EYEPNT(3), XYPART(2, 2), BARSIZ(3), BARBRK(3), TIKSIZ(3), XY
     *ZBAS(3), TTHETA, TPHI, FRELBL(4), PATRN(20,30), SCLPRM(10,3), WI
     *NDOW(4), SCREEN(2), SYMBOL, NOSYMB, FACTXY(19), LBLSIZ, SYMSIZ, X
     *YZLIM(3,2), WORLD(3), RADRMX, RADRMN, RADAMN, RADANG, RADX0, RADY
     *0, XUNUSD(6), AXANG(3), REDFAC, DSCAL, PATSZ, MARGIN(4), PSCR(2
     *), OREAL, OCPU, CSCRD, DATPTS, ERRPTS, DATXMN, DATXMX, DATYMN, DA
     *TYMX, DATZMN, DATZMX, DATSUM, ERRSUM, DATAVE, ERRAVE, DATCEN, ERR
     *CEN, DATSTD, ERRSTD, WINREL(2,2,NWINLEV),WINABS(2,2,NWINLEV),WINL
     *IM(2,2), FMARKER(3,8), SYDIR(3), GRDIR(3), EXYZLIM(3,2), DSLOPE(2
     *,2)
      REAL PLOT_EXTENT(2,2),FILL_ANGLE(MAX_FILL),FILL_WIDTH(MAX_FILL)
      INTEGER FILL_INDEX, FILL_TEX(MAX_FILL), N_LINES(6)
      EQUIVALENCE (DATDAT, DATPTS)
      INTEGER MAXREP
      PARAMETER (MAXREP=5)
      INTEGER IPATRN, NPATRN(30), NXYLIM(3,2), NPLOTS, NCSETS, NCCOL, N
     *CROW, IYEAR, IMONTH, IDAY, ISIGFG, ITXPRI, ITXSEC, ITITDT(3), L
     *ENCRD, IPROP, IHTEX, IBLINK, IERASE, ITCNTR, IUNUSD, NXYZ1(3), 
     *NXYZ2(3), LBLFMT(3), LBLCHR(3), NDIMNS(3), IBLKTP, IDIMNS, NMES
     *H0, NMESH1, NMESH2, MESH1, MESH2, MESH3, MESH2D, MESHN(3), NMESHN(
     *2), NFIELD, IFIELD(19), NINCR, NPOINT, IVARBL(19), IVPTR(19), I_
     *VORDER(19,2), LINEAR(4), NONLIN(4), MXECHO, LINES, MAXLNS, USRK
     *BD, USRSCR, PLTFIL, LINWID, LINCOL, LINTEX, ICPOIN(3), IREPCT(MA
     *XREP), LEVREP, GRDTYP, GRDTEX, OUTTEX, IAXTEX, TITEX, LETSET, LAB
     *TEX, TICTEX, SHADOWTYP,SHADOWTEX, NXYZDEF1(10), NXYZDEF2(10), IF
     *ILE_CASE ,MAX_SUBST
      INTEGER MAX_CYCLE
      PARAMETER (MAX_CYCLE=20)
      INTEGER N_CYCLE, ITX_CYCLE(MAX_CYCLE)
      REAL SYM_CYCLE(MAX_CYCLE)
      EQUIVALENCE (NMESH1,NMESHN)
      EQUIVALENCE (MESH1,MESHN)
      INTEGER IBUFFR(400)
      REAL BUFFER(400)
      INTEGER NCHSAVE 
      PARAMETER (NCHSAVE=2*512) 
      INTEGER*4 ICHSAVE(NCHSAVE)
      INTEGER*4 IVRPTR(15)
      CHARACTER*512 OUTSTR,C_FILE, C_NAME, C_SELECT
      CHARACTER C_TIT_ESCAPE*1,C_TIT_SUBSTITUTE*2
      INTEGER N_FILE, N_NAME, N_SELECT
      CHARACTER*8 PXNAME
      CHARACTER*64 INPFMT
      LOGICAL LTDATA, OUTSID(4)
      COMMON /T2COM/ PXNAME, REDUCE, TITX, TITY ,XFRM12, XFRM13, XFRM1
     *4, XFRM23 ,XFRM24, XFRM34 ,XVARSX ,TITSIZ, GRDSYM, GRDSIZ, CIRS
     *IZ, ASIZE, AFLARE ,SMSZDF, ORAXES, EYEDIR, VUEDIR, VUECEN ,VERTC
     *L, EYESEP, SCRD, SCRZ, EYEDIS, EYEPNT ,XYPART, BARSIZ, TIKSIZ, XY
     *ZBAS, TTHETA ,TPHI, FRELBL, IPATRN, NPATRN, PATRN ,SCLPRM, WINDO
     *W, SCREEN, SYMBOL, NOSYMB ,FACTXY, LBLSIZ, SYMSIZ, XYZLIM, WORLD 
     *,RADRMX, RADRMN, RADAMN, RADANG, RADX0, RADY0, XUNUSD ,USRKBD, U
     *SRSCR, PLTFIL ,ITITDT, LENCRD ,INPFMT, GRDTYP, LINWID, LINCOL, L
     *INTEX, TITCON, ITCNTR ,IUNUSD, NXYZ1, NXYZ2 ,LBLCHR, NDIMNS, IBL
     *KTP, IDIMNS ,NMESH1, NMESH2, MESH1, MESH2, MESH3, NFIELD ,IFIELD
     *, NINCR ,IVARBL, IVRPTR ,LINEAR, NONLIN ,NPOINT, LETSET ,MXECH
     *O, LINES, MAXLNS ,AXANG, MESH2D, REDFAC, GRDTEX, OUTTEX, IAXTEX, 
     *TITEX, DSCAL ,OUTSTR, IPROP, IHTEX, IBLINK, IERASE, LABTEX, TICTE
     *X, NXYLIM, PATSZ ,MARGIN, PSCR, ITXPRI, ITXSEC, OREAL, OCPU, CSCR
     *D, OUTSID ,TITLIN, TITINX, TITZ, TITX1, TITY1, LTDATA, NPLOTS, RE
     *VLEV ,LBLFMT, IYEAR, IMONTH, IDAY, ISIGFG ,DATPTS, ERRPTS, DATXM
     *N, DATXMX, DATYMN, DATYMX, DATZMN, DATZMX ,DATSUM, ERRSUM, DATAVE
     *, ERRAVE, DATCEN, ERRCEN, DATSTD, ERRSTD ,NCSETS, NCCOL, NCROW, F
     *MARKER, H2STAT, TITFAC, TITLOC, TITMAR ,TIKFAC, IWINLEV, WINREL, 
     *WINABS, WINLIM ,ICPOIN, LEVREP, IREPCT, SYDIR, GRDIR, NMESH0, EXY
     *ZLIM, IVPTR ,TITLMX, NXYZDEF1, NXYZDEF2, IFILE_CASE, N_CYCLE, ITX
     *_CYCLE ,SYM_CYCLE, PLOT_EXTENT, FILL_ANGLE, FILL_WIDTH, FILL_TEX 
     *,FILL_INDEX ,N_LINES ,DSLOPE ,MAX_SUBST, BARBRK ,I_VORDER,SHADOW
     *TYP,SHADOWTEX
      COMMON /T2SCRT/ BUFFER, IBUFFR, N_FILE,N_NAME,N_SELECT, ICHSAVE
      COMMON /T2_CHAR/ C_TIT_ESCAPE,C_TIT_SUBSTITUTE
      COMMON /T2_SCRT/ C_FILE, C_NAME, C_SELECT
      INTEGER JOUFIL, ERRFIL, OUTFIL, DBGFIL, INPFIL, NINMAX
      PARAMETER (NINMAX=20)
      INTEGER NINP(NINMAX)
      COMMON /T2TRBK/NINP, JOUFIL, ERRFIL, OUTFIL, DBGFIL, INPFIL
      CHARACTER*512 STRNG, STJOU
      LOGICAL LTOKEN
      REAL FLOTNG
      INTEGER INTERP, KEYORD, NSTRNG, MAXSTR, NSTJOU, LSTJOU, NTOKEN
      INTEGER*4 INTEG
      COMMON /TOKENC/ INTERP, INTEG, FLOTNG, KEYORD, NSTRNG, MAXSTR, ST
     *RNG, NSTJOU, LSTJOU, STJOU, LTOKEN, NTOKEN
      INTEGER IHSIZE,NPSTOR
      REAL TOLR
      PARAMETER (IHSIZE=2000)
      PARAMETER (TOLR=0.001)
      PARAMETER (NPSTOR=30)
      INTEGER IBOLD,IB,IBT,MAJMIN,MAJMAX,MINMIN,MINMAX,MAJSTP,MINSTP ,MI
     *NMN,MINMX,MAJMN,MAJMX ,MAJAX,MINAX,IFREE,IHBTOP(2),ITXTOP(2),LEFT,
     *IRIGHT,IPASS
      INTEGER*2 IHFWD(IHSIZE), IHBACK(IHSIZE)
      LOGICAL LFREE,VFLG,LVANISH
      REAL ROTCOS,ROTSIN,PNT12(2,2),XX(2,4) ,BUFR(NPSTOR),HORXY(2,IHSIZE
     *),VANISH_PNT(2)
      COMMON /T2MSHC/ MAJMIN,MAJMAX,MINMIN,MINMAX,MAJSTP,MINSTP ,MINMN,M
     *INMX,MAJMN,MAJMX ,MAJAX,MINAX,IB,IFREE,IHBTOP,ROTCOS,ROTSIN ,PNT12
     *,XX,IBT,VFLG,LEFT,IRIGHT ,ITXTOP,IBOLD,LFREE ,BUFR,HORXY ,IHFWD,IH
     *BACK,IPASS,LVANISH,VANISH_PNT
      EXTERNAL T2_MESH_DATA
      IF (IB.GT.2) CALL TXLINX(BUFR,IB/2,LINTEX)
      IB=0
      IBOLD=IBT
      END
      SUBROUTINE T2_MESH_HORIZ(ARRAY,NDIM0,NDIM1,NDIM2,WIDTH)
      REAL ARRAY(NDIM0,NDIM1,NDIM2)
      COMMON /T2FLGC/ FLAGS(200), LTRAP,LHANDL,LSYERR,LSCREV
      LOGICAL FLAGS, LTRAP,LHANDL,LSYERR,LSCREV(3)
      INTEGER RELFLAG 
      PARAMETER (RELFLAG=151)
      INTEGER IWINLEV 
      INTEGER NWINLEV , MAX_FILL 
      PARAMETER (NWINLEV =4)
      PARAMETER (MAX_FILL=4)
      REAL GRDSYM, GRDSIZ, DATDAT(2,8), H2STAT(12), TITLIN(4), TITFA
     *C(4), TITLOC(4), TITMAR(4), TITLMX(4), TIKFAC, TITINX, TITX1, TIT
     *Y1, TITX, TITY, TITZ, TITSIZ, TITCON(5), REVLEV, REDUCE(5), XFR
     *M12(12), XFRM13(12), XFRM14(12), XFRM23(12), XFRM24(12), XFRM34(6
     *), XVARSX(20), CIRSIZ(2,3), ASIZE, AFLARE, SMSZDF, ORAXES(3), EY
     *EDIR(3), VUEDIR(3), VUECEN(3), VERTCL(3), EYESEP, SCRD, SCRZ, EYE
     *DIS, EYEPNT(3), XYPART(2, 2), BARSIZ(3), BARBRK(3), TIKSIZ(3), XY
     *ZBAS(3), TTHETA, TPHI, FRELBL(4), PATRN(20,30), SCLPRM(10,3), WI
     *NDOW(4), SCREEN(2), SYMBOL, NOSYMB, FACTXY(19), LBLSIZ, SYMSIZ, X
     *YZLIM(3,2), WORLD(3), RADRMX, RADRMN, RADAMN, RADANG, RADX0, RADY
     *0, XUNUSD(6), AXANG(3), REDFAC, DSCAL, PATSZ, MARGIN(4), PSCR(2
     *), OREAL, OCPU, CSCRD, DATPTS, ERRPTS, DATXMN, DATXMX, DATYMN, DA
     *TYMX, DATZMN, DATZMX, DATSUM, ERRSUM, DATAVE, ERRAVE, DATCEN, ERR
     *CEN, DATSTD, ERRSTD, WINREL(2,2,NWINLEV),WINABS(2,2,NWINLEV),WINL
     *IM(2,2), FMARKER(3,8), SYDIR(3), GRDIR(3), EXYZLIM(3,2), DSLOPE(2
     *,2)
      REAL PLOT_EXTENT(2,2),FILL_ANGLE(MAX_FILL),FILL_WIDTH(MAX_FILL)
      INTEGER FILL_INDEX, FILL_TEX(MAX_FILL), N_LINES(6)
      EQUIVALENCE (DATDAT, DATPTS)
      INTEGER MAXREP
      PARAMETER (MAXREP=5)
      INTEGER IPATRN, NPATRN(30), NXYLIM(3,2), NPLOTS, NCSETS, NCCOL, N
     *CROW, IYEAR, IMONTH, IDAY, ISIGFG, ITXPRI, ITXSEC, ITITDT(3), L
     *ENCRD, IPROP, IHTEX, IBLINK, IERASE, ITCNTR, IUNUSD, NXYZ1(3), 
     *NXYZ2(3), LBLFMT(3), LBLCHR(3), NDIMNS(3), IBLKTP, IDIMNS, NMES
     *H0, NMESH1, NMESH2, MESH1, MESH2, MESH3, MESH2D, MESHN(3), NMESHN(
     *2), NFIELD, IFIELD(19), NINCR, NPOINT, IVARBL(19), IVPTR(19), I_
     *VORDER(19,2), LINEAR(4), NONLIN(4), MXECHO, LINES, MAXLNS, USRK
     *BD, USRSCR, PLTFIL, LINWID, LINCOL, LINTEX, ICPOIN(3), IREPCT(MA
     *XREP), LEVREP, GRDTYP, GRDTEX, OUTTEX, IAXTEX, TITEX, LETSET, LAB
     *TEX, TICTEX, SHADOWTYP,SHADOWTEX, NXYZDEF1(10), NXYZDEF2(10), IF
     *ILE_CASE ,MAX_SUBST
      INTEGER MAX_CYCLE
      PARAMETER (MAX_CYCLE=20)
      INTEGER N_CYCLE, ITX_CYCLE(MAX_CYCLE)
      REAL SYM_CYCLE(MAX_CYCLE)
      EQUIVALENCE (NMESH1,NMESHN)
      EQUIVALENCE (MESH1,MESHN)
      INTEGER IBUFFR(400)
      REAL BUFFER(400)
      INTEGER NCHSAVE 
      PARAMETER (NCHSAVE=2*512) 
      INTEGER*4 ICHSAVE(NCHSAVE)
      INTEGER*4 IVRPTR(15)
      CHARACTER*512 OUTSTR,C_FILE, C_NAME, C_SELECT
      CHARACTER C_TIT_ESCAPE*1,C_TIT_SUBSTITUTE*2
      INTEGER N_FILE, N_NAME, N_SELECT
      CHARACTER*8 PXNAME
      CHARACTER*64 INPFMT
      LOGICAL LTDATA, OUTSID(4)
      COMMON /T2COM/ PXNAME, REDUCE, TITX, TITY ,XFRM12, XFRM13, XFRM1
     *4, XFRM23 ,XFRM24, XFRM34 ,XVARSX ,TITSIZ, GRDSYM, GRDSIZ, CIRS
     *IZ, ASIZE, AFLARE ,SMSZDF, ORAXES, EYEDIR, VUEDIR, VUECEN ,VERTC
     *L, EYESEP, SCRD, SCRZ, EYEDIS, EYEPNT ,XYPART, BARSIZ, TIKSIZ, XY
     *ZBAS, TTHETA ,TPHI, FRELBL, IPATRN, NPATRN, PATRN ,SCLPRM, WINDO
     *W, SCREEN, SYMBOL, NOSYMB ,FACTXY, LBLSIZ, SYMSIZ, XYZLIM, WORLD 
     *,RADRMX, RADRMN, RADAMN, RADANG, RADX0, RADY0, XUNUSD ,USRKBD, U
     *SRSCR, PLTFIL ,ITITDT, LENCRD ,INPFMT, GRDTYP, LINWID, LINCOL, L
     *INTEX, TITCON, ITCNTR ,IUNUSD, NXYZ1, NXYZ2 ,LBLCHR, NDIMNS, IBL
     *KTP, IDIMNS ,NMESH1, NMESH2, MESH1, MESH2, MESH3, NFIELD ,IFIELD
     *, NINCR ,IVARBL, IVRPTR ,LINEAR, NONLIN ,NPOINT, LETSET ,MXECH
     *O, LINES, MAXLNS ,AXANG, MESH2D, REDFAC, GRDTEX, OUTTEX, IAXTEX, 
     *TITEX, DSCAL ,OUTSTR, IPROP, IHTEX, IBLINK, IERASE, LABTEX, TICTE
     *X, NXYLIM, PATSZ ,MARGIN, PSCR, ITXPRI, ITXSEC, OREAL, OCPU, CSCR
     *D, OUTSID ,TITLIN, TITINX, TITZ, TITX1, TITY1, LTDATA, NPLOTS, RE
     *VLEV ,LBLFMT, IYEAR, IMONTH, IDAY, ISIGFG ,DATPTS, ERRPTS, DATXM
     *N, DATXMX, DATYMN, DATYMX, DATZMN, DATZMX ,DATSUM, ERRSUM, DATAVE
     *, ERRAVE, DATCEN, ERRCEN, DATSTD, ERRSTD ,NCSETS, NCCOL, NCROW, F
     *MARKER, H2STAT, TITFAC, TITLOC, TITMAR ,TIKFAC, IWINLEV, WINREL, 
     *WINABS, WINLIM ,ICPOIN, LEVREP, IREPCT, SYDIR, GRDIR, NMESH0, EXY
     *ZLIM, IVPTR ,TITLMX, NXYZDEF1, NXYZDEF2, IFILE_CASE, N_CYCLE, ITX
     *_CYCLE ,SYM_CYCLE, PLOT_EXTENT, FILL_ANGLE, FILL_WIDTH, FILL_TEX 
     *,FILL_INDEX ,N_LINES ,DSLOPE ,MAX_SUBST, BARBRK ,I_VORDER,SHADOW
     *TYP,SHADOWTEX
      COMMON /T2SCRT/ BUFFER, IBUFFR, N_FILE,N_NAME,N_SELECT, ICHSAVE
      COMMON /T2_CHAR/ C_TIT_ESCAPE,C_TIT_SUBSTITUTE
      COMMON /T2_SCRT/ C_FILE, C_NAME, C_SELECT
      INTEGER JOUFIL, ERRFIL, OUTFIL, DBGFIL, INPFIL, NINMAX
      PARAMETER (NINMAX=20)
      INTEGER NINP(NINMAX)
      COMMON /T2TRBK/NINP, JOUFIL, ERRFIL, OUTFIL, DBGFIL, INPFIL
      CHARACTER*512 STRNG, STJOU
      LOGICAL LTOKEN
      REAL FLOTNG
      INTEGER INTERP, KEYORD, NSTRNG, MAXSTR, NSTJOU, LSTJOU, NTOKEN
      INTEGER*4 INTEG
      COMMON /TOKENC/ INTERP, INTEG, FLOTNG, KEYORD, NSTRNG, MAXSTR, ST
     *RNG, NSTJOU, LSTJOU, STJOU, LTOKEN, NTOKEN
      INTEGER IHSIZE,NPSTOR
      REAL TOLR
      PARAMETER (IHSIZE=2000)
      PARAMETER (TOLR=0.001)
      PARAMETER (NPSTOR=30)
      INTEGER IBOLD,IB,IBT,MAJMIN,MAJMAX,MINMIN,MINMAX,MAJSTP,MINSTP ,MI
     *NMN,MINMX,MAJMN,MAJMX ,MAJAX,MINAX,IFREE,IHBTOP(2),ITXTOP(2),LEFT,
     *IRIGHT,IPASS
      INTEGER*2 IHFWD(IHSIZE), IHBACK(IHSIZE)
      LOGICAL LFREE,VFLG,LVANISH
      REAL ROTCOS,ROTSIN,PNT12(2,2),XX(2,4) ,BUFR(NPSTOR),HORXY(2,IHSIZE
     *),VANISH_PNT(2)
      COMMON /T2MSHC/ MAJMIN,MAJMAX,MINMIN,MINMAX,MAJSTP,MINSTP ,MINMN,M
     *INMX,MAJMN,MAJMX ,MAJAX,MINAX,IB,IFREE,IHBTOP,ROTCOS,ROTSIN ,PNT12
     *,XX,IBT,VFLG,LEFT,IRIGHT ,ITXTOP,IBOLD,LFREE ,BUFR,HORXY ,IHFWD,IH
     *BACK,IPASS,LVANISH,VANISH_PNT
      EXTERNAL T2_MESH_DATA
      REAL XYZ(3,3),XY(2,3)
      DO 11071 I=1,3
      XYZ(MESH3,I)=XYZLIM(MESH3,1)
11071 CONTINUE
11072 CONTINUE
      IF (MINAX.EQ.MESH1) THEN
      XYZ(MINAX,1) = ARRAY(1,MINMIN,1)
      XYZ(MINAX,2) = ARRAY(1,MINMIN,1)
      XYZ(MINAX,3) = ARRAY(1,MINMAX,1)
      XYZ(MAJAX,1) = ARRAY(1,1,MAJMAX)
      XYZ(MAJAX,2) = ARRAY(1,1,MAJMIN)-WIDTH
      XYZ(MAJAX,3) = ARRAY(1,1,MAJMIN)-WIDTH
      ELSE
      XYZ(MINAX,1) = ARRAY(1,1,MINMIN)
      XYZ(MINAX,2) = ARRAY(1,1,MINMIN)
      XYZ(MINAX,3) = ARRAY(1,1,MINMAX)
      XYZ(MAJAX,1) = ARRAY(1,MAJMAX,1)
      XYZ(MAJAX,2) = ARRAY(1,MAJMIN,1)-WIDTH
      XYZ(MAJAX,3) = ARRAY(1,MAJMIN,1)-WIDTH
      ENDIF
      CALL T2XFRM(3,3,XYZ,NONLIN,XFRM14,2,XY)
      DO 11081 I=1,2
      XY(I,1) = 2.*XY(I,1) - XY(I,2)
      XY(I,3) = 2.*XY(I,3) - XY(I,2)
11081 CONTINUE
11082 CONTINUE
      CALL T2_MESH_DRAW(XY,3,5)
      END
      SUBROUTINE T2_MESH_FILL(X0,Y0,Z0,DX,DY,DZ,IXYZ,DXYZ)
      COMMON /T2FLGC/ FLAGS(200), LTRAP,LHANDL,LSYERR,LSCREV
      LOGICAL FLAGS, LTRAP,LHANDL,LSYERR,LSCREV(3)
      INTEGER RELFLAG 
      PARAMETER (RELFLAG=151)
      INTEGER IWINLEV 
      INTEGER NWINLEV , MAX_FILL 
      PARAMETER (NWINLEV =4)
      PARAMETER (MAX_FILL=4)
      REAL GRDSYM, GRDSIZ, DATDAT(2,8), H2STAT(12), TITLIN(4), TITFA
     *C(4), TITLOC(4), TITMAR(4), TITLMX(4), TIKFAC, TITINX, TITX1, TIT
     *Y1, TITX, TITY, TITZ, TITSIZ, TITCON(5), REVLEV, REDUCE(5), XFR
     *M12(12), XFRM13(12), XFRM14(12), XFRM23(12), XFRM24(12), XFRM34(6
     *), XVARSX(20), CIRSIZ(2,3), ASIZE, AFLARE, SMSZDF, ORAXES(3), EY
     *EDIR(3), VUEDIR(3), VUECEN(3), VERTCL(3), EYESEP, SCRD, SCRZ, EYE
     *DIS, EYEPNT(3), XYPART(2, 2), BARSIZ(3), BARBRK(3), TIKSIZ(3), XY
     *ZBAS(3), TTHETA, TPHI, FRELBL(4), PATRN(20,30), SCLPRM(10,3), WI
     *NDOW(4), SCREEN(2), SYMBOL, NOSYMB, FACTXY(19), LBLSIZ, SYMSIZ, X
     *YZLIM(3,2), WORLD(3), RADRMX, RADRMN, RADAMN, RADANG, RADX0, RADY
     *0, XUNUSD(6), AXANG(3), REDFAC, DSCAL, PATSZ, MARGIN(4), PSCR(2
     *), OREAL, OCPU, CSCRD, DATPTS, ERRPTS, DATXMN, DATXMX, DATYMN, DA
     *TYMX, DATZMN, DATZMX, DATSUM, ERRSUM, DATAVE, ERRAVE, DATCEN, ERR
     *CEN, DATSTD, ERRSTD, WINREL(2,2,NWINLEV),WINABS(2,2,NWINLEV),WINL
     *IM(2,2), FMARKER(3,8), SYDIR(3), GRDIR(3), EXYZLIM(3,2), DSLOPE(2
     *,2)
      REAL PLOT_EXTENT(2,2),FILL_ANGLE(MAX_FILL),FILL_WIDTH(MAX_FILL)
      INTEGER FILL_INDEX, FILL_TEX(MAX_FILL), N_LINES(6)
      EQUIVALENCE (DATDAT, DATPTS)
      INTEGER MAXREP
      PARAMETER (MAXREP=5)
      INTEGER IPATRN, NPATRN(30), NXYLIM(3,2), NPLOTS, NCSETS, NCCOL, N
     *CROW, IYEAR, IMONTH, IDAY, ISIGFG, ITXPRI, ITXSEC, ITITDT(3), L
     *ENCRD, IPROP, IHTEX, IBLINK, IERASE, ITCNTR, IUNUSD, NXYZ1(3), 
     *NXYZ2(3), LBLFMT(3), LBLCHR(3), NDIMNS(3), IBLKTP, IDIMNS, NMES
     *H0, NMESH1, NMESH2, MESH1, MESH2, MESH3, MESH2D, MESHN(3), NMESHN(
     *2), NFIELD, IFIELD(19), NINCR, NPOINT, IVARBL(19), IVPTR(19), I_
     *VORDER(19,2), LINEAR(4), NONLIN(4), MXECHO, LINES, MAXLNS, USRK
     *BD, USRSCR, PLTFIL, LINWID, LINCOL, LINTEX, ICPOIN(3), IREPCT(MA
     *XREP), LEVREP, GRDTYP, GRDTEX, OUTTEX, IAXTEX, TITEX, LETSET, LAB
     *TEX, TICTEX, SHADOWTYP,SHADOWTEX, NXYZDEF1(10), NXYZDEF2(10), IF
     *ILE_CASE ,MAX_SUBST
      INTEGER MAX_CYCLE
      PARAMETER (MAX_CYCLE=20)
      INTEGER N_CYCLE, ITX_CYCLE(MAX_CYCLE)
      REAL SYM_CYCLE(MAX_CYCLE)
      EQUIVALENCE (NMESH1,NMESHN)
      EQUIVALENCE (MESH1,MESHN)
      INTEGER IBUFFR(400)
      REAL BUFFER(400)
      INTEGER NCHSAVE 
      PARAMETER (NCHSAVE=2*512) 
      INTEGER*4 ICHSAVE(NCHSAVE)
      INTEGER*4 IVRPTR(15)
      CHARACTER*512 OUTSTR,C_FILE, C_NAME, C_SELECT
      CHARACTER C_TIT_ESCAPE*1,C_TIT_SUBSTITUTE*2
      INTEGER N_FILE, N_NAME, N_SELECT
      CHARACTER*8 PXNAME
      CHARACTER*64 INPFMT
      LOGICAL LTDATA, OUTSID(4)
      COMMON /T2COM/ PXNAME, REDUCE, TITX, TITY ,XFRM12, XFRM13, XFRM1
     *4, XFRM23 ,XFRM24, XFRM34 ,XVARSX ,TITSIZ, GRDSYM, GRDSIZ, CIRS
     *IZ, ASIZE, AFLARE ,SMSZDF, ORAXES, EYEDIR, VUEDIR, VUECEN ,VERTC
     *L, EYESEP, SCRD, SCRZ, EYEDIS, EYEPNT ,XYPART, BARSIZ, TIKSIZ, XY
     *ZBAS, TTHETA ,TPHI, FRELBL, IPATRN, NPATRN, PATRN ,SCLPRM, WINDO
     *W, SCREEN, SYMBOL, NOSYMB ,FACTXY, LBLSIZ, SYMSIZ, XYZLIM, WORLD 
     *,RADRMX, RADRMN, RADAMN, RADANG, RADX0, RADY0, XUNUSD ,USRKBD, U
     *SRSCR, PLTFIL ,ITITDT, LENCRD ,INPFMT, GRDTYP, LINWID, LINCOL, L
     *INTEX, TITCON, ITCNTR ,IUNUSD, NXYZ1, NXYZ2 ,LBLCHR, NDIMNS, IBL
     *KTP, IDIMNS ,NMESH1, NMESH2, MESH1, MESH2, MESH3, NFIELD ,IFIELD
     *, NINCR ,IVARBL, IVRPTR ,LINEAR, NONLIN ,NPOINT, LETSET ,MXECH
     *O, LINES, MAXLNS ,AXANG, MESH2D, REDFAC, GRDTEX, OUTTEX, IAXTEX, 
     *TITEX, DSCAL ,OUTSTR, IPROP, IHTEX, IBLINK, IERASE, LABTEX, TICTE
     *X, NXYLIM, PATSZ ,MARGIN, PSCR, ITXPRI, ITXSEC, OREAL, OCPU, CSCR
     *D, OUTSID ,TITLIN, TITINX, TITZ, TITX1, TITY1, LTDATA, NPLOTS, RE
     *VLEV ,LBLFMT, IYEAR, IMONTH, IDAY, ISIGFG ,DATPTS, ERRPTS, DATXM
     *N, DATXMX, DATYMN, DATYMX, DATZMN, DATZMX ,DATSUM, ERRSUM, DATAVE
     *, ERRAVE, DATCEN, ERRCEN, DATSTD, ERRSTD ,NCSETS, NCCOL, NCROW, F
     *MARKER, H2STAT, TITFAC, TITLOC, TITMAR ,TIKFAC, IWINLEV, WINREL, 
     *WINABS, WINLIM ,ICPOIN, LEVREP, IREPCT, SYDIR, GRDIR, NMESH0, EXY
     *ZLIM, IVPTR ,TITLMX, NXYZDEF1, NXYZDEF2, IFILE_CASE, N_CYCLE, ITX
     *_CYCLE ,SYM_CYCLE, PLOT_EXTENT, FILL_ANGLE, FILL_WIDTH, FILL_TEX 
     *,FILL_INDEX ,N_LINES ,DSLOPE ,MAX_SUBST, BARBRK ,I_VORDER,SHADOW
     *TYP,SHADOWTEX
      COMMON /T2SCRT/ BUFFER, IBUFFR, N_FILE,N_NAME,N_SELECT, ICHSAVE
      COMMON /T2_CHAR/ C_TIT_ESCAPE,C_TIT_SUBSTITUTE
      COMMON /T2_SCRT/ C_FILE, C_NAME, C_SELECT
      INTEGER JOUFIL, ERRFIL, OUTFIL, DBGFIL, INPFIL, NINMAX
      PARAMETER (NINMAX=20)
      INTEGER NINP(NINMAX)
      COMMON /T2TRBK/NINP, JOUFIL, ERRFIL, OUTFIL, DBGFIL, INPFIL
      CHARACTER*512 STRNG, STJOU
      LOGICAL LTOKEN
      REAL FLOTNG
      INTEGER INTERP, KEYORD, NSTRNG, MAXSTR, NSTJOU, LSTJOU, NTOKEN
      INTEGER*4 INTEG
      COMMON /TOKENC/ INTERP, INTEG, FLOTNG, KEYORD, NSTRNG, MAXSTR, ST
     *RNG, NSTJOU, LSTJOU, STJOU, LTOKEN, NTOKEN
      INTEGER IHSIZE,NPSTOR
      REAL TOLR
      PARAMETER (IHSIZE=2000)
      PARAMETER (TOLR=0.001)
      PARAMETER (NPSTOR=30)
      INTEGER IBOLD,IB,IBT,MAJMIN,MAJMAX,MINMIN,MINMAX,MAJSTP,MINSTP ,MI
     *NMN,MINMX,MAJMN,MAJMX ,MAJAX,MINAX,IFREE,IHBTOP(2),ITXTOP(2),LEFT,
     *IRIGHT,IPASS
      INTEGER*2 IHFWD(IHSIZE), IHBACK(IHSIZE)
      LOGICAL LFREE,VFLG,LVANISH
      REAL ROTCOS,ROTSIN,PNT12(2,2),XX(2,4) ,BUFR(NPSTOR),HORXY(2,IHSIZE
     *),VANISH_PNT(2)
      COMMON /T2MSHC/ MAJMIN,MAJMAX,MINMIN,MINMAX,MAJSTP,MINSTP ,MINMN,M
     *INMX,MAJMN,MAJMX ,MAJAX,MINAX,IB,IFREE,IHBTOP,ROTCOS,ROTSIN ,PNT12
     *,XX,IBT,VFLG,LEFT,IRIGHT ,ITXTOP,IBOLD,LFREE ,BUFR,HORXY ,IHFWD,IH
     *BACK,IPASS,LVANISH,VANISH_PNT
      EXTERNAL T2_MESH_DATA
      REAL XYZ(3,4),XY(2,4),DXYZ(1)
      REAL RAN
      XYZ(MAJAX,1)=X0
      XYZ(MAJAX,3)=X0
      XYZ(MAJAX,4)=DX
      XYZ(MINAX,1)=Y0
      XYZ(MINAX,3)=Y0
      XYZ(MINAX,4)=DY
      XYZ(MESH3,1)=Z0
      XYZ(MESH3,3)=Z0
      XYZ(MESH3,4)=DZ
      IFACE=1
      DO 11091 I=1,3
      IF(XYZ(I,4).eq.0) IFACE=I
11091 CONTINUE
11092 CONTINUE
      IFACE1=mod(IFACE,3)+1
      IFACE2=MOD(IFACE+1,3)+1
      IF(IAND(IXYZ,1024).ne.0) THEN
      DENOM= ABS((XYZLIM(IFACE1,1)-XYZLIM(IFACE1,2))*  (XYZLIM(IFACE2,1)
     *-XYZLIM(IFACE2,2)))
      IMAX=0
      IF(DENOM.ne.0) IMAX=1+ABS(DXYZ(1)*(XYZ(IFACE1,4)*XYZ(IFACE2,4))/DE
     *NOM)
      DO 11101 I=1,IMAX
      DO 11111 J=1,3
      XYZ(J,1)=XYZ(J,3)+XYZ(J,4)*RAN(ISEED)
      XYZ(J,2)=XYZ(J,1)
11111 CONTINUE
11112 CONTINUE
      CALL T2XFRM(3,2,XYZ,NONLIN,XFRM14,2,XY)
      CALL T2_MESH_DRAW(XY,2,6)
11101 CONTINUE
11102 CONTINUE
      ELSEIF(IAND(IXYZ,512).ne.0) THEN
      DO 11121 I=1,3
      XYZ(I,2)=XYZ(I,3)+XYZ(I,4)
11121 CONTINUE
11122 CONTINUE
      CALL T2XFRM(3,2,XYZ,NONLIN,XFRM14,2,XY)
      CALL T2_MESH_DRAW(XY,2,6)
      DO 11131 I=1,3
      XYZ(I,2)=XYZ(I,3)
11131 CONTINUE
11132 CONTINUE
      XYZ(IFACE1,1)=XYZ(IFACE1,1)+XYZ(IFACE1,4)
      XYZ(IFACE2,2)=XYZ(IFACE2,1)+XYZ(IFACE2,4)
      CALL T2XFRM(3,2,XYZ,NONLIN,XFRM14,2,XY)
      CALL T2_MESH_DRAW(XY,2,6)
      ELSE
      DO 11141 IFACE=1,2
      XS=ABS(DXYZ(IFACE1))
      IF(XS.ne.0) THEN
      XMIN=XYZ(IFACE1,3)-0.00001*XYZ(IFACE1,4)
      XMAX=XYZ(IFACE1,3)+1.00001*XYZ(IFACE1,4)
      DO 11151 I=1,3
      XYZ(I,2)=XYZ(I,3)
      XYZ(I,1)=XYZ(I,3)
11151 CONTINUE
11152 CONTINUE
      XMIN=XMIN-MOD(XMIN,XS)
      IMAX=ABS((XMAX-XMIN)/XS)
      XYZ(IFACE2,2)=XYZ(IFACE2,3)+XYZ(IFACE2,4)
      IF(XYZ(IFACE1,4).lt.0) XS=-XS
      DO 11161 I=1,IMAX
      XYZ(IFACE1,1)=XYZ(IFACE1,1)+XS
      XYZ(IFACE1,2)=XYZ(IFACE1,2)+XS
      CALL T2XFRM(3,2,XYZ,NONLIN,XFRM14,2,XY)
      CALL T2_MESH_DRAW(XY,2,6)
11161 CONTINUE
11162 CONTINUE
      ENDIF
      I=IFACE1
      IFACE1=IFACE2
      IFACE2=I
11141 CONTINUE
11142 CONTINUE
      ENDIF
      END
      SUBROUTINE T2_MESH_GRID(X0,Y0,Z0,DX,DY,DZ,DXYZ,NB)
      IMPLICIT NONE
      INTEGER NB
      REAL X0, Y0, Z0, DX, DY, DZ, DXYZ(NB)
      COMMON /T2FLGC/ FLAGS(200), LTRAP,LHANDL,LSYERR,LSCREV
      LOGICAL FLAGS, LTRAP,LHANDL,LSYERR,LSCREV(3)
      INTEGER RELFLAG 
      PARAMETER (RELFLAG=151)
      INTEGER IWINLEV 
      INTEGER NWINLEV , MAX_FILL 
      PARAMETER (NWINLEV =4)
      PARAMETER (MAX_FILL=4)
      REAL GRDSYM, GRDSIZ, DATDAT(2,8), H2STAT(12), TITLIN(4), TITFA
     *C(4), TITLOC(4), TITMAR(4), TITLMX(4), TIKFAC, TITINX, TITX1, TIT
     *Y1, TITX, TITY, TITZ, TITSIZ, TITCON(5), REVLEV, REDUCE(5), XFR
     *M12(12), XFRM13(12), XFRM14(12), XFRM23(12), XFRM24(12), XFRM34(6
     *), XVARSX(20), CIRSIZ(2,3), ASIZE, AFLARE, SMSZDF, ORAXES(3), EY
     *EDIR(3), VUEDIR(3), VUECEN(3), VERTCL(3), EYESEP, SCRD, SCRZ, EYE
     *DIS, EYEPNT(3), XYPART(2, 2), BARSIZ(3), BARBRK(3), TIKSIZ(3), XY
     *ZBAS(3), TTHETA, TPHI, FRELBL(4), PATRN(20,30), SCLPRM(10,3), WI
     *NDOW(4), SCREEN(2), SYMBOL, NOSYMB, FACTXY(19), LBLSIZ, SYMSIZ, X
     *YZLIM(3,2), WORLD(3), RADRMX, RADRMN, RADAMN, RADANG, RADX0, RADY
     *0, XUNUSD(6), AXANG(3), REDFAC, DSCAL, PATSZ, MARGIN(4), PSCR(2
     *), OREAL, OCPU, CSCRD, DATPTS, ERRPTS, DATXMN, DATXMX, DATYMN, DA
     *TYMX, DATZMN, DATZMX, DATSUM, ERRSUM, DATAVE, ERRAVE, DATCEN, ERR
     *CEN, DATSTD, ERRSTD, WINREL(2,2,NWINLEV),WINABS(2,2,NWINLEV),WINL
     *IM(2,2), FMARKER(3,8), SYDIR(3), GRDIR(3), EXYZLIM(3,2), DSLOPE(2
     *,2)
      REAL PLOT_EXTENT(2,2),FILL_ANGLE(MAX_FILL),FILL_WIDTH(MAX_FILL)
      INTEGER FILL_INDEX, FILL_TEX(MAX_FILL), N_LINES(6)
      EQUIVALENCE (DATDAT, DATPTS)
      INTEGER MAXREP
      PARAMETER (MAXREP=5)
      INTEGER IPATRN, NPATRN(30), NXYLIM(3,2), NPLOTS, NCSETS, NCCOL, N
     *CROW, IYEAR, IMONTH, IDAY, ISIGFG, ITXPRI, ITXSEC, ITITDT(3), L
     *ENCRD, IPROP, IHTEX, IBLINK, IERASE, ITCNTR, IUNUSD, NXYZ1(3), 
     *NXYZ2(3), LBLFMT(3), LBLCHR(3), NDIMNS(3), IBLKTP, IDIMNS, NMES
     *H0, NMESH1, NMESH2, MESH1, MESH2, MESH3, MESH2D, MESHN(3), NMESHN(
     *2), NFIELD, IFIELD(19), NINCR, NPOINT, IVARBL(19), IVPTR(19), I_
     *VORDER(19,2), LINEAR(4), NONLIN(4), MXECHO, LINES, MAXLNS, USRK
     *BD, USRSCR, PLTFIL, LINWID, LINCOL, LINTEX, ICPOIN(3), IREPCT(MA
     *XREP), LEVREP, GRDTYP, GRDTEX, OUTTEX, IAXTEX, TITEX, LETSET, LAB
     *TEX, TICTEX, SHADOWTYP,SHADOWTEX, NXYZDEF1(10), NXYZDEF2(10), IF
     *ILE_CASE ,MAX_SUBST
      INTEGER MAX_CYCLE
      PARAMETER (MAX_CYCLE=20)
      INTEGER N_CYCLE, ITX_CYCLE(MAX_CYCLE)
      REAL SYM_CYCLE(MAX_CYCLE)
      EQUIVALENCE (NMESH1,NMESHN)
      EQUIVALENCE (MESH1,MESHN)
      INTEGER IBUFFR(400)
      REAL BUFFER(400)
      INTEGER NCHSAVE 
      PARAMETER (NCHSAVE=2*512) 
      INTEGER*4 ICHSAVE(NCHSAVE)
      INTEGER*4 IVRPTR(15)
      CHARACTER*512 OUTSTR,C_FILE, C_NAME, C_SELECT
      CHARACTER C_TIT_ESCAPE*1,C_TIT_SUBSTITUTE*2
      INTEGER N_FILE, N_NAME, N_SELECT
      CHARACTER*8 PXNAME
      CHARACTER*64 INPFMT
      LOGICAL LTDATA, OUTSID(4)
      COMMON /T2COM/ PXNAME, REDUCE, TITX, TITY ,XFRM12, XFRM13, XFRM1
     *4, XFRM23 ,XFRM24, XFRM34 ,XVARSX ,TITSIZ, GRDSYM, GRDSIZ, CIRS
     *IZ, ASIZE, AFLARE ,SMSZDF, ORAXES, EYEDIR, VUEDIR, VUECEN ,VERTC
     *L, EYESEP, SCRD, SCRZ, EYEDIS, EYEPNT ,XYPART, BARSIZ, TIKSIZ, XY
     *ZBAS, TTHETA ,TPHI, FRELBL, IPATRN, NPATRN, PATRN ,SCLPRM, WINDO
     *W, SCREEN, SYMBOL, NOSYMB ,FACTXY, LBLSIZ, SYMSIZ, XYZLIM, WORLD 
     *,RADRMX, RADRMN, RADAMN, RADANG, RADX0, RADY0, XUNUSD ,USRKBD, U
     *SRSCR, PLTFIL ,ITITDT, LENCRD ,INPFMT, GRDTYP, LINWID, LINCOL, L
     *INTEX, TITCON, ITCNTR ,IUNUSD, NXYZ1, NXYZ2 ,LBLCHR, NDIMNS, IBL
     *KTP, IDIMNS ,NMESH1, NMESH2, MESH1, MESH2, MESH3, NFIELD ,IFIELD
     *, NINCR ,IVARBL, IVRPTR ,LINEAR, NONLIN ,NPOINT, LETSET ,MXECH
     *O, LINES, MAXLNS ,AXANG, MESH2D, REDFAC, GRDTEX, OUTTEX, IAXTEX, 
     *TITEX, DSCAL ,OUTSTR, IPROP, IHTEX, IBLINK, IERASE, LABTEX, TICTE
     *X, NXYLIM, PATSZ ,MARGIN, PSCR, ITXPRI, ITXSEC, OREAL, OCPU, CSCR
     *D, OUTSID ,TITLIN, TITINX, TITZ, TITX1, TITY1, LTDATA, NPLOTS, RE
     *VLEV ,LBLFMT, IYEAR, IMONTH, IDAY, ISIGFG ,DATPTS, ERRPTS, DATXM
     *N, DATXMX, DATYMN, DATYMX, DATZMN, DATZMX ,DATSUM, ERRSUM, DATAVE
     *, ERRAVE, DATCEN, ERRCEN, DATSTD, ERRSTD ,NCSETS, NCCOL, NCROW, F
     *MARKER, H2STAT, TITFAC, TITLOC, TITMAR ,TIKFAC, IWINLEV, WINREL, 
     *WINABS, WINLIM ,ICPOIN, LEVREP, IREPCT, SYDIR, GRDIR, NMESH0, EXY
     *ZLIM, IVPTR ,TITLMX, NXYZDEF1, NXYZDEF2, IFILE_CASE, N_CYCLE, ITX
     *_CYCLE ,SYM_CYCLE, PLOT_EXTENT, FILL_ANGLE, FILL_WIDTH, FILL_TEX 
     *,FILL_INDEX ,N_LINES ,DSLOPE ,MAX_SUBST, BARBRK ,I_VORDER,SHADOW
     *TYP,SHADOWTEX
      COMMON /T2SCRT/ BUFFER, IBUFFR, N_FILE,N_NAME,N_SELECT, ICHSAVE
      COMMON /T2_CHAR/ C_TIT_ESCAPE,C_TIT_SUBSTITUTE
      COMMON /T2_SCRT/ C_FILE, C_NAME, C_SELECT
      INTEGER JOUFIL, ERRFIL, OUTFIL, DBGFIL, INPFIL, NINMAX
      PARAMETER (NINMAX=20)
      INTEGER NINP(NINMAX)
      COMMON /T2TRBK/NINP, JOUFIL, ERRFIL, OUTFIL, DBGFIL, INPFIL
      CHARACTER*512 STRNG, STJOU
      LOGICAL LTOKEN
      REAL FLOTNG
      INTEGER INTERP, KEYORD, NSTRNG, MAXSTR, NSTJOU, LSTJOU, NTOKEN
      INTEGER*4 INTEG
      COMMON /TOKENC/ INTERP, INTEG, FLOTNG, KEYORD, NSTRNG, MAXSTR, ST
     *RNG, NSTJOU, LSTJOU, STJOU, LTOKEN, NTOKEN
      INTEGER IHSIZE,NPSTOR
      REAL TOLR
      PARAMETER (IHSIZE=2000)
      PARAMETER (TOLR=0.001)
      PARAMETER (NPSTOR=30)
      INTEGER IBOLD,IB,IBT,MAJMIN,MAJMAX,MINMIN,MINMAX,MAJSTP,MINSTP ,MI
     *NMN,MINMX,MAJMN,MAJMX ,MAJAX,MINAX,IFREE,IHBTOP(2),ITXTOP(2),LEFT,
     *IRIGHT,IPASS
      INTEGER*2 IHFWD(IHSIZE), IHBACK(IHSIZE)
      LOGICAL LFREE,VFLG,LVANISH
      REAL ROTCOS,ROTSIN,PNT12(2,2),XX(2,4) ,BUFR(NPSTOR),HORXY(2,IHSIZE
     *),VANISH_PNT(2)
      COMMON /T2MSHC/ MAJMIN,MAJMAX,MINMIN,MINMAX,MAJSTP,MINSTP ,MINMN,M
     *INMX,MAJMN,MAJMX ,MAJAX,MINAX,IB,IFREE,IHBTOP,ROTCOS,ROTSIN ,PNT12
     *,XX,IBT,VFLG,LEFT,IRIGHT ,ITXTOP,IBOLD,LFREE ,BUFR,HORXY ,IHFWD,IH
     *BACK,IPASS,LVANISH,VANISH_PNT
      EXTERNAL T2_MESH_DATA
      LOGICAL LFIRST, LCYCLE
      INTEGER I,J,ITEXSAV,IDUM
      REAL ZMIN, ZMAX
      REAL XYZ(3,2),XY(2,2)
      INTEGER IAND
      XYZ(MAJAX,1)=X0
      XYZ(MAJAX,2)=X0+DX
      XYZ(MINAX,1)=Y0
      XYZ(MINAX,2)=Y0+DY
      ZMIN=MIN(Z0,Z0+DZ)
      ZMAX=MAX(Z0,Z0+DZ)
      LFIRST=.true.
      LCYCLE=IAND(GRDTYP,256).ne.0 .and. MESH3 .eq.3
      IDUM=0
      ITEXSAV=0
      DO 11171 I=1,NB
      IF(DXYZ(I) .gt. ZMAX)GOTO 11172
      IF(DXYZ(I) .lt. ZMIN)GOTO 11171
      IF (LFIRST .or. LCYCLE) THEN
      CALL T2_MESH_flush
      IF (LFIRST) CALL T2CWTS(GRDTEX,ITEXSAV)
      IF (LCYCLE) THEN
      J=MOD(I-1,N_CYCLE)+1
      CALL T2CWTS(ITX_CYCLE(J),IDUM)
      ENDIF
      CALL TXSDEF
      LFIRST=.false.
      ENDIF
      DO 11181 J=1,2
      XYZ(MESH3,J)=DXYZ(I)
11181 CONTINUE
11182 CONTINUE
      CALL T2XFRM(3,2,XYZ,NONLIN,XFRM14,2,XY)
      CALL T2_MESH_DRAW(XY,2,6)
11171 CONTINUE
11172 CONTINUE
      IF (.not. LFIRST) THEN
      CALL T2_MESH_FLUSH
      CALL T2CWTS(ITEXSAV,IDUM)
      CALL TXSDEF
      ENDIF
      END
      SUBROUTINE T2_MESH_INSERT_NODES(I,X,Y)
      IMPLICIT NONE
      INTEGER I,J,IHF
      REAL X,Y
      INTEGER IHSIZE,NPSTOR
      REAL TOLR
      PARAMETER (IHSIZE=2000)
      PARAMETER (TOLR=0.001)
      PARAMETER (NPSTOR=30)
      INTEGER IBOLD,IB,IBT,MAJMIN,MAJMAX,MINMIN,MINMAX,MAJSTP,MINSTP ,MI
     *NMN,MINMX,MAJMN,MAJMX ,MAJAX,MINAX,IFREE,IHBTOP(2),ITXTOP(2),LEFT,
     *IRIGHT,IPASS
      INTEGER*2 IHFWD(IHSIZE), IHBACK(IHSIZE)
      LOGICAL LFREE,VFLG,LVANISH
      REAL ROTCOS,ROTSIN,PNT12(2,2),XX(2,4) ,BUFR(NPSTOR),HORXY(2,IHSIZE
     *),VANISH_PNT(2)
      COMMON /T2MSHC/ MAJMIN,MAJMAX,MINMIN,MINMAX,MAJSTP,MINSTP ,MINMN,M
     *INMX,MAJMN,MAJMX ,MAJAX,MINAX,IB,IFREE,IHBTOP,ROTCOS,ROTSIN ,PNT12
     *,XX,IBT,VFLG,LEFT,IRIGHT ,ITXTOP,IBOLD,LFREE ,BUFR,HORXY ,IHFWD,IH
     *BACK,IPASS,LVANISH,VANISH_PNT
      EXTERNAL T2_MESH_DATA
      J=IFREE
      IF (J.ne.0) THEN
      IFREE=IHFWD(J)
      HORXY(1,J)=X
      HORXY(2,J)=Y
      IHBACK(J)=I
      IHF=IHFWD(I)
      IHFWD(I)=J
      IHBACK(IHF)=J
      IHFWD(J)=IHF
      I=J
      ELSEIF (LFREE) THEN
      LFREE=.false.
      CALL T2ERR(0,' ',('*** ERROR *** Horizon nodes exceed storage'),3)
     *
      ENDIF
      END
      SUBROUTINE T2_MESH_REMOVE_NODES(I)
      IMPLICIT NONE
      INTEGER I,J
      INTEGER IHSIZE,NPSTOR
      REAL TOLR
      PARAMETER (IHSIZE=2000)
      PARAMETER (TOLR=0.001)
      PARAMETER (NPSTOR=30)
      INTEGER IBOLD,IB,IBT,MAJMIN,MAJMAX,MINMIN,MINMAX,MAJSTP,MINSTP ,MI
     *NMN,MINMX,MAJMN,MAJMX ,MAJAX,MINAX,IFREE,IHBTOP(2),ITXTOP(2),LEFT,
     *IRIGHT,IPASS
      INTEGER*2 IHFWD(IHSIZE), IHBACK(IHSIZE)
      LOGICAL LFREE,VFLG,LVANISH
      REAL ROTCOS,ROTSIN,PNT12(2,2),XX(2,4) ,BUFR(NPSTOR),HORXY(2,IHSIZE
     *),VANISH_PNT(2)
      COMMON /T2MSHC/ MAJMIN,MAJMAX,MINMIN,MINMAX,MAJSTP,MINSTP ,MINMN,M
     *INMX,MAJMN,MAJMX ,MAJAX,MINAX,IB,IFREE,IHBTOP,ROTCOS,ROTSIN ,PNT12
     *,XX,IBT,VFLG,LEFT,IRIGHT ,ITXTOP,IBOLD,LFREE ,BUFR,HORXY ,IHFWD,IH
     *BACK,IPASS,LVANISH,VANISH_PNT
      EXTERNAL T2_MESH_DATA
      J=IHBACK(I)
      IF(J.ne.0) IHFWD(J)=IHFWD(I)
      J=IHFWD(I)
      IF(J.ne.0) IHBACK(J)=IHBACK(I)
      IHFWD(I)=IFREE
      IFREE=I
      I=J
      END
