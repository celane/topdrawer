C        MORTRAN 2.79 (BRACKETED KEYWORD MACROS OF 09/28/81)          
      SUBROUTINE T2SET(INFOIN,CARDIN)
      EXTERNAL T2SETC
      LOGICAL INTRAC,LLLL,LTEMP,LTEMP1
      INTEGER INFOIN(10)
      CHARACTER*(*) CARDIN
      DOUBLE PRECISION TWOPI
      PARAMETER (TWOPI=6.2831 85307 18 D0)
      DOUBLE PRECISION ANGFAC(4)
      REAL TEMPA(10)
      CHARACTER*80 TSTR
      CHARACTER*10 LOGSTR
      INTEGER ITTX_CYCLE(7)
      INTEGER I,J,K,L,M,N, IMIN, IMAX, I1, I2, I3
      INTEGER NTSTR
      LOGICAL LTEST 
      INTEGER LISTPT,NPTMAX,NDSETS
      REAL DATBUF(10248)
      COMMON /T2XPNT/ LISTPT,NPTMAX,NDSETS,DATBUF
      COMMON /T2FLGC/ FLAGS(200), LTRAP,LHANDL,LSYERR,LSCREV
      LOGICAL FLAGS, LTRAP,LHANDL,LSYERR,LSCREV(3)
      INTEGER RELFLAG 
      PARAMETER (RELFLAG=151)
      INTEGER IWINLEV 
      INTEGER NWINLEV , MAX_FILL 
      PARAMETER (NWINLEV =4)
      PARAMETER (MAX_FILL=4)
      REAL GRDSYM, GRDSIZ, DATDAT(2,8), H2STAT(12), TITLIN(4), TITFA
     *C(4), TITLOC(4), TITMAR(4), TITLMX(4), TIKFAC, TITINX, TITX1, TIT
     *Y1, TITX, TITY, TITZ, TITSIZ, TITCON(5), REVLEV, REDUCE(5), XFR
     *M12(12), XFRM13(12), XFRM14(12), XFRM23(12), XFRM24(12), XFRM34(6
     *), XVARSX(20), CIRSIZ(2,3), ASIZE, AFLARE, SMSZDF, ORAXES(3), EY
     *EDIR(3), VUEDIR(3), VUECEN(3), VERTCL(3), EYESEP, SCRD, SCRZ, EYE
     *DIS, EYEPNT(3), XYPART(2, 2), BARSIZ(3), BARBRK(3), TIKSIZ(3), XY
     *ZBAS(3), TTHETA, TPHI, FRELBL(4), PATRN(20,30), SCLPRM(10,3), WI
     *NDOW(4), SCREEN(2), SYMBOL, NOSYMB, FACTXY(19), LBLSIZ, SYMSIZ, X
     *YZLIM(3,2), WORLD(3), RADRMX, RADRMN, RADAMN, RADANG, RADX0, RADY
     *0, XUNUSD(6), AXANG(3), REDFAC, DSCAL, PATSZ, MARGIN(4), PSCR(2
     *), OREAL, OCPU, CSCRD, DATPTS, ERRPTS, DATXMN, DATXMX, DATYMN, DA
     *TYMX, DATZMN, DATZMX, DATSUM, ERRSUM, DATAVE, ERRAVE, DATCEN, ERR
     *CEN, DATSTD, ERRSTD, WINREL(2,2,NWINLEV),WINABS(2,2,NWINLEV),WINL
     *IM(2,2), FMARKER(3,8), SYDIR(3), GRDIR(3), EXYZLIM(3,2), DSLOPE(2
     *,2)
      REAL PLOT_EXTENT(2,2),FILL_ANGLE(MAX_FILL),FILL_WIDTH(MAX_FILL)
      INTEGER FILL_INDEX, FILL_TEX(MAX_FILL), N_LINES(6)
      EQUIVALENCE (DATDAT, DATPTS)
      INTEGER MAXREP
      PARAMETER (MAXREP=5)
      INTEGER IPATRN, NPATRN(30), NXYLIM(3,2), NPLOTS, NCSETS, NCCOL, N
     *CROW, IYEAR, IMONTH, IDAY, ISIGFG, ITXPRI, ITXSEC, ITITDT(3), L
     *ENCRD, IPROP, IHTEX, IBLINK, IERASE, ITCNTR, IUNUSD, NXYZ1(3), 
     *NXYZ2(3), LBLFMT(3), LBLCHR(3), NDIMNS(3), IBLKTP, IDIMNS, NMES
     *H0, NMESH1, NMESH2, MESH1, MESH2, MESH3, MESH2D, MESHN(3), NMESHN(
     *2), NFIELD, IFIELD(19), NINCR, NPOINT, IVARBL(19), IVPTR(19), I_
     *VORDER(19,2), LINEAR(4), NONLIN(4), MXECHO, LINES, MAXLNS, USRK
     *BD, USRSCR, PLTFIL, LINWID, LINCOL, LINTEX, ICPOIN(3), IREPCT(MA
     *XREP), LEVREP, GRDTYP, GRDTEX, OUTTEX, IAXTEX, TITEX, LETSET, LAB
     *TEX, TICTEX, SHADOWTYP,SHADOWTEX, NXYZDEF1(10), NXYZDEF2(10), IF
     *ILE_CASE ,MAX_SUBST
      INTEGER MAX_CYCLE
      PARAMETER (MAX_CYCLE=20)
      INTEGER N_CYCLE, ITX_CYCLE(MAX_CYCLE)
      REAL SYM_CYCLE(MAX_CYCLE)
      EQUIVALENCE (NMESH1,NMESHN)
      EQUIVALENCE (MESH1,MESHN)
      INTEGER IBUFFR(400)
      REAL BUFFER(400)
      INTEGER NCHSAVE 
      PARAMETER (NCHSAVE=2*512) 
      INTEGER*4 ICHSAVE(NCHSAVE)
      INTEGER*4 IVRPTR(15)
      CHARACTER*512 OUTSTR,C_FILE, C_NAME, C_SELECT
      CHARACTER C_TIT_ESCAPE*1,C_TIT_SUBSTITUTE*2
      INTEGER N_FILE, N_NAME, N_SELECT
      CHARACTER*8 PXNAME
      CHARACTER*64 INPFMT
      LOGICAL LTDATA, OUTSID(4)
      COMMON /T2COM/ PXNAME, REDUCE, TITX, TITY ,XFRM12, XFRM13, XFRM1
     *4, XFRM23 ,XFRM24, XFRM34 ,XVARSX ,TITSIZ, GRDSYM, GRDSIZ, CIRS
     *IZ, ASIZE, AFLARE ,SMSZDF, ORAXES, EYEDIR, VUEDIR, VUECEN ,VERTC
     *L, EYESEP, SCRD, SCRZ, EYEDIS, EYEPNT ,XYPART, BARSIZ, TIKSIZ, XY
     *ZBAS, TTHETA ,TPHI, FRELBL, IPATRN, NPATRN, PATRN ,SCLPRM, WINDO
     *W, SCREEN, SYMBOL, NOSYMB ,FACTXY, LBLSIZ, SYMSIZ, XYZLIM, WORLD 
     *,RADRMX, RADRMN, RADAMN, RADANG, RADX0, RADY0, XUNUSD ,USRKBD, U
     *SRSCR, PLTFIL ,ITITDT, LENCRD ,INPFMT, GRDTYP, LINWID, LINCOL, L
     *INTEX, TITCON, ITCNTR ,IUNUSD, NXYZ1, NXYZ2 ,LBLCHR, NDIMNS, IBL
     *KTP, IDIMNS ,NMESH1, NMESH2, MESH1, MESH2, MESH3, NFIELD ,IFIELD
     *, NINCR ,IVARBL, IVRPTR ,LINEAR, NONLIN ,NPOINT, LETSET ,MXECH
     *O, LINES, MAXLNS ,AXANG, MESH2D, REDFAC, GRDTEX, OUTTEX, IAXTEX, 
     *TITEX, DSCAL ,OUTSTR, IPROP, IHTEX, IBLINK, IERASE, LABTEX, TICTE
     *X, NXYLIM, PATSZ ,MARGIN, PSCR, ITXPRI, ITXSEC, OREAL, OCPU, CSCR
     *D, OUTSID ,TITLIN, TITINX, TITZ, TITX1, TITY1, LTDATA, NPLOTS, RE
     *VLEV ,LBLFMT, IYEAR, IMONTH, IDAY, ISIGFG ,DATPTS, ERRPTS, DATXM
     *N, DATXMX, DATYMN, DATYMX, DATZMN, DATZMX ,DATSUM, ERRSUM, DATAVE
     *, ERRAVE, DATCEN, ERRCEN, DATSTD, ERRSTD ,NCSETS, NCCOL, NCROW, F
     *MARKER, H2STAT, TITFAC, TITLOC, TITMAR ,TIKFAC, IWINLEV, WINREL, 
     *WINABS, WINLIM ,ICPOIN, LEVREP, IREPCT, SYDIR, GRDIR, NMESH0, EXY
     *ZLIM, IVPTR ,TITLMX, NXYZDEF1, NXYZDEF2, IFILE_CASE, N_CYCLE, ITX
     *_CYCLE ,SYM_CYCLE, PLOT_EXTENT, FILL_ANGLE, FILL_WIDTH, FILL_TEX 
     *,FILL_INDEX ,N_LINES ,DSLOPE ,MAX_SUBST, BARBRK ,I_VORDER,SHADOW
     *TYP,SHADOWTEX
      COMMON /T2SCRT/ BUFFER, IBUFFR, N_FILE,N_NAME,N_SELECT, ICHSAVE
      COMMON /T2_CHAR/ C_TIT_ESCAPE,C_TIT_SUBSTITUTE
      COMMON /T2_SCRT/ C_FILE, C_NAME, C_SELECT
      INTEGER JOUFIL, ERRFIL, OUTFIL, DBGFIL, INPFIL, NINMAX
      PARAMETER (NINMAX=20)
      INTEGER NINP(NINMAX)
      COMMON /T2TRBK/NINP, JOUFIL, ERRFIL, OUTFIL, DBGFIL, INPFIL
      CHARACTER*512 STRNG, STJOU
      LOGICAL LTOKEN
      REAL FLOTNG
      INTEGER INTERP, KEYORD, NSTRNG, MAXSTR, NSTJOU, LSTJOU, NTOKEN
      INTEGER*4 INTEG
      COMMON /TOKENC/ INTERP, INTEG, FLOTNG, KEYORD, NSTRNG, MAXSTR, ST
     *RNG, NSTJOU, LSTJOU, STJOU, LTOKEN, NTOKEN
      LOGICAL DFLAGS(200),DSCREV(3)
      COMMON /T2FLGD/DFLAGS,DSCREV
      REAL DTITLIN(4), DTITFAC(4), DTITMAR(4)
      INTEGER DGRDTYP, DGRDTEX, DOUTTEX, IDAXTEX, DTITEX, DSHADOWTYP,DS
     *HADOWTEX, IFLDDF(19), NDDIMNS, IDTXPRI, IDTXSEC, LINCLF, LINTXF,
     * LINWDF, DNONLN(3), DNXYZ1(3), DNXYZ2(3), DLABTEX, DTICTEX, DNPAT
     *RN(30), DLBLCHR(3), ND_CYCLE, IDTX_CYCLE(MAX_CYCLE)
      REAL DSYM_CYCLE(MAX_CYCLE)
      REAL DTITSIZ, DGRDSYM, DGRDSIZ, DCIRSIZ(2,3), DASIZE, DAFLARE, D
     *SMSZDF, DORAXES(3), DEYEDIR(3), DVUEDIR(3), DVUECEN(3), DVERTCL(3
     *), DEYESEP, DSCRD, DSCRZ, DEYEDIS, DEYEPNT(3), DBARSIZ(3), DBARBR
     *K(3), DTIKSIZ(3), DXYZBS(3), DTTHETA, DTPHI, DFRELBL(4), DPATRN(2
     *0,30), DSCLPRM(10,3), DWINDOW(4), DSCREEN(2), DSYMBOL, DNOSYMB, 
     *DAXANG(3), DLBLSIZ, DSYMSIZ, DXYZLIM(3,2), DFACTXY(19), DRADANG,
     * DDSCAL, DPATSZ, DTITINX, DTIKFAC, DSYDIR(3), DGRDIR(3)
      COMMON /T2COMD/ DTITSIZ, DGRDSYM, DGRDSIZ, DCIRSIZ, DASIZE, DAFLA
     *RE, DSMSZDF, DORAXES, DEYEDIR, DVUEDIR, DVUECEN, DVERTCL, DEYESE
     *P, DSCRD, DSCRZ, DEYEDIS, DEYEPNT, DBARSIZ, DTIKSIZ, DXYZBS, DTTH
     *ETA, DTPHI, DFRELBL, DNPATRN, DPATRN, DSCLPRM, DWINDOW, DSCREEN,
     * DSYMBOL, DNOSYMB, DAXANG, DLBLSIZ, DSYMSIZ, DXYZLIM, DGRDTYP, D
     *FACTXY, IFLDDF, NDDIMNS, DGRDTEX, DOUTTEX, IDAXTEX, DTITEX, DRADA
     *NG, DDSCAL, DNONLN, DNXYZ1, DNXYZ2, LINCLF, LINTXF, LINWDF, DLABT
     *EX, DTICTEX, DPATSZ, IDTXPRI, IDTXSEC, DTITLIN, DTITINX, DLBLCHR,
     * DTITFAC, DTITMAR, DTIKFAC, DSYDIR, DGRDIR, ND_CYCLE, IDTX_CYCLE,
     * DSYM_CYCLE, DBARBRK,  DSHADOWTYP,DSHADOWTEX
      CHARACTER*80 PRMP1, PRMP2
      INTEGER NPRMP1, NPRMP2
      COMMON /T2PRMP/NPRMP1, PRMP1, NPRMP2, PRMP2
      REAL HNONE
      REAL PLIM(4,4),ZSCRN(2),XLLINE,YLLINE,XTLINE,YTLINE,XFRMFC, PAT(2
     *0),PATCUM,PATTOT,PATMOD,CCSCIS(4),DISPL, RESOL(2)
      INTEGER NPTS,IDDEVC,IPAT,NPAT,LMOVE,IROTAX,IROTAF
      COMMON/TXCOM/PLIM,ZSCRN, XLLINE,YLLINE,XTLINE,YTLINE,XFRMFC, IPA
     *T,NPAT,PAT,PATTOT, NPTS,IDDEVC,CCSCIS,LMOVE,IROTAX,DISPL,IROTAF,P
     *ATCUM,PATMOD, RESOL
      INTEGER IAND
      CHARACTER TKSTR*555
      REAL TXSYM
      EXTERNAL TXSYM
      LOGICAL TDSHOW,DMMY
      DATA ANGFAC/1.0D0,0.0174532925D0,0.0157079630D0,0.0628318530D0/
      DATA ITTX_CYCLE/2112,3776,1664,3008,1280,3328,768/
      DATA HNONE /-666.666/
      N1=0
      GOTO 10011
10015 CONTINUE
      I=MIN(MAX(NSTRNG,1),10)
      LOGSTR=STRNG(1:I)
      INFOIN(9)=-1
      GOTO 10012
10011 CALL TOKEN(INFOIN,CARDIN,';')
      GOTO (10015,10015,10015,10015,10015,10015,10015,10015,10015),INTER
     *P
10012 CONTINUE
      GOTO 10021
10050 CONTINUE
      CALL T2_SET_WINDOW(INFOIN,CARDIN)
      GOTO 10022
10060 CONTINUE
      GOTO 10071
10100 CONTINUE
      ASIZE=FLOTNG/REDUCE(3)
      N1=1
      IF (FLOTNG .lt. 0) ASIZE=FLOTNG 
      GOTO 10071
10110 CONTINUE
      AFLARE=FLOTNG
      N1=1
      GOTO 10071
10120 CONTINUE
      DASIZE=ASIZE
      DAFLARE=AFLARE
      N1=1
      GOTO 10071
10071 CALL TOKEN(INFOIN,CARDIN,'SIZE:0::-2,FLARE:::0.5,FLAIR:::0.5,PERMA
     *NENT,;')
      GOTO (10072,10077,10075,10075,10075,10075,10071,10077, 10075),INTE
     *RP
10075 CALL T2ERR(INFOIN,CARDIN,' ',5)
      GOTO 10071
10077 GOTO ( 10100,10110,10110,10120,10075),KEYORD
10072 CONTINUE
      IF (n1.eq.0.and..not.FLAGS(23)) THEN
      ASIZE=2.0 
      AFLARE=0.5
      ENDIF
      GOTO 10022
10130 CONTINUE
      CALL T2_SET_AXIS(INFOIN,CARDIN)
      GOTO 10022
10140 CONTINUE
      IMIN=1
      IMAX=3
      GOTO 10151
10160 CONTINUE
      N1=1
      DO 10171 I=IMIN,IMAX
      BARSIZ(I)=FLOTNG
      FLAGS(79-1+I)=.true.
10171 CONTINUE
10172 CONTINUE
      GOTO 10151
10200 CONTINUE
      IMIN=INTEG/10
      IMAX=MOD(INTEG,10)
      GOTO 10151
10210 CONTINUE
      N1=1
      FLAGS(131)=LTOKEN
      GOTO 10151
10220 CONTINUE
      GOTO 10151
10230 CONTINUE
      N1=1
      DO 10241 I=IMIN,IMAX
      BARBRK(I)=FLOTNG
10241 CONTINUE
10242 CONTINUE
      GOTO 10151
10250 CONTINUE
      N1=1
      DFLAGS(131)=FLAGS(131)
      DO 10261 I=1,3
      DFLAGS(79-1+I)=FLAGS(79-1+I)
      DBARBRK(I)=BARBRK(I)
      DBARSIZ(I)=BARSIZ(I)
10261 CONTINUE
10262 CONTINUE
      GOTO 10151
10180 GOTO ( 10200,10200,10200,10200,10210,10220,10230,10250,10155),KEYO
     *RD
10151 CALL TOKEN(INFOIN,CARDIN,'ALL:13,X:11,Y:22,Z:33,SUPPRESS:Y,SIZE,BR
     *EAK:::-1,PERMANENT,;')
      GOTO (10152,10180,10160,10160,10155,10155,10155,10180,10155),INTER
     *P
10155 CALL T2ERR(INFOIN,CARDIN,' ',5)
      GOTO 10151
10152 CONTINUE
      IF (n1.eq.0.and..not.FLAGS(23)) THEN
      FLAGS(131)=.FALSE.
      DO 10271 I=1,3
      BARSIZ(I)=0.1 
      BARBRK(I)=0
      FLAGS(79-1+I)=.false.
10271 CONTINUE
10272 CONTINUE
      ENDIF
      GOTO 10022
10280 CONTINUE
      I=INTEG
      INDX=0
      GOTO 10291
10300 CONTINUE
      N1=1
      INDX=INDX+1
      IF(INDX.le.2) THEN
      CIRSIZ(INDX,I)=FLOTNG
      IF(INDX .eq. 1) CIRSIZ(2,I)=FLOTNG
      ELSE
      INFOIN(9)=-1
      GOTO 10292
      ENDIF
      GOTO 10291
10330 CONTINUE
      INDX=0
      GOTO 10291
10340 CONTINUE
      N1=1
      IF(INDX .eq. 1) CIRSIZ(2,I)=CIRSIZ(1,I)
      DO 10351 J=1,2
      DCIRSIZ(J,I)=CIRSIZ(J,I)
10351 CONTINUE
10352 CONTINUE
      GOTO 10291
10310 GOTO ( 10330,10340,10295),KEYORD
10291 CALL TOKEN(INFOIN,CARDIN,'SIZE,PERMANENT,;')
      GOTO (10292,10310,10300,10300,10295,10295,10295,10310,10295),INTER
     *P
10295 CALL T2ERR(INFOIN,CARDIN,' ',5)
      GOTO 10291
10292 CONTINUE
      IF (n1.eq.0.and..not.FLAGS(23)) THEN
      DO 10361 J=1,2
      CIRSIZ(J,I)=1. 
10361 CONTINUE
10362 CONTINUE
      ENDIF
      GOTO 10022
10370 CONTINUE
      IBLINK=0
      IF( LTOKEN ) IBLINK=1
      CALL TXXOPT(10,IBLINK,DUM,I)
      GOTO 10022
10380 CONTINUE
      LENCRD=LEN(CARDIN)
      GOTO 10391
10420 CONTINUE
      GOTO 10391
10400 GOTO ( 10420,10395),KEYORD
10430 CONTINUE
      IF(INTEG.ge.20.and.INTEG.le.LEN(CARDIN)) THEN
      LENCRD=INTEG
      ELSE
      WRITE(OUTSTR,*)'*** ERROR ***  Length out of range: (20-',LEN(CARD
     *IN),')'
      CALL T2ERR(INFOIN,CARDIN,OUTSTR,-4)
      ENDIF
      GOTO 10391
10391 CALL TOKEN(INFOIN,CARDIN,'LENGTH,;')
      GOTO (10392,10400,10430,10430,10395,10395,10395,10400,10395),INTER
     *P
10395 CALL T2ERR(INFOIN,CARDIN,' ',5)
      GOTO 10391
10392 CONTINUE
      GOTO 10022
10440 CONTINUE
      CALL T2_SET_CHARACTERS(INFOIN,CARDIN)
      GOTO 10022
10450 CONTINUE
      FLAGS(60)=.TRUE.
      GOTO 10461
10490 CONTINUE
      FLAGS(60)=LTOKEN
      GOTO 10461
10461 CALL TOKEN(INFOIN,CARDIN,'DEFERRED:Y,IMMEDIATE:N,;')
      GOTO (10462,10467,10465,10465,10465,10465,10461,10467, 10465),INTE
     *RP
10465 CALL T2ERR(INFOIN,CARDIN,' ',5)
      GOTO 10461
10467 GOTO ( 10490,10490,10465),KEYORD
10462 CONTINUE
      GOTO 10022
10500 CONTINUE
      GOTO 10511
10540 CONTINUE
      N1=1
      LINCOL=INTEG
      GOTO 10511
10550 CONTINUE
      N1=1
      LINCLF=LINCOL
      GOTO 10511
10511 CALL TOKEN(INFOIN,CARDIN,'WHITE:1,RED:2,GREEN:3,BLUE:4,YELLOW:5,MA
     *GENTA:6,CYAN:7,BLACK:8,PERMANENT,;')
      GOTO (10512,10517,10515,10515,10515,10515,10511,10517, 10515),INTE
     *RP
10515 CALL T2ERR(INFOIN,CARDIN,' ',5)
      GOTO 10511
10517 GOTO ( 10540,10540,10540,10540,10540,10540,10540,10540,
     *10550,10515),KEYORD
10512 CONTINUE
      IF (n1.eq.0.and..not.FLAGS(23)) LINCOL=1
      GOTO 10022
10560 CONTINUE
      FLAGS(100)=LTOKEN
      GOTO 10022
10570 CONTINUE
      GOTO 10581
10610 CONTINUE
      MAX_SUBST=INTEG
      GOTO 10581
10581 CALL TOKEN(INFOIN,CARDIN,'MAXSUBSTITUTIONS:0::1000,;')
      GOTO (10582,10587,10585,10585,10585,10585,10581,10587, 10585),INTE
     *RP
10585 CALL T2ERR(INFOIN,CARDIN,' ',5)
      GOTO 10581
10587 GOTO ( 10610,10585),KEYORD
10582 CONTINUE
      GOTO 10022
10620 CONTINUE
      I=0
      J=0
      ICOLOR=-1
      IWIDTH=-1
      ITXTUR=-1
      TEMP=-1
      IPATRN=MIN(30,10)
      NPATRN(IPATRN)=0
      GOTO 10631
10660 CONTINUE
      N_CYCLE=INTEG
      J=1
      GOTO 10631
10670 CONTINUE
      IF (INTEG .eq. 0) THEN
      I=I+1
      ELSE
      I=INTEG
      ENDIF
      I=MIN(MAX_CYCLE,I)
      N_CYCLE=MAX(N_CYCLE,I)
      K=MIN(30,I+10)
      IF (ITXTUR .ge. 0) THEN
      NPATRN(K)=NPATRN(IPATRN)
      DO 10681 L=1,NPATRN(K)
      PATRN(L,K)=PATRN(L,IPATRN)
10681 CONTINUE
10682 CONTINUE
      ENDIF
      IF (IWIDTH.lt.0) IWIDTH=IAND(ITX_CYCLE(I)/8,7)
      IF (ITXTUR.lt.0) ITXTUR=IAND(ITX_CYCLE(I)/64,7)
      IF (ICOLOR.lt.0) ICOLOR=IAND(ITX_CYCLE(I)/512,7)
      ITX_CYCLE(I)=512*ICOLOR+64*ABS(ITXTUR)+8*IWIDTH+4096*K
      IF (TEMP .ge. 0) SYM_CYCLE(I)=TEMP
      ICOLOR=-1
      IWIDTH=-1
      ITXTUR=-1
      TEMP=-1
      J=1
      GOTO 10631
10690 CONTINUE
      ND_CYCLE=N_CYCLE
      DO 10701 K=1,MAX_CYCLE
      IDTX_CYCLE(K)=ITX_CYCLE(K)
      DSYM_CYCLE(K)=SYM_CYCLE(K)
10701 CONTINUE
10702 CONTINUE
      IF(J.eq.0) J=-1
      GOTO 10631
10710 CONTINUE
      ICOLOR=INTEG
      J=1
      GOTO 10631
10720 CONTINUE
      IF (ITXTUR .lt. 0) ITXTUR=0
      CALL T2GTEX(ITXTUR)
      J=1
      GOTO 10631
10730 CONTINUE
      IWIDTH=INTEG
      J=1
      GOTO 10631
10740 CONTINUE
      J=1
      IF (NSTRNG .gt. 0) THEN
      TEMP=TXSYM(STRNG(1:NSTRNG))
      ELSE
      TEMP=0
      ENDIF
      GOTO 10631
10631 CALL TOKEN(INFOIN,CARDIN,'NUMBER:1:20:5,ENTRY:1:20:0,PERMANENT,NOC
     *OLOR:0,WHITE:1,RED:2,GREEN:3,BLUE:4,YELLOW:5,MAGENTA:6,CYAN:7,NOTE
     *XTURE:0,DO:1,DOT:1,DOTS:1,DOTTED:1,DA:2,DASHES:2,DASHED:2,DOTDASHE
     *D:3,DOT-DASH:3,SOLID:4,FUNNY:5,DAASHES:7,SPACE:8,PATTERNED:6,INTEN
     *SITY:0:5:0,WIDTH:0:5:0,SYMBOL:T,BLACK:8,;')
      GOTO (10632,10637,10635,10635,10635,10635,10631,10637, 10635),INTE
     *RP
10635 CALL T2ERR(INFOIN,CARDIN,' ',5)
      GOTO 10631
10637 GOTO ( 10660,10670,10690,10710,10710,10710,10710,10710,10710,10710
     *,10710,10720,10720,10720,10720,10720,10720,10720,10720,10720,10720
     *,10720,10720,10720,10720,10720,10730,10730,10740,10710,10635),
     *KEYORD
10632 CONTINUE
      IF (J .gt. 0) THEN
      IF (I .eq. 0) THEN
      IMIN=1
      IMAX=MAX_CYCLE
      ELSE
      IMIN=I
      IMAX=I
      ENDIF
      I1=IWIDTH
      I2=ITXTUR
      I3=ICOLOR
      DO 10751 I=IMIN,IMAX
      K=MIN(30,I+10)
      IF (ITXTUR .ge. 0) THEN
      NPATRN(K)=NPATRN(IPATRN)
      DO 10761 L=1,NPATRN(K)
      PATRN(L,K)=PATRN(L,IPATRN)
10761 CONTINUE
10762 CONTINUE
      ENDIF
      IF (IWIDTH.lt.0) I1=IAND(ITX_CYCLE(I)/8,7)
      IF (ITXTUR.lt.0) I2=IAND(ITX_CYCLE(I)/64,7)
      IF (ICOLOR.lt.0) I3=IAND(ITX_CYCLE(I)/512,7)
      ITX_CYCLE(I)=512*I3+64*ABS(I2)+8*I1+4096*K
      IF (TEMP .ge. 0) SYM_CYCLE(I)=TEMP
10751 CONTINUE
10752 CONTINUE
      ELSEIF (J.eq.0) THEN
      N_CYCLE=5
      DO 10771 I=1,MAX_CYCLE
      K=MIN(30,I+10)
      NPATRN(K)=0
      ITX_CYCLE(I)=ITTX_CYCLE(MIN(I,7))
      SYM_CYCLE(I)=ICHAR('O')+256*(ICHAR('0')+MIN(9,I-1))
10771 CONTINUE
10772 CONTINUE
      ENDIF
      NPATRN(IPATRN)=0
      GOTO 10022
10780 CONTINUE
      CALL T2_SET_DATE(INFOIN,CARDIN)
      GOTO 10022
10790 CONTINUE
      IF (.NOT.FLAGS(57)) THEN
      CALL TXDEVC(INFOIN,CARDIN)
      CALL T2REST
      ENDIF
      GOTO 10022
10800 CONTINUE
      ISIGFG=INTEG
      GOTO 10022
10810 CONTINUE
      IF (INTRAC(I)) THEN
      GOTO 10821
10850 CONTINUE
      ERRFIL=86
      GOTO 10821
10860 CONTINUE
      ERRFIL=6
      GOTO 10821
10870 CONTINUE
      ERRFIL=OUTFIL
      GOTO 10821
10880 CONTINUE
      FLAGS(26)=LTOKEN
      GOTO 10821
10821 CALL TOKEN(INFOIN,CARDIN,'DEFERRED,IMMEDIATE,LIST,WAIT:Y,PAUSE:Y,N
     *OWAIT:N,NOPAUSE:N,;')
      GOTO (10822,10827,10825,10825,10825,10825,10821,10827, 10825),INTE
     *RP
10825 CALL T2ERR(INFOIN,CARDIN,' ',5)
      GOTO 10821
10827 GOTO ( 10850,10860,10870,10880,10880,10880,10880,10825),KEYORD
10822 CONTINUE
      ENDIF
      GOTO 10022
10890 CONTINUE
      FLAGS(130)=.true.
      GOTO 10901
10930 CONTINUE
      FLAGS(130)=INTEG .eq. 0
      GOTO 10902
10940 CONTINUE
      DFLAGS(130)=FLAGS(130)
      GOTO 10902
10901 CALL TOKEN(INFOIN,CARDIN,'ON:0:OFF:1,PERMANENT,;')
      GOTO (10905,10907,10905,10905,10905,10905,10902,10907, 10905),INTE
     *RP
10905 CALL T2ERR(INFOIN,CARDIN,' ',5)
      GOTO 10902
10907 GOTO ( 10930,10940,10905),KEYORD
10902 CONTINUE
      GOTO 10022
10950 CONTINUE
      CALL T2_SET_FILE(INFOIN,CARDIN)
      GOTO 10022
10960 CONTINUE
      CALL T2_SET_FILL(INFOIN,CARDIN)
      GOTO 10022
10970 CONTINUE
      CALL T2_FIT(INFOIN,CARDIN)
      GOTO 10022
10980 CONTINUE
      FLAGS(54)=LTOKEN
      GOTO 10022
10990 CONTINUE
      LETSET=2
      GOTO 11001
11030 CONTINUE
      LETSET=INTEG
      CALL TOKEN(INFOIN,CARDIN,'I,J,1,2,3,4,;')  ! for default case
      GOTO (11031,11033,11032) INTERP
      GOTO 11005
11031 CALL SET_DEFAULT_CASE(' ')
      GOTO 11002
11032 IF (INTEG.LE.0.OR.INTEG.GT.4) GOTO 11005
11033 CALL SET_DEFAULT_CASE(CARDIN(INFOIN(3):INFOIN(3)))
      GOTO 11002
11001 CALL TOKEN(INFOIN,CARDIN,'BASIC:1,EXTENDED:2,SIMPLEX:2,DUPLEX:3,;'
     *)
      GOTO (11005,11007,11005,11005,11005,11005,11002,11007, 11005),INTE
     *RP
11005 CALL T2ERR(INFOIN,CARDIN,' ',5)
      GOTO 11002
11007 GOTO ( 11030,11030,11030,11030,11005),KEYORD
11002 CONTINUE
      CALL TXXOPT(5,LETSET,DUMMY,IERR)
      GOTO 10022
11040 CONTINUE
      ITEMP=0
      ITEMP1=0
      DO 11051 I=1,NSTRNG
      IF(STRNG(I:I).eq.'(') ITEMP=ITEMP+1
      IF(STRNG(I:I).eq.')') ITEMP1=ITEMP1+1
      IF(ITEMP1.gt.ITEMP) ITEMP=-100
11051 CONTINUE
11052 CONTINUE
      IF (NSTRNG.eq.0) THEN
      INPFMT='(256A)'
      ELSEIF (ITEMP.le.0 .or. ITEMP.ne.ITEMP1) THEN
      CALL T2ERR(INFOIN,CARDIN,('*** ERROR *** Format has unmatched or m
     *issing parentheses'),4)
      ELSEIF (NSTRNG.LE.LEN(INPFMT)) THEN
      INPFMT=STRNG(1:NSTRNG)
      ELSE
      WRITE(OUTSTR,11060)LEN(INPFMT)
      CALL T2ERR(0,' ',OUTSTR,-3)
11060 FORMAT ('*** ERROR *** Format string longer than',I5,' characters'
     *)
      ENDIF
      GOTO 10022
11070 CONTINUE
      CALL T2_SET_GRID(INFOIN,CARDIN)
      GOTO 10022
11080 CONTINUE
      CALL T2_SET_HIST(INFOIN,CARDIN)
      GOTO 10022
11090 CONTINUE
      GOTO 11101
11130 CONTINUE
      N1=1
      LINWDF=LINWID
      GOTO 11101
11110 GOTO ( 11130,11105),KEYORD
11140 CONTINUE
      N1=1
      IF(INTEG.lt.1.or.INTEG.gt.9) THEN
      CALL T2ERR(INFOIN,CARDIN,('*** ERROR *** Intensity/width out of ra
     *nge: (1-9)'),4)
      ELSE
      LINWID=INTEG
      ENDIF
      GOTO 11101
11101 CALL TOKEN(INFOIN,CARDIN,'PERMANENT,;')
      GOTO (11102,11110,11140,11140,11105,11105,11105,11110,11105),INTER
     *P
11105 CALL T2ERR(INFOIN,CARDIN,' ',5)
      GOTO 11101
11102 CONTINUE
      IF(n1.eq.0.and..not.FLAGS(23)) LINWID=2
      GOTO 10022
11150 CONTINUE
      CALL T2_SET_LABELS(INFOIN,CARDIN)
      GOTO 10022
11160 CONTINUE
      CALL T2_SET_LIMITS(INFOIN,CARDIN)
      GOTO 10022
11170 CONTINUE
      CALL T2_SET_MODE(INFOIN,CARDIN)
      GOTO 10022
11180 CONTINUE
      CALL T2_SET_MONITOR(INFOIN,CARDIN)
      GOTO 10022
11190 CONTINUE
      CALL T2_SET_NAME(INFOIN,CARDIN)
      GOTO 10022
11200 CONTINUE
      CALL T2_SET_ORDER(INFOIN,CARDIN)
      GOTO 10022
11210 CONTINUE
      IPTR=0
      FLAGS(2)=.FALSE.
      ITXTUR=0
      IPATRN=5
      OUTTEX=MOD(OUTTEX,4096)+4096*IPATRN
      GOTO 11221
11250 CONTINUE
      FLAGS(2)=INTEG.eq.1
      GOTO 11221
11260 CONTINUE
      LLLL=INTEG.EQ.0
      IF (IPTR.le.0) THEN
      DO 11271 I=40,43
      FLAGS(I)=LLLL
11271 CONTINUE
11272 CONTINUE
      ELSEIF(IPTR.eq.2) THEN
      FLAGS(40)=LLLL
      FLAGS(42)=LLLL
      ELSEIF(IPTR.eq.1) THEN
      FLAGS(41)=LLLL
      FLAGS(43)=LLLL
      ELSE
      FLAGS(IPTR)=LLLL
      IPTR=0
      ENDIF
      GOTO 11221
11280 CONTINUE
      IPTR=INTEG
      GOTO 11221
11290 CONTINUE
      DO 11301 I=40,43
      DFLAGS(I)=FLAGS(I)
11301 CONTINUE
11302 CONTINUE
      DOUTTEX=OUTTEX
      DFLAGS(2)=FLAGS(2)
      GOTO 11221
11310 CONTINUE
      OUTTEX=IAND(NOT(512*7),OUTTEX)+INTEG*512
      GOTO 11221
11320 CONTINUE
      CALL T2GTEX(ITXTUR)
      OUTTEX=IAND(NOT(64*7),OUTTEX)+ITXTUR*64
      GOTO 11221
11330 CONTINUE
      OUTTEX=IAND(NOT(8*7),OUTTEX)+INTEG*8
      GOTO 11221
11221 CALL TOKEN(INFOIN,CARDIN,'INHIBIT:1,ENABLE:0,OFF:1,ON,ALL:0,X:1,Y:
     *2,LEFT:40,BOTTOM:41,RIGHT:42,TOP:43,PERMANENT,NOCOLOR:0,WHITE:1,RE
     *D:2,GREEN:3,BLUE:4,YELLOW:5,MAGENTA:6,CYAN:7,NOTEXTURE:0,DO:1,DOT:
     *1,DOTS:1,DOTTED:1,DA:2,DASHES:2,DASHED:2,DOTDASHED:3,DOT-DASH:3,SO
     *LID:4,FUNNY:5,DAASHES:7,SPACE:8,PATTERNED:6,INTENSITY:0:9:0,WIDTH:
     *0:9:0,BLACK:8,;')
      GOTO (11222,11227,11225,11225,11225,11225,11221,11227, 11225),INTE
     *RP
11225 CALL T2ERR(INFOIN,CARDIN,' ',5)
      GOTO 11221
11227 GOTO ( 11250,11250,11260,11260,11280,11280,11280,11280,11280,11280
     *,11280,11290,11310,11310,11310,11310,11310,11310,11310,11310,11320
     *,11320,11320,11320,11320,11320,11320,11320,11320,11320,11320,11320
     *,11320,11320,11320,11330,11330,11310,11225),KEYORD
11222 CONTINUE
      IF (IPTR.NE.0) FLAGS(IPTR)=.TRUE.
      GOTO 10022
11340 CONTINUE
      FLAGS(53)=LTOKEN
      GOTO 10022
11350 CONTINUE
      NPATRN(1)=0
      LTEST=.false.
      ITEMP=1
      GOTO 11361
11390 CONTINUE
      ITEMP=-1
      GOTO 11361
11400 CONTINUE
      DPATSZ=PATSZ
      LTEST=.TRUE.
      GOTO 11361
11410 CONTINUE
      IMAX=MOD(NPATRN(1),2)+2
      DO 11421 I=1,IMAX
      IF (NPATRN(1).ge.20) THEN
      CALL T2ERR(INFOIN,CARDIN,('*** ERROR *** Maximum pattern size exce
     *eded'),4)
      RETURN
      ENDIF
      NPATRN(1)=NPATRN(1)+1
      PATRN(1,NPATRN(1))=PATSZ*INTEG*ITEMP
      IF(MOD(NPATRN(1),2).eq.0) PATRN(NPATRN(1),1)=PATSZ*ITEMP
11421 CONTINUE
11422 CONTINUE
      ITEMP=1
      GOTO 11361
11430 CONTINUE
      PATSZ=FLOTNG
      IF (FLOTNG .LT. 0) FLOTNG=0.1 
      GOTO 11361
11440 CONTINUE
      IF (NPATRN(1).gt.0) THEN
      IF(MOD(NPATRN(1),2).ne.0) THEN
      NPATRN(1)=NPATRN(1)+1
      PATRN(NPATRN(1),1)=0
      ENDIF
      PATRN(NPATRN(1),1)=.5*PATSZ*ITEMP+PATRN(NPATRN(1),1)
      ENDIF
      GOTO 11361
11370 GOTO ( 11390,11390,11400,11410,11410,11410,11410,11430,11440,11365
     *),KEYORD
11450 CONTINUE
      NPATRN(1)=NPATRN(1)+1
      PATRN(NPATRN(1),1)=ITEMP*FLOTNG
      ITEMP=1
      IF(NPATRN(1).ge.20)GOTO 11362
      GOTO 11361
11365 CONTINUE
      GOTO 11362
11361 CALL TOKEN(INFOIN,CARDIN,'RANDOM,FUNNY,PERMANENT,DOT,DA:1,DASH:1,D
     *AASH:3,SIZE:.01::-.1,SPACE,;')
      GOTO (11362,11370,11450,11450,11365,11365,11365,11370,11365),INTER
     *P
11362 CONTINUE
      IF(LTEST) THEN
      DO 11461 I=1,NPATRN(1)
      DPATRN(I,1)=PATRN(I,1)
      DNPATRN(1)=NPATRN(1)
11461 CONTINUE
11462 CONTINUE
      ENDIF
      GOTO 10022
11470 CONTINUE
      LINCOL=INTEG
      GOTO 10022
11480 CONTINUE
      FLAGS(27)=.TRUE.
      ITYPE=INTEG
      IF (ITYPE .ne. 0) FLAGS(91)=FLAGS(27)
      GOTO 11491
11520 CONTINUE
      FLAGS(27)=INTEG.eq.0
      IF(ITYPE .ne. 0) FLAGS(91)=FLAGS(27)
      GOTO 11491
11530 CONTINUE
      DFLAGS(27)=FLAGS(27)
      DFLAGS(91)=FLAGS(91)
      DRADANG=RADANG
      GOTO 11491
11540 CONTINUE
      RADANG=TWOPI/FLOTNG
      FLAGS(88)=.TRUE.
      GOTO 11491
11550 CONTINUE
      RADANG=ANGFAC(INTEG)
      FLAGS(88)=.TRUE.
      GOTO 11491
11491 CALL TOKEN(INFOIN,CARDIN,'ON,OFF:1,PERMANENT,FULLCIRCLE:0::360,RAD
     *IANS:1,DEGREES:2,GRAD:3,PERCENT:4,;')
      GOTO (11492,11497,11495,11495,11495,11495,11491,11497, 11495),INTE
     *RP
11495 CALL T2ERR(INFOIN,CARDIN,' ',5)
      GOTO 11491
11497 GOTO ( 11520,11520,11530,11540,11550,11550,11550,11550,11495),KEYO
     *RD
11492 CONTINUE
      GOTO 10022
11560 CONTINUE
      ITEMP=0
      NTSTR=0
      TSTR=' '
      GOTO 11571
11600 CONTINUE
      IF (ITEMP.EQ.0.AND.NTSTR.GT.0) ITEMP=1
      IF (NTSTR.EQ.0) NTSTR=1
      IF(ITEMP.eq.1) THEN
      PRMP1=TSTR
      NPRMP1=NTSTR
      ELSEIF(ITEMP.eq.2) THEN
      PRMP2=TSTR
      NPRMP2=NTSTR
      ENDIF
      NTSTR=0
      TSTR=' '
      ITEMP=INTEG
      GOTO 11571
11610 CONTINUE
      TSTR(NTSTR+1:LEN(TSTR))=CHAR(27)//'[2J'
      NTSTR=MIN(NTSTR+4,80)
      GOTO 11571
11620 CONTINUE
      TSTR(NTSTR+1:LEN(TSTR))=CHAR(27)//'[H'//CHAR(27)//'[K'
      NTSTR=MIN(NTSTR+6,80)
      GOTO 11571
11630 CONTINUE
      TSTR(NTSTR+1:LEN(TSTR))=  CHAR(27)//'[50H'//CHAR(27)//'[K'
      NTSTR=MIN(NTSTR+8,80)
      GOTO 11571
11640 CONTINUE
      NTSTR=MIN(NTSTR+1,80)
      TSTR(NTSTR:NTSTR)=CHAR(7)
      GOTO 11571
11580 GOTO ( 11600,11600,11600,11610,11620,11630,11640,11575),KEYORD
11650 CONTINUE
      NTSTR=MIN(NTSTR+1,80)
      TSTR(NTSTR:NTSTR)=CHAR(INTEG)
      GOTO 11571
11575 CONTINUE
      IF(NSTRNG.le.0) THEN
      NSTRNG=1
      STRNG=' '
      ENDIF
      TSTR(NTSTR+1:LEN(TSTR))=STRNG(1:NSTRNG)
      NTSTR=MIN(NTSTR+NSTRNG,80)
      GOTO 11571
11571 CALL TOKEN(INFOIN,CARDIN,'MAIN:1,WAIT:2,PAUSE:2,ERASE,TOP,BOTTOM,B
     *ELL,;')
      GOTO (11572,11580,11650,11650,11575,11575,11575,11580,11575),INTER
     *P
11572 CONTINUE
      IF (ITEMP.EQ.0.AND.NTSTR.GT.0) ITEMP=1
      IF (NTSTR.EQ.0) NTSTR=1
      IF(ITEMP.eq.1) THEN
      PRMP1=TSTR
      NPRMP1=NTSTR
      ELSEIF(ITEMP.eq.2) THEN
      PRMP2=TSTR
      NPRMP2=NTSTR
      ENDIF
      GOTO 10022
11660 CONTINUE
      CALL T2_SET_PRI_SEC(INFOIN,CARDIN)
      GOTO 10022
11670 CONTINUE
      IF (REVLEV.ge.2 .and. FLOTNG.lt.2) THEN
      TTHETA=90-TTHETA
      DTTHETA=90-DTTHETA
      ENDIF
      REVLEV=FLOTNG
      GOTO 10022
11680 CONTINUE
      CALL T2_SET_SEGMENTS(INFOIN,CARDIN)
      GOTO 10022
11690 CONTINUE
      CALL T2_SET_SCALES(INFOIN,CARDIN)
      GOTO 10022
11700 CONTINUE
      CALL T2_SET_SHADOW(INFOIN,CARDIN)
      GOTO 10022
11710 CONTINUE
      CALL T2_SET_SHIELD(INFOIN,CARDIN)
      GOTO 10022
11720 CONTINUE
      CALL T2_SET_SIZE(INFOIN,CARDIN)
      GOTO 10022
11730 CONTINUE
      CALL T2_SET_STORAGE(INFOIN,CARDIN)
      GOTO 10022
11740 CONTINUE
      CALL T2_SET_STATISTICS(INFOIN,CARDIN)
      GOTO 10022
11750 CONTINUE
      N2=0
      TEMP=HNONE
      TEMP1=HNONE
      TEMP2=HNONE
      GOTO 11761
11790 CONTINUE
      N2=1
      IF (FLOTNG .lt. 0) THEN
      SYMSIZ=FLOTNG 
      FLAGS(72)=.FALSE.
      ELSE
      SYMSIZ=FLOTNG/REDUCE(3)
      FLAGS(72)=.true.
      ENDIF
      GOTO 11761
11800 CONTINUE
      DSYMBOL=SYMBOL
      SMSZDF=SYMSIZ
      N2=1
      N1=0
      DFLAGS(72)=FLAGS(72)
      DO 11811 I=1,3
      DSYDIR(I)=SYDIR(I)
11811 CONTINUE
11812 CONTINUE
      GOTO 11761
11820 CONTINUE
      SYDIR(1)=FLOTNG
      N2=1
      GOTO 11761
11830 CONTINUE
      SYDIR(2)=FLOTNG
      N2=1
      GOTO 11761
11840 CONTINUE
      SYDIR(3)=FLOTNG
      N2=1
      GOTO 11761
11770 GOTO ( 11790,11800,11820,11830,11840,11765),KEYORD
11765 CONTINUE
      IF(NSTRNG.gt.0) THEN
      SYMBOL=TXSYM(STRNG(1:NSTRNG))
      ELSE
      SYMBOL=NOSYMB
      ENDIF
      IF (N1.NE.0) THEN
      CALL T2ERR(INFOIN,CARDIN,('*** WARNING *** Symbol set twice. Last 
     *used.'),4)
      FLAGS(23)=.TRUE.
      ENDIF
      N1=N1+1
      N2=1
      GOTO 11761
11761 CALL TOKEN(INFOIN,CARDIN,'SIZE:::-2,PERMANENT,THETA:-360:360:0,PHI
     *:-180:180:-1,ANGLE:-360:360:0,;')
      GOTO (11762,11770,11765,11765,11765,11765,11765,11770,11765),INTER
     *P
11762 CONTINUE
      IF (N2.EQ.0) THEN
      SYDIR(1)=0
      SYDIR(2)=-1
      SYDIR(3)=0
      SYMBOL=NOSYMB
      SYMSIZ=0
      FLAGS(72)=.false.
      ENDIF
      IF (SYMSIZ.EQ.0.) SYMSIZ=2.0 
      GOTO 10022
11850 CONTINUE
      ITXTUR=0
      GOTO 11861
11890 CONTINUE
      N1=1
      CALL t2GTEX(ITXTUR)
      LINTEX=ITXTUR
      GOTO 11861
11900 CONTINUE
      N1=1
      LINTXF=LINTEX
      GOTO 11861
11861 CALL TOKEN(INFOIN,CARDIN,'DO:1,DOT:1,DOTS:1,DOTTED:1,DO:1,DOT:1,DO
     *TS:1,DOTTED:1,DA:2,DASHES:2,DASHED:2,DOT-DASH:3,DOTDASHED:3,SOLID:
     *4,FUNNY:5,PATTERNED:6,DAASHES:7,SPACE:8,,PERMANENT,;')
      GOTO (11862,11867,11865,11865,11865,11865,11861,11867, 11865),INTE
     *RP
11865 CALL T2ERR(INFOIN,CARDIN,' ',5)
      GOTO 11861
11867 GOTO ( 11890,11890,11890,11890,11890,11890,11890,11890,11890,11890
     *,11890,11890,11890,11890,11890,11890,11890,11890,11890,11900,11865
     *),KEYORD
11862 CONTINUE
      IF (n1.eq.0.and..not.FLAGS(23)) LINTEX=4
      GOTO 10022
11910 CONTINUE
      CALL T2_SET_THREE(INFOIN,CARDIN)
      GOTO 10022
11920 CONTINUE
      CALL T2_SET_TICKS(INFOIN,CARDIN)
      GOTO 10022
11930 CONTINUE
      CALL T2_SET_TITLES(INFOIN,CARDIN)
      GOTO 10022
11940 CONTINUE
      CALL T2_SET_UNITS(INFOIN,CARDIN)
      GOTO 10022
C0021 CALL TOKEN(INFOIN,CARDIN,'AREA,WINDOWS,ARROW,AX,AXIS,AXES,BAR,BOX:
C    *1,DI:2,DIAMOND:2,CIRCLE:3,ELLIPSE:3,BLINK:Y,CARD,INPUT,CHARACTERS,
C    *CLEAR,ERASE,COLOR,CTRL_Z:Y,COMMAND,CYCLE,DATE,DEVICE,DIGITS:0:8:0,
C    *ERRORS,EXACT,FI,FIL,FILES,,FILL,FIT:1,FLUSH:Y,FONT,FORMAT:S,GRID,H
C    *ISTOGRAM,INTENSITY,WIDTH,LABELS,LIMITS,MODE,MONITOR,NAME,ORDER,OUT
C    *LINE,FRAME,PAUSE:Y,WAIT:Y,PATTERN,PEN:1:7:1,PE:1:7:1,PEN1:1,PEN2:2
C    *,PEN3:3,POLAR,SPHERICAL:1,PROMPT,PRIMARY:1,SECONDARY:2,REVISION:::
C    *2.0,SEGMENTS,SCALES,SHADOW,SHIELDS:1:4:0,SIZE,ST,STORAGE,STATISTIC
C    *S,SYMBOL,TEXTURE,STRUCTURE,THREE,TICKS,TITLES,UNITS,;')
10021 TKSTR(:264)=             'AREA,WINDOWS,ARROW,AX,AXIS,AXES,BAR,BOX:
     *1,DI:2,DIAMOND:2,CIRCLE:3,ELLIPSE:3,BLINK:Y,CARD,INPUT,CHARACTERS,
     *CLEAR,ERASE,COLOR,CTRL_Z:Y,COMMAND,CYCLE,DATE,DEVICE,DIGITS:0:8:0,
     *ERRORS,EXACT,FI,FIL,FILES,,FILL,FIT:1,FLUSH:Y,FONT,FORMAT:S,GRID,H
     *ISTOGRAM,INTENSITY,WIDTH,L'
      TKSTR(265:)=             'ABELS,LIMITS,MODE,MONITOR,NAME,ORDER,OUT
     *LINE,FRAME,PAUSE:Y,WAIT:Y,PATTERN,PEN:1:7:1,PE:1:7:1,PEN1:1,PEN2:2
     *,PEN3:3,POLAR,SPHERICAL:1,PROMPT,PRIMARY:1,SECONDARY:2,REVISION:::
     *2.0,SEGMENTS,SCALES,SHADOW,SHIELDS:1:4:0,SIZE,ST,STORAGE,STATISTIC
     *S,SYMBOL,TEXTURE,STRUCTURE,THREE,TICKS,TITLES,UNITS,;'
      CALL TOKEN(INFOIN,CARDIN,TKSTR)
      GOTO (10025,10027,10025,10025,10025,10025,10022,10027, 10025),INTE
     *RP
10025 CALL T2ERR(INFOIN,CARDIN,' ',5)
      GOTO 10022
10027 GOTO ( 10050,10050,10060,10130,10130,10130,10140,10280,10280,10280
     *,10280,10280,10370,10380,10380,10440,10450,10450,10500,10560,10570
     *,10620,10780,10790,10800,10810,10890,10950,10950,10950,10950,10960
     *,10970,10980,10990,11040,11070,11080,11090,11090,11150,11160,11170
     *,11180,11190,11200,11210,11210,11340,11340,11350,11470,11470,11470
     *,11470,11470,11480,11480,11560,11660,11660,11670,11680,11690,11700
     *,11710,11720,11730,11730,11740,11750,11850,11850,11910,11920,11930
     *,11940,10025),KEYORD
10022 CONTINUE
C     IF (FLAGS(16).and.LOGSTR(1:2).ne.'HI') CALL TDSHOW(LOGSTR)
      IF (FLAGS(16).and.LOGSTR(1:2).ne.'HI') DMMY=TDSHOW(LOGSTR) !for unix-fort
      END
      SUBROUTINE T2_SET_NAME(INFOIN,CARDIN)
      IMPLICIT NONE
      INTEGER INFOIN(10)
      CHARACTER*(*) CARDIN
      COMMON /T2FLGC/ FLAGS(200), LTRAP,LHANDL,LSYERR,LSCREV
      LOGICAL FLAGS, LTRAP,LHANDL,LSYERR,LSCREV(3)
      INTEGER RELFLAG 
      PARAMETER (RELFLAG=151)
      INTEGER IWINLEV 
      INTEGER NWINLEV , MAX_FILL 
      PARAMETER (NWINLEV =4)
      PARAMETER (MAX_FILL=4)
      REAL GRDSYM, GRDSIZ, DATDAT(2,8), H2STAT(12), TITLIN(4), TITFA
     *C(4), TITLOC(4), TITMAR(4), TITLMX(4), TIKFAC, TITINX, TITX1, TIT
     *Y1, TITX, TITY, TITZ, TITSIZ, TITCON(5), REVLEV, REDUCE(5), XFR
     *M12(12), XFRM13(12), XFRM14(12), XFRM23(12), XFRM24(12), XFRM34(6
     *), XVARSX(20), CIRSIZ(2,3), ASIZE, AFLARE, SMSZDF, ORAXES(3), EY
     *EDIR(3), VUEDIR(3), VUECEN(3), VERTCL(3), EYESEP, SCRD, SCRZ, EYE
     *DIS, EYEPNT(3), XYPART(2, 2), BARSIZ(3), BARBRK(3), TIKSIZ(3), XY
     *ZBAS(3), TTHETA, TPHI, FRELBL(4), PATRN(20,30), SCLPRM(10,3), WI
     *NDOW(4), SCREEN(2), SYMBOL, NOSYMB, FACTXY(19), LBLSIZ, SYMSIZ, X
     *YZLIM(3,2), WORLD(3), RADRMX, RADRMN, RADAMN, RADANG, RADX0, RADY
     *0, XUNUSD(6), AXANG(3), REDFAC, DSCAL, PATSZ, MARGIN(4), PSCR(2
     *), OREAL, OCPU, CSCRD, DATPTS, ERRPTS, DATXMN, DATXMX, DATYMN, DA
     *TYMX, DATZMN, DATZMX, DATSUM, ERRSUM, DATAVE, ERRAVE, DATCEN, ERR
     *CEN, DATSTD, ERRSTD, WINREL(2,2,NWINLEV),WINABS(2,2,NWINLEV),WINL
     *IM(2,2), FMARKER(3,8), SYDIR(3), GRDIR(3), EXYZLIM(3,2), DSLOPE(2
     *,2)
      REAL PLOT_EXTENT(2,2),FILL_ANGLE(MAX_FILL),FILL_WIDTH(MAX_FILL)
      INTEGER FILL_INDEX, FILL_TEX(MAX_FILL), N_LINES(6)
      EQUIVALENCE (DATDAT, DATPTS)
      INTEGER MAXREP
      PARAMETER (MAXREP=5)
      INTEGER IPATRN, NPATRN(30), NXYLIM(3,2), NPLOTS, NCSETS, NCCOL, N
     *CROW, IYEAR, IMONTH, IDAY, ISIGFG, ITXPRI, ITXSEC, ITITDT(3), L
     *ENCRD, IPROP, IHTEX, IBLINK, IERASE, ITCNTR, IUNUSD, NXYZ1(3), 
     *NXYZ2(3), LBLFMT(3), LBLCHR(3), NDIMNS(3), IBLKTP, IDIMNS, NMES
     *H0, NMESH1, NMESH2, MESH1, MESH2, MESH3, MESH2D, MESHN(3), NMESHN(
     *2), NFIELD, IFIELD(19), NINCR, NPOINT, IVARBL(19), IVPTR(19), I_
     *VORDER(19,2), LINEAR(4), NONLIN(4), MXECHO, LINES, MAXLNS, USRK
     *BD, USRSCR, PLTFIL, LINWID, LINCOL, LINTEX, ICPOIN(3), IREPCT(MA
     *XREP), LEVREP, GRDTYP, GRDTEX, OUTTEX, IAXTEX, TITEX, LETSET, LAB
     *TEX, TICTEX, SHADOWTYP,SHADOWTEX, NXYZDEF1(10), NXYZDEF2(10), IF
     *ILE_CASE ,MAX_SUBST
      INTEGER MAX_CYCLE
      PARAMETER (MAX_CYCLE=20)
      INTEGER N_CYCLE, ITX_CYCLE(MAX_CYCLE)
      REAL SYM_CYCLE(MAX_CYCLE)
      EQUIVALENCE (NMESH1,NMESHN)
      EQUIVALENCE (MESH1,MESHN)
      INTEGER IBUFFR(400)
      REAL BUFFER(400)
      INTEGER NCHSAVE 
      PARAMETER (NCHSAVE=2*512) 
      INTEGER*4 ICHSAVE(NCHSAVE)
      INTEGER*4 IVRPTR(15)
      CHARACTER*512 OUTSTR,C_FILE, C_NAME, C_SELECT
      CHARACTER C_TIT_ESCAPE*1,C_TIT_SUBSTITUTE*2
      INTEGER N_FILE, N_NAME, N_SELECT
      CHARACTER*8 PXNAME
      CHARACTER*64 INPFMT
      LOGICAL LTDATA, OUTSID(4)
      COMMON /T2COM/ PXNAME, REDUCE, TITX, TITY ,XFRM12, XFRM13, XFRM1
     *4, XFRM23 ,XFRM24, XFRM34 ,XVARSX ,TITSIZ, GRDSYM, GRDSIZ, CIRS
     *IZ, ASIZE, AFLARE ,SMSZDF, ORAXES, EYEDIR, VUEDIR, VUECEN ,VERTC
     *L, EYESEP, SCRD, SCRZ, EYEDIS, EYEPNT ,XYPART, BARSIZ, TIKSIZ, XY
     *ZBAS, TTHETA ,TPHI, FRELBL, IPATRN, NPATRN, PATRN ,SCLPRM, WINDO
     *W, SCREEN, SYMBOL, NOSYMB ,FACTXY, LBLSIZ, SYMSIZ, XYZLIM, WORLD 
     *,RADRMX, RADRMN, RADAMN, RADANG, RADX0, RADY0, XUNUSD ,USRKBD, U
     *SRSCR, PLTFIL ,ITITDT, LENCRD ,INPFMT, GRDTYP, LINWID, LINCOL, L
     *INTEX, TITCON, ITCNTR ,IUNUSD, NXYZ1, NXYZ2 ,LBLCHR, NDIMNS, IBL
     *KTP, IDIMNS ,NMESH1, NMESH2, MESH1, MESH2, MESH3, NFIELD ,IFIELD
     *, NINCR ,IVARBL, IVRPTR ,LINEAR, NONLIN ,NPOINT, LETSET ,MXECH
     *O, LINES, MAXLNS ,AXANG, MESH2D, REDFAC, GRDTEX, OUTTEX, IAXTEX, 
     *TITEX, DSCAL ,OUTSTR, IPROP, IHTEX, IBLINK, IERASE, LABTEX, TICTE
     *X, NXYLIM, PATSZ ,MARGIN, PSCR, ITXPRI, ITXSEC, OREAL, OCPU, CSCR
     *D, OUTSID ,TITLIN, TITINX, TITZ, TITX1, TITY1, LTDATA, NPLOTS, RE
     *VLEV ,LBLFMT, IYEAR, IMONTH, IDAY, ISIGFG ,DATPTS, ERRPTS, DATXM
     *N, DATXMX, DATYMN, DATYMX, DATZMN, DATZMX ,DATSUM, ERRSUM, DATAVE
     *, ERRAVE, DATCEN, ERRCEN, DATSTD, ERRSTD ,NCSETS, NCCOL, NCROW, F
     *MARKER, H2STAT, TITFAC, TITLOC, TITMAR ,TIKFAC, IWINLEV, WINREL, 
     *WINABS, WINLIM ,ICPOIN, LEVREP, IREPCT, SYDIR, GRDIR, NMESH0, EXY
     *ZLIM, IVPTR ,TITLMX, NXYZDEF1, NXYZDEF2, IFILE_CASE, N_CYCLE, ITX
     *_CYCLE ,SYM_CYCLE, PLOT_EXTENT, FILL_ANGLE, FILL_WIDTH, FILL_TEX 
     *,FILL_INDEX ,N_LINES ,DSLOPE ,MAX_SUBST, BARBRK ,I_VORDER,SHADOW
     *TYP,SHADOWTEX
      COMMON /T2SCRT/ BUFFER, IBUFFR, N_FILE,N_NAME,N_SELECT, ICHSAVE
      COMMON /T2_CHAR/ C_TIT_ESCAPE,C_TIT_SUBSTITUTE
      COMMON /T2_SCRT/ C_FILE, C_NAME, C_SELECT
      INTEGER JOUFIL, ERRFIL, OUTFIL, DBGFIL, INPFIL, NINMAX
      PARAMETER (NINMAX=20)
      INTEGER NINP(NINMAX)
      COMMON /T2TRBK/NINP, JOUFIL, ERRFIL, OUTFIL, DBGFIL, INPFIL
      CHARACTER*512 STRNG, STJOU
      LOGICAL LTOKEN
      REAL FLOTNG
      INTEGER INTERP, KEYORD, NSTRNG, MAXSTR, NSTJOU, LSTJOU, NTOKEN
      INTEGER*4 INTEG
      COMMON /TOKENC/ INTERP, INTEG, FLOTNG, KEYORD, NSTRNG, MAXSTR, ST
     *RNG, NSTJOU, LSTJOU, STJOU, LTOKEN, NTOKEN
      INTEGER NSETD 
      PARAMETER (NSETD=19+9)
      INTEGER ISETD(NSETD),NINCR0,NINCR1,NINCR2,IBTYPE
      INTEGER I1,I2,I3,I4,I5,I6,I7,IM,NP,NL,IENDAT,IBGDAT
      INTEGER I_NDX,I_NDY,I_NDZ
      INTEGER N_SYMBOL 
      INTEGER N_XDATA 
      INTEGER N_DXDATA 
      INTEGER N_NDXDATA 
      INTEGER N_YDATA 
      INTEGER N_DYDATA 
      INTEGER N_NDYDATA 
      INTEGER N_ZDATA 
      INTEGER N_DZDATA 
      INTEGER N_NDZDATA 
      INTEGER N_UDATA 
      INTEGER N_DUDATA 
      INTEGER N_NDUDATA 
      INTEGER N_VDATA 
      INTEGER N_DVDATA 
      INTEGER N_NDVDATA 
      INTEGER N_WDATA 
      INTEGER N_DWDATA 
      INTEGER N_NDWDATA 
      INTEGER NCMAX 
      INTEGER NCSIZE 
      INTEGER NBTYPE 
      INTEGER NINDAT 
      INTEGER NSDATA 
      INTEGER NXDATA 
      INTEGER NDXDATA 
      INTEGER NNDXDATA 
      INTEGER NYDATA 
      INTEGER NDYDATA 
      INTEGER NNDYDATA 
      INTEGER NZDATA 
      INTEGER NDZDATA 
      INTEGER NNDZDATA 
      INTEGER NPDATA 
      INTEGER NLDATA 
      INTEGER NMDATA 
      INTEGER NBGDAT 
      INTEGER NENDAT 
      PARAMETER (N_SYMBOL=1) 
      PARAMETER (N_XDATA=2) 
      PARAMETER (N_DXDATA=3) 
      PARAMETER (N_NDXDATA=4) 
      PARAMETER (N_YDATA=5) 
      PARAMETER (N_DYDATA=6) 
      PARAMETER (N_NDYDATA=7) 
      PARAMETER (N_ZDATA=8) 
      PARAMETER (N_DZDATA=9) 
      PARAMETER (N_NDZDATA=10) 
      PARAMETER (N_UDATA=11) 
      PARAMETER (N_DUDATA=12) 
      PARAMETER (N_NDUDATA=13) 
      PARAMETER (N_VDATA=14) 
      PARAMETER (N_DVDATA=15) 
      PARAMETER (N_NDVDATA=16) 
      PARAMETER (N_WDATA=17) 
      PARAMETER (N_DWDATA=18) 
      PARAMETER (N_NDWDATA=19) 
      PARAMETER (NCMAX=6) 
      PARAMETER (NCSIZE=3) 
      PARAMETER (NBTYPE=1) 
      PARAMETER (NINDAT=2) 
      PARAMETER (NSDATA=5) 
      PARAMETER (NXDATA=NSDATA+1) 
      PARAMETER (NDXDATA=NXDATA+1) 
      PARAMETER (NNDXDATA=NXDATA+2) 
      PARAMETER (NYDATA=NXDATA+NCSIZE) 
      PARAMETER (NDYDATA=NYDATA+1) 
      PARAMETER (NNDYDATA=NYDATA+2) 
      PARAMETER (NZDATA=NYDATA+NCSIZE) 
      PARAMETER (NDZDATA=NZDATA+1) 
      PARAMETER (NNDZDATA=NZDATA+2) 
      PARAMETER (NPDATA=NSDATA+19) 
      PARAMETER (NLDATA=NPDATA+1) 
      PARAMETER (NMDATA=NLDATA+1) 
      PARAMETER (NBGDAT=NMDATA+1) 
      PARAMETER (NENDAT=NBGDAT+1) 
      EQUIVALENCE (IBTYPE,ISETD(NBTYPE))
      EQUIVALENCE (NINCR0,ISETD(NINDAT))
      EQUIVALENCE (NINCR1,ISETD(NINDAT+1))
      EQUIVALENCE (NINCR2,ISETD(NINDAT+2))
      EQUIVALENCE (I7,ISETD(NSDATA))
      EQUIVALENCE (I1,ISETD(NXDATA))
      EQUIVALENCE (I4,ISETD(NDXDATA))
      EQUIVALENCE (I2,ISETD(NYDATA))
      EQUIVALENCE (I5,ISETD(NDYDATA))
      EQUIVALENCE (I3,ISETD(NZDATA))
      EQUIVALENCE (I6,ISETD(NDZDATA))
      EQUIVALENCE (I_NDX,ISETD(NNDXDATA))
      EQUIVALENCE (I_NDY,ISETD(NNDYDATA))
      EQUIVALENCE (I_NDZ,ISETD(NNDZDATA))
      EQUIVALENCE (NP,ISETD(NPDATA))
      EQUIVALENCE (NL,ISETD(NLDATA))
      EQUIVALENCE (IM,ISETD(NMDATA))
      EQUIVALENCE (IBGDAT,ISETD(NBGDAT))
      EQUIVALENCE (IENDAT,ISETD(NENDAT))
      REAL HNONE
      INTEGER LISTPT,NPTMAX,NDSETS
      REAL DATBUF(10248)
      COMMON /T2XPNT/ LISTPT,NPTMAX,NDSETS,DATBUF
      LOGICAL LFIRST, T2_VIRT
      INTEGER ISET
      INTEGER I,J, ISIZE, IWDS, T2BTRIM, T2_CONFIRM_SET
      INTEGER NS1, NS2
      LOGICAL LLOG, LCONF
      DATA HNONE /-666.666/
      LCONF=FLAGS(104)
      LLOG=FLAGS(95)
      NS1=1
      NS2=NDSETS
      N_SELECT=1
      C_SELECT(1:1)='*'
      LFIRST=.true.
      N_NAME=-1
      GOTO 11951
11980 CONTINUE
      LCONF=LTOKEN
      GOTO 11951
11990 CONTINUE
      LLOG=LTOKEN
      GOTO 11951
12000 CONTINUE
      CALL T2NSET(INFOIN,CARDIN,NS1,NS2)
      GOTO 11951
12010 CONTINUE
      C_SELECT=STRNG
      N_SELECT=MAX(1,NSTRNG)
      GOTO 11951
11960 GOTO ( 11980,11990,12000,12010,11955),KEYORD
12020 CONTINUE
      N_NAME=MAX(1,NSTRNG)
      C_NAME=STRNG(:N_NAME)
      GOTO 11951
11951 CALL TOKEN(INFOIN,CARDIN,'CONFIRM:Y,LOG:Y,SETS,SELECT:S,;')
      GOTO (11952,11960,11955,11955,12020,11955,11955,11960,11955),INTER
     *P
11955 CALL T2ERR(INFOIN,CARDIN,' ',5)
      GOTO 11951
11952 CONTINUE
      IF (N_NAME .le. 0) THEN
      CALL T2ERR(INFOIN,CARDIN,'*** ERROR *** NO name specified',4)
      ENDIF
      IF (FLAGS(23)) RETURN
      DO 12031 ISET=NS1,NS2
      IF(LTRAP)GOTO 12032
      CALL T2GDSET(ISET,1,1,1,1,ISETD,HNONE,C_SELECT(:N_SELECT))
      IF(NP .lt. 1)GOTO 12031
      IF (LCONF) THEN
      GOTO (12040,12050,12060,12070) T2_CONFIRM_SET(ISET,'Rename')
12070 CONTINUE
      LCONF=.false.
12040 CONTINUE
      ENDIF
      OUTSTR=C_NAME(:N_NAME)
      IF (C_NAME(N_NAME:N_NAME) .eq. '%') CALL T2_GET_SET_NAME(IBGDAT,OU
     *TSTR(N_NAME:))
      ISIZE=MIN(400,T2BTRIM(OUTSTR))
      IWDS=((ISIZE+4+1)/4)-NINT(DATBUF(IVRPTR(15)+3))
      IF (IWDS .lt. 0) THEN
      DO 12081 J=IVRPTR(8),IVRPTR(12)-1
      DATBUF(J+IWDS)=DATBUF(J)
12081 CONTINUE
12082 CONTINUE
      ELSEIF (IWDS .gt. 0) THEN
      IF (.not. T2_VIRT(IWDS)) THEN
      CALL T2ERR(INFOIN,CARDIN,'*** ERROR *** Not enough storage',4)
      GOTO 12032
      ENDIF
      DO 12091 J=IVRPTR(12)-1,IVRPTR(8),-1
      DATBUF(J+IWDS)=DATBUF(J)
12091 CONTINUE
12092 CONTINUE
      ENDIF
      IVRPTR(12)=IVRPTR(12)+IWDS
      I=IVRPTR(15)+1
      DO 12101 J=1,3
      I=IVRPTR(15)+J
      DATBUF(I)=NINT(DATBUF(I))+IWDS
12101 CONTINUE
12102 CONTINUE
      READ(OUTSTR,12110)(DATBUF(J),J=I+1,I+NINT(DATBUF(I)))
12110 FORMAT(100A4)
      LFIRST=.false.
      IF (LLOG) THEN
      If ( .not. LCONF) THEN
      WRITE(6,*)'  Data set',ISET
      ENDIF
      WRITE(6,*)'  Renamed to "'//outstr(:ISIZE)//'"'
      ENDIF
12050 CONTINUE
12031 CONTINUE
12032 CONTINUE
12060 CONTINUE
      IF (LFIRST) WRITE(6,*) '  NO data set names changed'
      RETURN
      END
      INTEGER FUNCTION T2_CONFIRM_SET(ISET,string)
      IMPLICIT NONE
      character*(*) string
      COMMON /T2FLGC/ FLAGS(200), LTRAP,LHANDL,LSYERR,LSCREV
      LOGICAL FLAGS, LTRAP,LHANDL,LSYERR,LSCREV(3)
      INTEGER RELFLAG 
      PARAMETER (RELFLAG=151)
      INTEGER IWINLEV 
      INTEGER NWINLEV , MAX_FILL 
      PARAMETER (NWINLEV =4)
      PARAMETER (MAX_FILL=4)
      REAL GRDSYM, GRDSIZ, DATDAT(2,8), H2STAT(12), TITLIN(4), TITFA
     *C(4), TITLOC(4), TITMAR(4), TITLMX(4), TIKFAC, TITINX, TITX1, TIT
     *Y1, TITX, TITY, TITZ, TITSIZ, TITCON(5), REVLEV, REDUCE(5), XFR
     *M12(12), XFRM13(12), XFRM14(12), XFRM23(12), XFRM24(12), XFRM34(6
     *), XVARSX(20), CIRSIZ(2,3), ASIZE, AFLARE, SMSZDF, ORAXES(3), EY
     *EDIR(3), VUEDIR(3), VUECEN(3), VERTCL(3), EYESEP, SCRD, SCRZ, EYE
     *DIS, EYEPNT(3), XYPART(2, 2), BARSIZ(3), BARBRK(3), TIKSIZ(3), XY
     *ZBAS(3), TTHETA, TPHI, FRELBL(4), PATRN(20,30), SCLPRM(10,3), WI
     *NDOW(4), SCREEN(2), SYMBOL, NOSYMB, FACTXY(19), LBLSIZ, SYMSIZ, X
     *YZLIM(3,2), WORLD(3), RADRMX, RADRMN, RADAMN, RADANG, RADX0, RADY
     *0, XUNUSD(6), AXANG(3), REDFAC, DSCAL, PATSZ, MARGIN(4), PSCR(2
     *), OREAL, OCPU, CSCRD, DATPTS, ERRPTS, DATXMN, DATXMX, DATYMN, DA
     *TYMX, DATZMN, DATZMX, DATSUM, ERRSUM, DATAVE, ERRAVE, DATCEN, ERR
     *CEN, DATSTD, ERRSTD, WINREL(2,2,NWINLEV),WINABS(2,2,NWINLEV),WINL
     *IM(2,2), FMARKER(3,8), SYDIR(3), GRDIR(3), EXYZLIM(3,2), DSLOPE(2
     *,2)
      REAL PLOT_EXTENT(2,2),FILL_ANGLE(MAX_FILL),FILL_WIDTH(MAX_FILL)
      INTEGER FILL_INDEX, FILL_TEX(MAX_FILL), N_LINES(6)
      EQUIVALENCE (DATDAT, DATPTS)
      INTEGER MAXREP
      PARAMETER (MAXREP=5)
      INTEGER IPATRN, NPATRN(30), NXYLIM(3,2), NPLOTS, NCSETS, NCCOL, N
     *CROW, IYEAR, IMONTH, IDAY, ISIGFG, ITXPRI, ITXSEC, ITITDT(3), L
     *ENCRD, IPROP, IHTEX, IBLINK, IERASE, ITCNTR, IUNUSD, NXYZ1(3), 
     *NXYZ2(3), LBLFMT(3), LBLCHR(3), NDIMNS(3), IBLKTP, IDIMNS, NMES
     *H0, NMESH1, NMESH2, MESH1, MESH2, MESH3, MESH2D, MESHN(3), NMESHN(
     *2), NFIELD, IFIELD(19), NINCR, NPOINT, IVARBL(19), IVPTR(19), I_
     *VORDER(19,2), LINEAR(4), NONLIN(4), MXECHO, LINES, MAXLNS, USRK
     *BD, USRSCR, PLTFIL, LINWID, LINCOL, LINTEX, ICPOIN(3), IREPCT(MA
     *XREP), LEVREP, GRDTYP, GRDTEX, OUTTEX, IAXTEX, TITEX, LETSET, LAB
     *TEX, TICTEX, SHADOWTYP,SHADOWTEX, NXYZDEF1(10), NXYZDEF2(10), IF
     *ILE_CASE ,MAX_SUBST
      INTEGER MAX_CYCLE
      PARAMETER (MAX_CYCLE=20)
      INTEGER N_CYCLE, ITX_CYCLE(MAX_CYCLE)
      REAL SYM_CYCLE(MAX_CYCLE)
      EQUIVALENCE (NMESH1,NMESHN)
      EQUIVALENCE (MESH1,MESHN)
      INTEGER IBUFFR(400)
      REAL BUFFER(400)
      INTEGER NCHSAVE 
      PARAMETER (NCHSAVE=2*512) 
      INTEGER*4 ICHSAVE(NCHSAVE)
      INTEGER*4 IVRPTR(15)
      CHARACTER*512 OUTSTR,C_FILE, C_NAME, C_SELECT
      CHARACTER C_TIT_ESCAPE*1,C_TIT_SUBSTITUTE*2
      INTEGER N_FILE, N_NAME, N_SELECT
      CHARACTER*8 PXNAME
      CHARACTER*64 INPFMT
      LOGICAL LTDATA, OUTSID(4)
      COMMON /T2COM/ PXNAME, REDUCE, TITX, TITY ,XFRM12, XFRM13, XFRM1
     *4, XFRM23 ,XFRM24, XFRM34 ,XVARSX ,TITSIZ, GRDSYM, GRDSIZ, CIRS
     *IZ, ASIZE, AFLARE ,SMSZDF, ORAXES, EYEDIR, VUEDIR, VUECEN ,VERTC
     *L, EYESEP, SCRD, SCRZ, EYEDIS, EYEPNT ,XYPART, BARSIZ, TIKSIZ, XY
     *ZBAS, TTHETA ,TPHI, FRELBL, IPATRN, NPATRN, PATRN ,SCLPRM, WINDO
     *W, SCREEN, SYMBOL, NOSYMB ,FACTXY, LBLSIZ, SYMSIZ, XYZLIM, WORLD 
     *,RADRMX, RADRMN, RADAMN, RADANG, RADX0, RADY0, XUNUSD ,USRKBD, U
     *SRSCR, PLTFIL ,ITITDT, LENCRD ,INPFMT, GRDTYP, LINWID, LINCOL, L
     *INTEX, TITCON, ITCNTR ,IUNUSD, NXYZ1, NXYZ2 ,LBLCHR, NDIMNS, IBL
     *KTP, IDIMNS ,NMESH1, NMESH2, MESH1, MESH2, MESH3, NFIELD ,IFIELD
     *, NINCR ,IVARBL, IVRPTR ,LINEAR, NONLIN ,NPOINT, LETSET ,MXECH
     *O, LINES, MAXLNS ,AXANG, MESH2D, REDFAC, GRDTEX, OUTTEX, IAXTEX, 
     *TITEX, DSCAL ,OUTSTR, IPROP, IHTEX, IBLINK, IERASE, LABTEX, TICTE
     *X, NXYLIM, PATSZ ,MARGIN, PSCR, ITXPRI, ITXSEC, OREAL, OCPU, CSCR
     *D, OUTSID ,TITLIN, TITINX, TITZ, TITX1, TITY1, LTDATA, NPLOTS, RE
     *VLEV ,LBLFMT, IYEAR, IMONTH, IDAY, ISIGFG ,DATPTS, ERRPTS, DATXM
     *N, DATXMX, DATYMN, DATYMX, DATZMN, DATZMX ,DATSUM, ERRSUM, DATAVE
     *, ERRAVE, DATCEN, ERRCEN, DATSTD, ERRSTD ,NCSETS, NCCOL, NCROW, F
     *MARKER, H2STAT, TITFAC, TITLOC, TITMAR ,TIKFAC, IWINLEV, WINREL, 
     *WINABS, WINLIM ,ICPOIN, LEVREP, IREPCT, SYDIR, GRDIR, NMESH0, EXY
     *ZLIM, IVPTR ,TITLMX, NXYZDEF1, NXYZDEF2, IFILE_CASE, N_CYCLE, ITX
     *_CYCLE ,SYM_CYCLE, PLOT_EXTENT, FILL_ANGLE, FILL_WIDTH, FILL_TEX 
     *,FILL_INDEX ,N_LINES ,DSLOPE ,MAX_SUBST, BARBRK ,I_VORDER,SHADOW
     *TYP,SHADOWTEX
      COMMON /T2SCRT/ BUFFER, IBUFFR, N_FILE,N_NAME,N_SELECT, ICHSAVE
      COMMON /T2_CHAR/ C_TIT_ESCAPE,C_TIT_SUBSTITUTE
      COMMON /T2_SCRT/ C_FILE, C_NAME, C_SELECT
      INTEGER JOUFIL, ERRFIL, OUTFIL, DBGFIL, INPFIL, NINMAX
      PARAMETER (NINMAX=20)
      INTEGER NINP(NINMAX)
      COMMON /T2TRBK/NINP, JOUFIL, ERRFIL, OUTFIL, DBGFIL, INPFIL
      CHARACTER*512 STRNG, STJOU
      LOGICAL LTOKEN
      REAL FLOTNG
      INTEGER INTERP, KEYORD, NSTRNG, MAXSTR, NSTJOU, LSTJOU, NTOKEN
      INTEGER*4 INTEG
      COMMON /TOKENC/ INTERP, INTEG, FLOTNG, KEYORD, NSTRNG, MAXSTR, ST
     *RNG, NSTJOU, LSTJOU, STJOU, LTOKEN, NTOKEN
      INTEGER NSETD 
      PARAMETER (NSETD=19+9)
      INTEGER ISETD(NSETD),NINCR0,NINCR1,NINCR2,IBTYPE
      INTEGER I1,I2,I3,I4,I5,I6,I7,IM,NP,NL,IENDAT,IBGDAT
      INTEGER I_NDX,I_NDY,I_NDZ
      INTEGER N_SYMBOL 
      INTEGER N_XDATA 
      INTEGER N_DXDATA 
      INTEGER N_NDXDATA 
      INTEGER N_YDATA 
      INTEGER N_DYDATA 
      INTEGER N_NDYDATA 
      INTEGER N_ZDATA 
      INTEGER N_DZDATA 
      INTEGER N_NDZDATA 
      INTEGER N_UDATA 
      INTEGER N_DUDATA 
      INTEGER N_NDUDATA 
      INTEGER N_VDATA 
      INTEGER N_DVDATA 
      INTEGER N_NDVDATA 
      INTEGER N_WDATA 
      INTEGER N_DWDATA 
      INTEGER N_NDWDATA 
      INTEGER NCMAX 
      INTEGER NCSIZE 
      INTEGER NBTYPE 
      INTEGER NINDAT 
      INTEGER NSDATA 
      INTEGER NXDATA 
      INTEGER NDXDATA 
      INTEGER NNDXDATA 
      INTEGER NYDATA 
      INTEGER NDYDATA 
      INTEGER NNDYDATA 
      INTEGER NZDATA 
      INTEGER NDZDATA 
      INTEGER NNDZDATA 
      INTEGER NPDATA 
      INTEGER NLDATA 
      INTEGER NMDATA 
      INTEGER NBGDAT 
      INTEGER NENDAT 
      PARAMETER (N_SYMBOL=1) 
      PARAMETER (N_XDATA=2) 
      PARAMETER (N_DXDATA=3) 
      PARAMETER (N_NDXDATA=4) 
      PARAMETER (N_YDATA=5) 
      PARAMETER (N_DYDATA=6) 
      PARAMETER (N_NDYDATA=7) 
      PARAMETER (N_ZDATA=8) 
      PARAMETER (N_DZDATA=9) 
      PARAMETER (N_NDZDATA=10) 
      PARAMETER (N_UDATA=11) 
      PARAMETER (N_DUDATA=12) 
      PARAMETER (N_NDUDATA=13) 
      PARAMETER (N_VDATA=14) 
      PARAMETER (N_DVDATA=15) 
      PARAMETER (N_NDVDATA=16) 
      PARAMETER (N_WDATA=17) 
      PARAMETER (N_DWDATA=18) 
      PARAMETER (N_NDWDATA=19) 
      PARAMETER (NCMAX=6) 
      PARAMETER (NCSIZE=3) 
      PARAMETER (NBTYPE=1) 
      PARAMETER (NINDAT=2) 
      PARAMETER (NSDATA=5) 
      PARAMETER (NXDATA=NSDATA+1) 
      PARAMETER (NDXDATA=NXDATA+1) 
      PARAMETER (NNDXDATA=NXDATA+2) 
      PARAMETER (NYDATA=NXDATA+NCSIZE) 
      PARAMETER (NDYDATA=NYDATA+1) 
      PARAMETER (NNDYDATA=NYDATA+2) 
      PARAMETER (NZDATA=NYDATA+NCSIZE) 
      PARAMETER (NDZDATA=NZDATA+1) 
      PARAMETER (NNDZDATA=NZDATA+2) 
      PARAMETER (NPDATA=NSDATA+19) 
      PARAMETER (NLDATA=NPDATA+1) 
      PARAMETER (NMDATA=NLDATA+1) 
      PARAMETER (NBGDAT=NMDATA+1) 
      PARAMETER (NENDAT=NBGDAT+1) 
      EQUIVALENCE (IBTYPE,ISETD(NBTYPE))
      EQUIVALENCE (NINCR0,ISETD(NINDAT))
      EQUIVALENCE (NINCR1,ISETD(NINDAT+1))
      EQUIVALENCE (NINCR2,ISETD(NINDAT+2))
      EQUIVALENCE (I7,ISETD(NSDATA))
      EQUIVALENCE (I1,ISETD(NXDATA))
      EQUIVALENCE (I4,ISETD(NDXDATA))
      EQUIVALENCE (I2,ISETD(NYDATA))
      EQUIVALENCE (I5,ISETD(NDYDATA))
      EQUIVALENCE (I3,ISETD(NZDATA))
      EQUIVALENCE (I6,ISETD(NDZDATA))
      EQUIVALENCE (I_NDX,ISETD(NNDXDATA))
      EQUIVALENCE (I_NDY,ISETD(NNDYDATA))
      EQUIVALENCE (I_NDZ,ISETD(NNDZDATA))
      EQUIVALENCE (NP,ISETD(NPDATA))
      EQUIVALENCE (NL,ISETD(NLDATA))
      EQUIVALENCE (IM,ISETD(NMDATA))
      EQUIVALENCE (IBGDAT,ISETD(NBGDAT))
      EQUIVALENCE (IENDAT,ISETD(NENDAT))
      REAL HNONE
      INTEGER LISTPT,NPTMAX,NDSETS
      REAL DATBUF(10248)
      COMMON /T2XPNT/ LISTPT,NPTMAX,NDSETS,DATBUF
      CHARACTER*4 CSIZE(2)
      CHARACTER*3 CXYZ(3)
      INTEGER I,J,ISET, T2BTRIM, T2_CONFIRM
      DATA HNONE /-666.666/
      DATA CSIZE/'Size',' by '/
      DATA CXYZ/' X',' Y',' Z'/
      CALL T2GDSET(ISET,1, 2 147 483 647,1, 2 147 483 647,ISETD,HNONE,'*
     *')
      CALL T2_GET_SET_NAME(IBGDAT,outstr)
      WRITE (6,*) '  Data set=',ISET
      WRITE (6,*) '    Name="'//outstr(:t2btrim(outstr))//'"'
      WRITE (6,*) '    ', (CSIZE(I),CXYZ(MESHN(I)),ISETD(NPDATA-1+I),I=1
     *,MIN(1,IBTYPE))
      T2_CONFIRM_SET=T2_CONFIRM(string)
      END
      SUBROUTINE T2_SET_ORDER(INFOIN,CARDIN)
      IMPLICIT NONE
      INTEGER INFOIN(10)
      CHARACTER*(*) CARDIN
      COMMON /T2FLGC/ FLAGS(200), LTRAP,LHANDL,LSYERR,LSCREV
      LOGICAL FLAGS, LTRAP,LHANDL,LSYERR,LSCREV(3)
      INTEGER RELFLAG 
      PARAMETER (RELFLAG=151)
      INTEGER IWINLEV 
      INTEGER NWINLEV , MAX_FILL 
      PARAMETER (NWINLEV =4)
      PARAMETER (MAX_FILL=4)
      REAL GRDSYM, GRDSIZ, DATDAT(2,8), H2STAT(12), TITLIN(4), TITFA
     *C(4), TITLOC(4), TITMAR(4), TITLMX(4), TIKFAC, TITINX, TITX1, TIT
     *Y1, TITX, TITY, TITZ, TITSIZ, TITCON(5), REVLEV, REDUCE(5), XFR
     *M12(12), XFRM13(12), XFRM14(12), XFRM23(12), XFRM24(12), XFRM34(6
     *), XVARSX(20), CIRSIZ(2,3), ASIZE, AFLARE, SMSZDF, ORAXES(3), EY
     *EDIR(3), VUEDIR(3), VUECEN(3), VERTCL(3), EYESEP, SCRD, SCRZ, EYE
     *DIS, EYEPNT(3), XYPART(2, 2), BARSIZ(3), BARBRK(3), TIKSIZ(3), XY
     *ZBAS(3), TTHETA, TPHI, FRELBL(4), PATRN(20,30), SCLPRM(10,3), WI
     *NDOW(4), SCREEN(2), SYMBOL, NOSYMB, FACTXY(19), LBLSIZ, SYMSIZ, X
     *YZLIM(3,2), WORLD(3), RADRMX, RADRMN, RADAMN, RADANG, RADX0, RADY
     *0, XUNUSD(6), AXANG(3), REDFAC, DSCAL, PATSZ, MARGIN(4), PSCR(2
     *), OREAL, OCPU, CSCRD, DATPTS, ERRPTS, DATXMN, DATXMX, DATYMN, DA
     *TYMX, DATZMN, DATZMX, DATSUM, ERRSUM, DATAVE, ERRAVE, DATCEN, ERR
     *CEN, DATSTD, ERRSTD, WINREL(2,2,NWINLEV),WINABS(2,2,NWINLEV),WINL
     *IM(2,2), FMARKER(3,8), SYDIR(3), GRDIR(3), EXYZLIM(3,2), DSLOPE(2
     *,2)
      REAL PLOT_EXTENT(2,2),FILL_ANGLE(MAX_FILL),FILL_WIDTH(MAX_FILL)
      INTEGER FILL_INDEX, FILL_TEX(MAX_FILL), N_LINES(6)
      EQUIVALENCE (DATDAT, DATPTS)
      INTEGER MAXREP
      PARAMETER (MAXREP=5)
      INTEGER IPATRN, NPATRN(30), NXYLIM(3,2), NPLOTS, NCSETS, NCCOL, N
     *CROW, IYEAR, IMONTH, IDAY, ISIGFG, ITXPRI, ITXSEC, ITITDT(3), L
     *ENCRD, IPROP, IHTEX, IBLINK, IERASE, ITCNTR, IUNUSD, NXYZ1(3), 
     *NXYZ2(3), LBLFMT(3), LBLCHR(3), NDIMNS(3), IBLKTP, IDIMNS, NMES
     *H0, NMESH1, NMESH2, MESH1, MESH2, MESH3, MESH2D, MESHN(3), NMESHN(
     *2), NFIELD, IFIELD(19), NINCR, NPOINT, IVARBL(19), IVPTR(19), I_
     *VORDER(19,2), LINEAR(4), NONLIN(4), MXECHO, LINES, MAXLNS, USRK
     *BD, USRSCR, PLTFIL, LINWID, LINCOL, LINTEX, ICPOIN(3), IREPCT(MA
     *XREP), LEVREP, GRDTYP, GRDTEX, OUTTEX, IAXTEX, TITEX, LETSET, LAB
     *TEX, TICTEX, SHADOWTYP,SHADOWTEX, NXYZDEF1(10), NXYZDEF2(10), IF
     *ILE_CASE ,MAX_SUBST
      INTEGER MAX_CYCLE
      PARAMETER (MAX_CYCLE=20)
      INTEGER N_CYCLE, ITX_CYCLE(MAX_CYCLE)
      REAL SYM_CYCLE(MAX_CYCLE)
      EQUIVALENCE (NMESH1,NMESHN)
      EQUIVALENCE (MESH1,MESHN)
      INTEGER IBUFFR(400)
      REAL BUFFER(400)
      INTEGER NCHSAVE 
      PARAMETER (NCHSAVE=2*512) 
      INTEGER*4 ICHSAVE(NCHSAVE)
      INTEGER*4 IVRPTR(15)
      CHARACTER*512 OUTSTR,C_FILE, C_NAME, C_SELECT
      CHARACTER C_TIT_ESCAPE*1,C_TIT_SUBSTITUTE*2
      INTEGER N_FILE, N_NAME, N_SELECT
      CHARACTER*8 PXNAME
      CHARACTER*64 INPFMT
      LOGICAL LTDATA, OUTSID(4)
      COMMON /T2COM/ PXNAME, REDUCE, TITX, TITY ,XFRM12, XFRM13, XFRM1
     *4, XFRM23 ,XFRM24, XFRM34 ,XVARSX ,TITSIZ, GRDSYM, GRDSIZ, CIRS
     *IZ, ASIZE, AFLARE ,SMSZDF, ORAXES, EYEDIR, VUEDIR, VUECEN ,VERTC
     *L, EYESEP, SCRD, SCRZ, EYEDIS, EYEPNT ,XYPART, BARSIZ, TIKSIZ, XY
     *ZBAS, TTHETA ,TPHI, FRELBL, IPATRN, NPATRN, PATRN ,SCLPRM, WINDO
     *W, SCREEN, SYMBOL, NOSYMB ,FACTXY, LBLSIZ, SYMSIZ, XYZLIM, WORLD 
     *,RADRMX, RADRMN, RADAMN, RADANG, RADX0, RADY0, XUNUSD ,USRKBD, U
     *SRSCR, PLTFIL ,ITITDT, LENCRD ,INPFMT, GRDTYP, LINWID, LINCOL, L
     *INTEX, TITCON, ITCNTR ,IUNUSD, NXYZ1, NXYZ2 ,LBLCHR, NDIMNS, IBL
     *KTP, IDIMNS ,NMESH1, NMESH2, MESH1, MESH2, MESH3, NFIELD ,IFIELD
     *, NINCR ,IVARBL, IVRPTR ,LINEAR, NONLIN ,NPOINT, LETSET ,MXECH
     *O, LINES, MAXLNS ,AXANG, MESH2D, REDFAC, GRDTEX, OUTTEX, IAXTEX, 
     *TITEX, DSCAL ,OUTSTR, IPROP, IHTEX, IBLINK, IERASE, LABTEX, TICTE
     *X, NXYLIM, PATSZ ,MARGIN, PSCR, ITXPRI, ITXSEC, OREAL, OCPU, CSCR
     *D, OUTSID ,TITLIN, TITINX, TITZ, TITX1, TITY1, LTDATA, NPLOTS, RE
     *VLEV ,LBLFMT, IYEAR, IMONTH, IDAY, ISIGFG ,DATPTS, ERRPTS, DATXM
     *N, DATXMX, DATYMN, DATYMX, DATZMN, DATZMX ,DATSUM, ERRSUM, DATAVE
     *, ERRAVE, DATCEN, ERRCEN, DATSTD, ERRSTD ,NCSETS, NCCOL, NCROW, F
     *MARKER, H2STAT, TITFAC, TITLOC, TITMAR ,TIKFAC, IWINLEV, WINREL, 
     *WINABS, WINLIM ,ICPOIN, LEVREP, IREPCT, SYDIR, GRDIR, NMESH0, EXY
     *ZLIM, IVPTR ,TITLMX, NXYZDEF1, NXYZDEF2, IFILE_CASE, N_CYCLE, ITX
     *_CYCLE ,SYM_CYCLE, PLOT_EXTENT, FILL_ANGLE, FILL_WIDTH, FILL_TEX 
     *,FILL_INDEX ,N_LINES ,DSLOPE ,MAX_SUBST, BARBRK ,I_VORDER,SHADOW
     *TYP,SHADOWTEX
      COMMON /T2SCRT/ BUFFER, IBUFFR, N_FILE,N_NAME,N_SELECT, ICHSAVE
      COMMON /T2_CHAR/ C_TIT_ESCAPE,C_TIT_SUBSTITUTE
      COMMON /T2_SCRT/ C_FILE, C_NAME, C_SELECT
      INTEGER JOUFIL, ERRFIL, OUTFIL, DBGFIL, INPFIL, NINMAX
      PARAMETER (NINMAX=20)
      INTEGER NINP(NINMAX)
      COMMON /T2TRBK/NINP, JOUFIL, ERRFIL, OUTFIL, DBGFIL, INPFIL
      CHARACTER*512 STRNG, STJOU
      LOGICAL LTOKEN
      REAL FLOTNG
      INTEGER INTERP, KEYORD, NSTRNG, MAXSTR, NSTJOU, LSTJOU, NTOKEN
      INTEGER*4 INTEG
      COMMON /TOKENC/ INTERP, INTEG, FLOTNG, KEYORD, NSTRNG, MAXSTR, ST
     *RNG, NSTJOU, LSTJOU, STJOU, LTOKEN, NTOKEN
      INTEGER NSETD 
      PARAMETER (NSETD=19+9)
      INTEGER ISETD(NSETD),NINCR0,NINCR1,NINCR2,IBTYPE
      INTEGER I1,I2,I3,I4,I5,I6,I7,IM,NP,NL,IENDAT,IBGDAT
      INTEGER I_NDX,I_NDY,I_NDZ
      INTEGER N_SYMBOL 
      INTEGER N_XDATA 
      INTEGER N_DXDATA 
      INTEGER N_NDXDATA 
      INTEGER N_YDATA 
      INTEGER N_DYDATA 
      INTEGER N_NDYDATA 
      INTEGER N_ZDATA 
      INTEGER N_DZDATA 
      INTEGER N_NDZDATA 
      INTEGER N_UDATA 
      INTEGER N_DUDATA 
      INTEGER N_NDUDATA 
      INTEGER N_VDATA 
      INTEGER N_DVDATA 
      INTEGER N_NDVDATA 
      INTEGER N_WDATA 
      INTEGER N_DWDATA 
      INTEGER N_NDWDATA 
      INTEGER NCMAX 
      INTEGER NCSIZE 
      INTEGER NBTYPE 
      INTEGER NINDAT 
      INTEGER NSDATA 
      INTEGER NXDATA 
      INTEGER NDXDATA 
      INTEGER NNDXDATA 
      INTEGER NYDATA 
      INTEGER NDYDATA 
      INTEGER NNDYDATA 
      INTEGER NZDATA 
      INTEGER NDZDATA 
      INTEGER NNDZDATA 
      INTEGER NPDATA 
      INTEGER NLDATA 
      INTEGER NMDATA 
      INTEGER NBGDAT 
      INTEGER NENDAT 
      PARAMETER (N_SYMBOL=1) 
      PARAMETER (N_XDATA=2) 
      PARAMETER (N_DXDATA=3) 
      PARAMETER (N_NDXDATA=4) 
      PARAMETER (N_YDATA=5) 
      PARAMETER (N_DYDATA=6) 
      PARAMETER (N_NDYDATA=7) 
      PARAMETER (N_ZDATA=8) 
      PARAMETER (N_DZDATA=9) 
      PARAMETER (N_NDZDATA=10) 
      PARAMETER (N_UDATA=11) 
      PARAMETER (N_DUDATA=12) 
      PARAMETER (N_NDUDATA=13) 
      PARAMETER (N_VDATA=14) 
      PARAMETER (N_DVDATA=15) 
      PARAMETER (N_NDVDATA=16) 
      PARAMETER (N_WDATA=17) 
      PARAMETER (N_DWDATA=18) 
      PARAMETER (N_NDWDATA=19) 
      PARAMETER (NCMAX=6) 
      PARAMETER (NCSIZE=3) 
      PARAMETER (NBTYPE=1) 
      PARAMETER (NINDAT=2) 
      PARAMETER (NSDATA=5) 
      PARAMETER (NXDATA=NSDATA+1) 
      PARAMETER (NDXDATA=NXDATA+1) 
      PARAMETER (NNDXDATA=NXDATA+2) 
      PARAMETER (NYDATA=NXDATA+NCSIZE) 
      PARAMETER (NDYDATA=NYDATA+1) 
      PARAMETER (NNDYDATA=NYDATA+2) 
      PARAMETER (NZDATA=NYDATA+NCSIZE) 
      PARAMETER (NDZDATA=NZDATA+1) 
      PARAMETER (NNDZDATA=NZDATA+2) 
      PARAMETER (NPDATA=NSDATA+19) 
      PARAMETER (NLDATA=NPDATA+1) 
      PARAMETER (NMDATA=NLDATA+1) 
      PARAMETER (NBGDAT=NMDATA+1) 
      PARAMETER (NENDAT=NBGDAT+1) 
      EQUIVALENCE (IBTYPE,ISETD(NBTYPE))
      EQUIVALENCE (NINCR0,ISETD(NINDAT))
      EQUIVALENCE (NINCR1,ISETD(NINDAT+1))
      EQUIVALENCE (NINCR2,ISETD(NINDAT+2))
      EQUIVALENCE (I7,ISETD(NSDATA))
      EQUIVALENCE (I1,ISETD(NXDATA))
      EQUIVALENCE (I4,ISETD(NDXDATA))
      EQUIVALENCE (I2,ISETD(NYDATA))
      EQUIVALENCE (I5,ISETD(NDYDATA))
      EQUIVALENCE (I3,ISETD(NZDATA))
      EQUIVALENCE (I6,ISETD(NDZDATA))
      EQUIVALENCE (I_NDX,ISETD(NNDXDATA))
      EQUIVALENCE (I_NDY,ISETD(NNDYDATA))
      EQUIVALENCE (I_NDZ,ISETD(NNDZDATA))
      EQUIVALENCE (NP,ISETD(NPDATA))
      EQUIVALENCE (NL,ISETD(NLDATA))
      EQUIVALENCE (IM,ISETD(NMDATA))
      EQUIVALENCE (IBGDAT,ISETD(NBGDAT))
      EQUIVALENCE (IENDAT,ISETD(NENDAT))
      LOGICAL DFLAGS(200),DSCREV(3)
      COMMON /T2FLGD/DFLAGS,DSCREV
      REAL DTITLIN(4), DTITFAC(4), DTITMAR(4)
      INTEGER DGRDTYP, DGRDTEX, DOUTTEX, IDAXTEX, DTITEX, DSHADOWTYP,DS
     *HADOWTEX, IFLDDF(19), NDDIMNS, IDTXPRI, IDTXSEC, LINCLF, LINTXF,
     * LINWDF, DNONLN(3), DNXYZ1(3), DNXYZ2(3), DLABTEX, DTICTEX, DNPAT
     *RN(30), DLBLCHR(3), ND_CYCLE, IDTX_CYCLE(MAX_CYCLE)
      REAL DSYM_CYCLE(MAX_CYCLE)
      REAL DTITSIZ, DGRDSYM, DGRDSIZ, DCIRSIZ(2,3), DASIZE, DAFLARE, D
     *SMSZDF, DORAXES(3), DEYEDIR(3), DVUEDIR(3), DVUECEN(3), DVERTCL(3
     *), DEYESEP, DSCRD, DSCRZ, DEYEDIS, DEYEPNT(3), DBARSIZ(3), DBARBR
     *K(3), DTIKSIZ(3), DXYZBS(3), DTTHETA, DTPHI, DFRELBL(4), DPATRN(2
     *0,30), DSCLPRM(10,3), DWINDOW(4), DSCREEN(2), DSYMBOL, DNOSYMB, 
     *DAXANG(3), DLBLSIZ, DSYMSIZ, DXYZLIM(3,2), DFACTXY(19), DRADANG,
     * DDSCAL, DPATSZ, DTITINX, DTIKFAC, DSYDIR(3), DGRDIR(3)
      COMMON /T2COMD/ DTITSIZ, DGRDSYM, DGRDSIZ, DCIRSIZ, DASIZE, DAFLA
     *RE, DSMSZDF, DORAXES, DEYEDIR, DVUEDIR, DVUECEN, DVERTCL, DEYESE
     *P, DSCRD, DSCRZ, DEYEDIS, DEYEPNT, DBARSIZ, DTIKSIZ, DXYZBS, DTTH
     *ETA, DTPHI, DFRELBL, DNPATRN, DPATRN, DSCLPRM, DWINDOW, DSCREEN,
     * DSYMBOL, DNOSYMB, DAXANG, DLBLSIZ, DSYMSIZ, DXYZLIM, DGRDTYP, D
     *FACTXY, IFLDDF, NDDIMNS, DGRDTEX, DOUTTEX, IDAXTEX, DTITEX, DRADA
     *NG, DDSCAL, DNONLN, DNXYZ1, DNXYZ2, LINCLF, LINTXF, LINWDF, DLABT
     *EX, DTICTEX, DPATSZ, IDTXPRI, IDTXSEC, DTITLIN, DTITINX, DLBLCHR,
     * DTITFAC, DTITMAR, DTIKFAC, DSYDIR, DGRDIR, ND_CYCLE, IDTX_CYCLE,
     * DSYM_CYCLE, DBARBRK,  DSHADOWTYP,DSHADOWTEX
      INTEGER I,J,K,L,ITEMP,IVAR(19+2),IVTEMP
      LOGICAL LTEMP,LTEMP1
      INTEGER IDEFAU(5),IMIN,IMAX
      INTEGER IAND,IOR
      DATA IDEFAU/N_XDATA,N_YDATA,N_DXDATA,N_DYDATA,N_SYMBOL/
      DO 12121 I=1,19
      IFIELD(I)=0
12121 CONTINUE
12122 CONTINUE
      IFIELD(1)=-1
      IVTEMP=0
      IVAR(1)=NINCR
      DO 12131 I=1,NINCR
      IVAR(I+1)=IVARBL(I)
      IVTEMP=IVTEMP+2**IVARBL(I)
12131 CONTINUE
12132 CONTINUE
      FLAGS(12)=.false.
      NFIELD=0
      ITEMP=0
      LTEMP=.false.
      FLAGS(27)=.false.
      FLAGS(91)=.FALSE.
      DO 12141 I=RELFLAG,RELFLAG+19-1
      FLAGS(I)=.FALSE.
12141 CONTINUE
12142 CONTINUE
12150 CONTINUE
12151 CONTINUE
      IF( NFIELD.ge.100) THEN
      CALL T2ERR(INFOIN,CARDIN,('*** ERROR *** Maximum number of fields 
     *exceeded (99)'),4)
      ENDIF
      GOTO 12161
12170 CONTINUE
      GOTO 12152
12200 CONTINUE
      LTEMP=.true.
      GOTO 12162
12210 CONTINUE
      FLAGS(12)=LTOKEN
      GOTO 12162
12220 CONTINUE
      NFIELD=NFIELD+1
      I = INTEG/100 
      INTEG=MOD(INTEG,100)
      IF (NFIELD.EQ.1) THEN
      CALL T2ERR(INFOIN,CARDIN,('*** WARNING *** Symbol should not be fi
     *rst'),4)
      ENDIF
      GOTO 12162
12230 CONTINUE
      NFIELD=NFIELD+1
      I=INTEG/100
      INTEG=MOD(INTEG,100)
      GOTO 12162
12240 CONTINUE
      NFIELD=NFIELD+1
      I=INTEG/100
      INTEG=MOD(INTEG,100)
      FLAGS(27)=.true.
      IF(IAND(I,1) .ge. 1) THEN
      FLAGS(91)=.true.
      ENDIF
      GOTO 12162
12250 CONTINUE
      NFIELD=NFIELD+INTEG
      INTEG=0
      GOTO 12162
12180 GOTO ( 12200,12210,12220,12230,12230,12230,12230,12230,12230,12230
     *,12230,12230,12230,12230,12230,12230,12230,12230,12230,12230,12230
     *,12230,12230,12230,12230,12230,12230,12230,12230,12230,12230,12230
     *,12240,12240,12240,12240,12240,12240,12240,12240,12240,12240,12240
     *,12240,12240,12240,12240,12250,12165),KEYORD
12161 CALL TOKEN(INFOIN,CARDIN,'PERMANENT,PACKED:Y,SYMBOL:1,X:2,DX:3,Y:4
     *,DY:5,Z:6,DZ:7,NDX:8,NDY:9:NDZ:10,U:11,DU:12,NDU:13,V:14,DV:15,NDV
     *:16,W:17,DW:18,NDW:19,RU:212,NRU:213,RV:215,NRV:216,RW:218,NRW:219
     *,RX:203,RY:205,RZ:207,NRX:208,NRY:209,NRZ:210,THETA:2,DTHETA:3,RAD
     *IUS:4,DRADIUS:5,PHI:106,DPHI:107,NDTHETA:8,NDRADIUS:9,NDPHI:110,RT
     *HETA:203,RRADIUS:205,RPHI:307,NRTHETA:208,NRRADIUS:209,NRPHI:310,D
     *UMMY:1:99:1,;')
      GOTO (12170,12180,12165,12165,12165,12165,12165,12180,12165),INTER
     *P
12165 CALL T2ERR(INFOIN,CARDIN,' ',5)
      GOTO 12162
12162 CONTINUE
      IF (INTEG.GT.0) THEN
      INTEG=I_VORDER(INTEG,1)
      IF (INTEG .gt. 19 .or. INTEG .lt. 1) THEN
      CALL T2ERR(INFOIN,CARDIN,'*** ERROR *** Illegal coordinate',4)
      RETURN
      ENDIF
      IF (IAND(I,2) .EQ. 2) FLAGS(INTEG+RELFLAG-1)=.TRUE.
      J=2**INTEG
      IF ( IAND(J,ITEMP) .ne. 0) THEN
      CALL T2ERR(INFOIN,CARDIN,'*** WARNING *** Duplicate field (previou
     *s ignored)',4)
      ENDIF
      ITEMP=IOR(ITEMP,J)
      I=INTEG
      IFIELD(I)=NFIELD
      FACTXY(I)=1.
      IF (I.ne.1) THEN
      GOTO 12261
12270 CONTINUE
      FACTXY(I)=FLOTNG
      GOTO 12262
12265 CONTINUE
      INFOIN(9)=-1
      GOTO 12262
12261 CALL TOKEN(INFOIN,CARDIN,';')
      GOTO (12265,12265,12270,12270,12265,12265,12265,12265,12265),INTER
     *P
12262 CONTINUE
      ENDIF
      IMIN=I
      IMAX=I
      IF(I.gt.1 .and. (I-2)/NCSIZE .lt. NCMAX) IMIN=MAX(NCSIZE*((IMAX-2)
     */NCSIZE)+2,1)
      DO 12281 I=IMIN,IMAX
      J=2**I
      IF (IAND(J,IVTEMP).eq.0) THEN
      IVTEMP=IVTEMP+J
      IVAR(1)=IVAR(1)+1
      IVAR(IVAR(1)+1)=99
      L=I
      DO 12291 J=2,IVAR(1)+1
      K=IVAR(J)
      IF (K.gt.L) THEN
      IVAR(J)=L
      L=K
      ENDIF
12291 CONTINUE
12292 CONTINUE
      CALL T2SETS(IVAR)
      ENDIF
12281 CONTINUE
12282 CONTINUE
      ENDIF
      GOTO 12151
12152 CONTINUE
      IF (NFIELD.le.0) THEN
      NFIELD=5
      DO 12301 I=1,5
      IFIELD(IDEFAU(I))=I
12301 CONTINUE
12302 CONTINUE
      ENDIF
      IF (LTEMP) THEN
      DFLAGS(12)=FLAGS(12)
      DO 12311 I=1,19
      IFLDDF(I)=IFIELD(I)
      DFACTXY(I)=FACTXY(I)
12311 CONTINUE
12312 CONTINUE
      DO 12321 I=RELFLAG,RELFLAG+19-1
      DFLAGS(I)=FLAGS(I)
12321 CONTINUE
12322 CONTINUE
      DFLAGS(27)=FLAGS(27)
      DFLAGS(91)=FLAGS(91)
      ENDIF
      END
      SUBROUTINE T2_SET_SEGMENTS(INFOIN,CARDIN)
      IMPLICIT NONE
      INTEGER INFOIN(10)
      character*(*) CARDIN
      COMMON /T2FLGC/ FLAGS(200), LTRAP,LHANDL,LSYERR,LSCREV
      LOGICAL FLAGS, LTRAP,LHANDL,LSYERR,LSCREV(3)
      INTEGER RELFLAG 
      PARAMETER (RELFLAG=151)
      INTEGER IWINLEV 
      INTEGER NWINLEV , MAX_FILL 
      PARAMETER (NWINLEV =4)
      PARAMETER (MAX_FILL=4)
      REAL GRDSYM, GRDSIZ, DATDAT(2,8), H2STAT(12), TITLIN(4), TITFA
     *C(4), TITLOC(4), TITMAR(4), TITLMX(4), TIKFAC, TITINX, TITX1, TIT
     *Y1, TITX, TITY, TITZ, TITSIZ, TITCON(5), REVLEV, REDUCE(5), XFR
     *M12(12), XFRM13(12), XFRM14(12), XFRM23(12), XFRM24(12), XFRM34(6
     *), XVARSX(20), CIRSIZ(2,3), ASIZE, AFLARE, SMSZDF, ORAXES(3), EY
     *EDIR(3), VUEDIR(3), VUECEN(3), VERTCL(3), EYESEP, SCRD, SCRZ, EYE
     *DIS, EYEPNT(3), XYPART(2, 2), BARSIZ(3), BARBRK(3), TIKSIZ(3), XY
     *ZBAS(3), TTHETA, TPHI, FRELBL(4), PATRN(20,30), SCLPRM(10,3), WI
     *NDOW(4), SCREEN(2), SYMBOL, NOSYMB, FACTXY(19), LBLSIZ, SYMSIZ, X
     *YZLIM(3,2), WORLD(3), RADRMX, RADRMN, RADAMN, RADANG, RADX0, RADY
     *0, XUNUSD(6), AXANG(3), REDFAC, DSCAL, PATSZ, MARGIN(4), PSCR(2
     *), OREAL, OCPU, CSCRD, DATPTS, ERRPTS, DATXMN, DATXMX, DATYMN, DA
     *TYMX, DATZMN, DATZMX, DATSUM, ERRSUM, DATAVE, ERRAVE, DATCEN, ERR
     *CEN, DATSTD, ERRSTD, WINREL(2,2,NWINLEV),WINABS(2,2,NWINLEV),WINL
     *IM(2,2), FMARKER(3,8), SYDIR(3), GRDIR(3), EXYZLIM(3,2), DSLOPE(2
     *,2)
      REAL PLOT_EXTENT(2,2),FILL_ANGLE(MAX_FILL),FILL_WIDTH(MAX_FILL)
      INTEGER FILL_INDEX, FILL_TEX(MAX_FILL), N_LINES(6)
      EQUIVALENCE (DATDAT, DATPTS)
      INTEGER MAXREP
      PARAMETER (MAXREP=5)
      INTEGER IPATRN, NPATRN(30), NXYLIM(3,2), NPLOTS, NCSETS, NCCOL, N
     *CROW, IYEAR, IMONTH, IDAY, ISIGFG, ITXPRI, ITXSEC, ITITDT(3), L
     *ENCRD, IPROP, IHTEX, IBLINK, IERASE, ITCNTR, IUNUSD, NXYZ1(3), 
     *NXYZ2(3), LBLFMT(3), LBLCHR(3), NDIMNS(3), IBLKTP, IDIMNS, NMES
     *H0, NMESH1, NMESH2, MESH1, MESH2, MESH3, MESH2D, MESHN(3), NMESHN(
     *2), NFIELD, IFIELD(19), NINCR, NPOINT, IVARBL(19), IVPTR(19), I_
     *VORDER(19,2), LINEAR(4), NONLIN(4), MXECHO, LINES, MAXLNS, USRK
     *BD, USRSCR, PLTFIL, LINWID, LINCOL, LINTEX, ICPOIN(3), IREPCT(MA
     *XREP), LEVREP, GRDTYP, GRDTEX, OUTTEX, IAXTEX, TITEX, LETSET, LAB
     *TEX, TICTEX, SHADOWTYP,SHADOWTEX, NXYZDEF1(10), NXYZDEF2(10), IF
     *ILE_CASE ,MAX_SUBST
      INTEGER MAX_CYCLE
      PARAMETER (MAX_CYCLE=20)
      INTEGER N_CYCLE, ITX_CYCLE(MAX_CYCLE)
      REAL SYM_CYCLE(MAX_CYCLE)
      EQUIVALENCE (NMESH1,NMESHN)
      EQUIVALENCE (MESH1,MESHN)
      INTEGER IBUFFR(400)
      REAL BUFFER(400)
      INTEGER NCHSAVE 
      PARAMETER (NCHSAVE=2*512) 
      INTEGER*4 ICHSAVE(NCHSAVE)
      INTEGER*4 IVRPTR(15)
      CHARACTER*512 OUTSTR,C_FILE, C_NAME, C_SELECT
      CHARACTER C_TIT_ESCAPE*1,C_TIT_SUBSTITUTE*2
      INTEGER N_FILE, N_NAME, N_SELECT
      CHARACTER*8 PXNAME
      CHARACTER*64 INPFMT
      LOGICAL LTDATA, OUTSID(4)
      COMMON /T2COM/ PXNAME, REDUCE, TITX, TITY ,XFRM12, XFRM13, XFRM1
     *4, XFRM23 ,XFRM24, XFRM34 ,XVARSX ,TITSIZ, GRDSYM, GRDSIZ, CIRS
     *IZ, ASIZE, AFLARE ,SMSZDF, ORAXES, EYEDIR, VUEDIR, VUECEN ,VERTC
     *L, EYESEP, SCRD, SCRZ, EYEDIS, EYEPNT ,XYPART, BARSIZ, TIKSIZ, XY
     *ZBAS, TTHETA ,TPHI, FRELBL, IPATRN, NPATRN, PATRN ,SCLPRM, WINDO
     *W, SCREEN, SYMBOL, NOSYMB ,FACTXY, LBLSIZ, SYMSIZ, XYZLIM, WORLD 
     *,RADRMX, RADRMN, RADAMN, RADANG, RADX0, RADY0, XUNUSD ,USRKBD, U
     *SRSCR, PLTFIL ,ITITDT, LENCRD ,INPFMT, GRDTYP, LINWID, LINCOL, L
     *INTEX, TITCON, ITCNTR ,IUNUSD, NXYZ1, NXYZ2 ,LBLCHR, NDIMNS, IBL
     *KTP, IDIMNS ,NMESH1, NMESH2, MESH1, MESH2, MESH3, NFIELD ,IFIELD
     *, NINCR ,IVARBL, IVRPTR ,LINEAR, NONLIN ,NPOINT, LETSET ,MXECH
     *O, LINES, MAXLNS ,AXANG, MESH2D, REDFAC, GRDTEX, OUTTEX, IAXTEX, 
     *TITEX, DSCAL ,OUTSTR, IPROP, IHTEX, IBLINK, IERASE, LABTEX, TICTE
     *X, NXYLIM, PATSZ ,MARGIN, PSCR, ITXPRI, ITXSEC, OREAL, OCPU, CSCR
     *D, OUTSID ,TITLIN, TITINX, TITZ, TITX1, TITY1, LTDATA, NPLOTS, RE
     *VLEV ,LBLFMT, IYEAR, IMONTH, IDAY, ISIGFG ,DATPTS, ERRPTS, DATXM
     *N, DATXMX, DATYMN, DATYMX, DATZMN, DATZMX ,DATSUM, ERRSUM, DATAVE
     *, ERRAVE, DATCEN, ERRCEN, DATSTD, ERRSTD ,NCSETS, NCCOL, NCROW, F
     *MARKER, H2STAT, TITFAC, TITLOC, TITMAR ,TIKFAC, IWINLEV, WINREL, 
     *WINABS, WINLIM ,ICPOIN, LEVREP, IREPCT, SYDIR, GRDIR, NMESH0, EXY
     *ZLIM, IVPTR ,TITLMX, NXYZDEF1, NXYZDEF2, IFILE_CASE, N_CYCLE, ITX
     *_CYCLE ,SYM_CYCLE, PLOT_EXTENT, FILL_ANGLE, FILL_WIDTH, FILL_TEX 
     *,FILL_INDEX ,N_LINES ,DSLOPE ,MAX_SUBST, BARBRK ,I_VORDER,SHADOW
     *TYP,SHADOWTEX
      COMMON /T2SCRT/ BUFFER, IBUFFR, N_FILE,N_NAME,N_SELECT, ICHSAVE
      COMMON /T2_CHAR/ C_TIT_ESCAPE,C_TIT_SUBSTITUTE
      COMMON /T2_SCRT/ C_FILE, C_NAME, C_SELECT
      INTEGER JOUFIL, ERRFIL, OUTFIL, DBGFIL, INPFIL, NINMAX
      PARAMETER (NINMAX=20)
      INTEGER NINP(NINMAX)
      COMMON /T2TRBK/NINP, JOUFIL, ERRFIL, OUTFIL, DBGFIL, INPFIL
      CHARACTER*512 STRNG, STJOU
      LOGICAL LTOKEN
      REAL FLOTNG
      INTEGER INTERP, KEYORD, NSTRNG, MAXSTR, NSTJOU, LSTJOU, NTOKEN
      INTEGER*4 INTEG
      COMMON /TOKENC/ INTERP, INTEG, FLOTNG, KEYORD, NSTRNG, MAXSTR, ST
     *RNG, NSTJOU, LSTJOU, STJOU, LTOKEN, NTOKEN
      LOGICAL DFLAGS(200),DSCREV(3)
      COMMON /T2FLGD/DFLAGS,DSCREV
      REAL DTITLIN(4), DTITFAC(4), DTITMAR(4)
      INTEGER DGRDTYP, DGRDTEX, DOUTTEX, IDAXTEX, DTITEX, DSHADOWTYP,DS
     *HADOWTEX, IFLDDF(19), NDDIMNS, IDTXPRI, IDTXSEC, LINCLF, LINTXF,
     * LINWDF, DNONLN(3), DNXYZ1(3), DNXYZ2(3), DLABTEX, DTICTEX, DNPAT
     *RN(30), DLBLCHR(3), ND_CYCLE, IDTX_CYCLE(MAX_CYCLE)
      REAL DSYM_CYCLE(MAX_CYCLE)
      REAL DTITSIZ, DGRDSYM, DGRDSIZ, DCIRSIZ(2,3), DASIZE, DAFLARE, D
     *SMSZDF, DORAXES(3), DEYEDIR(3), DVUEDIR(3), DVUECEN(3), DVERTCL(3
     *), DEYESEP, DSCRD, DSCRZ, DEYEDIS, DEYEPNT(3), DBARSIZ(3), DBARBR
     *K(3), DTIKSIZ(3), DXYZBS(3), DTTHETA, DTPHI, DFRELBL(4), DPATRN(2
     *0,30), DSCLPRM(10,3), DWINDOW(4), DSCREEN(2), DSYMBOL, DNOSYMB, 
     *DAXANG(3), DLBLSIZ, DSYMSIZ, DXYZLIM(3,2), DFACTXY(19), DRADANG,
     * DDSCAL, DPATSZ, DTITINX, DTIKFAC, DSYDIR(3), DGRDIR(3)
      COMMON /T2COMD/ DTITSIZ, DGRDSYM, DGRDSIZ, DCIRSIZ, DASIZE, DAFLA
     *RE, DSMSZDF, DORAXES, DEYEDIR, DVUEDIR, DVUECEN, DVERTCL, DEYESE
     *P, DSCRD, DSCRZ, DEYEDIS, DEYEPNT, DBARSIZ, DTIKSIZ, DXYZBS, DTTH
     *ETA, DTPHI, DFRELBL, DNPATRN, DPATRN, DSCLPRM, DWINDOW, DSCREEN,
     * DSYMBOL, DNOSYMB, DAXANG, DLBLSIZ, DSYMSIZ, DXYZLIM, DGRDTYP, D
     *FACTXY, IFLDDF, NDDIMNS, DGRDTEX, DOUTTEX, IDAXTEX, DTITEX, DRADA
     *NG, DDSCAL, DNONLN, DNXYZ1, DNXYZ2, LINCLF, LINTXF, LINWDF, DLABT
     *EX, DTICTEX, DPATSZ, IDTXPRI, IDTXSEC, DTITLIN, DTITINX, DLBLCHR,
     * DTITFAC, DTITMAR, DTIKFAC, DSYDIR, DGRDIR, ND_CYCLE, IDTX_CYCLE,
     * DSYM_CYCLE, DBARBRK,  DSHADOWTYP,DSHADOWTEX
      INTEGER I,IMIN,IMAX
      I=0
      GOTO 12331
12360 CONTINUE
      IMIN=MOD(INTEG,100)
      IMAX=MAX(IMIN,INTEG/100)
      DO 12371 I=IMIN+120,IMAX+120
      FLAGS(I)=LTOKEN
12371 CONTINUE
12372 CONTINUE
      GOTO 12331
12331 CALL TOKEN(INFOIN,CARDIN,'ALL:601:Y,PLOTS:1:Y AXES:2:Y,LABELS:3:Y,
     *TICKS:4:Y,OUTLINE:5:Y,POINTS:6:Y,TITLES:7:Y,,;')
      GOTO (12332,12337,12335,12335,12335,12335,12331,12337, 12335),INTE
     *RP
12335 CALL T2ERR(INFOIN,CARDIN,' ',5)
      GOTO 12331
12337 GOTO ( 12360,12360,12360,12360,12360,12360,12360,12360,12335),KEYO
     *RD
12332 CONTINUE
      IF (I.eq.0) then
      DO 12381 I=121,127
      FLAGS(I)=.false.
12381 CONTINUE
12382 CONTINUE
      ENDIF
      IMIN=0
      DO 12391 I=121,127
      DFLAGS(I)=FLAGS(I)
      IF (FLAGS(I)) IMIN=1
12391 CONTINUE
12392 CONTINUE
      CALL TXXOPT(13,IMIN,0.,IMAX)
      END
      SUBROUTINE T2_SET_SIZE(INFOIN,CARDIN)
      IMPLICIT NONE
      INTEGER INFOIN(10)
      CHARACTER*(*) CARDIN
      REAL PLIM(4,4),ZSCRN(2),XLLINE,YLLINE,XTLINE,YTLINE,XFRMFC, PAT(2
     *0),PATCUM,PATTOT,PATMOD,CCSCIS(4),DISPL, RESOL(2)
      INTEGER NPTS,IDDEVC,IPAT,NPAT,LMOVE,IROTAX,IROTAF
      COMMON/TXCOM/PLIM,ZSCRN, XLLINE,YLLINE,XTLINE,YTLINE,XFRMFC, IPA
     *T,NPAT,PAT,PATTOT, NPTS,IDDEVC,CCSCIS,LMOVE,IROTAX,DISPL,IROTAF,P
     *ATCUM,PATMOD, RESOL
      COMMON /T2FLGC/ FLAGS(200), LTRAP,LHANDL,LSYERR,LSCREV
      LOGICAL FLAGS, LTRAP,LHANDL,LSYERR,LSCREV(3)
      INTEGER RELFLAG 
      PARAMETER (RELFLAG=151)
      INTEGER IWINLEV 
      INTEGER NWINLEV , MAX_FILL 
      PARAMETER (NWINLEV =4)
      PARAMETER (MAX_FILL=4)
      REAL GRDSYM, GRDSIZ, DATDAT(2,8), H2STAT(12), TITLIN(4), TITFA
     *C(4), TITLOC(4), TITMAR(4), TITLMX(4), TIKFAC, TITINX, TITX1, TIT
     *Y1, TITX, TITY, TITZ, TITSIZ, TITCON(5), REVLEV, REDUCE(5), XFR
     *M12(12), XFRM13(12), XFRM14(12), XFRM23(12), XFRM24(12), XFRM34(6
     *), XVARSX(20), CIRSIZ(2,3), ASIZE, AFLARE, SMSZDF, ORAXES(3), EY
     *EDIR(3), VUEDIR(3), VUECEN(3), VERTCL(3), EYESEP, SCRD, SCRZ, EYE
     *DIS, EYEPNT(3), XYPART(2, 2), BARSIZ(3), BARBRK(3), TIKSIZ(3), XY
     *ZBAS(3), TTHETA, TPHI, FRELBL(4), PATRN(20,30), SCLPRM(10,3), WI
     *NDOW(4), SCREEN(2), SYMBOL, NOSYMB, FACTXY(19), LBLSIZ, SYMSIZ, X
     *YZLIM(3,2), WORLD(3), RADRMX, RADRMN, RADAMN, RADANG, RADX0, RADY
     *0, XUNUSD(6), AXANG(3), REDFAC, DSCAL, PATSZ, MARGIN(4), PSCR(2
     *), OREAL, OCPU, CSCRD, DATPTS, ERRPTS, DATXMN, DATXMX, DATYMN, DA
     *TYMX, DATZMN, DATZMX, DATSUM, ERRSUM, DATAVE, ERRAVE, DATCEN, ERR
     *CEN, DATSTD, ERRSTD, WINREL(2,2,NWINLEV),WINABS(2,2,NWINLEV),WINL
     *IM(2,2), FMARKER(3,8), SYDIR(3), GRDIR(3), EXYZLIM(3,2), DSLOPE(2
     *,2)
      REAL PLOT_EXTENT(2,2),FILL_ANGLE(MAX_FILL),FILL_WIDTH(MAX_FILL)
      INTEGER FILL_INDEX, FILL_TEX(MAX_FILL), N_LINES(6)
      EQUIVALENCE (DATDAT, DATPTS)
      INTEGER MAXREP
      PARAMETER (MAXREP=5)
      INTEGER IPATRN, NPATRN(30), NXYLIM(3,2), NPLOTS, NCSETS, NCCOL, N
     *CROW, IYEAR, IMONTH, IDAY, ISIGFG, ITXPRI, ITXSEC, ITITDT(3), L
     *ENCRD, IPROP, IHTEX, IBLINK, IERASE, ITCNTR, IUNUSD, NXYZ1(3), 
     *NXYZ2(3), LBLFMT(3), LBLCHR(3), NDIMNS(3), IBLKTP, IDIMNS, NMES
     *H0, NMESH1, NMESH2, MESH1, MESH2, MESH3, MESH2D, MESHN(3), NMESHN(
     *2), NFIELD, IFIELD(19), NINCR, NPOINT, IVARBL(19), IVPTR(19), I_
     *VORDER(19,2), LINEAR(4), NONLIN(4), MXECHO, LINES, MAXLNS, USRK
     *BD, USRSCR, PLTFIL, LINWID, LINCOL, LINTEX, ICPOIN(3), IREPCT(MA
     *XREP), LEVREP, GRDTYP, GRDTEX, OUTTEX, IAXTEX, TITEX, LETSET, LAB
     *TEX, TICTEX, SHADOWTYP,SHADOWTEX, NXYZDEF1(10), NXYZDEF2(10), IF
     *ILE_CASE ,MAX_SUBST
      INTEGER MAX_CYCLE
      PARAMETER (MAX_CYCLE=20)
      INTEGER N_CYCLE, ITX_CYCLE(MAX_CYCLE)
      REAL SYM_CYCLE(MAX_CYCLE)
      EQUIVALENCE (NMESH1,NMESHN)
      EQUIVALENCE (MESH1,MESHN)
      INTEGER IBUFFR(400)
      REAL BUFFER(400)
      INTEGER NCHSAVE 
      PARAMETER (NCHSAVE=2*512) 
      INTEGER*4 ICHSAVE(NCHSAVE)
      INTEGER*4 IVRPTR(15)
      CHARACTER*512 OUTSTR,C_FILE, C_NAME, C_SELECT
      CHARACTER C_TIT_ESCAPE*1,C_TIT_SUBSTITUTE*2
      INTEGER N_FILE, N_NAME, N_SELECT
      CHARACTER*8 PXNAME
      CHARACTER*64 INPFMT
      LOGICAL LTDATA, OUTSID(4)
      COMMON /T2COM/ PXNAME, REDUCE, TITX, TITY ,XFRM12, XFRM13, XFRM1
     *4, XFRM23 ,XFRM24, XFRM34 ,XVARSX ,TITSIZ, GRDSYM, GRDSIZ, CIRS
     *IZ, ASIZE, AFLARE ,SMSZDF, ORAXES, EYEDIR, VUEDIR, VUECEN ,VERTC
     *L, EYESEP, SCRD, SCRZ, EYEDIS, EYEPNT ,XYPART, BARSIZ, TIKSIZ, XY
     *ZBAS, TTHETA ,TPHI, FRELBL, IPATRN, NPATRN, PATRN ,SCLPRM, WINDO
     *W, SCREEN, SYMBOL, NOSYMB ,FACTXY, LBLSIZ, SYMSIZ, XYZLIM, WORLD 
     *,RADRMX, RADRMN, RADAMN, RADANG, RADX0, RADY0, XUNUSD ,USRKBD, U
     *SRSCR, PLTFIL ,ITITDT, LENCRD ,INPFMT, GRDTYP, LINWID, LINCOL, L
     *INTEX, TITCON, ITCNTR ,IUNUSD, NXYZ1, NXYZ2 ,LBLCHR, NDIMNS, IBL
     *KTP, IDIMNS ,NMESH1, NMESH2, MESH1, MESH2, MESH3, NFIELD ,IFIELD
     *, NINCR ,IVARBL, IVRPTR ,LINEAR, NONLIN ,NPOINT, LETSET ,MXECH
     *O, LINES, MAXLNS ,AXANG, MESH2D, REDFAC, GRDTEX, OUTTEX, IAXTEX, 
     *TITEX, DSCAL ,OUTSTR, IPROP, IHTEX, IBLINK, IERASE, LABTEX, TICTE
     *X, NXYLIM, PATSZ ,MARGIN, PSCR, ITXPRI, ITXSEC, OREAL, OCPU, CSCR
     *D, OUTSID ,TITLIN, TITINX, TITZ, TITX1, TITY1, LTDATA, NPLOTS, RE
     *VLEV ,LBLFMT, IYEAR, IMONTH, IDAY, ISIGFG ,DATPTS, ERRPTS, DATXM
     *N, DATXMX, DATYMN, DATYMX, DATZMN, DATZMX ,DATSUM, ERRSUM, DATAVE
     *, ERRAVE, DATCEN, ERRCEN, DATSTD, ERRSTD ,NCSETS, NCCOL, NCROW, F
     *MARKER, H2STAT, TITFAC, TITLOC, TITMAR ,TIKFAC, IWINLEV, WINREL, 
     *WINABS, WINLIM ,ICPOIN, LEVREP, IREPCT, SYDIR, GRDIR, NMESH0, EXY
     *ZLIM, IVPTR ,TITLMX, NXYZDEF1, NXYZDEF2, IFILE_CASE, N_CYCLE, ITX
     *_CYCLE ,SYM_CYCLE, PLOT_EXTENT, FILL_ANGLE, FILL_WIDTH, FILL_TEX 
     *,FILL_INDEX ,N_LINES ,DSLOPE ,MAX_SUBST, BARBRK ,I_VORDER,SHADOW
     *TYP,SHADOWTEX
      COMMON /T2SCRT/ BUFFER, IBUFFR, N_FILE,N_NAME,N_SELECT, ICHSAVE
      COMMON /T2_CHAR/ C_TIT_ESCAPE,C_TIT_SUBSTITUTE
      COMMON /T2_SCRT/ C_FILE, C_NAME, C_SELECT
      INTEGER JOUFIL, ERRFIL, OUTFIL, DBGFIL, INPFIL, NINMAX
      PARAMETER (NINMAX=20)
      INTEGER NINP(NINMAX)
      COMMON /T2TRBK/NINP, JOUFIL, ERRFIL, OUTFIL, DBGFIL, INPFIL
      CHARACTER*512 STRNG, STJOU
      LOGICAL LTOKEN
      REAL FLOTNG
      INTEGER INTERP, KEYORD, NSTRNG, MAXSTR, NSTJOU, LSTJOU, NTOKEN
      INTEGER*4 INTEG
      COMMON /TOKENC/ INTERP, INTEG, FLOTNG, KEYORD, NSTRNG, MAXSTR, ST
     *RNG, NSTJOU, LSTJOU, STJOU, LTOKEN, NTOKEN
      INTEGER I,J
      LOGICAL LMARG(4),LSCR(2)
      REAL CM 
      PARAMETER (CM=2.54)
      REAL INCHES , MM , METERS 
      PARAMETER (INCHES = CM/2.54) 
      PARAMETER (MM = 10.*CM ) 
      PARAMETER (METERS = CM/100 ) 
      REAL UNITS(4)
      DATA UNITS/INCHES,MM,CM,METERS/
      IF (.NOT.FLAGS(1).or.FLAGS(73).or.FLAGS(74).or.FLAGS(75).or. IWINL
     *EV.gt.1) THEN
      CALL T2ERR(INFOIN,CARDIN,('*** ERROR *** Size may not be changed a
     *fter plot is started.'),4)
      RETURN
      ELSE
      REDUCE(1)=0
      IROTAX=IROTAF
      J=0
      DO 12401 I=1,2
      SCREEN(I)=SCREEN(I)/REDUCE(2)
      LSCR(I)=.true.
12401 CONTINUE
12402 CONTINUE
      DO 12411 I=1,4
      MARGIN(I)=MARGIN(I)/REDUCE(2)
      LMARG(I)=.true.
      WINDOW(I)=WINDOW(I)/REDUCE(2)
12411 CONTINUE
12412 CONTINUE
      I=0
      GOTO 12421
12450 CONTINUE
      REDUCE(1)=0
      IF (FLOTNG.ne.0) REDUCE(1)=1/FLOTNG
      I=1
      GOTO 12421
12460 CONTINUE
      REDUCE(1)=FLOTNG
      I=1
      GOTO 12421
12470 CONTINUE
      REDUCE(2)=FLOTNG
      I=1
      GOTO 12421
12480 CONTINUE
      REDUCE(2)=UNITS(INTEG)
      I=1
      GOTO 12421
12490 CONTINUE
      IROTAX=MOD(INTEG+4,4)
      I=1
      GOTO 12421
12500 CONTINUE
      J=INTEG
      GOTO 12421
12510 CONTINUE
      I=INTEG
      CALL TOKEN(INFOIN,CARDIN,';')
      IF(INTERP.NE.3.AND.INTERP.NE.4)THEN
      CALL T2ERR(INFOIN,CARDIN,' ',5)
      ELSE
      MARGIN(I)=ABS(FLOTNG)
      LMARG(I)=.false.
      ENDIF
      GOTO 12421
12530 CONTINUE
      DO 12541 I=1,4
      MARGIN(I)=0
12541 CONTINUE
12542 CONTINUE
      I=1
      GOTO 12551
12560 CONTINUE
      IF(I.eq.1) THEN
      DO 12571 I=1,4
      LMARG(I)=.false.
      MARGIN(I)=ABS(FLOTNG)
12571 CONTINUE
12572 CONTINUE
      ELSEIF(I.le.4) THEN
      MARGIN(I)=ABS(FLOTNG)
      ELSE
      CALL T2ERR(INFOIN,CARDIN,('*** ERROR *** Extraneous numbers'),4)
      ENDIF
      I=I+1
      GOTO 12551
12555 CONTINUE
      INFOIN(9)=-1
      GOTO 12552
12551 CALL TOKEN(INFOIN,CARDIN,';')
      GOTO (12552,12555,12560,12560,12555,12555,12555,12555,12555),INTER
     *P
12552 CONTINUE
      GOTO 12421
12430 GOTO ( 12450,12460,12470,12480,12480,12480,12480,12480,12480,12490
     *,12490,12490,12490,12500,12500,12500,12510,12510,12510,12510,12530
     *,12425),KEYORD
12580 CONTINUE
      J=J+1
      I=1
      IF(J .le. 2) THEN
      IF(FLOTNG.ge.1 .and. FLOTNG.le.999) THEN
      SCREEN(J)=ABS(FLOTNG)
      LSCR(J)=.false.
      ELSE
      CALL T2ERR(INFOIN,CARDIN,('*** ERROR *** Size out of range (1-999)
     *'),4)
      ENDIF
      ELSE
      CALL T2ERR(INFOIN,CARDIN,' ',5)
      ENDIF
      GOTO 12421
12421 CALL TOKEN(INFOIN,CARDIN,'MAGNIFY:.00001:100000:0,REDUCE:.00001:10
     *0000:0,UNITS:.00001:100000:1,INCHES:1,MM:2,MILLIMETERS:2,CM:3,CENT
c    *IMETERS,METERS:4,ORIENTATION:-3:3:0,SIDEWAYS:1,ROTATED:1,NORMAL,X:
     *IMETERS,METERS:4,ORIENTATION:-3:3:0,SIDEWAYS:3,ROTATED:3,NORMAL,X:
     *0,Y:1,BY:1,LEFT:1,RIGHT:2,BOTTOM:3,TOP:4,MARGINS,;')
      GOTO (12422,12430,12580,12580,12425,12425,12425,12430,12425),INTER
     *P
12425 CALL T2ERR(INFOIN,CARDIN,' ',5)
      GOTO 12421
12422 CONTINUE
      IF (I .eq. 0) THEN
      IROTAX=0
      REDUCE(2)=1
      SCREEN(1)=13
      SCREEN(2)=10
      REDUCE(2)=1
      DO 12591 I=1,4
      MARGIN(I)=0
12591 CONTINUE
12592 CONTINUE
      ENDIF
      DO 12601 I=1,2
      IF (LSCR(I)) SCREEN(I)=SCREEN(I)*REDUCE(2)
12601 CONTINUE
12602 CONTINUE
      DO 12611 I=1,4
      IF (LMARG(I)) MARGIN(I)=MARGIN(I)*REDUCE(2)
      WINDOW(I)=WINDOW(I)*REDUCE(2)
12611 CONTINUE
12612 CONTINUE
      TITX=SCREEN(1)*0.1
      TITY=SCREEN(2) * 0.9
      TITZ=0
      DO 12621 I=1,2
      WINLIM(I,1)=0
      WINLIM(I,2)=SCREEN(I)
      DO 12631 J=1,2
      XYPART(J,I)=1
12631 CONTINUE
12632 CONTINUE
12621 CONTINUE
12622 CONTINUE
      FLAGS(74)=.false.
      FLAGS(93)=.TRUE.
      ENDIF
      END
      SUBROUTINE T2_SET_AXIS(INFOIN,CARDIN)
      IMPLICIT NONE
      INTEGER INFOIN(10)
      CHARACTER*(*) CARDIN
      COMMON /T2FLGC/ FLAGS(200), LTRAP,LHANDL,LSYERR,LSCREV
      LOGICAL FLAGS, LTRAP,LHANDL,LSYERR,LSCREV(3)
      INTEGER RELFLAG 
      PARAMETER (RELFLAG=151)
      INTEGER IWINLEV 
      INTEGER NWINLEV , MAX_FILL 
      PARAMETER (NWINLEV =4)
      PARAMETER (MAX_FILL=4)
      REAL GRDSYM, GRDSIZ, DATDAT(2,8), H2STAT(12), TITLIN(4), TITFA
     *C(4), TITLOC(4), TITMAR(4), TITLMX(4), TIKFAC, TITINX, TITX1, TIT
     *Y1, TITX, TITY, TITZ, TITSIZ, TITCON(5), REVLEV, REDUCE(5), XFR
     *M12(12), XFRM13(12), XFRM14(12), XFRM23(12), XFRM24(12), XFRM34(6
     *), XVARSX(20), CIRSIZ(2,3), ASIZE, AFLARE, SMSZDF, ORAXES(3), EY
     *EDIR(3), VUEDIR(3), VUECEN(3), VERTCL(3), EYESEP, SCRD, SCRZ, EYE
     *DIS, EYEPNT(3), XYPART(2, 2), BARSIZ(3), BARBRK(3), TIKSIZ(3), XY
     *ZBAS(3), TTHETA, TPHI, FRELBL(4), PATRN(20,30), SCLPRM(10,3), WI
     *NDOW(4), SCREEN(2), SYMBOL, NOSYMB, FACTXY(19), LBLSIZ, SYMSIZ, X
     *YZLIM(3,2), WORLD(3), RADRMX, RADRMN, RADAMN, RADANG, RADX0, RADY
     *0, XUNUSD(6), AXANG(3), REDFAC, DSCAL, PATSZ, MARGIN(4), PSCR(2
     *), OREAL, OCPU, CSCRD, DATPTS, ERRPTS, DATXMN, DATXMX, DATYMN, DA
     *TYMX, DATZMN, DATZMX, DATSUM, ERRSUM, DATAVE, ERRAVE, DATCEN, ERR
     *CEN, DATSTD, ERRSTD, WINREL(2,2,NWINLEV),WINABS(2,2,NWINLEV),WINL
     *IM(2,2), FMARKER(3,8), SYDIR(3), GRDIR(3), EXYZLIM(3,2), DSLOPE(2
     *,2)
      REAL PLOT_EXTENT(2,2),FILL_ANGLE(MAX_FILL),FILL_WIDTH(MAX_FILL)
      INTEGER FILL_INDEX, FILL_TEX(MAX_FILL), N_LINES(6)
      EQUIVALENCE (DATDAT, DATPTS)
      INTEGER MAXREP
      PARAMETER (MAXREP=5)
      INTEGER IPATRN, NPATRN(30), NXYLIM(3,2), NPLOTS, NCSETS, NCCOL, N
     *CROW, IYEAR, IMONTH, IDAY, ISIGFG, ITXPRI, ITXSEC, ITITDT(3), L
     *ENCRD, IPROP, IHTEX, IBLINK, IERASE, ITCNTR, IUNUSD, NXYZ1(3), 
     *NXYZ2(3), LBLFMT(3), LBLCHR(3), NDIMNS(3), IBLKTP, IDIMNS, NMES
     *H0, NMESH1, NMESH2, MESH1, MESH2, MESH3, MESH2D, MESHN(3), NMESHN(
     *2), NFIELD, IFIELD(19), NINCR, NPOINT, IVARBL(19), IVPTR(19), I_
     *VORDER(19,2), LINEAR(4), NONLIN(4), MXECHO, LINES, MAXLNS, USRK
     *BD, USRSCR, PLTFIL, LINWID, LINCOL, LINTEX, ICPOIN(3), IREPCT(MA
     *XREP), LEVREP, GRDTYP, GRDTEX, OUTTEX, IAXTEX, TITEX, LETSET, LAB
     *TEX, TICTEX, SHADOWTYP,SHADOWTEX, NXYZDEF1(10), NXYZDEF2(10), IF
     *ILE_CASE ,MAX_SUBST
      INTEGER MAX_CYCLE
      PARAMETER (MAX_CYCLE=20)
      INTEGER N_CYCLE, ITX_CYCLE(MAX_CYCLE)
      REAL SYM_CYCLE(MAX_CYCLE)
      EQUIVALENCE (NMESH1,NMESHN)
      EQUIVALENCE (MESH1,MESHN)
      INTEGER IBUFFR(400)
      REAL BUFFER(400)
      INTEGER NCHSAVE 
      PARAMETER (NCHSAVE=2*512) 
      INTEGER*4 ICHSAVE(NCHSAVE)
      INTEGER*4 IVRPTR(15)
      CHARACTER*512 OUTSTR,C_FILE, C_NAME, C_SELECT
      CHARACTER C_TIT_ESCAPE*1,C_TIT_SUBSTITUTE*2
      INTEGER N_FILE, N_NAME, N_SELECT
      CHARACTER*8 PXNAME
      CHARACTER*64 INPFMT
      LOGICAL LTDATA, OUTSID(4)
      COMMON /T2COM/ PXNAME, REDUCE, TITX, TITY ,XFRM12, XFRM13, XFRM1
     *4, XFRM23 ,XFRM24, XFRM34 ,XVARSX ,TITSIZ, GRDSYM, GRDSIZ, CIRS
     *IZ, ASIZE, AFLARE ,SMSZDF, ORAXES, EYEDIR, VUEDIR, VUECEN ,VERTC
     *L, EYESEP, SCRD, SCRZ, EYEDIS, EYEPNT ,XYPART, BARSIZ, TIKSIZ, XY
     *ZBAS, TTHETA ,TPHI, FRELBL, IPATRN, NPATRN, PATRN ,SCLPRM, WINDO
     *W, SCREEN, SYMBOL, NOSYMB ,FACTXY, LBLSIZ, SYMSIZ, XYZLIM, WORLD 
     *,RADRMX, RADRMN, RADAMN, RADANG, RADX0, RADY0, XUNUSD ,USRKBD, U
     *SRSCR, PLTFIL ,ITITDT, LENCRD ,INPFMT, GRDTYP, LINWID, LINCOL, L
     *INTEX, TITCON, ITCNTR ,IUNUSD, NXYZ1, NXYZ2 ,LBLCHR, NDIMNS, IBL
     *KTP, IDIMNS ,NMESH1, NMESH2, MESH1, MESH2, MESH3, NFIELD ,IFIELD
     *, NINCR ,IVARBL, IVRPTR ,LINEAR, NONLIN ,NPOINT, LETSET ,MXECH
     *O, LINES, MAXLNS ,AXANG, MESH2D, REDFAC, GRDTEX, OUTTEX, IAXTEX, 
     *TITEX, DSCAL ,OUTSTR, IPROP, IHTEX, IBLINK, IERASE, LABTEX, TICTE
     *X, NXYLIM, PATSZ ,MARGIN, PSCR, ITXPRI, ITXSEC, OREAL, OCPU, CSCR
     *D, OUTSID ,TITLIN, TITINX, TITZ, TITX1, TITY1, LTDATA, NPLOTS, RE
     *VLEV ,LBLFMT, IYEAR, IMONTH, IDAY, ISIGFG ,DATPTS, ERRPTS, DATXM
     *N, DATXMX, DATYMN, DATYMX, DATZMN, DATZMX ,DATSUM, ERRSUM, DATAVE
     *, ERRAVE, DATCEN, ERRCEN, DATSTD, ERRSTD ,NCSETS, NCCOL, NCROW, F
     *MARKER, H2STAT, TITFAC, TITLOC, TITMAR ,TIKFAC, IWINLEV, WINREL, 
     *WINABS, WINLIM ,ICPOIN, LEVREP, IREPCT, SYDIR, GRDIR, NMESH0, EXY
     *ZLIM, IVPTR ,TITLMX, NXYZDEF1, NXYZDEF2, IFILE_CASE, N_CYCLE, ITX
     *_CYCLE ,SYM_CYCLE, PLOT_EXTENT, FILL_ANGLE, FILL_WIDTH, FILL_TEX 
     *,FILL_INDEX ,N_LINES ,DSLOPE ,MAX_SUBST, BARBRK ,I_VORDER,SHADOW
     *TYP,SHADOWTEX
      COMMON /T2SCRT/ BUFFER, IBUFFR, N_FILE,N_NAME,N_SELECT, ICHSAVE
      COMMON /T2_CHAR/ C_TIT_ESCAPE,C_TIT_SUBSTITUTE
      COMMON /T2_SCRT/ C_FILE, C_NAME, C_SELECT
      INTEGER JOUFIL, ERRFIL, OUTFIL, DBGFIL, INPFIL, NINMAX
      PARAMETER (NINMAX=20)
      INTEGER NINP(NINMAX)
      COMMON /T2TRBK/NINP, JOUFIL, ERRFIL, OUTFIL, DBGFIL, INPFIL
      CHARACTER*512 STRNG, STJOU
      LOGICAL LTOKEN
      REAL FLOTNG
      INTEGER INTERP, KEYORD, NSTRNG, MAXSTR, NSTJOU, LSTJOU, NTOKEN
      INTEGER*4 INTEG
      COMMON /TOKENC/ INTERP, INTEG, FLOTNG, KEYORD, NSTRNG, MAXSTR, ST
     *RNG, NSTJOU, LSTJOU, STJOU, LTOKEN, NTOKEN
      LOGICAL DFLAGS(200),DSCREV(3)
      COMMON /T2FLGD/DFLAGS,DSCREV
      REAL DTITLIN(4), DTITFAC(4), DTITMAR(4)
      INTEGER DGRDTYP, DGRDTEX, DOUTTEX, IDAXTEX, DTITEX, DSHADOWTYP,DS
     *HADOWTEX, IFLDDF(19), NDDIMNS, IDTXPRI, IDTXSEC, LINCLF, LINTXF,
     * LINWDF, DNONLN(3), DNXYZ1(3), DNXYZ2(3), DLABTEX, DTICTEX, DNPAT
     *RN(30), DLBLCHR(3), ND_CYCLE, IDTX_CYCLE(MAX_CYCLE)
      REAL DSYM_CYCLE(MAX_CYCLE)
      REAL DTITSIZ, DGRDSYM, DGRDSIZ, DCIRSIZ(2,3), DASIZE, DAFLARE, D
     *SMSZDF, DORAXES(3), DEYEDIR(3), DVUEDIR(3), DVUECEN(3), DVERTCL(3
     *), DEYESEP, DSCRD, DSCRZ, DEYEDIS, DEYEPNT(3), DBARSIZ(3), DBARBR
     *K(3), DTIKSIZ(3), DXYZBS(3), DTTHETA, DTPHI, DFRELBL(4), DPATRN(2
     *0,30), DSCLPRM(10,3), DWINDOW(4), DSCREEN(2), DSYMBOL, DNOSYMB, 
     *DAXANG(3), DLBLSIZ, DSYMSIZ, DXYZLIM(3,2), DFACTXY(19), DRADANG,
     * DDSCAL, DPATSZ, DTITINX, DTIKFAC, DSYDIR(3), DGRDIR(3)
      COMMON /T2COMD/ DTITSIZ, DGRDSYM, DGRDSIZ, DCIRSIZ, DASIZE, DAFLA
     *RE, DSMSZDF, DORAXES, DEYEDIR, DVUEDIR, DVUECEN, DVERTCL, DEYESE
     *P, DSCRD, DSCRZ, DEYEDIS, DEYEPNT, DBARSIZ, DTIKSIZ, DXYZBS, DTTH
     *ETA, DTPHI, DFRELBL, DNPATRN, DPATRN, DSCLPRM, DWINDOW, DSCREEN,
     * DSYMBOL, DNOSYMB, DAXANG, DLBLSIZ, DSYMSIZ, DXYZLIM, DGRDTYP, D
     *FACTXY, IFLDDF, NDDIMNS, DGRDTEX, DOUTTEX, IDAXTEX, DTITEX, DRADA
     *NG, DDSCAL, DNONLN, DNXYZ1, DNXYZ2, LINCLF, LINTXF, LINWDF, DLABT
     *EX, DTICTEX, DPATSZ, IDTXPRI, IDTXSEC, DTITLIN, DTITINX, DLBLCHR,
     * DTITFAC, DTITMAR, DTIKFAC, DSYDIR, DGRDIR, ND_CYCLE, IDTX_CYCLE,
     * DSYM_CYCLE, DBARBRK,  DSHADOWTYP,DSHADOWTEX
      LOGICAL LLLL,LSET
      INTEGER I,ITXTUR,IFLAG
      INTEGER IAND
      ITXTUR=0
      IPATRN=2
      IAXTEX=MOD(IAXTEX,4096)+4096*IPATRN
      IFLAG=1
      FLAGS(2)=.false.
      FLAGS(3)=.false.
      LSET=.FALSE.
      GOTO 12641
12670 CONTINUE
      LSET=.true.
      FLAGS(3)=INTEG.eq.1
      FLAGS(2)=FLAGS(3)
      GOTO 12641
12680 CONTINUE
      LSET=.true.
      FLAGS(132+INTEG)=LTOKEN
      GOTO 12641
12690 CONTINUE
      LSET=.TRUE.
      LLLL=INTEG.EQ.0
12700 GOTO (12710,12720,12730,12740,12750,12760,12770,12780),IFLAG
12710 CONTINUE
      DO 12791 I=19,22
      FLAGS(I)=LLLL
12791 CONTINUE
12792 CONTINUE
      DO 12801 I=50,52
      FLAGS(I)=LLLL
12801 CONTINUE
12802 CONTINUE
      GOTO 12702
12750 CONTINUE
      FLAGS(19)=LLLL
      FLAGS(51)=.TRUE.
      GOTO 12702
12760 CONTINUE
      FLAGS(20)=LLLL
      FLAGS(50)=.TRUE.
      GOTO 12702
12770 CONTINUE
      FLAGS(21)=LLLL
      FLAGS(51)=.TRUE.
      GOTO 12702
12780 CONTINUE
      FLAGS(22)=LLLL
      FLAGS(50)=.TRUE.
      GOTO 12702
12720 CONTINUE
      FLAGS(20)=LLLL
      FLAGS(22)=LLLL
      FLAGS(50)=LLLL
      GOTO 12702
12730 CONTINUE
      FLAGS(19)=LLLL
      FLAGS(21)=LLLL
      FLAGS(51)=LLLL
      GOTO 12702
12740 CONTINUE
      FLAGS(52)=LLLL
      GOTO 12702
12702 CONTINUE
      GOTO 12641
12810 CONTINUE
      IFLAG=INTEG
      LSET=.TRUE.
      GOTO 12641
12820 CONTINUE
      DO 12831 I=19,22
      DFLAGS(I)=FLAGS(I)
12831 CONTINUE
12832 CONTINUE
      DO 12841 I=50,52
      DFLAGS(I)=FLAGS(I)
12841 CONTINUE
12842 CONTINUE
      DO 12851 I=0,1
      DFLAGS(I+2)=FLAGS(I+2)
12851 CONTINUE
12852 CONTINUE
      DO 12861 I=0,2
      DFLAGS(I+132)=FLAGS(I+132)
12861 CONTINUE
12862 CONTINUE
      IDAXTEX=IAXTEX
      LSET=.TRUE.
      GOTO 12641
12870 CONTINUE
      IAXTEX=IAND(NOT(512*7),IAXTEX)+INTEG*512
      LSET=.TRUE.
      GOTO 12641
12880 CONTINUE
      CALL T2GTEX(ITXTUR)
      LSET=.TRUE.
      IAXTEX=IAND(NOT(64*7),IAXTEX)+ITXTUR*64
      GOTO 12641
12890 CONTINUE
      LSET=.TRUE.
      IAXTEX=IAND(NOT(8*7),IAXTEX)+INTEG*8
      GOTO 12641
12641 CALL TOKEN(INFOIN,CARDIN,'INHIBIT:1,ENABLE:0,FRONT:0Y,BOTH:1Y,THRE
     *E:2Y,OFF:1,ON,ALL:1,X:2,Y:3,Z:4,LEFT:5,BOTTOM:6,RIGHT:7,TOP:8,PERM
     *ANENT,NOCOLOR:0,WHITE:1,RED:2,GREEN:3,BLUE:4,YELLOW:5,MAGENTA:6,CY
     *AN:7,NOTEXTURE:0,DO:1,DOT:1,DOTS:1,DOTTED:1,DA:2,DASHES:2,DASHED:2
     *,SOLID:4,DOTDASHED:3,DOT-DASH:3,FUNNY:5,DAASHES:7,SPACE:8,PATTERNE
     *D:6,INTENSITY:0:9:0,WIDTH:0:9:0,BLACK:8,;')
      GOTO (12642,12647,12645,12645,12645,12645,12641,12647, 12645),INTE
     *RP
12645 CALL T2ERR(INFOIN,CARDIN,' ',5)
      GOTO 12641
12647 GOTO ( 12670,12670,12680,12680,12680,12690,12690,12810,12810,12810
     *,12810,12810,12810,12810,12810,12820,12870,12870,12870,12870,12870
     *,12870,12870,12870,12880,12880,12880,12880,12880,12880,12880,12880
     *,12880,12880,12880,12880,12880,12880,12880,12890,12890,12870,12645
     *),KEYORD
12642 CONTINUE
      IF(.NOT.LSET.AND..NOT.FLAGS(23)) THEN
      IAXTEX=256
      DO 12901 I=19,22
      FLAGS(I)=.TRUE.
12901 CONTINUE
12902 CONTINUE
      DO 12911 I=50,52
      FLAGS(I)=.TRUE.
12911 CONTINUE
12912 CONTINUE
      DO 12921 I=0,2
      FLAGS(132+I)=.false.
12921 CONTINUE
12922 CONTINUE
      ENDIF
      END
      SUBROUTINE T2_SET_WINDOW(INFOIN,CARDIN)
      IMPLICIT NONE
      INTEGER INFOIN(10)
      CHARACTER*(*) CARDIN
      COMMON /T2FLGC/ FLAGS(200), LTRAP,LHANDL,LSYERR,LSCREV
      LOGICAL FLAGS, LTRAP,LHANDL,LSYERR,LSCREV(3)
      INTEGER RELFLAG 
      PARAMETER (RELFLAG=151)
      INTEGER IWINLEV 
      INTEGER NWINLEV , MAX_FILL 
      PARAMETER (NWINLEV =4)
      PARAMETER (MAX_FILL=4)
      REAL GRDSYM, GRDSIZ, DATDAT(2,8), H2STAT(12), TITLIN(4), TITFA
     *C(4), TITLOC(4), TITMAR(4), TITLMX(4), TIKFAC, TITINX, TITX1, TIT
     *Y1, TITX, TITY, TITZ, TITSIZ, TITCON(5), REVLEV, REDUCE(5), XFR
     *M12(12), XFRM13(12), XFRM14(12), XFRM23(12), XFRM24(12), XFRM34(6
     *), XVARSX(20), CIRSIZ(2,3), ASIZE, AFLARE, SMSZDF, ORAXES(3), EY
     *EDIR(3), VUEDIR(3), VUECEN(3), VERTCL(3), EYESEP, SCRD, SCRZ, EYE
     *DIS, EYEPNT(3), XYPART(2, 2), BARSIZ(3), BARBRK(3), TIKSIZ(3), XY
     *ZBAS(3), TTHETA, TPHI, FRELBL(4), PATRN(20,30), SCLPRM(10,3), WI
     *NDOW(4), SCREEN(2), SYMBOL, NOSYMB, FACTXY(19), LBLSIZ, SYMSIZ, X
     *YZLIM(3,2), WORLD(3), RADRMX, RADRMN, RADAMN, RADANG, RADX0, RADY
     *0, XUNUSD(6), AXANG(3), REDFAC, DSCAL, PATSZ, MARGIN(4), PSCR(2
     *), OREAL, OCPU, CSCRD, DATPTS, ERRPTS, DATXMN, DATXMX, DATYMN, DA
     *TYMX, DATZMN, DATZMX, DATSUM, ERRSUM, DATAVE, ERRAVE, DATCEN, ERR
     *CEN, DATSTD, ERRSTD, WINREL(2,2,NWINLEV),WINABS(2,2,NWINLEV),WINL
     *IM(2,2), FMARKER(3,8), SYDIR(3), GRDIR(3), EXYZLIM(3,2), DSLOPE(2
     *,2)
      REAL PLOT_EXTENT(2,2),FILL_ANGLE(MAX_FILL),FILL_WIDTH(MAX_FILL)
      INTEGER FILL_INDEX, FILL_TEX(MAX_FILL), N_LINES(6)
      EQUIVALENCE (DATDAT, DATPTS)
      INTEGER MAXREP
      PARAMETER (MAXREP=5)
      INTEGER IPATRN, NPATRN(30), NXYLIM(3,2), NPLOTS, NCSETS, NCCOL, N
     *CROW, IYEAR, IMONTH, IDAY, ISIGFG, ITXPRI, ITXSEC, ITITDT(3), L
     *ENCRD, IPROP, IHTEX, IBLINK, IERASE, ITCNTR, IUNUSD, NXYZ1(3), 
     *NXYZ2(3), LBLFMT(3), LBLCHR(3), NDIMNS(3), IBLKTP, IDIMNS, NMES
     *H0, NMESH1, NMESH2, MESH1, MESH2, MESH3, MESH2D, MESHN(3), NMESHN(
     *2), NFIELD, IFIELD(19), NINCR, NPOINT, IVARBL(19), IVPTR(19), I_
     *VORDER(19,2), LINEAR(4), NONLIN(4), MXECHO, LINES, MAXLNS, USRK
     *BD, USRSCR, PLTFIL, LINWID, LINCOL, LINTEX, ICPOIN(3), IREPCT(MA
     *XREP), LEVREP, GRDTYP, GRDTEX, OUTTEX, IAXTEX, TITEX, LETSET, LAB
     *TEX, TICTEX, SHADOWTYP,SHADOWTEX, NXYZDEF1(10), NXYZDEF2(10), IF
     *ILE_CASE ,MAX_SUBST
      INTEGER MAX_CYCLE
      PARAMETER (MAX_CYCLE=20)
      INTEGER N_CYCLE, ITX_CYCLE(MAX_CYCLE)
      REAL SYM_CYCLE(MAX_CYCLE)
      EQUIVALENCE (NMESH1,NMESHN)
      EQUIVALENCE (MESH1,MESHN)
      INTEGER IBUFFR(400)
      REAL BUFFER(400)
      INTEGER NCHSAVE 
      PARAMETER (NCHSAVE=2*512) 
      INTEGER*4 ICHSAVE(NCHSAVE)
      INTEGER*4 IVRPTR(15)
      CHARACTER*512 OUTSTR,C_FILE, C_NAME, C_SELECT
      CHARACTER C_TIT_ESCAPE*1,C_TIT_SUBSTITUTE*2
      INTEGER N_FILE, N_NAME, N_SELECT
      CHARACTER*8 PXNAME
      CHARACTER*64 INPFMT
      LOGICAL LTDATA, OUTSID(4)
      COMMON /T2COM/ PXNAME, REDUCE, TITX, TITY ,XFRM12, XFRM13, XFRM1
     *4, XFRM23 ,XFRM24, XFRM34 ,XVARSX ,TITSIZ, GRDSYM, GRDSIZ, CIRS
     *IZ, ASIZE, AFLARE ,SMSZDF, ORAXES, EYEDIR, VUEDIR, VUECEN ,VERTC
     *L, EYESEP, SCRD, SCRZ, EYEDIS, EYEPNT ,XYPART, BARSIZ, TIKSIZ, XY
     *ZBAS, TTHETA ,TPHI, FRELBL, IPATRN, NPATRN, PATRN ,SCLPRM, WINDO
     *W, SCREEN, SYMBOL, NOSYMB ,FACTXY, LBLSIZ, SYMSIZ, XYZLIM, WORLD 
     *,RADRMX, RADRMN, RADAMN, RADANG, RADX0, RADY0, XUNUSD ,USRKBD, U
     *SRSCR, PLTFIL ,ITITDT, LENCRD ,INPFMT, GRDTYP, LINWID, LINCOL, L
     *INTEX, TITCON, ITCNTR ,IUNUSD, NXYZ1, NXYZ2 ,LBLCHR, NDIMNS, IBL
     *KTP, IDIMNS ,NMESH1, NMESH2, MESH1, MESH2, MESH3, NFIELD ,IFIELD
     *, NINCR ,IVARBL, IVRPTR ,LINEAR, NONLIN ,NPOINT, LETSET ,MXECH
     *O, LINES, MAXLNS ,AXANG, MESH2D, REDFAC, GRDTEX, OUTTEX, IAXTEX, 
     *TITEX, DSCAL ,OUTSTR, IPROP, IHTEX, IBLINK, IERASE, LABTEX, TICTE
     *X, NXYLIM, PATSZ ,MARGIN, PSCR, ITXPRI, ITXSEC, OREAL, OCPU, CSCR
     *D, OUTSID ,TITLIN, TITINX, TITZ, TITX1, TITY1, LTDATA, NPLOTS, RE
     *VLEV ,LBLFMT, IYEAR, IMONTH, IDAY, ISIGFG ,DATPTS, ERRPTS, DATXM
     *N, DATXMX, DATYMN, DATYMX, DATZMN, DATZMX ,DATSUM, ERRSUM, DATAVE
     *, ERRAVE, DATCEN, ERRCEN, DATSTD, ERRSTD ,NCSETS, NCCOL, NCROW, F
     *MARKER, H2STAT, TITFAC, TITLOC, TITMAR ,TIKFAC, IWINLEV, WINREL, 
     *WINABS, WINLIM ,ICPOIN, LEVREP, IREPCT, SYDIR, GRDIR, NMESH0, EXY
     *ZLIM, IVPTR ,TITLMX, NXYZDEF1, NXYZDEF2, IFILE_CASE, N_CYCLE, ITX
     *_CYCLE ,SYM_CYCLE, PLOT_EXTENT, FILL_ANGLE, FILL_WIDTH, FILL_TEX 
     *,FILL_INDEX ,N_LINES ,DSLOPE ,MAX_SUBST, BARBRK ,I_VORDER,SHADOW
     *TYP,SHADOWTEX
      COMMON /T2SCRT/ BUFFER, IBUFFR, N_FILE,N_NAME,N_SELECT, ICHSAVE
      COMMON /T2_CHAR/ C_TIT_ESCAPE,C_TIT_SUBSTITUTE
      COMMON /T2_SCRT/ C_FILE, C_NAME, C_SELECT
      INTEGER JOUFIL, ERRFIL, OUTFIL, DBGFIL, INPFIL, NINMAX
      PARAMETER (NINMAX=20)
      INTEGER NINP(NINMAX)
      COMMON /T2TRBK/NINP, JOUFIL, ERRFIL, OUTFIL, DBGFIL, INPFIL
      CHARACTER*512 STRNG, STJOU
      LOGICAL LTOKEN
      REAL FLOTNG
      INTEGER INTERP, KEYORD, NSTRNG, MAXSTR, NSTJOU, LSTJOU, NTOKEN
      INTEGER*4 INTEG
      COMMON /TOKENC/ INTERP, INTEG, FLOTNG, KEYORD, NSTRNG, MAXSTR, ST
     *RNG, NSTJOU, LSTJOU, STJOU, LTOKEN, NTOKEN
      LOGICAL DFLAGS(200),DSCREV(3)
      COMMON /T2FLGD/DFLAGS,DSCREV
      REAL DTITLIN(4), DTITFAC(4), DTITMAR(4)
      INTEGER DGRDTYP, DGRDTEX, DOUTTEX, IDAXTEX, DTITEX, DSHADOWTYP,DS
     *HADOWTEX, IFLDDF(19), NDDIMNS, IDTXPRI, IDTXSEC, LINCLF, LINTXF,
     * LINWDF, DNONLN(3), DNXYZ1(3), DNXYZ2(3), DLABTEX, DTICTEX, DNPAT
     *RN(30), DLBLCHR(3), ND_CYCLE, IDTX_CYCLE(MAX_CYCLE)
      REAL DSYM_CYCLE(MAX_CYCLE)
      REAL DTITSIZ, DGRDSYM, DGRDSIZ, DCIRSIZ(2,3), DASIZE, DAFLARE, D
     *SMSZDF, DORAXES(3), DEYEDIR(3), DVUEDIR(3), DVUECEN(3), DVERTCL(3
     *), DEYESEP, DSCRD, DSCRZ, DEYEDIS, DEYEPNT(3), DBARSIZ(3), DBARBR
     *K(3), DTIKSIZ(3), DXYZBS(3), DTTHETA, DTPHI, DFRELBL(4), DPATRN(2
     *0,30), DSCLPRM(10,3), DWINDOW(4), DSCREEN(2), DSYMBOL, DNOSYMB, 
     *DAXANG(3), DLBLSIZ, DSYMSIZ, DXYZLIM(3,2), DFACTXY(19), DRADANG,
     * DDSCAL, DPATSZ, DTITINX, DTIKFAC, DSYDIR(3), DGRDIR(3)
      COMMON /T2COMD/ DTITSIZ, DGRDSYM, DGRDSIZ, DCIRSIZ, DASIZE, DAFLA
     *RE, DSMSZDF, DORAXES, DEYEDIR, DVUEDIR, DVUECEN, DVERTCL, DEYESE
     *P, DSCRD, DSCRZ, DEYEDIS, DEYEPNT, DBARSIZ, DTIKSIZ, DXYZBS, DTTH
     *ETA, DTPHI, DFRELBL, DNPATRN, DPATRN, DSCLPRM, DWINDOW, DSCREEN,
     * DSYMBOL, DNOSYMB, DAXANG, DLBLSIZ, DSYMSIZ, DXYZLIM, DGRDTYP, D
     *FACTXY, IFLDDF, NDDIMNS, DGRDTEX, DOUTTEX, IDAXTEX, DTITEX, DRADA
     *NG, DDSCAL, DNONLN, DNXYZ1, DNXYZ2, LINCLF, LINTXF, LINWDF, DLABT
     *EX, DTICTEX, DPATSZ, IDTXPRI, IDTXSEC, DTITLIN, DTITINX, DLBLCHR,
     * DTITFAC, DTITMAR, DTIKFAC, DSYDIR, DGRDIR, ND_CYCLE, IDTX_CYCLE,
     * DSYM_CYCLE, DBARBRK,  DSHADOWTYP,DSHADOWTEX
      LOGICAL F1,F2,LSET(2,2),LWERR
      REAL XYZ0(3),XYZ1(3),XYZ2(3),XYZ3(3),XYWIN(2,2),XYSAVE(2,2)
      REAL XYWLIM(2,2),TEMP1,TEMP2,T,XMAX,YMAX
      INTEGER IXY,IFRTO,I,J,K,ILEV,I2OF,NXY,NFRTO,IMIN
      LOGICAL LXY,LXYS
      IF (.NOT.FLAGS(73)) CALL TXDEF1
      IF (.not.FLAGS(74)) THEN
      CALL TXDEFW
      FLAGS(74)=.false.
      ENDIF
      ILEV=IWINLEV
      DO 12931 I=1,2
      DO 12941 J=1,2
      XYWIN(J,I)=WINDOW(2*(I-1)+J)
      XYSAVE(J,I)=XYPART(J,I)
      WINABS(J,I,ILEV)=XYWIN(J,I)
      LSET(J,I)=.false.
12941 CONTINUE
12942 CONTINUE
12931 CONTINUE
12932 CONTINUE
      LWERR=.FALSE.
      I2OF=0
      IXY=1
      IFRTO=1
      NXY=0
      NFRTO=0
      LXY=.false.
      LXYS=.false.
      GOTO 12951
12960 CONTINUE
      GOTO 12970
13000 CONTINUE
      ILEV=IWINLEV+INTEG
      GOTO 13010
13020 CONTINUE
      ILEV=INTEG
13010 CONTINUE
      IF (INTEG.gt.MIN(IWINLEV+1,NWINLEV)) THEN
      CALL T2ERR(INFOIN,CARDIN,('*** ERROR *** Level too large'),4)
      RETURN
      ENDIF
      IF (ILEV.gt.IWINLEV) THEN
      DO 13031 I=1,2
      DO 13041 J=1,2
      WINREL(J,I,ILEV)=1.
13041 CONTINUE
13042 CONTINUE
13031 CONTINUE
13032 CONTINUE
      ENDIF
      GOTO 12951
13050 CONTINUE
12970 CONTINUE
      IF (LXY.or.LXYS) GOTO 13060
      INFOIN(9)=-1
      I2OF=-2
      NFRTO=1
      XYSAVE(1,2)=MAX(1,INT(ABS(XYPART(1,2))))*  MAX(1,INT(ABS(XYPART(2,
     *2))))
      XYSAVE(1,1)=MAX(1,INT(ABS(XYPART(1,1))))+  (MAX(1,INT(ABS(XYPART(2
     *,1))))-1)*  MAX(1,INT(ABS(XYPART(1,2))))
      DO 13071 I=1,2
      LSET(2,I)=.true.
      XYSAVE(2,I)=1.0
13071 CONTINUE
13072 CONTINUE
      GOTO 13080
13090 CONTINUE
      IF (LXYS) GOTO 13060
      IF (JOUFIL.ne.0) NSTJOU=LSTJOU
      NONLIN(4)=0
      LXY=.true.
      DO 13101 I=1,2
      J=0
      CALL T2CURS(J,XYZ0,XYWIN(1,I),XYZ2,F1,F2)
      LXY=LXY.and.J.eq.ICHAR(' ') .and. F1
      IF(.not.LXY)GOTO 13102
13101 CONTINUE
13102 CONTINUE
      IF (LXY) THEN
      I=48
      IF( LSTJOU+I.le.LEN(STJOU).and.JOUFIL.ne.0) THEN
      WRITE(STJOU(LSTJOU+1:LSTJOU+I),'(1p,4(A,G10.3))', ERR=13110)  ' X=
     *',XYWIN(1,1),' ',XYWIN(1,2), ' Y=',XYWIN(2,1),' ',XYWIN(2,2)
      CALL T2SQEZ(STJOU(LSTJOU+2:LSTJOU+I),I)
      NSTJOU=LSTJOU+I+1
13110 CONTINUE
      ENDIF
      NXY=1
      LXYS=.true.
      DO 13121 I=1,2
      DO 13131 J=1,2
      XYSAVE(J,I)=0
      LSET(J,I)=.true.
13131 CONTINUE
13132 CONTINUE
13121 CONTINUE
13122 CONTINUE
      ENDIF
      NONLIN(4)=1
      GOTO 12951
13140 CONTINUE
      LBLCHR(2)=FLOTNG
      GOTO 12951
13150 CONTINUE
      IF (LXY.or.LXYS) GOTO 13060
      LXY=.true.
      IFRTO=MOD(INTEG,10)
      NFRTO=0
      IXY=1
      NXY=1
      I2OF=INTEG
      GOTO 13080
13160 CONTINUE
      IF (NXY.gt.0) GOTO 13170
      LXY=.true.
      IFRTO=1
      NFRTO=1
      IXY=INTEG
      NXY=0
      I2OF=0
13080 CONTINUE
      IF (LSET(IXY,IFRTO)) THEN
13060 CONTINUE
      CALL T2ERR(INFOIN,CARDIN,('*** ERROR *** Redundant options'),4)
      RETURN
      ENDIF
      GOTO 13181
13210 CONTINUE
      XYSAVE(IXY,1)=XYSAVE(IXY,1)+SIGN(FLOTNG,XYSAVE(IXY,1))
      GOTO 13220
13230 CONTINUE
      XYSAVE(IXY,1)=FLOTNG*(INT(XYSAVE(IXY,2))-1)+  MOD(XYSAVE(IXY,1),1.
     *0)+1
13220 CONTINUE
      IF (I2OF.gt.0.or.IFRTO.gt.1) GOTO 13170
      I2OF=-2
      IF (LSET(IXY,1)) GOTO 13060
      LXYS=.true.
      LSET(IXY,1)=.true.
      GOTO 13240
13250 CONTINUE
      IF (I2OF*((I2OF-INTEG)/2) .ne. 0) THEN
13170 CONTINUE
      CALL T2ERR(INFOIN,CARDIN,('*** ERROR *** Conflicting options'),4)
      RETURN
      ELSE
      IF (NXY.eq.1) THEN
      IXY=1
      endif
      IFRTO=MOD(ABS(INTEG),10)
      I2OF=INTEG
      ENDIF
      GOTO 13181
13190 GOTO ( 13210,13210,13230,13230,13250,13250,13250,13250,13250,13185
     *),KEYORD
13260 CONTINUE
      IF (IXY.le.2.and.IFRTO.le.2) THEN
      IF (LSET(IXY,IFRTO)) GOTO 13060
      LSET(IXY,IFRTO)=.true.
      XYSAVE(IXY,IFRTO)=FLOTNG
      XYWIN(IXY,IFRTO)=FLOTNG
      IXY=IXY+NXY
      IFRTO=IFRTO+NFRTO
      ELSE
      CALL T2ERR(INFOIN,CARDIN,('*** ERROR *** Extra number'),4)
      RETURN
      ENDIF
      GOTO 13181
13185 CONTINUE
      INFOIN(9)=-1
      GOTO 13182
13181 CALL TOKEN(INFOIN,CARDIN,'NEXT:1,PREVIOUS:-1,FIRST:0,LAST:1,AT:11,
     *SIZE:12,FROM:1,TO:2,OF:-2,;')
      GOTO (13182,13190,13260,13260,13185,13185,13185,13190,13185),INTER
     *P
13182 CONTINUE
13240 CONTINUE
      IF (I2OF.eq.0) THEN
      IF (IFRTO.le.2) THEN
      I2OF=-2
      ELSE
      I2OF=1
      ENDIF
      ENDIF
      LXYS=.true.
      IMIN=IXY
      IF (NXY.eq.1) IMIN=1
      IF (I2OF.lt.0) THEN
      IF (LXY.and..not.LSET(IXY,2)) XYSAVE(IXY,2)=XYPART(IXY,2)
      LSET(IXY,2)=.true.
      ENDIF
      DO 13271 I=IMIN,IMIN+NXY
      DO 13281 J=1,2
      IF (.not.LSET(I,J)) THEN
      CALL T2ERR(INFOIN,CARDIN,('*** ERROR *** Missing (FROM or TO)'),4)
     *
      RETURN
      ENDIF
      IF (I2OF.gt.0) XYSAVE(I,J)=0
13281 CONTINUE
13282 CONTINUE
      IF (I2OF.ge.10) THEN
      T=XYWIN(I,2)/2
      XYWIN(I,2)=XYWIN(I,1)+T
      XYWIN(I,1)=XYWIN(I,1)-T
      ENDIF
13271 CONTINUE
13272 CONTINUE
      GOTO 12951
12980 GOTO ( 13000,13000,13020,13050,13050,13050,13050,13090,13140,13150
     *,13150,13150,13150,13160,13160,12955),KEYORD
12951 CALL TOKEN(INFOIN,CARDIN,'INSIDE:1,OUTSIDE:-1,LEVEL:1::1,FIRST,NEX
     *T,LAST,PREVIOUS,CURSOR,CHARACTERS:-20:20:6,AT:11,SIZE:12,FROM:1,TO
     *:2,X:1,Y:2,;')
      GOTO (12952,12980,12960,12960,12955,12955,12955,12980,12955),INTER
     *P
12955 CALL T2ERR(INFOIN,CARDIN,' ',5)
      GOTO 12951
12952 CONTINUE
      DO 13291 I=1,2
      XYWLIM(I,1)=0
      XYWLIM(I,2)=SCREEN(I)
      IF (ILEV.gt.1) THEN
      XYWLIM(I,1)=WINABS(I,1,ILEV-1)
      XYWLIM(I,2)=WINABS(I,2,ILEV-1)-XYWLIM(I,1)
      ENDIF
13291 CONTINUE
13292 CONTINUE
      IF (.not.LXY.and.LXYS) THEN
      LSET(1,1)=XYSAVE(1,1).lt.0
      TEMP1=NINT(ABS(XYSAVE(1,1)))
      IF (IFRTO.ge.3) then
      TEMP2=NINT(ABS(XYSAVE(1,2)))
      IF (TEMP2.lt.0.5) GOTO 13300
      T=SQRT(XYWLIM(1,2)*XYWLIM(2,2)/TEMP2 )
      I=NINT(XYWLIM(1,2)/T)
      J=NINT(XYWLIM(2,2)/T)
      I=MAX(1,I)
      J=MAX(1,J)
13311 CONTINUE
      IF(I*J.ge.TEMP2)GOTO 13312
      IF ( MOD(XYWLIM(1,2),T) .gt. MOD(XYWLIM(2,2),T) ) THEN
      I=I+1
      ELSE
      J=J+1
      ENDIF
      GOTO 13311
13312 CONTINUE
      T=SIGN(1.0,XYSAVE(1,2))
      XYSAVE(1,2)=I*T
      XYSAVE(2,2)=J*T
      DO 13321 I=1,2
      XYSAVE(I,1)=0
13321 CONTINUE
13322 CONTINUE
      ELSE
      DO 13331 I=1,2
      DO 13341 J=1,2
      XYSAVE(J,I)=XYPART(J,I)
13341 CONTINUE
13342 CONTINUE
13331 CONTINUE
13332 CONTINUE
      ENDIF
      XMAX=MAX(1,INT(ABS(XYSAVE(1,2))))
      YMAX=MAX(1,INT(ABS(XYSAVE(2,2))))
      LSET(2,1)=LSET(1,1)
      DO 13351 I=1,2
      LSET(I,1)=LSET(I,1).or.XYSAVE(I,2).lt.0
      XYSAVE(I,1)=1+MOD(ABS(XYSAVE(I,1)),1.)
13351 CONTINUE
13352 CONTINUE
      T=MIN(MAX(AINT(ABS(TEMP1)),1.),XMAX*YMAX)-1
      XYSAVE(1,1)=MOD(T,XMAX)+ABS(XYSAVE(1,1))
      XYSAVE(2,1)=AINT(T/XMAX)+XYSAVE(2,1)
      DO 13361 I=1,2
      T=1
      IF (LSET(I,1)) XYSAVE(I,1)=-XYSAVE(I,1)
13361 CONTINUE
13362 CONTINUE
      DO 13371 I=1,2
      DO 13381 J=1,2
      LSET(J,I)=.true.
13381 CONTINUE
13382 CONTINUE
13371 CONTINUE
13372 CONTINUE
      ENDIF
      DO 13391 IXY=1,2
      IF (.not.LSET(IXY,1)) THEN
      DO 13401 J=1,2
      XYWIN(IXY,J)=WINABS(IXY,J,ILEV)
      XYSAVE(IXY,J)=WINREL(IXY,J,ILEV)
13401 CONTINUE
13402 CONTINUE
      ENDIF
      IF (XYSAVE(IXY,1) .ne. 0) THEN
      DO 13411 J=1,2
      LWERR=LWERR.or. ABS(XYSAVE(IXY,J)) .lt. 0.5
13411 CONTINUE
13412 CONTINUE
      LWERR=ABS(XYSAVE(IXY,1)).gt.ABS(XYSAVE(IXY,2))+0.5
      ELSE
      IF (XYWIN(IXY,1).GT.XYWIN(IXY,2)) THEN
      T=XYWIN(IXY,1)
      XYWIN(IXY,1)=XYWIN(IXY,2)
      XYWIN(IXY,2)=T
      ENDIF
      LWERR=LWERR .or.  XYWIN(IXY,1).lt.0.0 .or.  XYWIN(IXY,2).gt.XYWLIM
     *(IXY,2) .or.  XYWIN(IXY,1).eq.XYWIN(IXY,2)
      ENDIF
13391 CONTINUE
13392 CONTINUE
      IF (LWERR) THEN
13300 CONTINUE
      WRITE(OUTSTR,13420)(XYWLIM(I,2),I=1,2)
      CALL T2ERR(INFOIN,CARDIN,OUTSTR,4)
13420 FORMAT ('*** ERROR *** Window must lie within ', 'limits (X 0.0 to
     *',f6.2,', Y 0.0 to',f6.2,')')
      RETURN
      ENDIF
      IWINLEV=ILEV
      DO 13431 I=1,2
      DO 13441 IXY=1,2
      WINLIM(IXY,I) =XYWLIM(IXY,I)
      XYPART(IXY,I) =XYSAVE(IXY,I)
      WINREL(IXY,I,ILEV)=XYSAVE(IXY,I)
      WINABS(IXY,I,ILEV)=XYWIN(IXY,I)
      WINDOW(IXY+2*(I-1))=XYWIN(IXY,I)
13441 CONTINUE
13442 CONTINUE
13431 CONTINUE
13432 CONTINUE
      DO 13451 I=5,10
      FLAGS(I)=FLAGS(I+60)
13451 CONTINUE
13452 CONTINUE
      FLAGS(2)=DFLAGS(2)
      FLAGS(3)=DFLAGS(3)
      FLAGS(74)=.FALSE.
      FLAGS(75)=.FALSE.
      END
      SUBROUTINE T2_SET_LABELS(INFOIN,CARDIN)
      IMPLICIT NONE
      INTEGER INFOIN(10)
      CHARACTER*(*) CARDIN
      COMMON /T2FLGC/ FLAGS(200), LTRAP,LHANDL,LSYERR,LSCREV
      LOGICAL FLAGS, LTRAP,LHANDL,LSYERR,LSCREV(3)
      INTEGER RELFLAG 
      PARAMETER (RELFLAG=151)
      INTEGER IWINLEV 
      INTEGER NWINLEV , MAX_FILL 
      PARAMETER (NWINLEV =4)
      PARAMETER (MAX_FILL=4)
      REAL GRDSYM, GRDSIZ, DATDAT(2,8), H2STAT(12), TITLIN(4), TITFA
     *C(4), TITLOC(4), TITMAR(4), TITLMX(4), TIKFAC, TITINX, TITX1, TIT
     *Y1, TITX, TITY, TITZ, TITSIZ, TITCON(5), REVLEV, REDUCE(5), XFR
     *M12(12), XFRM13(12), XFRM14(12), XFRM23(12), XFRM24(12), XFRM34(6
     *), XVARSX(20), CIRSIZ(2,3), ASIZE, AFLARE, SMSZDF, ORAXES(3), EY
     *EDIR(3), VUEDIR(3), VUECEN(3), VERTCL(3), EYESEP, SCRD, SCRZ, EYE
     *DIS, EYEPNT(3), XYPART(2, 2), BARSIZ(3), BARBRK(3), TIKSIZ(3), XY
     *ZBAS(3), TTHETA, TPHI, FRELBL(4), PATRN(20,30), SCLPRM(10,3), WI
     *NDOW(4), SCREEN(2), SYMBOL, NOSYMB, FACTXY(19), LBLSIZ, SYMSIZ, X
     *YZLIM(3,2), WORLD(3), RADRMX, RADRMN, RADAMN, RADANG, RADX0, RADY
     *0, XUNUSD(6), AXANG(3), REDFAC, DSCAL, PATSZ, MARGIN(4), PSCR(2
     *), OREAL, OCPU, CSCRD, DATPTS, ERRPTS, DATXMN, DATXMX, DATYMN, DA
     *TYMX, DATZMN, DATZMX, DATSUM, ERRSUM, DATAVE, ERRAVE, DATCEN, ERR
     *CEN, DATSTD, ERRSTD, WINREL(2,2,NWINLEV),WINABS(2,2,NWINLEV),WINL
     *IM(2,2), FMARKER(3,8), SYDIR(3), GRDIR(3), EXYZLIM(3,2), DSLOPE(2
     *,2)
      REAL PLOT_EXTENT(2,2),FILL_ANGLE(MAX_FILL),FILL_WIDTH(MAX_FILL)
      INTEGER FILL_INDEX, FILL_TEX(MAX_FILL), N_LINES(6)
      EQUIVALENCE (DATDAT, DATPTS)
      INTEGER MAXREP
      PARAMETER (MAXREP=5)
      INTEGER IPATRN, NPATRN(30), NXYLIM(3,2), NPLOTS, NCSETS, NCCOL, N
     *CROW, IYEAR, IMONTH, IDAY, ISIGFG, ITXPRI, ITXSEC, ITITDT(3), L
     *ENCRD, IPROP, IHTEX, IBLINK, IERASE, ITCNTR, IUNUSD, NXYZ1(3), 
     *NXYZ2(3), LBLFMT(3), LBLCHR(3), NDIMNS(3), IBLKTP, IDIMNS, NMES
     *H0, NMESH1, NMESH2, MESH1, MESH2, MESH3, MESH2D, MESHN(3), NMESHN(
     *2), NFIELD, IFIELD(19), NINCR, NPOINT, IVARBL(19), IVPTR(19), I_
     *VORDER(19,2), LINEAR(4), NONLIN(4), MXECHO, LINES, MAXLNS, USRK
     *BD, USRSCR, PLTFIL, LINWID, LINCOL, LINTEX, ICPOIN(3), IREPCT(MA
     *XREP), LEVREP, GRDTYP, GRDTEX, OUTTEX, IAXTEX, TITEX, LETSET, LAB
     *TEX, TICTEX, SHADOWTYP,SHADOWTEX, NXYZDEF1(10), NXYZDEF2(10), IF
     *ILE_CASE ,MAX_SUBST
      INTEGER MAX_CYCLE
      PARAMETER (MAX_CYCLE=20)
      INTEGER N_CYCLE, ITX_CYCLE(MAX_CYCLE)
      REAL SYM_CYCLE(MAX_CYCLE)
      EQUIVALENCE (NMESH1,NMESHN)
      EQUIVALENCE (MESH1,MESHN)
      INTEGER IBUFFR(400)
      REAL BUFFER(400)
      INTEGER NCHSAVE 
      PARAMETER (NCHSAVE=2*512) 
      INTEGER*4 ICHSAVE(NCHSAVE)
      INTEGER*4 IVRPTR(15)
      CHARACTER*512 OUTSTR,C_FILE, C_NAME, C_SELECT
      CHARACTER C_TIT_ESCAPE*1,C_TIT_SUBSTITUTE*2
      INTEGER N_FILE, N_NAME, N_SELECT
      CHARACTER*8 PXNAME
      CHARACTER*64 INPFMT
      LOGICAL LTDATA, OUTSID(4)
      COMMON /T2COM/ PXNAME, REDUCE, TITX, TITY ,XFRM12, XFRM13, XFRM1
     *4, XFRM23 ,XFRM24, XFRM34 ,XVARSX ,TITSIZ, GRDSYM, GRDSIZ, CIRS
     *IZ, ASIZE, AFLARE ,SMSZDF, ORAXES, EYEDIR, VUEDIR, VUECEN ,VERTC
     *L, EYESEP, SCRD, SCRZ, EYEDIS, EYEPNT ,XYPART, BARSIZ, TIKSIZ, XY
     *ZBAS, TTHETA ,TPHI, FRELBL, IPATRN, NPATRN, PATRN ,SCLPRM, WINDO
     *W, SCREEN, SYMBOL, NOSYMB ,FACTXY, LBLSIZ, SYMSIZ, XYZLIM, WORLD 
     *,RADRMX, RADRMN, RADAMN, RADANG, RADX0, RADY0, XUNUSD ,USRKBD, U
     *SRSCR, PLTFIL ,ITITDT, LENCRD ,INPFMT, GRDTYP, LINWID, LINCOL, L
     *INTEX, TITCON, ITCNTR ,IUNUSD, NXYZ1, NXYZ2 ,LBLCHR, NDIMNS, IBL
     *KTP, IDIMNS ,NMESH1, NMESH2, MESH1, MESH2, MESH3, NFIELD ,IFIELD
     *, NINCR ,IVARBL, IVRPTR ,LINEAR, NONLIN ,NPOINT, LETSET ,MXECH
     *O, LINES, MAXLNS ,AXANG, MESH2D, REDFAC, GRDTEX, OUTTEX, IAXTEX, 
     *TITEX, DSCAL ,OUTSTR, IPROP, IHTEX, IBLINK, IERASE, LABTEX, TICTE
     *X, NXYLIM, PATSZ ,MARGIN, PSCR, ITXPRI, ITXSEC, OREAL, OCPU, CSCR
     *D, OUTSID ,TITLIN, TITINX, TITZ, TITX1, TITY1, LTDATA, NPLOTS, RE
     *VLEV ,LBLFMT, IYEAR, IMONTH, IDAY, ISIGFG ,DATPTS, ERRPTS, DATXM
     *N, DATXMX, DATYMN, DATYMX, DATZMN, DATZMX ,DATSUM, ERRSUM, DATAVE
     *, ERRAVE, DATCEN, ERRCEN, DATSTD, ERRSTD ,NCSETS, NCCOL, NCROW, F
     *MARKER, H2STAT, TITFAC, TITLOC, TITMAR ,TIKFAC, IWINLEV, WINREL, 
     *WINABS, WINLIM ,ICPOIN, LEVREP, IREPCT, SYDIR, GRDIR, NMESH0, EXY
     *ZLIM, IVPTR ,TITLMX, NXYZDEF1, NXYZDEF2, IFILE_CASE, N_CYCLE, ITX
     *_CYCLE ,SYM_CYCLE, PLOT_EXTENT, FILL_ANGLE, FILL_WIDTH, FILL_TEX 
     *,FILL_INDEX ,N_LINES ,DSLOPE ,MAX_SUBST, BARBRK ,I_VORDER,SHADOW
     *TYP,SHADOWTEX
      COMMON /T2SCRT/ BUFFER, IBUFFR, N_FILE,N_NAME,N_SELECT, ICHSAVE
      COMMON /T2_CHAR/ C_TIT_ESCAPE,C_TIT_SUBSTITUTE
      COMMON /T2_SCRT/ C_FILE, C_NAME, C_SELECT
      INTEGER JOUFIL, ERRFIL, OUTFIL, DBGFIL, INPFIL, NINMAX
      PARAMETER (NINMAX=20)
      INTEGER NINP(NINMAX)
      COMMON /T2TRBK/NINP, JOUFIL, ERRFIL, OUTFIL, DBGFIL, INPFIL
      CHARACTER*512 STRNG, STJOU
      LOGICAL LTOKEN
      REAL FLOTNG
      INTEGER INTERP, KEYORD, NSTRNG, MAXSTR, NSTJOU, LSTJOU, NTOKEN
      INTEGER*4 INTEG
      COMMON /TOKENC/ INTERP, INTEG, FLOTNG, KEYORD, NSTRNG, MAXSTR, ST
     *RNG, NSTJOU, LSTJOU, STJOU, LTOKEN, NTOKEN
      LOGICAL DFLAGS(200),DSCREV(3)
      COMMON /T2FLGD/DFLAGS,DSCREV
      REAL DTITLIN(4), DTITFAC(4), DTITMAR(4)
      INTEGER DGRDTYP, DGRDTEX, DOUTTEX, IDAXTEX, DTITEX, DSHADOWTYP,DS
     *HADOWTEX, IFLDDF(19), NDDIMNS, IDTXPRI, IDTXSEC, LINCLF, LINTXF,
     * LINWDF, DNONLN(3), DNXYZ1(3), DNXYZ2(3), DLABTEX, DTICTEX, DNPAT
     *RN(30), DLBLCHR(3), ND_CYCLE, IDTX_CYCLE(MAX_CYCLE)
      REAL DSYM_CYCLE(MAX_CYCLE)
      REAL DTITSIZ, DGRDSYM, DGRDSIZ, DCIRSIZ(2,3), DASIZE, DAFLARE, D
     *SMSZDF, DORAXES(3), DEYEDIR(3), DVUEDIR(3), DVUECEN(3), DVERTCL(3
     *), DEYESEP, DSCRD, DSCRZ, DEYEDIS, DEYEPNT(3), DBARSIZ(3), DBARBR
     *K(3), DTIKSIZ(3), DXYZBS(3), DTTHETA, DTPHI, DFRELBL(4), DPATRN(2
     *0,30), DSCLPRM(10,3), DWINDOW(4), DSCREEN(2), DSYMBOL, DNOSYMB, 
     *DAXANG(3), DLBLSIZ, DSYMSIZ, DXYZLIM(3,2), DFACTXY(19), DRADANG,
     * DDSCAL, DPATSZ, DTITINX, DTIKFAC, DSYDIR(3), DGRDIR(3)
      COMMON /T2COMD/ DTITSIZ, DGRDSYM, DGRDSIZ, DCIRSIZ, DASIZE, DAFLA
     *RE, DSMSZDF, DORAXES, DEYEDIR, DVUEDIR, DVUECEN, DVERTCL, DEYESE
     *P, DSCRD, DSCRZ, DEYEDIS, DEYEPNT, DBARSIZ, DTIKSIZ, DXYZBS, DTTH
     *ETA, DTPHI, DFRELBL, DNPATRN, DPATRN, DSCLPRM, DWINDOW, DSCREEN,
     * DSYMBOL, DNOSYMB, DAXANG, DLBLSIZ, DSYMSIZ, DXYZLIM, DGRDTYP, D
     *FACTXY, IFLDDF, NDDIMNS, DGRDTEX, DOUTTEX, IDAXTEX, DTITEX, DRADA
     *NG, DDSCAL, DNONLN, DNXYZ1, DNXYZ2, LINCLF, LINTXF, LINWDF, DLABT
     *EX, DTICTEX, DPATSZ, IDTXPRI, IDTXSEC, DTITLIN, DTITINX, DLBLCHR,
     * DTITFAC, DTITMAR, DTIKFAC, DSYDIR, DGRDIR, ND_CYCLE, IDTX_CYCLE,
     * DSYM_CYCLE, DBARBRK,  DSHADOWTYP,DSHADOWTEX
      LOGICAL F1,F2,F3(2)
      LOGICAL LLLL,LSET
      INTEGER I,J,IFLAG,JMIN,JMAX,JSTP
      INTEGER IAND
      INTEGER JM(8,3)
      DATA JM/1,1,2,1,1,2,3,4, 4,4,4,0,1,2,3,4, 1,2,2,1,1,1,1,1/
      IFLAG=1
      LSET=.FALSE.
      FLAGS(3)=.FALSE.
      GOTO 13461
13490 CONTINUE
      JMIN=JM(INTEG,1)
      JMAX=JM(INTEG,2)
      JSTP=JM(INTEG,3)
      LSET=.TRUE.
      CALL TOKEN(INFOIN,CARDIN,';')
      IF(INTERP.NE.3.AND.INTERP.NE.4)THEN
      CALL T2ERR(INFOIN,CARDIN,' ',5)
      ELSE
      DO 13511 J=JMIN,JMAX,JSTP
      FRELBL(J)=MIN(MAX(FLOTNG,-6.),6.)
13511 CONTINUE
13512 CONTINUE
      ENDIF
      GOTO 13461
13520 CONTINUE
      LBLCHR(2)=FLOTNG
      GOTO 13461
13530 CONTINUE
      LSET=.TRUE.
      IF (FLOTNG .lt. 0) THEN
      LBLSIZ=FLOTNG 
      FLAGS(77)=.FALSE.
      ELSE
      LBLSIZ=FLOTNG/REDUCE(3)
      FLAGS(77)=.TRUE.
      ENDIF
      GOTO 13461
13540 CONTINUE
      LSET=.TRUE.
      LLLL=INTEG.EQ.0
13550 GOTO (13560,13570,13580,13590,13600,13610,13620,13630),IFLAG
13560 CONTINUE
      DO 13641 I=36,39
      FLAGS(I)=LLLL
13641 CONTINUE
13642 CONTINUE
      DO 13651 I=47,49
      FLAGS(I)=LLLL
13651 CONTINUE
13652 CONTINUE
      GOTO 13552
13600 CONTINUE
      FLAGS(36)=LLLL
      FLAGS(48)=.TRUE.
      GOTO 13552
13610 CONTINUE
      FLAGS(37)=LLLL
      FLAGS(47)=.TRUE.
      GOTO 13552
13620 CONTINUE
      FLAGS(38)=LLLL
      FLAGS(48)=.TRUE.
      GOTO 13552
13630 CONTINUE
      FLAGS(39)=LLLL
      FLAGS(47)=.TRUE.
      GOTO 13552
13570 CONTINUE
      FLAGS(37)=LLLL
      FLAGS(39)=LLLL
      FLAGS(47)=LLLL
      GOTO 13552
13580 CONTINUE
      FLAGS(36)=LLLL
      FLAGS(38)=LLLL
      FLAGS(48)=LLLL
      GOTO 13552
13590 CONTINUE
      FLAGS(49)=LLLL
      GOTO 13552
13552 CONTINUE
      GOTO 13461
13660 CONTINUE
      IFLAG=INTEG
      LSET=.TRUE.
      GOTO 13461
13670 CONTINUE
      JMIN=JM(IFLAG,1)
      JMAX=JM(IFLAG,2)
      JSTP=JM(IFLAG,3)
      DO 13681 J=JMIN,JMAX,JSTP
      FRELBL(J)=FLOTNG
13681 CONTINUE
13682 CONTINUE
      GOTO 13461
13690 CONTINUE
      DLBLSIZ=LBLSIZ
      DO 13701 I=1,4
      DFRELBL(I)=FRELBL(I)
13701 CONTINUE
13702 CONTINUE
      DO 13711 I=36,39
      DFLAGS(I)=FLAGS(I)
13711 CONTINUE
13712 CONTINUE
      DO 13721 I=47,49
      DFLAGS(I)=FLAGS(I)
13721 CONTINUE
13722 CONTINUE
      DO 13731 I=1,3
      DLBLCHR(I)=LBLCHR(I)
13731 CONTINUE
13732 CONTINUE
      DLABTEX=LABTEX
      DFLAGS(94)=FLAGS(94)
      DFLAGS(77)=FLAGS(77)
      LSET=.TRUE.
      GOTO 13461
13740 CONTINUE
      FLAGS(94)=LTOKEN
      GOTO 13461
13750 CONTINUE
      LABTEX=IAND(NOT(512*7),LABTEX)+INTEG*512
      LSET=.TRUE.
      GOTO 13461
13760 CONTINUE
      LSET=.TRUE.
      LABTEX=IAND(NOT(8*7),LABTEX)+INTEG*8
      GOTO 13461
13461 CALL TOKEN(INFOIN,CARDIN,'DOWN:6,UP:8,SIDEWAYS:3,CHARACTERS:-20:20
     *:6,SIZE:0::-2,OFF:1,ON,ALL:1,X:2,Y:3,Z:4,LEFT:5,BOTTOM:6,RIGHT:7,T
     *OP:8,SHIFT:-6:6:0,PERMANENT,INSIDE:Y,NOCOLOR:0,WHITE:1,RED:2,GREEN
     *:3,BLUE:4,YELLOW:5,MAGENTA:6,CYAN:7,INTENSITY:0:9:2,WIDTH:0:9:2,BL
     *ACK:8,;')
      GOTO (13462,13467,13465,13465,13465,13465,13461,13467, 13465),INTE
     *RP
13465 CALL T2ERR(INFOIN,CARDIN,' ',5)
      GOTO 13461
13467 GOTO ( 13490,13490,13490,13520,13530,13540,13540,13660,13660,13660
     *,13660,13660,13660,13660,13660,13670,13690,13740,13750,13750,13750
     *,13750,13750,13750,13750,13750,13760,13760,13750,13465),KEYORD
13462 CONTINUE
      IF(.not.LSET.and..not.FLAGS(23)) THEN
      DO 13771 I=1,4
      FRELBL(I)=1
13771 CONTINUE
13772 CONTINUE
      LABTEX=256
      FLAGS(77)=.FALSE.
      LBLSIZ=2.0 
      FLAGS(36)=.TRUE.
      FLAGS(37)=.TRUE.
      FLAGS(38)=.FALSE.
      FLAGS(39)=.FALSE.
      DO 13781 I=47,49
      FLAGS(I)=.TRUE.
13781 CONTINUE
13782 CONTINUE
      ENDIF
      END
      SUBROUTINE T2_SET_LIMITS(INFOIN,CARDIN)
      IMPLICIT NONE
      INTEGER INFOIN(10)
      CHARACTER*(*) CARDIN
      COMMON /T2FLGC/ FLAGS(200), LTRAP,LHANDL,LSYERR,LSCREV
      LOGICAL FLAGS, LTRAP,LHANDL,LSYERR,LSCREV(3)
      INTEGER RELFLAG 
      PARAMETER (RELFLAG=151)
      INTEGER IWINLEV 
      INTEGER NWINLEV , MAX_FILL 
      PARAMETER (NWINLEV =4)
      PARAMETER (MAX_FILL=4)
      REAL GRDSYM, GRDSIZ, DATDAT(2,8), H2STAT(12), TITLIN(4), TITFA
     *C(4), TITLOC(4), TITMAR(4), TITLMX(4), TIKFAC, TITINX, TITX1, TIT
     *Y1, TITX, TITY, TITZ, TITSIZ, TITCON(5), REVLEV, REDUCE(5), XFR
     *M12(12), XFRM13(12), XFRM14(12), XFRM23(12), XFRM24(12), XFRM34(6
     *), XVARSX(20), CIRSIZ(2,3), ASIZE, AFLARE, SMSZDF, ORAXES(3), EY
     *EDIR(3), VUEDIR(3), VUECEN(3), VERTCL(3), EYESEP, SCRD, SCRZ, EYE
     *DIS, EYEPNT(3), XYPART(2, 2), BARSIZ(3), BARBRK(3), TIKSIZ(3), XY
     *ZBAS(3), TTHETA, TPHI, FRELBL(4), PATRN(20,30), SCLPRM(10,3), WI
     *NDOW(4), SCREEN(2), SYMBOL, NOSYMB, FACTXY(19), LBLSIZ, SYMSIZ, X
     *YZLIM(3,2), WORLD(3), RADRMX, RADRMN, RADAMN, RADANG, RADX0, RADY
     *0, XUNUSD(6), AXANG(3), REDFAC, DSCAL, PATSZ, MARGIN(4), PSCR(2
     *), OREAL, OCPU, CSCRD, DATPTS, ERRPTS, DATXMN, DATXMX, DATYMN, DA
     *TYMX, DATZMN, DATZMX, DATSUM, ERRSUM, DATAVE, ERRAVE, DATCEN, ERR
     *CEN, DATSTD, ERRSTD, WINREL(2,2,NWINLEV),WINABS(2,2,NWINLEV),WINL
     *IM(2,2), FMARKER(3,8), SYDIR(3), GRDIR(3), EXYZLIM(3,2), DSLOPE(2
     *,2)
      REAL PLOT_EXTENT(2,2),FILL_ANGLE(MAX_FILL),FILL_WIDTH(MAX_FILL)
      INTEGER FILL_INDEX, FILL_TEX(MAX_FILL), N_LINES(6)
      EQUIVALENCE (DATDAT, DATPTS)
      INTEGER MAXREP
      PARAMETER (MAXREP=5)
      INTEGER IPATRN, NPATRN(30), NXYLIM(3,2), NPLOTS, NCSETS, NCCOL, N
     *CROW, IYEAR, IMONTH, IDAY, ISIGFG, ITXPRI, ITXSEC, ITITDT(3), L
     *ENCRD, IPROP, IHTEX, IBLINK, IERASE, ITCNTR, IUNUSD, NXYZ1(3), 
     *NXYZ2(3), LBLFMT(3), LBLCHR(3), NDIMNS(3), IBLKTP, IDIMNS, NMES
     *H0, NMESH1, NMESH2, MESH1, MESH2, MESH3, MESH2D, MESHN(3), NMESHN(
     *2), NFIELD, IFIELD(19), NINCR, NPOINT, IVARBL(19), IVPTR(19), I_
     *VORDER(19,2), LINEAR(4), NONLIN(4), MXECHO, LINES, MAXLNS, USRK
     *BD, USRSCR, PLTFIL, LINWID, LINCOL, LINTEX, ICPOIN(3), IREPCT(MA
     *XREP), LEVREP, GRDTYP, GRDTEX, OUTTEX, IAXTEX, TITEX, LETSET, LAB
     *TEX, TICTEX, SHADOWTYP,SHADOWTEX, NXYZDEF1(10), NXYZDEF2(10), IF
     *ILE_CASE ,MAX_SUBST
      INTEGER MAX_CYCLE
      PARAMETER (MAX_CYCLE=20)
      INTEGER N_CYCLE, ITX_CYCLE(MAX_CYCLE)
      REAL SYM_CYCLE(MAX_CYCLE)
      EQUIVALENCE (NMESH1,NMESHN)
      EQUIVALENCE (MESH1,MESHN)
      INTEGER IBUFFR(400)
      REAL BUFFER(400)
      INTEGER NCHSAVE 
      PARAMETER (NCHSAVE=2*512) 
      INTEGER*4 ICHSAVE(NCHSAVE)
      INTEGER*4 IVRPTR(15)
      CHARACTER*512 OUTSTR,C_FILE, C_NAME, C_SELECT
      CHARACTER C_TIT_ESCAPE*1,C_TIT_SUBSTITUTE*2
      INTEGER N_FILE, N_NAME, N_SELECT
      CHARACTER*8 PXNAME
      CHARACTER*64 INPFMT
      LOGICAL LTDATA, OUTSID(4)
      COMMON /T2COM/ PXNAME, REDUCE, TITX, TITY ,XFRM12, XFRM13, XFRM1
     *4, XFRM23 ,XFRM24, XFRM34 ,XVARSX ,TITSIZ, GRDSYM, GRDSIZ, CIRS
     *IZ, ASIZE, AFLARE ,SMSZDF, ORAXES, EYEDIR, VUEDIR, VUECEN ,VERTC
     *L, EYESEP, SCRD, SCRZ, EYEDIS, EYEPNT ,XYPART, BARSIZ, TIKSIZ, XY
     *ZBAS, TTHETA ,TPHI, FRELBL, IPATRN, NPATRN, PATRN ,SCLPRM, WINDO
     *W, SCREEN, SYMBOL, NOSYMB ,FACTXY, LBLSIZ, SYMSIZ, XYZLIM, WORLD 
     *,RADRMX, RADRMN, RADAMN, RADANG, RADX0, RADY0, XUNUSD ,USRKBD, U
     *SRSCR, PLTFIL ,ITITDT, LENCRD ,INPFMT, GRDTYP, LINWID, LINCOL, L
     *INTEX, TITCON, ITCNTR ,IUNUSD, NXYZ1, NXYZ2 ,LBLCHR, NDIMNS, IBL
     *KTP, IDIMNS ,NMESH1, NMESH2, MESH1, MESH2, MESH3, NFIELD ,IFIELD
     *, NINCR ,IVARBL, IVRPTR ,LINEAR, NONLIN ,NPOINT, LETSET ,MXECH
     *O, LINES, MAXLNS ,AXANG, MESH2D, REDFAC, GRDTEX, OUTTEX, IAXTEX, 
     *TITEX, DSCAL ,OUTSTR, IPROP, IHTEX, IBLINK, IERASE, LABTEX, TICTE
     *X, NXYLIM, PATSZ ,MARGIN, PSCR, ITXPRI, ITXSEC, OREAL, OCPU, CSCR
     *D, OUTSID ,TITLIN, TITINX, TITZ, TITX1, TITY1, LTDATA, NPLOTS, RE
     *VLEV ,LBLFMT, IYEAR, IMONTH, IDAY, ISIGFG ,DATPTS, ERRPTS, DATXM
     *N, DATXMX, DATYMN, DATYMX, DATZMN, DATZMX ,DATSUM, ERRSUM, DATAVE
     *, ERRAVE, DATCEN, ERRCEN, DATSTD, ERRSTD ,NCSETS, NCCOL, NCROW, F
     *MARKER, H2STAT, TITFAC, TITLOC, TITMAR ,TIKFAC, IWINLEV, WINREL, 
     *WINABS, WINLIM ,ICPOIN, LEVREP, IREPCT, SYDIR, GRDIR, NMESH0, EXY
     *ZLIM, IVPTR ,TITLMX, NXYZDEF1, NXYZDEF2, IFILE_CASE, N_CYCLE, ITX
     *_CYCLE ,SYM_CYCLE, PLOT_EXTENT, FILL_ANGLE, FILL_WIDTH, FILL_TEX 
     *,FILL_INDEX ,N_LINES ,DSLOPE ,MAX_SUBST, BARBRK ,I_VORDER,SHADOW
     *TYP,SHADOWTEX
      COMMON /T2SCRT/ BUFFER, IBUFFR, N_FILE,N_NAME,N_SELECT, ICHSAVE
      COMMON /T2_CHAR/ C_TIT_ESCAPE,C_TIT_SUBSTITUTE
      COMMON /T2_SCRT/ C_FILE, C_NAME, C_SELECT
      INTEGER JOUFIL, ERRFIL, OUTFIL, DBGFIL, INPFIL, NINMAX
      PARAMETER (NINMAX=20)
      INTEGER NINP(NINMAX)
      COMMON /T2TRBK/NINP, JOUFIL, ERRFIL, OUTFIL, DBGFIL, INPFIL
      CHARACTER*512 STRNG, STJOU
      LOGICAL LTOKEN
      REAL FLOTNG
      INTEGER INTERP, KEYORD, NSTRNG, MAXSTR, NSTJOU, LSTJOU, NTOKEN
      INTEGER*4 INTEG
      COMMON /TOKENC/ INTERP, INTEG, FLOTNG, KEYORD, NSTRNG, MAXSTR, ST
     *RNG, NSTJOU, LSTJOU, STJOU, LTOKEN, NTOKEN
      LOGICAL DFLAGS(200),DSCREV(3)
      COMMON /T2FLGD/DFLAGS,DSCREV
      REAL DTITLIN(4), DTITFAC(4), DTITMAR(4)
      INTEGER DGRDTYP, DGRDTEX, DOUTTEX, IDAXTEX, DTITEX, DSHADOWTYP,DS
     *HADOWTEX, IFLDDF(19), NDDIMNS, IDTXPRI, IDTXSEC, LINCLF, LINTXF,
     * LINWDF, DNONLN(3), DNXYZ1(3), DNXYZ2(3), DLABTEX, DTICTEX, DNPAT
     *RN(30), DLBLCHR(3), ND_CYCLE, IDTX_CYCLE(MAX_CYCLE)
      REAL DSYM_CYCLE(MAX_CYCLE)
      REAL DTITSIZ, DGRDSYM, DGRDSIZ, DCIRSIZ(2,3), DASIZE, DAFLARE, D
     *SMSZDF, DORAXES(3), DEYEDIR(3), DVUEDIR(3), DVUECEN(3), DVERTCL(3
     *), DEYESEP, DSCRD, DSCRZ, DEYEDIS, DEYEPNT(3), DBARSIZ(3), DBARBR
     *K(3), DTIKSIZ(3), DXYZBS(3), DTTHETA, DTPHI, DFRELBL(4), DPATRN(2
     *0,30), DSCLPRM(10,3), DWINDOW(4), DSCREEN(2), DSYMBOL, DNOSYMB, 
     *DAXANG(3), DLBLSIZ, DSYMSIZ, DXYZLIM(3,2), DFACTXY(19), DRADANG,
     * DDSCAL, DPATSZ, DTITINX, DTIKFAC, DSYDIR(3), DGRDIR(3)
      COMMON /T2COMD/ DTITSIZ, DGRDSYM, DGRDSIZ, DCIRSIZ, DASIZE, DAFLA
     *RE, DSMSZDF, DORAXES, DEYEDIR, DVUEDIR, DVUECEN, DVERTCL, DEYESE
     *P, DSCRD, DSCRZ, DEYEDIS, DEYEPNT, DBARSIZ, DTIKSIZ, DXYZBS, DTTH
     *ETA, DTPHI, DFRELBL, DNPATRN, DPATRN, DSCLPRM, DWINDOW, DSCREEN,
     * DSYMBOL, DNOSYMB, DAXANG, DLBLSIZ, DSYMSIZ, DXYZLIM, DGRDTYP, D
     *FACTXY, IFLDDF, NDDIMNS, DGRDTEX, DOUTTEX, IDAXTEX, DTITEX, DRADA
     *NG, DDSCAL, DNONLN, DNXYZ1, DNXYZ2, LINCLF, LINTXF, LINWDF, DLABT
     *EX, DTICTEX, DPATSZ, IDTXPRI, IDTXSEC, DTITLIN, DTITINX, DLBLCHR,
     * DTITFAC, DTITMAR, DTIKFAC, DSYDIR, DGRDIR, ND_CYCLE, IDTX_CYCLE,
     * DSYM_CYCLE, DBARBRK,  DSHADOWTYP,DSHADOWTEX
      CHARACTER*5 CXYZ(3,2)
      LOGICAL F1,F2,F3(2),LRESET,LSET
      REAL XYZ0(3),XYZ1(3),XYZ2(3),XYZ3(3),XYWIN(2,2)
      INTEGER I,J,K,JMIN,JMAX,ICH,IXYZ,IM,IDXYZ,IDM
      INTEGER ICNVRT(3,2)
      REAL TEMP,RADMAX,T
      DATA CXYZ/'XMIN=','YMIN=','ZMIN=','XMAX=','YMAX=','ZMAX='/
      DATA ICNVRT/1,3,5,2,4,6/
      ICH=0
      FLAGS(13)=.false.
      LRESET=.TRUE.
      IXYZ=1
      IM=1
      IDXYZ=0
      IDM=0
      LSET=.false.
      GOTO 13791
13820 CONTINUE
      FLAGS(13)=.true.
      DSCAL=0
      GOTO 13831
13840 CONTINUE
      DSCAL=FLOTNG
      GOTO 13832
13835 CONTINUE
      INFOIN(9)=-1
      GOTO 13832
13831 CALL TOKEN(INFOIN,CARDIN,';')
      GOTO (13835,13835,13840,13840,13835,13835,13835,13835,13835),INTER
     *P
13832 CONTINUE
      CALL TOKEN(INFOIN,CARDIN,'TO,;')
      IF(INTERP.NE.2)THEN
      INFOIN(9)=-1
      ENDIF
      GOTO 13861
13870 CONTINUE
      IF(FLOTNG.ne.0)DSCAL=DSCAL/FLOTNG
      GOTO 13862
13865 CONTINUE
      INFOIN(9)=-1
      GOTO 13862
13861 CALL TOKEN(INFOIN,CARDIN,';')
      GOTO (13865,13865,13870,13870,13865,13865,13865,13865,13865),INTER
     *P
13862 CONTINUE
      GOTO 13791
13880 CONTINUE
      NONLIN(4)=0
      IF (JOUFIL.ne.0) NSTJOU=LSTJOU
      DO 13891 I=1,2
      J=0
      CALL T2CURS(J,XYZ0,XYZ1,XYZ2,F1,F2)
      JMIN=1
      JMAX=2
      IF(FLAGS(56)) JMAX=3
      IF(J .ge. ICHAR('a')) J=J-ICHAR('a')+ICHAR('A')
      IF(J .eq. ICHAR('X')) THEN
      JMAX=1
      J=ICHAR(' ')
      ELSEIF(J .eq. ICHAR('Y')) THEN
      JMIN=2
      JMAX=2
      J=ICHAR(' ')
      ELSEIF(J .eq. ICHAR('Z')) THEN
      JMIN=3
      JMAX=3
      J=ICHAR(' ')
      ENDIF
      IF(J .eq. ICHAR(' ').and.F2) then
      ICH=1
      DO 13901 J=1,2
      XYWIN(J,I)=XYZ1(J)
13901 CONTINUE
13902 CONTINUE
      DO 13911 J=JMIN,JMAX
      If(.not.FLAGS(56)) THEN
      K=17
      IF (K+LSTJOU.le.LEN(STJOU).and. JOUFIL.ne.0) THEN
      WRITE(STJOU(LSTJOU+1:LSTJOU+K),'(1X,A,1P,G10.3)', ERR=13920)  CXYZ
     *(J,I),XYZ2(J)
      CALL T2SQEZ(STJOU(LSTJOU+2:LSTJOU+K),K)
      NSTJOU=LSTJOU+K+1
      LSTJOU=NSTJOU
13920 CONTINUE
      ENDIF
      XYZLIM(J,I)=XYZ2(J)
      K=I+2*J+2
      FLAGS(K)=.TRUE.
      FLAGS(K+60)=.TRUE.
      ENDIF
13911 CONTINUE
13912 CONTINUE
      endif
13891 CONTINUE
13892 CONTINUE
      IF(FLAGS(56)) THEN
      TEMP=.01
      DO 13931 I=1,2
      TEMP=MAX(TEMP,ABS( (XYWIN(I,2)-XYWIN(I,1))/  (WINDOW(I+2)-WINDOW(I
     *))))
      XYZ1(I)=(XYWIN(I,1)+XYWIN(I,2))/2
      XYZ0(I)=(WINDOW(I+2)+WINDOW(I))/2
13931 CONTINUE
13932 CONTINUE
      SCRD=SCRD/TEMP
      CALL T2IFRM(2,1,XYZ1,LINEAR,XFRM23,3,XYZ2)
      CALL T2IFRM(2,1,XYZ0,LINEAR,XFRM23,3,XYZ1)
      DO 13941 I=1,3
      XYZ2(I)=XYZ2(I)-XYZ1(I)
      VUECEN(I)=VUECEN(I)+XYZ2(I)
13941 CONTINUE
13942 CONTINUE
      FLAGS(61)=.true.
      IF (JOUFIL.ne.0.and.NSTJOU+67.le.LEN(STJOU)) THEN
      NSTJOU=NSTJOU+67
      WRITE(STJOU(LSTJOU+1:NSTJOU),'(1P,5(A,G10.3))', ERR=13950)  ';SET 
     *THREE SCRD=',SCRD,'CENTER=',(VUECEN(I),',',I=1,3)
      STJOU(NSTJOU:NSTJOU)=';'
13950 CONTINUE
      ENDIF
      ENDIF
      NONLIN(4)=1
      GOTO 13791
13960 CONTINUE
      LRESET=.FALSE.
      GOTO 13791
13970 CONTINUE
      IXYZ=INTEG
      IF(IDM + IDXYZ .eq. 0) IDM=1
      IF (IDXYZ.eq.0) IM=1
      LSET=.true.
      GOTO 13791
13980 CONTINUE
      IM=INTEG
      IF(IDM + IDXYZ .eq. 0) IDXYZ=1
      IF (IDM.eq.0) IXYZ=1
      LSET=.true.
      GOTO 13791
13990 CONTINUE
      IM=INTEG/10
      IXYZ=MOD(INTEG,10)
      LSET=.true.
      GOTO 13791
14000 CONTINUE
      DDSCAL=DSCAL
      DFLAGS(13)=FLAGS(13)
      DO 14011 I=5,10
      DFLAGS(60+I)=FLAGS(I)
14011 CONTINUE
14012 CONTINUE
      GOTO 13791
14020 CONTINUE
      RADMAX=FLOTNG
      FLAGS(85)=.TRUE.
      FLAGS(86)=.TRUE.
      GOTO 13791
13800 GOTO ( 13820,13880,13960,13970,13970,13970,13980,13980,13990,13990
     *,13990,13990,13990,13990,14000,14020,13795),KEYORD
14030 CONTINUE
      IF(IDM + IDXYZ .eq. 0) IDXYZ=1
      IF(IXYZ.gt.3 .or. IM.gt.2) THEN
      CALL T2ERR(INFOIN,CARDIN,('*** ERROR *** Extraneous number'),4)
      ELSE
      LSET=.false.
      XYZLIM(IXYZ,IM)=FLOTNG
      DXYZLIM(IXYZ,IM)=FLOTNG
      ICH=ICNVRT(IXYZ,IM)
      FLAGS(ICH+4)=.TRUE.
      FLAGS(ICH+64)=.TRUE.
      IXYZ=IXYZ+IDXYZ
      IM=IM+IDM
      ENDIF
      GOTO 13791
13791 CALL TOKEN(INFOIN,CARDIN,'SCALE,CURSOR,NORESET,X:1,Y:2,Z:3,FROM:1,
     *TO:2,XMIN:11,XMAX:21,YMIN:12,YMAX:22,ZMIN:13,ZMAX:23,PERMANENT,RAD
     *IUS:::10,;')
      GOTO (13792,13800,14030,14030,13795,13795,13795,13800,13795),INTER
     *P
13795 CALL T2ERR(INFOIN,CARDIN,' ',5)
      GOTO 13791
13792 CONTINUE
      DO 14041 I=1,3
      J=2*I+3
      If (FLAGS(J).and.FLAGS(J+1)) THEN
      IF (XYZLIM(I,1).gt.XYZLIM(I,2)) THEN
      T=XYZLIM(I,1)
      XYZLIM(I,1)=XYZLIM(I,2)
      XYZLIM(I,2)=T
      ENDIF
      IF (XYZLIM(I,2)-XYZLIM(I,1) .lt. 2*10.**(1-6)*ABS(XYZLIM(I,1)+XYZL
     *IM(I,2))) then
      WRITE(OUTSTR,*)'*** ERROR *** ',CXYZ(I,1)(1:1),' Limits too close 
     *together'
      CALL T2ERR(INFOIN,CARDIN,OUTSTR,-4)
      FLAGS(J)=.false.
      FLAGS(J+1)=.false.
      FLAGS(J+60)=.false.
      FLAGS(J+61)=.false.
      endif
      endif
14041 CONTINUE
14042 CONTINUE
      IF (ICH.EQ.0.and. .not.FLAGS(23)) then
      DO 14051 I=1,6
      FLAGS(I+4)=.FALSE.
      FLAGS(I+64)=.FALSE.
14051 CONTINUE
14052 CONTINUE
      LRESET=.TRUE.
      endif
      IF (LRESET) FLAGS(75)=.FALSE.
      END
      SUBROUTINE T2_SET_TICKS(INFOIN,CARDIN)
      IMPLICIT NONE
      LOGICAL LLLL
      INTEGER INFOIN(10)
      CHARACTER*(*) CARDIN
      COMMON /T2FLGC/ FLAGS(200), LTRAP,LHANDL,LSYERR,LSCREV
      LOGICAL FLAGS, LTRAP,LHANDL,LSYERR,LSCREV(3)
      INTEGER RELFLAG 
      PARAMETER (RELFLAG=151)
      INTEGER IWINLEV 
      INTEGER NWINLEV , MAX_FILL 
      PARAMETER (NWINLEV =4)
      PARAMETER (MAX_FILL=4)
      REAL GRDSYM, GRDSIZ, DATDAT(2,8), H2STAT(12), TITLIN(4), TITFA
     *C(4), TITLOC(4), TITMAR(4), TITLMX(4), TIKFAC, TITINX, TITX1, TIT
     *Y1, TITX, TITY, TITZ, TITSIZ, TITCON(5), REVLEV, REDUCE(5), XFR
     *M12(12), XFRM13(12), XFRM14(12), XFRM23(12), XFRM24(12), XFRM34(6
     *), XVARSX(20), CIRSIZ(2,3), ASIZE, AFLARE, SMSZDF, ORAXES(3), EY
     *EDIR(3), VUEDIR(3), VUECEN(3), VERTCL(3), EYESEP, SCRD, SCRZ, EYE
     *DIS, EYEPNT(3), XYPART(2, 2), BARSIZ(3), BARBRK(3), TIKSIZ(3), XY
     *ZBAS(3), TTHETA, TPHI, FRELBL(4), PATRN(20,30), SCLPRM(10,3), WI
     *NDOW(4), SCREEN(2), SYMBOL, NOSYMB, FACTXY(19), LBLSIZ, SYMSIZ, X
     *YZLIM(3,2), WORLD(3), RADRMX, RADRMN, RADAMN, RADANG, RADX0, RADY
     *0, XUNUSD(6), AXANG(3), REDFAC, DSCAL, PATSZ, MARGIN(4), PSCR(2
     *), OREAL, OCPU, CSCRD, DATPTS, ERRPTS, DATXMN, DATXMX, DATYMN, DA
     *TYMX, DATZMN, DATZMX, DATSUM, ERRSUM, DATAVE, ERRAVE, DATCEN, ERR
     *CEN, DATSTD, ERRSTD, WINREL(2,2,NWINLEV),WINABS(2,2,NWINLEV),WINL
     *IM(2,2), FMARKER(3,8), SYDIR(3), GRDIR(3), EXYZLIM(3,2), DSLOPE(2
     *,2)
      REAL PLOT_EXTENT(2,2),FILL_ANGLE(MAX_FILL),FILL_WIDTH(MAX_FILL)
      INTEGER FILL_INDEX, FILL_TEX(MAX_FILL), N_LINES(6)
      EQUIVALENCE (DATDAT, DATPTS)
      INTEGER MAXREP
      PARAMETER (MAXREP=5)
      INTEGER IPATRN, NPATRN(30), NXYLIM(3,2), NPLOTS, NCSETS, NCCOL, N
     *CROW, IYEAR, IMONTH, IDAY, ISIGFG, ITXPRI, ITXSEC, ITITDT(3), L
     *ENCRD, IPROP, IHTEX, IBLINK, IERASE, ITCNTR, IUNUSD, NXYZ1(3), 
     *NXYZ2(3), LBLFMT(3), LBLCHR(3), NDIMNS(3), IBLKTP, IDIMNS, NMES
     *H0, NMESH1, NMESH2, MESH1, MESH2, MESH3, MESH2D, MESHN(3), NMESHN(
     *2), NFIELD, IFIELD(19), NINCR, NPOINT, IVARBL(19), IVPTR(19), I_
     *VORDER(19,2), LINEAR(4), NONLIN(4), MXECHO, LINES, MAXLNS, USRK
     *BD, USRSCR, PLTFIL, LINWID, LINCOL, LINTEX, ICPOIN(3), IREPCT(MA
     *XREP), LEVREP, GRDTYP, GRDTEX, OUTTEX, IAXTEX, TITEX, LETSET, LAB
     *TEX, TICTEX, SHADOWTYP,SHADOWTEX, NXYZDEF1(10), NXYZDEF2(10), IF
     *ILE_CASE ,MAX_SUBST
      INTEGER MAX_CYCLE
      PARAMETER (MAX_CYCLE=20)
      INTEGER N_CYCLE, ITX_CYCLE(MAX_CYCLE)
      REAL SYM_CYCLE(MAX_CYCLE)
      EQUIVALENCE (NMESH1,NMESHN)
      EQUIVALENCE (MESH1,MESHN)
      INTEGER IBUFFR(400)
      REAL BUFFER(400)
      INTEGER NCHSAVE 
      PARAMETER (NCHSAVE=2*512) 
      INTEGER*4 ICHSAVE(NCHSAVE)
      INTEGER*4 IVRPTR(15)
      CHARACTER*512 OUTSTR,C_FILE, C_NAME, C_SELECT
      CHARACTER C_TIT_ESCAPE*1,C_TIT_SUBSTITUTE*2
      INTEGER N_FILE, N_NAME, N_SELECT
      CHARACTER*8 PXNAME
      CHARACTER*64 INPFMT
      LOGICAL LTDATA, OUTSID(4)
      COMMON /T2COM/ PXNAME, REDUCE, TITX, TITY ,XFRM12, XFRM13, XFRM1
     *4, XFRM23 ,XFRM24, XFRM34 ,XVARSX ,TITSIZ, GRDSYM, GRDSIZ, CIRS
     *IZ, ASIZE, AFLARE ,SMSZDF, ORAXES, EYEDIR, VUEDIR, VUECEN ,VERTC
     *L, EYESEP, SCRD, SCRZ, EYEDIS, EYEPNT ,XYPART, BARSIZ, TIKSIZ, XY
     *ZBAS, TTHETA ,TPHI, FRELBL, IPATRN, NPATRN, PATRN ,SCLPRM, WINDO
     *W, SCREEN, SYMBOL, NOSYMB ,FACTXY, LBLSIZ, SYMSIZ, XYZLIM, WORLD 
     *,RADRMX, RADRMN, RADAMN, RADANG, RADX0, RADY0, XUNUSD ,USRKBD, U
     *SRSCR, PLTFIL ,ITITDT, LENCRD ,INPFMT, GRDTYP, LINWID, LINCOL, L
     *INTEX, TITCON, ITCNTR ,IUNUSD, NXYZ1, NXYZ2 ,LBLCHR, NDIMNS, IBL
     *KTP, IDIMNS ,NMESH1, NMESH2, MESH1, MESH2, MESH3, NFIELD ,IFIELD
     *, NINCR ,IVARBL, IVRPTR ,LINEAR, NONLIN ,NPOINT, LETSET ,MXECH
     *O, LINES, MAXLNS ,AXANG, MESH2D, REDFAC, GRDTEX, OUTTEX, IAXTEX, 
     *TITEX, DSCAL ,OUTSTR, IPROP, IHTEX, IBLINK, IERASE, LABTEX, TICTE
     *X, NXYLIM, PATSZ ,MARGIN, PSCR, ITXPRI, ITXSEC, OREAL, OCPU, CSCR
     *D, OUTSID ,TITLIN, TITINX, TITZ, TITX1, TITY1, LTDATA, NPLOTS, RE
     *VLEV ,LBLFMT, IYEAR, IMONTH, IDAY, ISIGFG ,DATPTS, ERRPTS, DATXM
     *N, DATXMX, DATYMN, DATYMX, DATZMN, DATZMX ,DATSUM, ERRSUM, DATAVE
     *, ERRAVE, DATCEN, ERRCEN, DATSTD, ERRSTD ,NCSETS, NCCOL, NCROW, F
     *MARKER, H2STAT, TITFAC, TITLOC, TITMAR ,TIKFAC, IWINLEV, WINREL, 
     *WINABS, WINLIM ,ICPOIN, LEVREP, IREPCT, SYDIR, GRDIR, NMESH0, EXY
     *ZLIM, IVPTR ,TITLMX, NXYZDEF1, NXYZDEF2, IFILE_CASE, N_CYCLE, ITX
     *_CYCLE ,SYM_CYCLE, PLOT_EXTENT, FILL_ANGLE, FILL_WIDTH, FILL_TEX 
     *,FILL_INDEX ,N_LINES ,DSLOPE ,MAX_SUBST, BARBRK ,I_VORDER,SHADOW
     *TYP,SHADOWTEX
      COMMON /T2SCRT/ BUFFER, IBUFFR, N_FILE,N_NAME,N_SELECT, ICHSAVE
      COMMON /T2_CHAR/ C_TIT_ESCAPE,C_TIT_SUBSTITUTE
      COMMON /T2_SCRT/ C_FILE, C_NAME, C_SELECT
      INTEGER JOUFIL, ERRFIL, OUTFIL, DBGFIL, INPFIL, NINMAX
      PARAMETER (NINMAX=20)
      INTEGER NINP(NINMAX)
      COMMON /T2TRBK/NINP, JOUFIL, ERRFIL, OUTFIL, DBGFIL, INPFIL
      CHARACTER*512 STRNG, STJOU
      LOGICAL LTOKEN
      REAL FLOTNG
      INTEGER INTERP, KEYORD, NSTRNG, MAXSTR, NSTJOU, LSTJOU, NTOKEN
      INTEGER*4 INTEG
      COMMON /TOKENC/ INTERP, INTEG, FLOTNG, KEYORD, NSTRNG, MAXSTR, ST
     *RNG, NSTJOU, LSTJOU, STJOU, LTOKEN, NTOKEN
      LOGICAL DFLAGS(200),DSCREV(3)
      COMMON /T2FLGD/DFLAGS,DSCREV
      REAL DTITLIN(4), DTITFAC(4), DTITMAR(4)
      INTEGER DGRDTYP, DGRDTEX, DOUTTEX, IDAXTEX, DTITEX, DSHADOWTYP,DS
     *HADOWTEX, IFLDDF(19), NDDIMNS, IDTXPRI, IDTXSEC, LINCLF, LINTXF,
     * LINWDF, DNONLN(3), DNXYZ1(3), DNXYZ2(3), DLABTEX, DTICTEX, DNPAT
     *RN(30), DLBLCHR(3), ND_CYCLE, IDTX_CYCLE(MAX_CYCLE)
      REAL DSYM_CYCLE(MAX_CYCLE)
      REAL DTITSIZ, DGRDSYM, DGRDSIZ, DCIRSIZ(2,3), DASIZE, DAFLARE, D
     *SMSZDF, DORAXES(3), DEYEDIR(3), DVUEDIR(3), DVUECEN(3), DVERTCL(3
     *), DEYESEP, DSCRD, DSCRZ, DEYEDIS, DEYEPNT(3), DBARSIZ(3), DBARBR
     *K(3), DTIKSIZ(3), DXYZBS(3), DTTHETA, DTPHI, DFRELBL(4), DPATRN(2
     *0,30), DSCLPRM(10,3), DWINDOW(4), DSCREEN(2), DSYMBOL, DNOSYMB, 
     *DAXANG(3), DLBLSIZ, DSYMSIZ, DXYZLIM(3,2), DFACTXY(19), DRADANG,
     * DDSCAL, DPATSZ, DTITINX, DTIKFAC, DSYDIR(3), DGRDIR(3)
      COMMON /T2COMD/ DTITSIZ, DGRDSYM, DGRDSIZ, DCIRSIZ, DASIZE, DAFLA
     *RE, DSMSZDF, DORAXES, DEYEDIR, DVUEDIR, DVUECEN, DVERTCL, DEYESE
     *P, DSCRD, DSCRZ, DEYEDIS, DEYEPNT, DBARSIZ, DTIKSIZ, DXYZBS, DTTH
     *ETA, DTPHI, DFRELBL, DNPATRN, DPATRN, DSCLPRM, DWINDOW, DSCREEN,
     * DSYMBOL, DNOSYMB, DAXANG, DLBLSIZ, DSYMSIZ, DXYZLIM, DGRDTYP, D
     *FACTXY, IFLDDF, NDDIMNS, DGRDTEX, DOUTTEX, IDAXTEX, DTITEX, DRADA
     *NG, DDSCAL, DNONLN, DNXYZ1, DNXYZ2, LINCLF, LINTXF, LINWDF, DLABT
     *EX, DTICTEX, DPATSZ, IDTXPRI, IDTXSEC, DTITLIN, DTITINX, DLBLCHR,
     * DTITFAC, DTITMAR, DTIKFAC, DSYDIR, DGRDIR, ND_CYCLE, IDTX_CYCLE,
     * DSYM_CYCLE, DBARBRK,  DSHADOWTYP,DSHADOWTEX
      INTEGER I,IFLAG,ITXTUR
      LOGICAL LSET
      INTEGER IAND
      IFLAG=1
      FLAGS(3)=.FALSE.
      ITXTUR=0
      IPATRN=3
      TICTEX=MOD(TICTEX,4096)+4096*IPATRN
      LSET=.FALSE.
      GOTO 14061
14090 CONTINUE
      TIKFAC=FLOTNG
      GOTO 14061
14100 CONTINUE
      LSET=.TRUE.
      IF (FLOTNG .LT. 0) THEN
      FLOTNG=0.1 
      FLAGS(78)=.FALSE.
      ELSE
      FLAGS(78)=.TRUE.
      ENDIF
      DO 14111 I=1,3
      TIKSIZ(I)=FLOTNG
14111 CONTINUE
14112 CONTINUE
      GOTO 14061
14120 CONTINUE
      LSET=.TRUE.
      LLLL=INTEG.EQ.0
14130 GOTO (14140,14150,14160,14170,14180,14190,14200,14210),IFLAG
14140 CONTINUE
      DO 14221 I=32,35
      FLAGS(I)=LLLL
14221 CONTINUE
14222 CONTINUE
      DO 14231 I=44,46
      FLAGS(I)=LLLL
14231 CONTINUE
14232 CONTINUE
      GOTO 14132
14180 CONTINUE
      FLAGS(32)=LLLL
      FLAGS(45)=.TRUE.
      GOTO 14132
14190 CONTINUE
      FLAGS(33)=LLLL
      FLAGS(44)=.TRUE.
      GOTO 14132
14200 CONTINUE
      FLAGS(34)=LLLL
      FLAGS(45)=.TRUE.
      GOTO 14132
14210 CONTINUE
      FLAGS(35)=LLLL
      FLAGS(44)=.TRUE.
      GOTO 14132
14150 CONTINUE
      FLAGS(33)=LLLL
      FLAGS(35)=LLLL
      FLAGS(44)=LLLL
      GOTO 14132
14160 CONTINUE
      FLAGS(32)=LLLL
      FLAGS(34)=LLLL
      FLAGS(45)=LLLL
      GOTO 14132
14170 CONTINUE
      FLAGS(46)=LLLL
      GOTO 14132
14132 CONTINUE
      GOTO 14061
14240 CONTINUE
      IFLAG=INTEG
      LSET=.TRUE.
      GOTO 14061
14250 CONTINUE
      DO 14261 I=32,35
      DFLAGS(I)=FLAGS(I)
14261 CONTINUE
14262 CONTINUE
      DO 14271 I=44,46
      DFLAGS(I)=FLAGS(I)
14271 CONTINUE
14272 CONTINUE
      DO 14281 I=1,3
      DTIKSIZ(I)=TIKSIZ(I)
14281 CONTINUE
14282 CONTINUE
      DTIKFAC=TIKFAC
      DTICTEX=TICTEX
      DFLAGS(78)=FLAGS(78)
      LSET=.TRUE.
      GOTO 14061
14290 CONTINUE
      TICTEX=IAND(NOT(512*7),TICTEX)+INTEG*512
      LSET=.TRUE.
      GOTO 14061
14300 CONTINUE
      CALL T2GTEX(ITXTUR)
      TICTEX=IAND(NOT(64*7),TICTEX)+ITXTUR*64
      LSET=.TRUE.
      GOTO 14061
14310 CONTINUE
      LSET=.TRUE.
      TICTEX=IAND(NOT(8*7),TICTEX)+INTEG*8
      GOTO 14061
14061 CALL TOKEN(INFOIN,CARDIN,'LONG:0.1:10:3,SIZE:0::-.1,OFF:1,ON,ALL:1
     *,X:2,Y:3,Z:4,LEFT:5,BOTTOM:6,RIGHT:7,TOP:8,PERMANENT,NOCOLOR:0,WHI
     *TE:1,RED:2,GREEN:3,BLUE:4,YELLOW:5,MAGENTA:6,CYAN:7,NOTEXTURE:0,DO
     *:1,DOT:1,DOTS:1,DOTTED:1,DA:2,DASHES:2,DASHED:2,SOLID:4,DOTDASHED:
     *3,DOT-DASH:3,FUNNY:5,DAASHES:7,SPACE:8,PATTERNED:6,INTENSITY:0:9:2
     *,WIDTH:0:9:2,;')
      GOTO (14062,14067,14065,14065,14065,14065,14061,14067, 14065),INTE
     *RP
14065 CALL T2ERR(INFOIN,CARDIN,' ',5)
      GOTO 14061
14067 GOTO ( 14090,14100,14120,14120,14240,14240,14240,14240,14240,14240
     *,14240,14240,14250,14290,14290,14290,14290,14290,14290,14290,14290
     *,14300,14300,14300,14300,14300,14300,14300,14300,14300,14300,14300
     *,14300,14300,14300,14300,14310,14310,14065),KEYORD
14062 CONTINUE
      IF(.not.LSET.and..not.FLAGS(23)) THEN
      TICTEX=0
      FLAGS(78)=.FALSE.
      DO 14321 I=1,3
      TIKSIZ(I)=0.1 
14321 CONTINUE
14322 CONTINUE
      DO 14331 I=44,46
      FLAGS(I)=.TRUE.
14331 CONTINUE
14332 CONTINUE
      DO 14341 I=32,35
      FLAGS(I)=.TRUE.
14341 CONTINUE
14342 CONTINUE
      ENDIF
      END
      SUBROUTINE T2_SET_SCALES(INFOIN,CARDIN)
      IMPLICIT NONE
      INTEGER INFOIN(10)
      CHARACTER*(*) CARDIN
      REAL BUFFR(10)
      COMMON /T2FLGC/ FLAGS(200), LTRAP,LHANDL,LSYERR,LSCREV
      LOGICAL FLAGS, LTRAP,LHANDL,LSYERR,LSCREV(3)
      INTEGER RELFLAG 
      PARAMETER (RELFLAG=151)
      INTEGER IWINLEV 
      INTEGER NWINLEV , MAX_FILL 
      PARAMETER (NWINLEV =4)
      PARAMETER (MAX_FILL=4)
      REAL GRDSYM, GRDSIZ, DATDAT(2,8), H2STAT(12), TITLIN(4), TITFA
     *C(4), TITLOC(4), TITMAR(4), TITLMX(4), TIKFAC, TITINX, TITX1, TIT
     *Y1, TITX, TITY, TITZ, TITSIZ, TITCON(5), REVLEV, REDUCE(5), XFR
     *M12(12), XFRM13(12), XFRM14(12), XFRM23(12), XFRM24(12), XFRM34(6
     *), XVARSX(20), CIRSIZ(2,3), ASIZE, AFLARE, SMSZDF, ORAXES(3), EY
     *EDIR(3), VUEDIR(3), VUECEN(3), VERTCL(3), EYESEP, SCRD, SCRZ, EYE
     *DIS, EYEPNT(3), XYPART(2, 2), BARSIZ(3), BARBRK(3), TIKSIZ(3), XY
     *ZBAS(3), TTHETA, TPHI, FRELBL(4), PATRN(20,30), SCLPRM(10,3), WI
     *NDOW(4), SCREEN(2), SYMBOL, NOSYMB, FACTXY(19), LBLSIZ, SYMSIZ, X
     *YZLIM(3,2), WORLD(3), RADRMX, RADRMN, RADAMN, RADANG, RADX0, RADY
     *0, XUNUSD(6), AXANG(3), REDFAC, DSCAL, PATSZ, MARGIN(4), PSCR(2
     *), OREAL, OCPU, CSCRD, DATPTS, ERRPTS, DATXMN, DATXMX, DATYMN, DA
     *TYMX, DATZMN, DATZMX, DATSUM, ERRSUM, DATAVE, ERRAVE, DATCEN, ERR
     *CEN, DATSTD, ERRSTD, WINREL(2,2,NWINLEV),WINABS(2,2,NWINLEV),WINL
     *IM(2,2), FMARKER(3,8), SYDIR(3), GRDIR(3), EXYZLIM(3,2), DSLOPE(2
     *,2)
      REAL PLOT_EXTENT(2,2),FILL_ANGLE(MAX_FILL),FILL_WIDTH(MAX_FILL)
      INTEGER FILL_INDEX, FILL_TEX(MAX_FILL), N_LINES(6)
      EQUIVALENCE (DATDAT, DATPTS)
      INTEGER MAXREP
      PARAMETER (MAXREP=5)
      INTEGER IPATRN, NPATRN(30), NXYLIM(3,2), NPLOTS, NCSETS, NCCOL, N
     *CROW, IYEAR, IMONTH, IDAY, ISIGFG, ITXPRI, ITXSEC, ITITDT(3), L
     *ENCRD, IPROP, IHTEX, IBLINK, IERASE, ITCNTR, IUNUSD, NXYZ1(3), 
     *NXYZ2(3), LBLFMT(3), LBLCHR(3), NDIMNS(3), IBLKTP, IDIMNS, NMES
     *H0, NMESH1, NMESH2, MESH1, MESH2, MESH3, MESH2D, MESHN(3), NMESHN(
     *2), NFIELD, IFIELD(19), NINCR, NPOINT, IVARBL(19), IVPTR(19), I_
     *VORDER(19,2), LINEAR(4), NONLIN(4), MXECHO, LINES, MAXLNS, USRK
     *BD, USRSCR, PLTFIL, LINWID, LINCOL, LINTEX, ICPOIN(3), IREPCT(MA
     *XREP), LEVREP, GRDTYP, GRDTEX, OUTTEX, IAXTEX, TITEX, LETSET, LAB
     *TEX, TICTEX, SHADOWTYP,SHADOWTEX, NXYZDEF1(10), NXYZDEF2(10), IF
     *ILE_CASE ,MAX_SUBST
      INTEGER MAX_CYCLE
      PARAMETER (MAX_CYCLE=20)
      INTEGER N_CYCLE, ITX_CYCLE(MAX_CYCLE)
      REAL SYM_CYCLE(MAX_CYCLE)
      EQUIVALENCE (NMESH1,NMESHN)
      EQUIVALENCE (MESH1,MESHN)
      INTEGER IBUFFR(400)
      REAL BUFFER(400)
      INTEGER NCHSAVE 
      PARAMETER (NCHSAVE=2*512) 
      INTEGER*4 ICHSAVE(NCHSAVE)
      INTEGER*4 IVRPTR(15)
      CHARACTER*512 OUTSTR,C_FILE, C_NAME, C_SELECT
      CHARACTER C_TIT_ESCAPE*1,C_TIT_SUBSTITUTE*2
      INTEGER N_FILE, N_NAME, N_SELECT
      CHARACTER*8 PXNAME
      CHARACTER*64 INPFMT
      LOGICAL LTDATA, OUTSID(4)
      COMMON /T2COM/ PXNAME, REDUCE, TITX, TITY ,XFRM12, XFRM13, XFRM1
     *4, XFRM23 ,XFRM24, XFRM34 ,XVARSX ,TITSIZ, GRDSYM, GRDSIZ, CIRS
     *IZ, ASIZE, AFLARE ,SMSZDF, ORAXES, EYEDIR, VUEDIR, VUECEN ,VERTC
     *L, EYESEP, SCRD, SCRZ, EYEDIS, EYEPNT ,XYPART, BARSIZ, TIKSIZ, XY
     *ZBAS, TTHETA ,TPHI, FRELBL, IPATRN, NPATRN, PATRN ,SCLPRM, WINDO
     *W, SCREEN, SYMBOL, NOSYMB ,FACTXY, LBLSIZ, SYMSIZ, XYZLIM, WORLD 
     *,RADRMX, RADRMN, RADAMN, RADANG, RADX0, RADY0, XUNUSD ,USRKBD, U
     *SRSCR, PLTFIL ,ITITDT, LENCRD ,INPFMT, GRDTYP, LINWID, LINCOL, L
     *INTEX, TITCON, ITCNTR ,IUNUSD, NXYZ1, NXYZ2 ,LBLCHR, NDIMNS, IBL
     *KTP, IDIMNS ,NMESH1, NMESH2, MESH1, MESH2, MESH3, NFIELD ,IFIELD
     *, NINCR ,IVARBL, IVRPTR ,LINEAR, NONLIN ,NPOINT, LETSET ,MXECH
     *O, LINES, MAXLNS ,AXANG, MESH2D, REDFAC, GRDTEX, OUTTEX, IAXTEX, 
     *TITEX, DSCAL ,OUTSTR, IPROP, IHTEX, IBLINK, IERASE, LABTEX, TICTE
     *X, NXYLIM, PATSZ ,MARGIN, PSCR, ITXPRI, ITXSEC, OREAL, OCPU, CSCR
     *D, OUTSID ,TITLIN, TITINX, TITZ, TITX1, TITY1, LTDATA, NPLOTS, RE
     *VLEV ,LBLFMT, IYEAR, IMONTH, IDAY, ISIGFG ,DATPTS, ERRPTS, DATXM
     *N, DATXMX, DATYMN, DATYMX, DATZMN, DATZMX ,DATSUM, ERRSUM, DATAVE
     *, ERRAVE, DATCEN, ERRCEN, DATSTD, ERRSTD ,NCSETS, NCCOL, NCROW, F
     *MARKER, H2STAT, TITFAC, TITLOC, TITMAR ,TIKFAC, IWINLEV, WINREL, 
     *WINABS, WINLIM ,ICPOIN, LEVREP, IREPCT, SYDIR, GRDIR, NMESH0, EXY
     *ZLIM, IVPTR ,TITLMX, NXYZDEF1, NXYZDEF2, IFILE_CASE, N_CYCLE, ITX
     *_CYCLE ,SYM_CYCLE, PLOT_EXTENT, FILL_ANGLE, FILL_WIDTH, FILL_TEX 
     *,FILL_INDEX ,N_LINES ,DSLOPE ,MAX_SUBST, BARBRK ,I_VORDER,SHADOW
     *TYP,SHADOWTEX
      COMMON /T2SCRT/ BUFFER, IBUFFR, N_FILE,N_NAME,N_SELECT, ICHSAVE
      COMMON /T2_CHAR/ C_TIT_ESCAPE,C_TIT_SUBSTITUTE
      COMMON /T2_SCRT/ C_FILE, C_NAME, C_SELECT
      INTEGER JOUFIL, ERRFIL, OUTFIL, DBGFIL, INPFIL, NINMAX
      PARAMETER (NINMAX=20)
      INTEGER NINP(NINMAX)
      COMMON /T2TRBK/NINP, JOUFIL, ERRFIL, OUTFIL, DBGFIL, INPFIL
      CHARACTER*512 STRNG, STJOU
      LOGICAL LTOKEN
      REAL FLOTNG
      INTEGER INTERP, KEYORD, NSTRNG, MAXSTR, NSTJOU, LSTJOU, NTOKEN
      INTEGER*4 INTEG
      COMMON /TOKENC/ INTERP, INTEG, FLOTNG, KEYORD, NSTRNG, MAXSTR, ST
     *RNG, NSTJOU, LSTJOU, STJOU, LTOKEN, NTOKEN
      LOGICAL DFLAGS(200),DSCREV(3)
      COMMON /T2FLGD/DFLAGS,DSCREV
      REAL DTITLIN(4), DTITFAC(4), DTITMAR(4)
      INTEGER DGRDTYP, DGRDTEX, DOUTTEX, IDAXTEX, DTITEX, DSHADOWTYP,DS
     *HADOWTEX, IFLDDF(19), NDDIMNS, IDTXPRI, IDTXSEC, LINCLF, LINTXF,
     * LINWDF, DNONLN(3), DNXYZ1(3), DNXYZ2(3), DLABTEX, DTICTEX, DNPAT
     *RN(30), DLBLCHR(3), ND_CYCLE, IDTX_CYCLE(MAX_CYCLE)
      REAL DSYM_CYCLE(MAX_CYCLE)
      REAL DTITSIZ, DGRDSYM, DGRDSIZ, DCIRSIZ(2,3), DASIZE, DAFLARE, D
     *SMSZDF, DORAXES(3), DEYEDIR(3), DVUEDIR(3), DVUECEN(3), DVERTCL(3
     *), DEYESEP, DSCRD, DSCRZ, DEYEDIS, DEYEPNT(3), DBARSIZ(3), DBARBR
     *K(3), DTIKSIZ(3), DXYZBS(3), DTTHETA, DTPHI, DFRELBL(4), DPATRN(2
     *0,30), DSCLPRM(10,3), DWINDOW(4), DSCREEN(2), DSYMBOL, DNOSYMB, 
     *DAXANG(3), DLBLSIZ, DSYMSIZ, DXYZLIM(3,2), DFACTXY(19), DRADANG,
     * DDSCAL, DPATSZ, DTITINX, DTIKFAC, DSYDIR(3), DGRDIR(3)
      COMMON /T2COMD/ DTITSIZ, DGRDSYM, DGRDSIZ, DCIRSIZ, DASIZE, DAFLA
     *RE, DSMSZDF, DORAXES, DEYEDIR, DVUEDIR, DVUECEN, DVERTCL, DEYESE
     *P, DSCRD, DSCRZ, DEYEDIS, DEYEPNT, DBARSIZ, DTIKSIZ, DXYZBS, DTTH
     *ETA, DTPHI, DFRELBL, DNPATRN, DPATRN, DSCLPRM, DWINDOW, DSCREEN,
     * DSYMBOL, DNOSYMB, DAXANG, DLBLSIZ, DSYMSIZ, DXYZLIM, DGRDTYP, D
     *FACTXY, IFLDDF, NDDIMNS, DGRDTEX, DOUTTEX, IDAXTEX, DTITEX, DRADA
     *NG, DDSCAL, DNONLN, DNXYZ1, DNXYZ2, LINCLF, LINTXF, LINWDF, DLABT
     *EX, DTICTEX, DPATSZ, IDTXPRI, IDTXSEC, DTITLIN, DTITINX, DLBLCHR,
     * DTITFAC, DTITMAR, DTIKFAC, DSYDIR, DGRDIR, ND_CYCLE, IDTX_CYCLE,
     * DSYM_CYCLE, DBARBRK,  DSHADOWTYP,DSHADOWTEX
      INTEGER NSCL(2)
      LOGICAL LTEST,LPERM,LBUF(10),LREVRS
      INTEGER I,J,I1,I2,IXYMIN,IXYMAX,ISCAL,N1,N2,ISH1,ISH2
      INTEGER IAND,IOR
      REAL SFAC(4)
      DATA SFAC/ 1.0E0, 60.,3600.,86400./
      GOTO 14351
14380 CONTINUE
      IXYMIN=INTEG/10
      IXYMAX=MOD(INTEG,10)
      DO 14391 I=1,10
      BUFFR(I)=SCLPRM(I,IXYMIN)
      LBUF(I)=.false.
14391 CONTINUE
14392 CONTINUE
      LREVRS=LSCREV(IXYMIN)
      ISCAL=NONLIN(IXYMIN)
      N1=0
      N2=0
      ISH1=0
      ISH2=0
      GOTO 14401
14430 CONTINUE
      ISCAL=-MOD(INTEG,10)
      I=INTEG/10+1
      BUFFR(4)=SFAC(I)
14440 CONTINUE
      IF (.not. LBUF(1)) BUFFR(1)=10
      IF (ISCAL.eq.-6) THEN
      IF (.not. LBUF(2)) BUFFR(2)=0
      IF (.not. LBUF(3)) BUFFR(3)=1.
      ENDIF
      LREVRS=.false.
      GOTO 14401
14450 CONTINUE
      ISCAL=-8
      BUFFR(4)=FLOTNG
      GOTO 14440
14460 CONTINUE
      ISCAL=-8
      BUFFR(4)=1/FLOTNG
      GOTO 14440
14470 CONTINUE
      LREVRS=LTOKEN
      GOTO 14401
14480 CONTINUE
      ISCAL=INTEG
      LREVRS=.false.
      IF (.not.LBUF(1)) BUFFR(1)=10.
      DO 14491 I=2,10
      IF (.not.LBUF(I)) BUFFR(I)=0
14491 CONTINUE
14492 CONTINUE
      DO 14501 I=2,10
      GOTO 14511
14520 CONTINUE
      BUFFR(I)=FLOTNG
      LBUF(I)=.true.
      GOTO 14512
14515 CONTINUE
      INFOIN(9)=-1
      GOTO 14512
14511 CALL TOKEN(INFOIN,CARDIN,';')
      GOTO (14515,14515,14520,14520,14515,14515,14515,14515,14515),INTER
     *P
14512 CONTINUE
14501 CONTINUE
14502 CONTINUE
      GOTO 14401
14530 CONTINUE
      BUFFR(1)=FLOTNG
      LBUF(1)=.true.
      GOTO 14401
14540 CONTINUE
      BUFFR(2)=FLOTNG
      LBUF(2)=.true.
      GOTO 14401
14550 CONTINUE
      BUFFR(3)=FLOTNG
      LBUF(3)=.true.
      GOTO 14401
14560 CONTINUE
      DO 14571 I=1,3
      DO 14581 J=1,10
      DSCLPRM(J,I)=SCLPRM(J,I)
14581 CONTINUE
14582 CONTINUE
      DNONLN(I)=NONLIN(I)
      DNXYZ1(I)=NXYZ1(I)
      DNXYZ2(I)=NXYZ2(I)
      DSCREV(I)=LSCREV(I)
14571 CONTINUE
14572 CONTINUE
      I1=N1
      I2=N2
      IF (ISH1.ne.0) I1=ISIGN(I1,ISH1)
      IF (ISH2.ne.0) I2=ISIGN(I2,ISH2)
      DO 14591 I=IXYMIN,IXYMAX
      DNONLN(I)=ISCAL
      DNXYZ1(I)=I1
      DNXYZ2(I)=I2
      DSCREV(I)=LREVRS
      DO 14601 J=1,10
      DSCLPRM(J,I)=BUFFR(J)
14601 CONTINUE
14602 CONTINUE
14591 CONTINUE
14592 CONTINUE
      GOTO 14401
14610 CONTINUE
      IF(ISCAL.eq.-2.or.ISCAL.eq.-3) THEN
      N2=(INTEG+1)*2**10-1
      ELSE
      GOTO 14620
      ENDIF
      GOTO 14401
14630 CONTINUE
      IF(ISCAL.eq.-2.or.ISCAL.eq.-3) THEN
      N1=IAND(N1,2**10-1)+INTEG*2**10
      ELSE
14620 CONTINUE
      CALL T2ERR(INFOIN,CARDIN,'*** ERROR *** Illegal if not LOG scale',
     *4)
      ENDIF
      GOTO 14401
14640 CONTINUE
      N1=ABS(N1)
      IF (ISCAL.lt.0.and.N1.eq.0) THEN
      N1=NXYZDEF1(-ISCAL)
      ISH1=NXYZDEF1(-ISCAL)
      ENDIF
      GOTO 14651
14660 CONTINUE
      IF(ISCAL.eq.-2.or.ISCAL.eq.-3) THEN
      IF (INTEG.ge.1 .and. INTEG.le.9) THEN
      N1=IOR(N1,2**INTEG)
      ELSE
      CALL T2ERR(INFOIN,CARDIN,'*** ERROR *** Bad tick number (1-9)',4)
      ENDIF
      ELSE
      N1=INTEG
      ENDIF
      GOTO 14651
14690 CONTINUE
      N1=IAND(N1,2**10*31)+INTEG
      GOTO 14651
14700 CONTINUE
      IF (.not. LTOKEN) INTEG=-INTEG
      IF (ABS(INTEG).eq.2) THEN
      IF(ISCAL/2.ne.-1) GOTO 14620
      ENDIF
      N1=IOR(N1,2**17)
      ISH1=INTEG
      GOTO 14651
14670 GOTO ( 14690,14690,14700,14700,14700,14655),KEYORD
14655 CONTINUE
      INFOIN(9)=-1
      GOTO 14652
14651 CALL TOKEN(INFOIN,CARDIN,'ALL:2,NONE:1,EXPONENTIAL:-2:Y,SHORT:-1:Y
     *,LONG:1:Y,;')
      GOTO (14652,14670,14660,14660,14655,14655,14655,14670,14655),INTER
     *P
14652 CONTINUE
      GOTO 14401
14710 CONTINUE
      N2=ABS(N2)
      IF (ISCAL.lt.0.and.N2.eq.0) THEN
      N2=NXYZDEF2(-ISCAL)
      ISH2=NXYZDEF2(-ISCAL)
      ENDIF
      GOTO 14721
14730 CONTINUE
      IF(ISCAL.eq.-2.or.ISCAL.eq.-3) THEN
      IF (INTEG.ge.1 .and. INTEG.le.9) THEN
      N2=IOR(N2,2**INTEG)
      ELSE
      CALL T2ERR(INFOIN,CARDIN,'*** ERROR *** Bad tick number (1-9)',4)
      ENDIF
      ELSE
      N2=-INTEG
      ENDIF
      GOTO 14721
14760 CONTINUE
      N2=IAND(N2,2**10*31)+INTEG
      GOTO 14721
14770 CONTINUE
      IF (.not. LTOKEN) INTEG=-INTEG
      N2=IOR(N2,2**17)
      ISH2=INTEG
      GOTO 14721
14740 GOTO ( 14760,14760,14770,14770,14725),KEYORD
14725 CONTINUE
      INFOIN(9)=-1
      GOTO 14722
14721 CALL TOKEN(INFOIN,CARDIN,'ALL:2,NONE:1,SHORT:-1:Y,LONG:1:Y,;')
      GOTO (14722,14740,14730,14730,14725,14725,14725,14740,14725),INTER
     *P
14722 CONTINUE
      GOTO 14401
14410 GOTO ( 14430,14430,14430,14430,14430,14430,14430,14430,14430,14430
     *,14430,14450,14460,14470,14480,14530,14540,14540,14550,14560,14610
     *,14630,14640,14710,14405),KEYORD
14780 CONTINUE
      N1=INTEG
      GOTO 14791
14800 CONTINUE
      N2=INTEG
      GOTO 14792
14795 CONTINUE
      N2=0
      INFOIN(9)=-1
      GOTO 14792
14791 CALL TOKEN(INFOIN,CARDIN,';')
      GOTO (14795,14795,14800,14800,14795,14795,14795,14795,14795),INTER
     *P
14792 CONTINUE
      GOTO 14401
14405 CONTINUE
      INFOIN(9)=-1
      GOTO 14402
14401 CALL TOKEN(INFOIN,CARDIN,'LINEAR:1,LOGARITHMIC:2,-LOGARITHMIC:3,MO
     *NTHS:4,YEARS:5,NORMAL:6,TIME:27,DAYS:37,HOURS:27,MINUTES:17,SECOND
     *S:7,POWER:0.1:100:2,ROOT:0.1:100:2,REVERSE:Y,USER:0:100:0,BASE:2:1
     *00:10,OFFSET,MEAN:::0,DEVIATION:::1,PERMANENT,SUBTICKS:0:9:4,DECAD
     *ES:0:31:1,LABELS,TICKS,;')
      GOTO (14402,14410,14780,14780,14405,14405,14405,14410,14405),INTER
     *P
14402 CONTINUE
      DO 14811 I=IXYMIN,IXYMAX
      IF (ISCAL.NE.NONLIN(I)) FLAGS(75)=.FALSE.
      FLAGS(I+61)=.TRUE.
      NONLIN(I)=ISCAL
      IF (ISH1.ne.0) N1=ISIGN(N1,ISH1)
      IF (ISH2.ne.0) N2=ISIGN(N2,ISH2)
      NXYZ1(I)=N1
      NXYZ2(I)=N2
      LSCREV(I)=LREVRS
      DO 14821 J=1,10
      SCLPRM(J,I)=BUFFR(J)
14821 CONTINUE
14822 CONTINUE
14811 CONTINUE
14812 CONTINUE
      GOTO 14351
14351 CALL TOKEN(INFOIN,CARDIN,'X:11,Y:22,Z:33,ALL:13,;')
      GOTO (14352,14357,14355,14355,14355,14355,14351,14357, 14355),INTE
     *RP
14355 CALL T2ERR(INFOIN,CARDIN,' ',5)
      GOTO 14351
14357 GOTO ( 14380,14380,14380,14380,14355),KEYORD
14352 CONTINUE
      END
      SUBROUTINE T2_SET_Shadow(INFOIN,CARDIN)
      IMPLICIT NONE
      INTEGER INFOIN(10)
      CHARACTER*(*) CARDIN
      COMMON /T2FLGC/ FLAGS(200), LTRAP,LHANDL,LSYERR,LSCREV
      LOGICAL FLAGS, LTRAP,LHANDL,LSYERR,LSCREV(3)
      INTEGER RELFLAG 
      PARAMETER (RELFLAG=151)
      INTEGER IWINLEV 
      INTEGER NWINLEV , MAX_FILL 
      PARAMETER (NWINLEV =4)
      PARAMETER (MAX_FILL=4)
      REAL GRDSYM, GRDSIZ, DATDAT(2,8), H2STAT(12), TITLIN(4), TITFA
     *C(4), TITLOC(4), TITMAR(4), TITLMX(4), TIKFAC, TITINX, TITX1, TIT
     *Y1, TITX, TITY, TITZ, TITSIZ, TITCON(5), REVLEV, REDUCE(5), XFR
     *M12(12), XFRM13(12), XFRM14(12), XFRM23(12), XFRM24(12), XFRM34(6
     *), XVARSX(20), CIRSIZ(2,3), ASIZE, AFLARE, SMSZDF, ORAXES(3), EY
     *EDIR(3), VUEDIR(3), VUECEN(3), VERTCL(3), EYESEP, SCRD, SCRZ, EYE
     *DIS, EYEPNT(3), XYPART(2, 2), BARSIZ(3), BARBRK(3), TIKSIZ(3), XY
     *ZBAS(3), TTHETA, TPHI, FRELBL(4), PATRN(20,30), SCLPRM(10,3), WI
     *NDOW(4), SCREEN(2), SYMBOL, NOSYMB, FACTXY(19), LBLSIZ, SYMSIZ, X
     *YZLIM(3,2), WORLD(3), RADRMX, RADRMN, RADAMN, RADANG, RADX0, RADY
     *0, XUNUSD(6), AXANG(3), REDFAC, DSCAL, PATSZ, MARGIN(4), PSCR(2
     *), OREAL, OCPU, CSCRD, DATPTS, ERRPTS, DATXMN, DATXMX, DATYMN, DA
     *TYMX, DATZMN, DATZMX, DATSUM, ERRSUM, DATAVE, ERRAVE, DATCEN, ERR
     *CEN, DATSTD, ERRSTD, WINREL(2,2,NWINLEV),WINABS(2,2,NWINLEV),WINL
     *IM(2,2), FMARKER(3,8), SYDIR(3), GRDIR(3), EXYZLIM(3,2), DSLOPE(2
     *,2)
      REAL PLOT_EXTENT(2,2),FILL_ANGLE(MAX_FILL),FILL_WIDTH(MAX_FILL)
      INTEGER FILL_INDEX, FILL_TEX(MAX_FILL), N_LINES(6)
      EQUIVALENCE (DATDAT, DATPTS)
      INTEGER MAXREP
      PARAMETER (MAXREP=5)
      INTEGER IPATRN, NPATRN(30), NXYLIM(3,2), NPLOTS, NCSETS, NCCOL, N
     *CROW, IYEAR, IMONTH, IDAY, ISIGFG, ITXPRI, ITXSEC, ITITDT(3), L
     *ENCRD, IPROP, IHTEX, IBLINK, IERASE, ITCNTR, IUNUSD, NXYZ1(3), 
     *NXYZ2(3), LBLFMT(3), LBLCHR(3), NDIMNS(3), IBLKTP, IDIMNS, NMES
     *H0, NMESH1, NMESH2, MESH1, MESH2, MESH3, MESH2D, MESHN(3), NMESHN(
     *2), NFIELD, IFIELD(19), NINCR, NPOINT, IVARBL(19), IVPTR(19), I_
     *VORDER(19,2), LINEAR(4), NONLIN(4), MXECHO, LINES, MAXLNS, USRK
     *BD, USRSCR, PLTFIL, LINWID, LINCOL, LINTEX, ICPOIN(3), IREPCT(MA
     *XREP), LEVREP, GRDTYP, GRDTEX, OUTTEX, IAXTEX, TITEX, LETSET, LAB
     *TEX, TICTEX, SHADOWTYP,SHADOWTEX, NXYZDEF1(10), NXYZDEF2(10), IF
     *ILE_CASE ,MAX_SUBST
      INTEGER MAX_CYCLE
      PARAMETER (MAX_CYCLE=20)
      INTEGER N_CYCLE, ITX_CYCLE(MAX_CYCLE)
      REAL SYM_CYCLE(MAX_CYCLE)
      EQUIVALENCE (NMESH1,NMESHN)
      EQUIVALENCE (MESH1,MESHN)
      INTEGER IBUFFR(400)
      REAL BUFFER(400)
      INTEGER NCHSAVE 
      PARAMETER (NCHSAVE=2*512) 
      INTEGER*4 ICHSAVE(NCHSAVE)
      INTEGER*4 IVRPTR(15)
      CHARACTER*512 OUTSTR,C_FILE, C_NAME, C_SELECT
      CHARACTER C_TIT_ESCAPE*1,C_TIT_SUBSTITUTE*2
      INTEGER N_FILE, N_NAME, N_SELECT
      CHARACTER*8 PXNAME
      CHARACTER*64 INPFMT
      LOGICAL LTDATA, OUTSID(4)
      COMMON /T2COM/ PXNAME, REDUCE, TITX, TITY ,XFRM12, XFRM13, XFRM1
     *4, XFRM23 ,XFRM24, XFRM34 ,XVARSX ,TITSIZ, GRDSYM, GRDSIZ, CIRS
     *IZ, ASIZE, AFLARE ,SMSZDF, ORAXES, EYEDIR, VUEDIR, VUECEN ,VERTC
     *L, EYESEP, SCRD, SCRZ, EYEDIS, EYEPNT ,XYPART, BARSIZ, TIKSIZ, XY
     *ZBAS, TTHETA ,TPHI, FRELBL, IPATRN, NPATRN, PATRN ,SCLPRM, WINDO
     *W, SCREEN, SYMBOL, NOSYMB ,FACTXY, LBLSIZ, SYMSIZ, XYZLIM, WORLD 
     *,RADRMX, RADRMN, RADAMN, RADANG, RADX0, RADY0, XUNUSD ,USRKBD, U
     *SRSCR, PLTFIL ,ITITDT, LENCRD ,INPFMT, GRDTYP, LINWID, LINCOL, L
     *INTEX, TITCON, ITCNTR ,IUNUSD, NXYZ1, NXYZ2 ,LBLCHR, NDIMNS, IBL
     *KTP, IDIMNS ,NMESH1, NMESH2, MESH1, MESH2, MESH3, NFIELD ,IFIELD
     *, NINCR ,IVARBL, IVRPTR ,LINEAR, NONLIN ,NPOINT, LETSET ,MXECH
     *O, LINES, MAXLNS ,AXANG, MESH2D, REDFAC, GRDTEX, OUTTEX, IAXTEX, 
     *TITEX, DSCAL ,OUTSTR, IPROP, IHTEX, IBLINK, IERASE, LABTEX, TICTE
     *X, NXYLIM, PATSZ ,MARGIN, PSCR, ITXPRI, ITXSEC, OREAL, OCPU, CSCR
     *D, OUTSID ,TITLIN, TITINX, TITZ, TITX1, TITY1, LTDATA, NPLOTS, RE
     *VLEV ,LBLFMT, IYEAR, IMONTH, IDAY, ISIGFG ,DATPTS, ERRPTS, DATXM
     *N, DATXMX, DATYMN, DATYMX, DATZMN, DATZMX ,DATSUM, ERRSUM, DATAVE
     *, ERRAVE, DATCEN, ERRCEN, DATSTD, ERRSTD ,NCSETS, NCCOL, NCROW, F
     *MARKER, H2STAT, TITFAC, TITLOC, TITMAR ,TIKFAC, IWINLEV, WINREL, 
     *WINABS, WINLIM ,ICPOIN, LEVREP, IREPCT, SYDIR, GRDIR, NMESH0, EXY
     *ZLIM, IVPTR ,TITLMX, NXYZDEF1, NXYZDEF2, IFILE_CASE, N_CYCLE, ITX
     *_CYCLE ,SYM_CYCLE, PLOT_EXTENT, FILL_ANGLE, FILL_WIDTH, FILL_TEX 
     *,FILL_INDEX ,N_LINES ,DSLOPE ,MAX_SUBST, BARBRK ,I_VORDER,SHADOW
     *TYP,SHADOWTEX
      COMMON /T2SCRT/ BUFFER, IBUFFR, N_FILE,N_NAME,N_SELECT, ICHSAVE
      COMMON /T2_CHAR/ C_TIT_ESCAPE,C_TIT_SUBSTITUTE
      COMMON /T2_SCRT/ C_FILE, C_NAME, C_SELECT
      INTEGER JOUFIL, ERRFIL, OUTFIL, DBGFIL, INPFIL, NINMAX
      PARAMETER (NINMAX=20)
      INTEGER NINP(NINMAX)
      COMMON /T2TRBK/NINP, JOUFIL, ERRFIL, OUTFIL, DBGFIL, INPFIL
      CHARACTER*512 STRNG, STJOU
      LOGICAL LTOKEN
      REAL FLOTNG
      INTEGER INTERP, KEYORD, NSTRNG, MAXSTR, NSTJOU, LSTJOU, NTOKEN
      INTEGER*4 INTEG
      COMMON /TOKENC/ INTERP, INTEG, FLOTNG, KEYORD, NSTRNG, MAXSTR, ST
     *RNG, NSTJOU, LSTJOU, STJOU, LTOKEN, NTOKEN
      LOGICAL DFLAGS(200),DSCREV(3)
      COMMON /T2FLGD/DFLAGS,DSCREV
      REAL DTITLIN(4), DTITFAC(4), DTITMAR(4)
      INTEGER DGRDTYP, DGRDTEX, DOUTTEX, IDAXTEX, DTITEX, DSHADOWTYP,DS
     *HADOWTEX, IFLDDF(19), NDDIMNS, IDTXPRI, IDTXSEC, LINCLF, LINTXF,
     * LINWDF, DNONLN(3), DNXYZ1(3), DNXYZ2(3), DLABTEX, DTICTEX, DNPAT
     *RN(30), DLBLCHR(3), ND_CYCLE, IDTX_CYCLE(MAX_CYCLE)
      REAL DSYM_CYCLE(MAX_CYCLE)
      REAL DTITSIZ, DGRDSYM, DGRDSIZ, DCIRSIZ(2,3), DASIZE, DAFLARE, D
     *SMSZDF, DORAXES(3), DEYEDIR(3), DVUEDIR(3), DVUECEN(3), DVERTCL(3
     *), DEYESEP, DSCRD, DSCRZ, DEYEDIS, DEYEPNT(3), DBARSIZ(3), DBARBR
     *K(3), DTIKSIZ(3), DXYZBS(3), DTTHETA, DTPHI, DFRELBL(4), DPATRN(2
     *0,30), DSCLPRM(10,3), DWINDOW(4), DSCREEN(2), DSYMBOL, DNOSYMB, 
     *DAXANG(3), DLBLSIZ, DSYMSIZ, DXYZLIM(3,2), DFACTXY(19), DRADANG,
     * DDSCAL, DPATSZ, DTITINX, DTIKFAC, DSYDIR(3), DGRDIR(3)
      COMMON /T2COMD/ DTITSIZ, DGRDSYM, DGRDSIZ, DCIRSIZ, DASIZE, DAFLA
     *RE, DSMSZDF, DORAXES, DEYEDIR, DVUEDIR, DVUECEN, DVERTCL, DEYESE
     *P, DSCRD, DSCRZ, DEYEDIS, DEYEPNT, DBARSIZ, DTIKSIZ, DXYZBS, DTTH
     *ETA, DTPHI, DFRELBL, DNPATRN, DPATRN, DSCLPRM, DWINDOW, DSCREEN,
     * DSYMBOL, DNOSYMB, DAXANG, DLBLSIZ, DSYMSIZ, DXYZLIM, DGRDTYP, D
     *FACTXY, IFLDDF, NDDIMNS, DGRDTEX, DOUTTEX, IDAXTEX, DTITEX, DRADA
     *NG, DDSCAL, DNONLN, DNXYZ1, DNXYZ2, LINCLF, LINTXF, LINWDF, DLABT
     *EX, DTICTEX, DPATSZ, IDTXPRI, IDTXSEC, DTITLIN, DTITINX, DLBLCHR,
     * DTITFAC, DTITMAR, DTIKFAC, DSYDIR, DGRDIR, ND_CYCLE, IDTX_CYCLE,
     * DSYM_CYCLE, DBARBRK,  DSHADOWTYP,DSHADOWTEX
      INTEGER I,LCOUNT,ITXTUR
      REAL TXSYM
      INTEGER IAND,IOR
      LCOUNT=0
      ITXTUR=0
      IPATRN=6
      SHADOWTEX=MOD(SHADOWTEX,4096)+4096*IPATRN
14831 CONTINUE
      LCOUNT=LCOUNT+1
      GOTO 14841
14850 CONTINUE
      IF (LCOUNT.eq.1) THEN
      SHADOWTEX=0
      SHADOWTYP=0
      ENDIF
      RETURN
14880 CONTINUE
      IF (LTOKEN) THEN
      SHADOWTYP=IOR(SHADOWTYP,INTEG)
      ELSE
      SHADOWTYP=IAND(SHADOWTYP,NOT(INTEG))
      ENDIF
      GOTO 14842
14890 CONTINUE
      DSHADOWTEX=SHADOWTEX
      DSHADOWTYP=SHADOWTYP
      GOTO 14842
14900 CONTINUE
      SHADOWTEX=IAND(NOT(512*7),SHADOWTEX)+INTEG*512
      GOTO 14842
14910 CONTINUE
      CALL T2GTEX(ITXTUR)
      SHADOWTEX=IAND(NOT(64*7),SHADOWTEX)+ITXTUR*64
      GOTO 14842
14920 CONTINUE
      SHADOWTEX=IAND(NOT(8*7),SHADOWTEX)+INTEG*8
      GOTO 14842
14860 GOTO ( 14880,14880,14880,14880,14880,14880,14880,14880,14890,14900
     *,14900,14900,14900,14900,14900,14900,14900,14910,14910,14910,14910
     *,14910,14910,14910,14910,14910,14910,14910,14910,14910,14910,14910
     *,14920,14920,14900,14845),KEYORD
14841 CALL TOKEN(INFOIN,CARDIN,'ALL:-1:Y,SYMBOL:8:Y,YZ:16:Y,ZX:32:Y,XY:6
     *4:Y,X:1:Y,Y:2:Y,Z:4:Y,PERMANENT,NOCOLOR:0,WHITE:1,RED:2,GREEN:3,BL
     *UE:4,YELLOW:5,MAGENTA:6,CYAN:7,NOTEXTURE:0,DO:1,DOT:1,DOTS:1,DOTTE
     *D:1,DA:2,DASHES:2,DASHED:2,SOLID:4,DOTDASHED:3,DOT-DASH:3,FUNNY:5,
     *DAASHES:7,SPACE:8,PATTERNED:6,INTENSITY:0:9:2,WIDTH:0:9:2,BLACK:8,
     *;')
      GOTO (14850,14860,14845,14845,14845,14845,14845,14860,14845),INTER
     *P
14845 CALL T2ERR(INFOIN,CARDIN,' ',5)
      GOTO 14842
14842 CONTINUE
      GOTO 14831
14832 CONTINUE
      END
      SUBROUTINE T2_SET_SHIELD(INFOIN,CARDIN)
      IMPLICIT NONE
      INTEGER INFOIN(10)
      CHARACTER*(*) CARDIN
      COMMON /T2FLGC/ FLAGS(200), LTRAP,LHANDL,LSYERR,LSCREV
      LOGICAL FLAGS, LTRAP,LHANDL,LSYERR,LSCREV(3)
      INTEGER RELFLAG 
      PARAMETER (RELFLAG=151)
      INTEGER IWINLEV 
      INTEGER NWINLEV , MAX_FILL 
      PARAMETER (NWINLEV =4)
      PARAMETER (MAX_FILL=4)
      REAL GRDSYM, GRDSIZ, DATDAT(2,8), H2STAT(12), TITLIN(4), TITFA
     *C(4), TITLOC(4), TITMAR(4), TITLMX(4), TIKFAC, TITINX, TITX1, TIT
     *Y1, TITX, TITY, TITZ, TITSIZ, TITCON(5), REVLEV, REDUCE(5), XFR
     *M12(12), XFRM13(12), XFRM14(12), XFRM23(12), XFRM24(12), XFRM34(6
     *), XVARSX(20), CIRSIZ(2,3), ASIZE, AFLARE, SMSZDF, ORAXES(3), EY
     *EDIR(3), VUEDIR(3), VUECEN(3), VERTCL(3), EYESEP, SCRD, SCRZ, EYE
     *DIS, EYEPNT(3), XYPART(2, 2), BARSIZ(3), BARBRK(3), TIKSIZ(3), XY
     *ZBAS(3), TTHETA, TPHI, FRELBL(4), PATRN(20,30), SCLPRM(10,3), WI
     *NDOW(4), SCREEN(2), SYMBOL, NOSYMB, FACTXY(19), LBLSIZ, SYMSIZ, X
     *YZLIM(3,2), WORLD(3), RADRMX, RADRMN, RADAMN, RADANG, RADX0, RADY
     *0, XUNUSD(6), AXANG(3), REDFAC, DSCAL, PATSZ, MARGIN(4), PSCR(2
     *), OREAL, OCPU, CSCRD, DATPTS, ERRPTS, DATXMN, DATXMX, DATYMN, DA
     *TYMX, DATZMN, DATZMX, DATSUM, ERRSUM, DATAVE, ERRAVE, DATCEN, ERR
     *CEN, DATSTD, ERRSTD, WINREL(2,2,NWINLEV),WINABS(2,2,NWINLEV),WINL
     *IM(2,2), FMARKER(3,8), SYDIR(3), GRDIR(3), EXYZLIM(3,2), DSLOPE(2
     *,2)
      REAL PLOT_EXTENT(2,2),FILL_ANGLE(MAX_FILL),FILL_WIDTH(MAX_FILL)
      INTEGER FILL_INDEX, FILL_TEX(MAX_FILL), N_LINES(6)
      EQUIVALENCE (DATDAT, DATPTS)
      INTEGER MAXREP
      PARAMETER (MAXREP=5)
      INTEGER IPATRN, NPATRN(30), NXYLIM(3,2), NPLOTS, NCSETS, NCCOL, N
     *CROW, IYEAR, IMONTH, IDAY, ISIGFG, ITXPRI, ITXSEC, ITITDT(3), L
     *ENCRD, IPROP, IHTEX, IBLINK, IERASE, ITCNTR, IUNUSD, NXYZ1(3), 
     *NXYZ2(3), LBLFMT(3), LBLCHR(3), NDIMNS(3), IBLKTP, IDIMNS, NMES
     *H0, NMESH1, NMESH2, MESH1, MESH2, MESH3, MESH2D, MESHN(3), NMESHN(
     *2), NFIELD, IFIELD(19), NINCR, NPOINT, IVARBL(19), IVPTR(19), I_
     *VORDER(19,2), LINEAR(4), NONLIN(4), MXECHO, LINES, MAXLNS, USRK
     *BD, USRSCR, PLTFIL, LINWID, LINCOL, LINTEX, ICPOIN(3), IREPCT(MA
     *XREP), LEVREP, GRDTYP, GRDTEX, OUTTEX, IAXTEX, TITEX, LETSET, LAB
     *TEX, TICTEX, SHADOWTYP,SHADOWTEX, NXYZDEF1(10), NXYZDEF2(10), IF
     *ILE_CASE ,MAX_SUBST
      INTEGER MAX_CYCLE
      PARAMETER (MAX_CYCLE=20)
      INTEGER N_CYCLE, ITX_CYCLE(MAX_CYCLE)
      REAL SYM_CYCLE(MAX_CYCLE)
      EQUIVALENCE (NMESH1,NMESHN)
      EQUIVALENCE (MESH1,MESHN)
      INTEGER IBUFFR(400)
      REAL BUFFER(400)
      INTEGER NCHSAVE 
      PARAMETER (NCHSAVE=2*512) 
      INTEGER*4 ICHSAVE(NCHSAVE)
      INTEGER*4 IVRPTR(15)
      CHARACTER*512 OUTSTR,C_FILE, C_NAME, C_SELECT
      CHARACTER C_TIT_ESCAPE*1,C_TIT_SUBSTITUTE*2
      INTEGER N_FILE, N_NAME, N_SELECT
      CHARACTER*8 PXNAME
      CHARACTER*64 INPFMT
      LOGICAL LTDATA, OUTSID(4)
      COMMON /T2COM/ PXNAME, REDUCE, TITX, TITY ,XFRM12, XFRM13, XFRM1
     *4, XFRM23 ,XFRM24, XFRM34 ,XVARSX ,TITSIZ, GRDSYM, GRDSIZ, CIRS
     *IZ, ASIZE, AFLARE ,SMSZDF, ORAXES, EYEDIR, VUEDIR, VUECEN ,VERTC
     *L, EYESEP, SCRD, SCRZ, EYEDIS, EYEPNT ,XYPART, BARSIZ, TIKSIZ, XY
     *ZBAS, TTHETA ,TPHI, FRELBL, IPATRN, NPATRN, PATRN ,SCLPRM, WINDO
     *W, SCREEN, SYMBOL, NOSYMB ,FACTXY, LBLSIZ, SYMSIZ, XYZLIM, WORLD 
     *,RADRMX, RADRMN, RADAMN, RADANG, RADX0, RADY0, XUNUSD ,USRKBD, U
     *SRSCR, PLTFIL ,ITITDT, LENCRD ,INPFMT, GRDTYP, LINWID, LINCOL, L
     *INTEX, TITCON, ITCNTR ,IUNUSD, NXYZ1, NXYZ2 ,LBLCHR, NDIMNS, IBL
     *KTP, IDIMNS ,NMESH1, NMESH2, MESH1, MESH2, MESH3, NFIELD ,IFIELD
     *, NINCR ,IVARBL, IVRPTR ,LINEAR, NONLIN ,NPOINT, LETSET ,MXECH
     *O, LINES, MAXLNS ,AXANG, MESH2D, REDFAC, GRDTEX, OUTTEX, IAXTEX, 
     *TITEX, DSCAL ,OUTSTR, IPROP, IHTEX, IBLINK, IERASE, LABTEX, TICTE
     *X, NXYLIM, PATSZ ,MARGIN, PSCR, ITXPRI, ITXSEC, OREAL, OCPU, CSCR
     *D, OUTSID ,TITLIN, TITINX, TITZ, TITX1, TITY1, LTDATA, NPLOTS, RE
     *VLEV ,LBLFMT, IYEAR, IMONTH, IDAY, ISIGFG ,DATPTS, ERRPTS, DATXM
     *N, DATXMX, DATYMN, DATYMX, DATZMN, DATZMX ,DATSUM, ERRSUM, DATAVE
     *, ERRAVE, DATCEN, ERRCEN, DATSTD, ERRSTD ,NCSETS, NCCOL, NCROW, F
     *MARKER, H2STAT, TITFAC, TITLOC, TITMAR ,TIKFAC, IWINLEV, WINREL, 
     *WINABS, WINLIM ,ICPOIN, LEVREP, IREPCT, SYDIR, GRDIR, NMESH0, EXY
     *ZLIM, IVPTR ,TITLMX, NXYZDEF1, NXYZDEF2, IFILE_CASE, N_CYCLE, ITX
     *_CYCLE ,SYM_CYCLE, PLOT_EXTENT, FILL_ANGLE, FILL_WIDTH, FILL_TEX 
     *,FILL_INDEX ,N_LINES ,DSLOPE ,MAX_SUBST, BARBRK ,I_VORDER,SHADOW
     *TYP,SHADOWTEX
      COMMON /T2SCRT/ BUFFER, IBUFFR, N_FILE,N_NAME,N_SELECT, ICHSAVE
      COMMON /T2_CHAR/ C_TIT_ESCAPE,C_TIT_SUBSTITUTE
      COMMON /T2_SCRT/ C_FILE, C_NAME, C_SELECT
      INTEGER JOUFIL, ERRFIL, OUTFIL, DBGFIL, INPFIL, NINMAX
      PARAMETER (NINMAX=20)
      INTEGER NINP(NINMAX)
      COMMON /T2TRBK/NINP, JOUFIL, ERRFIL, OUTFIL, DBGFIL, INPFIL
      CHARACTER*512 STRNG, STJOU
      LOGICAL LTOKEN
      REAL FLOTNG
      INTEGER INTERP, KEYORD, NSTRNG, MAXSTR, NSTJOU, LSTJOU, NTOKEN
      INTEGER*4 INTEG
      COMMON /TOKENC/ INTERP, INTEG, FLOTNG, KEYORD, NSTRNG, MAXSTR, ST
     *RNG, NSTJOU, LSTJOU, STJOU, LTOKEN, NTOKEN
      REAL PLIM(4,4),ZSCRN(2),XLLINE,YLLINE,XTLINE,YTLINE,XFRMFC, PAT(2
     *0),PATCUM,PATTOT,PATMOD,CCSCIS(4),DISPL, RESOL(2)
      INTEGER NPTS,IDDEVC,IPAT,NPAT,LMOVE,IROTAX,IROTAF
      COMMON/TXCOM/PLIM,ZSCRN, XLLINE,YLLINE,XTLINE,YTLINE,XFRMFC, IPA
     *T,NPAT,PAT,PATTOT, NPTS,IDDEVC,CCSCIS,LMOVE,IROTAX,DISPL,IROTAF,P
     *ATCUM,PATMOD, RESOL
      REAL HNONE
      INTEGER IDATA
      CHARACTER*4 DIGITS
      INTEGER NLIM,ISHLD,I,J, IXYZ,IFRTO
      REAL XYSHLD(2,2),XYDEV(2,2)
      REAL TLIM(3,2)
      DATA HNONE /-666.666/
      DATA DIGITS/'1234'/
      ISHLD=INTEG
      IDATA=1
      DO 14931 J=1,2
      DO 14941 I=1,3
      TLIM(I,J)=HNONE
14941 CONTINUE
14942 CONTINUE
14931 CONTINUE
14932 CONTINUE
      IXYZ=1
      IFRTO=1
      CALL TXVOID
      IF (.not. FLAGS(73)) CALL TXDEF1
      if (.not. FLAGS(74)) THEN
      CALL TXDEFW
      ENDIF
      GOTO 14951
14980 CONTINUE
      IF (FLAGS(23)) RETURN
      IF (ISHLD .gt. 0) THEN
      IFRTO=ISHLD
      ELSE
      IFRTO=1
      ISHLD=4
      ENDIF
      DO 14991 I=IFRTO,ISHLD
      CALL UGSHLD('DELETE,SHIELD='//DIGITS(I:I),XYSHLD)
14991 CONTINUE
14992 CONTINUE
      RETURN
15000 CONTINUE
      IXYZ=1
      IFRTO=INTEG
      GOTO 14951
15010 CONTINUE
      IFRTO=INTEG
      GOTO 14951
15020 CONTINUE
      IDATA=1
      INFOIN(9)=-1
      CALL T2XYZC(INFOIN,CARDIN,TLIM,2,NLIM)
      GOTO 14951
15030 CONTINUE
      IDATA=INTEG
      GOTO 14951
14960 GOTO ( 14980,15000,15000,15010,15010,15010,15020,15030,15030,15030
     *,14955),KEYORD
15040 CONTINUE
      TLIM(IXYZ,IFRTO)=FLOTNG
      IXYZ=MIN(3,IXYZ+1)
      GOTO 14951
14951 CALL TOKEN(INFOIN,CARDIN,'OFF,FROM:1,TO:2,X:1,Y:2,Z:3,CURSOR,DATA:
     *2,TEXT:1,RELATIVE:3,;')
      GOTO (14952,14960,15040,15040,14955,14955,14955,14960,14955),INTER
     *P
14955 CALL T2ERR(INFOIN,CARDIN,' ',5)
      GOTO 14951
14952 CONTINUE
      IF (FLAGS(23)) RETURN
      IF (IDATA.eq.2) THEN
      if (.not. FLAGS(75)) THEN
      CALL TXDEF2
      CALL T2STLM
      ENDIF
      DO 15051 I=1,2
      DO 15061 J=1,3
      IF (TLIM(J,I) .eq. HNONE) TLIM(J,I)=XYZLIM(J,I)
15061 CONTINUE
15062 CONTINUE
15051 CONTINUE
15052 CONTINUE
      CALL T2XFRM(3,2,TLIM,NONLIN,XFRM14,2,XYDEV)
      ELSE
      DO 15071 I=1,2
      DO 15081 J=1,2
      IF (TLIM(J,I) .eq. HNONE) TLIM(J,I)=WINDOW(J+2*(I-1))
15081 CONTINUE
15082 CONTINUE
15071 CONTINUE
15072 CONTINUE
      DO 15091 I=1,2
      DO 15101 J=1,2
      XYSHLD(J,I)=TLIM(J,I)
15101 CONTINUE
15102 CONTINUE
15091 CONTINUE
15092 CONTINUE
      CALL T2XFRM(2,2,XYSHLD,LINEAR,XFRM34,2,XYDEV)
      ENDIF
      IF (FLAGS(23)) RETURN
      GOTO (15110,15111,15112,15113),IROTAX+1
15110 XYSHLD(1,1)=          MIN(XYDEV(1,1),XYDEV(1,2))
      XYSHLD(1,2)=          MAX(XYDEV(1,1),XYDEV(1,2))
      XYSHLD(2,1)=          MIN(XYDEV(2,1),XYDEV(2,2))
      XYSHLD(2,2)=          MAX(XYDEV(2,1),XYDEV(2,2))
      GOTO 15120
15111 XYSHLD(1,1)=          MIN(XYDEV(2,1),XYDEV(2,2))
      XYSHLD(1,2)=          MAX(XYDEV(2,1),XYDEV(2,2))
      XYSHLD(2,1)=PLIM(3,4)-MAX(XYDEV(1,1),XYDEV(1,2))
      XYSHLD(2,2)=PLIM(3,4)-MIN(XYDEV(1,1),XYDEV(1,2))
      GOTO 15120
15112 XYSHLD(1,1)=PLIM(3,4)-MAX(XYDEV(1,1),XYDEV(1,2))
      XYSHLD(1,2)=PLIM(3,4)-MIN(XYDEV(1,1),XYDEV(1,2))
      XYSHLD(2,1)=PLIM(4,4)-MAX(XYDEV(2,1),XYDEV(2,2))
      XYSHLD(2,2)=PLIM(4,4)-MIN(XYDEV(2,1),XYDEV(2,2))
      GOTO 15120
15113 XYSHLD(1,1)=PLIM(4,4)-MAX(XYDEV(2,1),XYDEV(2,2))
      XYSHLD(1,2)=PLIM(4,4)-MIN(XYDEV(2,1),XYDEV(2,2))
      XYSHLD(2,1)=          MIN(XYDEV(1,1),XYDEV(1,2))
      XYSHLD(2,2)=          MAX(XYDEV(1,1),XYDEV(1,2))
      GOTO 15120
15120 CONTINUE
      IF (ISHLD .eq. 0) THEN
      DO 15121 I=1,4
      CALL UGSHLD('GET,SHIELD='//DIGITS(I:I),XYDEV)
      IF (XYDEV(1,1) .eq. XYDEV(1,2)) THEN
      ISHLD=I
      GOTO 15122
      ENDIF
15121 CONTINUE
15122 CONTINUE
      IF (ISHLD .eq. 0) THEN
      CALL T2ERR(INFOIN,CARDIN,'*** ERROR *** No more shields to allocat
     *e',4)
      RETURN
      ENDIF
      ENDIF
      CALL UGSHLD('PUT,SHIELD='//DIGITS(ISHLD:ISHLD),XYSHLD)
      END
      SUBROUTINE T2_SET_STORAGE(INFOIN,CARDIN)
      IMPLICIT NONE
      INTEGER INFOIN(10)
      CHARACTER*(*) CARDIN
      COMMON /T2FLGC/ FLAGS(200), LTRAP,LHANDL,LSYERR,LSCREV
      LOGICAL FLAGS, LTRAP,LHANDL,LSYERR,LSCREV(3)
      INTEGER RELFLAG 
      PARAMETER (RELFLAG=151)
      INTEGER IWINLEV 
      INTEGER NWINLEV , MAX_FILL 
      PARAMETER (NWINLEV =4)
      PARAMETER (MAX_FILL=4)
      REAL GRDSYM, GRDSIZ, DATDAT(2,8), H2STAT(12), TITLIN(4), TITFA
     *C(4), TITLOC(4), TITMAR(4), TITLMX(4), TIKFAC, TITINX, TITX1, TIT
     *Y1, TITX, TITY, TITZ, TITSIZ, TITCON(5), REVLEV, REDUCE(5), XFR
     *M12(12), XFRM13(12), XFRM14(12), XFRM23(12), XFRM24(12), XFRM34(6
     *), XVARSX(20), CIRSIZ(2,3), ASIZE, AFLARE, SMSZDF, ORAXES(3), EY
     *EDIR(3), VUEDIR(3), VUECEN(3), VERTCL(3), EYESEP, SCRD, SCRZ, EYE
     *DIS, EYEPNT(3), XYPART(2, 2), BARSIZ(3), BARBRK(3), TIKSIZ(3), XY
     *ZBAS(3), TTHETA, TPHI, FRELBL(4), PATRN(20,30), SCLPRM(10,3), WI
     *NDOW(4), SCREEN(2), SYMBOL, NOSYMB, FACTXY(19), LBLSIZ, SYMSIZ, X
     *YZLIM(3,2), WORLD(3), RADRMX, RADRMN, RADAMN, RADANG, RADX0, RADY
     *0, XUNUSD(6), AXANG(3), REDFAC, DSCAL, PATSZ, MARGIN(4), PSCR(2
     *), OREAL, OCPU, CSCRD, DATPTS, ERRPTS, DATXMN, DATXMX, DATYMN, DA
     *TYMX, DATZMN, DATZMX, DATSUM, ERRSUM, DATAVE, ERRAVE, DATCEN, ERR
     *CEN, DATSTD, ERRSTD, WINREL(2,2,NWINLEV),WINABS(2,2,NWINLEV),WINL
     *IM(2,2), FMARKER(3,8), SYDIR(3), GRDIR(3), EXYZLIM(3,2), DSLOPE(2
     *,2)
      REAL PLOT_EXTENT(2,2),FILL_ANGLE(MAX_FILL),FILL_WIDTH(MAX_FILL)
      INTEGER FILL_INDEX, FILL_TEX(MAX_FILL), N_LINES(6)
      EQUIVALENCE (DATDAT, DATPTS)
      INTEGER MAXREP
      PARAMETER (MAXREP=5)
      INTEGER IPATRN, NPATRN(30), NXYLIM(3,2), NPLOTS, NCSETS, NCCOL, N
     *CROW, IYEAR, IMONTH, IDAY, ISIGFG, ITXPRI, ITXSEC, ITITDT(3), L
     *ENCRD, IPROP, IHTEX, IBLINK, IERASE, ITCNTR, IUNUSD, NXYZ1(3), 
     *NXYZ2(3), LBLFMT(3), LBLCHR(3), NDIMNS(3), IBLKTP, IDIMNS, NMES
     *H0, NMESH1, NMESH2, MESH1, MESH2, MESH3, MESH2D, MESHN(3), NMESHN(
     *2), NFIELD, IFIELD(19), NINCR, NPOINT, IVARBL(19), IVPTR(19), I_
     *VORDER(19,2), LINEAR(4), NONLIN(4), MXECHO, LINES, MAXLNS, USRK
     *BD, USRSCR, PLTFIL, LINWID, LINCOL, LINTEX, ICPOIN(3), IREPCT(MA
     *XREP), LEVREP, GRDTYP, GRDTEX, OUTTEX, IAXTEX, TITEX, LETSET, LAB
     *TEX, TICTEX, SHADOWTYP,SHADOWTEX, NXYZDEF1(10), NXYZDEF2(10), IF
     *ILE_CASE ,MAX_SUBST
      INTEGER MAX_CYCLE
      PARAMETER (MAX_CYCLE=20)
      INTEGER N_CYCLE, ITX_CYCLE(MAX_CYCLE)
      REAL SYM_CYCLE(MAX_CYCLE)
      EQUIVALENCE (NMESH1,NMESHN)
      EQUIVALENCE (MESH1,MESHN)
      INTEGER IBUFFR(400)
      REAL BUFFER(400)
      INTEGER NCHSAVE 
      PARAMETER (NCHSAVE=2*512) 
      INTEGER*4 ICHSAVE(NCHSAVE)
      INTEGER*4 IVRPTR(15)
      CHARACTER*512 OUTSTR,C_FILE, C_NAME, C_SELECT
      CHARACTER C_TIT_ESCAPE*1,C_TIT_SUBSTITUTE*2
      INTEGER N_FILE, N_NAME, N_SELECT
      CHARACTER*8 PXNAME
      CHARACTER*64 INPFMT
      LOGICAL LTDATA, OUTSID(4)
      COMMON /T2COM/ PXNAME, REDUCE, TITX, TITY ,XFRM12, XFRM13, XFRM1
     *4, XFRM23 ,XFRM24, XFRM34 ,XVARSX ,TITSIZ, GRDSYM, GRDSIZ, CIRS
     *IZ, ASIZE, AFLARE ,SMSZDF, ORAXES, EYEDIR, VUEDIR, VUECEN ,VERTC
     *L, EYESEP, SCRD, SCRZ, EYEDIS, EYEPNT ,XYPART, BARSIZ, TIKSIZ, XY
     *ZBAS, TTHETA ,TPHI, FRELBL, IPATRN, NPATRN, PATRN ,SCLPRM, WINDO
     *W, SCREEN, SYMBOL, NOSYMB ,FACTXY, LBLSIZ, SYMSIZ, XYZLIM, WORLD 
     *,RADRMX, RADRMN, RADAMN, RADANG, RADX0, RADY0, XUNUSD ,USRKBD, U
     *SRSCR, PLTFIL ,ITITDT, LENCRD ,INPFMT, GRDTYP, LINWID, LINCOL, L
     *INTEX, TITCON, ITCNTR ,IUNUSD, NXYZ1, NXYZ2 ,LBLCHR, NDIMNS, IBL
     *KTP, IDIMNS ,NMESH1, NMESH2, MESH1, MESH2, MESH3, NFIELD ,IFIELD
     *, NINCR ,IVARBL, IVRPTR ,LINEAR, NONLIN ,NPOINT, LETSET ,MXECH
     *O, LINES, MAXLNS ,AXANG, MESH2D, REDFAC, GRDTEX, OUTTEX, IAXTEX, 
     *TITEX, DSCAL ,OUTSTR, IPROP, IHTEX, IBLINK, IERASE, LABTEX, TICTE
     *X, NXYLIM, PATSZ ,MARGIN, PSCR, ITXPRI, ITXSEC, OREAL, OCPU, CSCR
     *D, OUTSID ,TITLIN, TITINX, TITZ, TITX1, TITY1, LTDATA, NPLOTS, RE
     *VLEV ,LBLFMT, IYEAR, IMONTH, IDAY, ISIGFG ,DATPTS, ERRPTS, DATXM
     *N, DATXMX, DATYMN, DATYMX, DATZMN, DATZMX ,DATSUM, ERRSUM, DATAVE
     *, ERRAVE, DATCEN, ERRCEN, DATSTD, ERRSTD ,NCSETS, NCCOL, NCROW, F
     *MARKER, H2STAT, TITFAC, TITLOC, TITMAR ,TIKFAC, IWINLEV, WINREL, 
     *WINABS, WINLIM ,ICPOIN, LEVREP, IREPCT, SYDIR, GRDIR, NMESH0, EXY
     *ZLIM, IVPTR ,TITLMX, NXYZDEF1, NXYZDEF2, IFILE_CASE, N_CYCLE, ITX
     *_CYCLE ,SYM_CYCLE, PLOT_EXTENT, FILL_ANGLE, FILL_WIDTH, FILL_TEX 
     *,FILL_INDEX ,N_LINES ,DSLOPE ,MAX_SUBST, BARBRK ,I_VORDER,SHADOW
     *TYP,SHADOWTEX
      COMMON /T2SCRT/ BUFFER, IBUFFR, N_FILE,N_NAME,N_SELECT, ICHSAVE
      COMMON /T2_CHAR/ C_TIT_ESCAPE,C_TIT_SUBSTITUTE
      COMMON /T2_SCRT/ C_FILE, C_NAME, C_SELECT
      INTEGER JOUFIL, ERRFIL, OUTFIL, DBGFIL, INPFIL, NINMAX
      PARAMETER (NINMAX=20)
      INTEGER NINP(NINMAX)
      COMMON /T2TRBK/NINP, JOUFIL, ERRFIL, OUTFIL, DBGFIL, INPFIL
      CHARACTER*512 STRNG, STJOU
      LOGICAL LTOKEN
      REAL FLOTNG
      INTEGER INTERP, KEYORD, NSTRNG, MAXSTR, NSTJOU, LSTJOU, NTOKEN
      INTEGER*4 INTEG
      COMMON /TOKENC/ INTERP, INTEG, FLOTNG, KEYORD, NSTRNG, MAXSTR, ST
     *RNG, NSTJOU, LSTJOU, STJOU, LTOKEN, NTOKEN
      INTEGER NSETD 
      PARAMETER (NSETD=19+9)
      INTEGER ISETD(NSETD),NINCR0,NINCR1,NINCR2,IBTYPE
      INTEGER I1,I2,I3,I4,I5,I6,I7,IM,NP,NL,IENDAT,IBGDAT
      INTEGER I_NDX,I_NDY,I_NDZ
      INTEGER N_SYMBOL 
      INTEGER N_XDATA 
      INTEGER N_DXDATA 
      INTEGER N_NDXDATA 
      INTEGER N_YDATA 
      INTEGER N_DYDATA 
      INTEGER N_NDYDATA 
      INTEGER N_ZDATA 
      INTEGER N_DZDATA 
      INTEGER N_NDZDATA 
      INTEGER N_UDATA 
      INTEGER N_DUDATA 
      INTEGER N_NDUDATA 
      INTEGER N_VDATA 
      INTEGER N_DVDATA 
      INTEGER N_NDVDATA 
      INTEGER N_WDATA 
      INTEGER N_DWDATA 
      INTEGER N_NDWDATA 
      INTEGER NCMAX 
      INTEGER NCSIZE 
      INTEGER NBTYPE 
      INTEGER NINDAT 
      INTEGER NSDATA 
      INTEGER NXDATA 
      INTEGER NDXDATA 
      INTEGER NNDXDATA 
      INTEGER NYDATA 
      INTEGER NDYDATA 
      INTEGER NNDYDATA 
      INTEGER NZDATA 
      INTEGER NDZDATA 
      INTEGER NNDZDATA 
      INTEGER NPDATA 
      INTEGER NLDATA 
      INTEGER NMDATA 
      INTEGER NBGDAT 
      INTEGER NENDAT 
      PARAMETER (N_SYMBOL=1) 
      PARAMETER (N_XDATA=2) 
      PARAMETER (N_DXDATA=3) 
      PARAMETER (N_NDXDATA=4) 
      PARAMETER (N_YDATA=5) 
      PARAMETER (N_DYDATA=6) 
      PARAMETER (N_NDYDATA=7) 
      PARAMETER (N_ZDATA=8) 
      PARAMETER (N_DZDATA=9) 
      PARAMETER (N_NDZDATA=10) 
      PARAMETER (N_UDATA=11) 
      PARAMETER (N_DUDATA=12) 
      PARAMETER (N_NDUDATA=13) 
      PARAMETER (N_VDATA=14) 
      PARAMETER (N_DVDATA=15) 
      PARAMETER (N_NDVDATA=16) 
      PARAMETER (N_WDATA=17) 
      PARAMETER (N_DWDATA=18) 
      PARAMETER (N_NDWDATA=19) 
      PARAMETER (NCMAX=6) 
      PARAMETER (NCSIZE=3) 
      PARAMETER (NBTYPE=1) 
      PARAMETER (NINDAT=2) 
      PARAMETER (NSDATA=5) 
      PARAMETER (NXDATA=NSDATA+1) 
      PARAMETER (NDXDATA=NXDATA+1) 
      PARAMETER (NNDXDATA=NXDATA+2) 
      PARAMETER (NYDATA=NXDATA+NCSIZE) 
      PARAMETER (NDYDATA=NYDATA+1) 
      PARAMETER (NNDYDATA=NYDATA+2) 
      PARAMETER (NZDATA=NYDATA+NCSIZE) 
      PARAMETER (NDZDATA=NZDATA+1) 
      PARAMETER (NNDZDATA=NZDATA+2) 
      PARAMETER (NPDATA=NSDATA+19) 
      PARAMETER (NLDATA=NPDATA+1) 
      PARAMETER (NMDATA=NLDATA+1) 
      PARAMETER (NBGDAT=NMDATA+1) 
      PARAMETER (NENDAT=NBGDAT+1) 
      EQUIVALENCE (IBTYPE,ISETD(NBTYPE))
      EQUIVALENCE (NINCR0,ISETD(NINDAT))
      EQUIVALENCE (NINCR1,ISETD(NINDAT+1))
      EQUIVALENCE (NINCR2,ISETD(NINDAT+2))
      EQUIVALENCE (I7,ISETD(NSDATA))
      EQUIVALENCE (I1,ISETD(NXDATA))
      EQUIVALENCE (I4,ISETD(NDXDATA))
      EQUIVALENCE (I2,ISETD(NYDATA))
      EQUIVALENCE (I5,ISETD(NDYDATA))
      EQUIVALENCE (I3,ISETD(NZDATA))
      EQUIVALENCE (I6,ISETD(NDZDATA))
      EQUIVALENCE (I_NDX,ISETD(NNDXDATA))
      EQUIVALENCE (I_NDY,ISETD(NNDYDATA))
      EQUIVALENCE (I_NDZ,ISETD(NNDZDATA))
      EQUIVALENCE (NP,ISETD(NPDATA))
      EQUIVALENCE (NL,ISETD(NLDATA))
      EQUIVALENCE (IM,ISETD(NMDATA))
      EQUIVALENCE (IBGDAT,ISETD(NBGDAT))
      EQUIVALENCE (IENDAT,ISETD(NENDAT))
      LOGICAL DFLAGS(200),DSCREV(3)
      COMMON /T2FLGD/DFLAGS,DSCREV
      REAL DTITLIN(4), DTITFAC(4), DTITMAR(4)
      INTEGER DGRDTYP, DGRDTEX, DOUTTEX, IDAXTEX, DTITEX, DSHADOWTYP,DS
     *HADOWTEX, IFLDDF(19), NDDIMNS, IDTXPRI, IDTXSEC, LINCLF, LINTXF,
     * LINWDF, DNONLN(3), DNXYZ1(3), DNXYZ2(3), DLABTEX, DTICTEX, DNPAT
     *RN(30), DLBLCHR(3), ND_CYCLE, IDTX_CYCLE(MAX_CYCLE)
      REAL DSYM_CYCLE(MAX_CYCLE)
      REAL DTITSIZ, DGRDSYM, DGRDSIZ, DCIRSIZ(2,3), DASIZE, DAFLARE, D
     *SMSZDF, DORAXES(3), DEYEDIR(3), DVUEDIR(3), DVUECEN(3), DVERTCL(3
     *), DEYESEP, DSCRD, DSCRZ, DEYEDIS, DEYEPNT(3), DBARSIZ(3), DBARBR
     *K(3), DTIKSIZ(3), DXYZBS(3), DTTHETA, DTPHI, DFRELBL(4), DPATRN(2
     *0,30), DSCLPRM(10,3), DWINDOW(4), DSCREEN(2), DSYMBOL, DNOSYMB, 
     *DAXANG(3), DLBLSIZ, DSYMSIZ, DXYZLIM(3,2), DFACTXY(19), DRADANG,
     * DDSCAL, DPATSZ, DTITINX, DTIKFAC, DSYDIR(3), DGRDIR(3)
      COMMON /T2COMD/ DTITSIZ, DGRDSYM, DGRDSIZ, DCIRSIZ, DASIZE, DAFLA
     *RE, DSMSZDF, DORAXES, DEYEDIR, DVUEDIR, DVUECEN, DVERTCL, DEYESE
     *P, DSCRD, DSCRZ, DEYEDIS, DEYEPNT, DBARSIZ, DTIKSIZ, DXYZBS, DTTH
     *ETA, DTPHI, DFRELBL, DNPATRN, DPATRN, DSCLPRM, DWINDOW, DSCREEN,
     * DSYMBOL, DNOSYMB, DAXANG, DLBLSIZ, DSYMSIZ, DXYZLIM, DGRDTYP, D
     *FACTXY, IFLDDF, NDDIMNS, DGRDTEX, DOUTTEX, IDAXTEX, DTITEX, DRADA
     *NG, DDSCAL, DNONLN, DNXYZ1, DNXYZ2, LINCLF, LINTXF, LINWDF, DLABT
     *EX, DTICTEX, DPATSZ, IDTXPRI, IDTXSEC, DTITLIN, DTITINX, DLBLCHR,
     * DTITFAC, DTITMAR, DTIKFAC, DSYDIR, DGRDIR, ND_CYCLE, IDTX_CYCLE,
     * DSYM_CYCLE, DBARBRK,  DSHADOWTYP,DSHADOWTEX
      INTEGER LISTPT,NPTMAX,NDSETS
      REAL DATBUF(10248)
      COMMON /T2XPNT/ LISTPT,NPTMAX,NDSETS,DATBUF
      INTEGER I,J,K,L,IDEFAU(5),IVAR(19+2),ITEMP,IMIN,IMAX
      LOGICAL LTEST
      LOGICAL T2_VIRT
      INTEGER IAND,IOR
      DATA IDEFAU/1,2,4,3,5/
      ITEMP=1
      LTEST=.false.
      IVAR(2)=1
      IVAR(1)=1
      DFLAGS(27)=.false.
      FLAGS(27)=.FALSE.
      DFLAGS(91)=.false.
      FLAGS(91)=.FALSE.
      DO 15131 I=RELFLAG,RELFLAG+19-1
      FLAGS(I)=.FALSE.
15131 CONTINUE
15132 CONTINUE
      GOTO 15141
15170 CONTINUE
      IF (.not. T2_VIRT(INTEG)) CALL T2ERR(INFOIN,CARDIN,'*** ERROR *** 
     *Unable to allocate memory',4)
      GOTO 15141
15180 CONTINUE
      LTEST=.true.
      I=INTEG/100
      INTEG=MOD(INTEG,100)
      IF (IAND(I,4) .EQ. 4) THEN
      FLAGS(27)=.true.
      DFLAGS(27)=.true.
      IF (IAND(I,1) .EQ. 1) THEN
      FLAGS(91)=.true.
      DFLAGS(91)=.true.
      ENDIF
      ENDIF
      IF (INTEG.eq.0) THEN
      IMAX=19
      IMIN=1
      ELSE
      IMAX=I_VORDER(INTEG,1)
      IF (IAND(I,2) .eq. 2) THEN
      FLAGS(IMAX+RELFLAG-1)=.true.
      ENDIF
      IMIN=IMAX
      IF ( (IMAX-2)/NCSIZE .lt. NCMAX) IMIN=MAX(NCSIZE*((IMAX-2)/NCSIZE)
     *+2,1)
      ENDIF
      IF (IMAX .gt. 19 .or. IMAX .lt. 1) THEN
      CALL T2ERR(INFOIN,CARDIN,'*** ERROR *** Illegal coordinate',4)
      RETURN
      ENDIF
      DO 15191 I=IMIN,IMAX
      L=I
      J=2**(L-1)
      IF (IAND(ITEMP,J).eq.0) THEN
      ITEMP=IOR(ITEMP,J)
      IVAR(1)=IVAR(1)+1
      IVAR(IVAR(1)+1)=99
      DO 15201 J=2,IVAR(1)+1
      K=IVAR(J)
      IF (K.gt.L) THEN
      IVAR(J)=L
      L=K
      ENDIF
15201 CONTINUE
15202 CONTINUE
      ENDIF
15191 CONTINUE
15192 CONTINUE
      GOTO 15141
15141 CALL TOKEN(INFOIN,CARDIN,'SIZE:::0,ALL:0,SYMBOL:1,X:2,DX:3,Y:4,DY:
     *5,Z:6,DZ:7,NDX:8,NDY:9,NDZ:10,U:11,DU:12,NDU:13,V:14,DV:15,NDV:16,
     *W:17,DW:18,NDW:19,THETA:402,DTHETA:403,RADIUS:404,DRADIUS:405,PHI:
     *506,DPHI:507,NDTHETA:408,NDRADIUS:409,NDPHI:510,RX:203,RY:205,RZ:2
     *07,NRX:208,NRY:209,NRZ:210,RU:212,NRU:213,RV:215,NRV:216,RW:218,NR
     *W:219,RTHETA:603,RRADIUS:605,RPHI:707,;')
      GOTO (15142,15147,15145,15145,15145,15145,15141,15147, 15145),INTE
     *RP
15145 CALL T2ERR(INFOIN,CARDIN,' ',5)
      GOTO 15141
15147 GOTO ( 15170,15180,15180,15180,15180,15180,15180,15180,15180,15180
     *,15180,15180,15180,15180,15180,15180,15180,15180,15180,15180,15180
     *,15180,15180,15180,15180,15180,15180,15180,15180,15180,15180,15180
     *,15180,15180,15180,15180,15180,15180,15180,15180,15180,15180,15180
     *,15180,15180,15145),KEYORD
15142 CONTINUE
      IMIN=1
      IF (LTEST) THEN
      IMAX=3
      ELSE
      IMAX=5
      ENDIF
      DO 15211 I=IMIN,IMAX
      L=IDEFAU(I)
      L=I_VORDER(L,1)
      J=2**(L-1)
      IF (IAND(J,ITEMP).eq.0) THEN
      ITEMP=IOR(ITEMP,J)
      IVAR(1)=IVAR(1)+1
      IVAR(IVAR(1)+1)=99
      DO 15221 J=2,IVAR(1)+1
      K=IVAR(J)
      IF (K.gt.L) THEN
      IVAR(J)=L
      L=K
      ENDIF
15221 CONTINUE
15222 CONTINUE
      ENDIF
15211 CONTINUE
15212 CONTINUE
      CALL T2SETS(IVAR) 
      END
      SUBROUTINE T2_SET_GRID(INFOIN,CARDIN)
      IMPLICIT NONE
      INTEGER INFOIN(10)
      CHARACTER*(*) CARDIN
      COMMON /T2FLGC/ FLAGS(200), LTRAP,LHANDL,LSYERR,LSCREV
      LOGICAL FLAGS, LTRAP,LHANDL,LSYERR,LSCREV(3)
      INTEGER RELFLAG 
      PARAMETER (RELFLAG=151)
      INTEGER IWINLEV 
      INTEGER NWINLEV , MAX_FILL 
      PARAMETER (NWINLEV =4)
      PARAMETER (MAX_FILL=4)
      REAL GRDSYM, GRDSIZ, DATDAT(2,8), H2STAT(12), TITLIN(4), TITFA
     *C(4), TITLOC(4), TITMAR(4), TITLMX(4), TIKFAC, TITINX, TITX1, TIT
     *Y1, TITX, TITY, TITZ, TITSIZ, TITCON(5), REVLEV, REDUCE(5), XFR
     *M12(12), XFRM13(12), XFRM14(12), XFRM23(12), XFRM24(12), XFRM34(6
     *), XVARSX(20), CIRSIZ(2,3), ASIZE, AFLARE, SMSZDF, ORAXES(3), EY
     *EDIR(3), VUEDIR(3), VUECEN(3), VERTCL(3), EYESEP, SCRD, SCRZ, EYE
     *DIS, EYEPNT(3), XYPART(2, 2), BARSIZ(3), BARBRK(3), TIKSIZ(3), XY
     *ZBAS(3), TTHETA, TPHI, FRELBL(4), PATRN(20,30), SCLPRM(10,3), WI
     *NDOW(4), SCREEN(2), SYMBOL, NOSYMB, FACTXY(19), LBLSIZ, SYMSIZ, X
     *YZLIM(3,2), WORLD(3), RADRMX, RADRMN, RADAMN, RADANG, RADX0, RADY
     *0, XUNUSD(6), AXANG(3), REDFAC, DSCAL, PATSZ, MARGIN(4), PSCR(2
     *), OREAL, OCPU, CSCRD, DATPTS, ERRPTS, DATXMN, DATXMX, DATYMN, DA
     *TYMX, DATZMN, DATZMX, DATSUM, ERRSUM, DATAVE, ERRAVE, DATCEN, ERR
     *CEN, DATSTD, ERRSTD, WINREL(2,2,NWINLEV),WINABS(2,2,NWINLEV),WINL
     *IM(2,2), FMARKER(3,8), SYDIR(3), GRDIR(3), EXYZLIM(3,2), DSLOPE(2
     *,2)
      REAL PLOT_EXTENT(2,2),FILL_ANGLE(MAX_FILL),FILL_WIDTH(MAX_FILL)
      INTEGER FILL_INDEX, FILL_TEX(MAX_FILL), N_LINES(6)
      EQUIVALENCE (DATDAT, DATPTS)
      INTEGER MAXREP
      PARAMETER (MAXREP=5)
      INTEGER IPATRN, NPATRN(30), NXYLIM(3,2), NPLOTS, NCSETS, NCCOL, N
     *CROW, IYEAR, IMONTH, IDAY, ISIGFG, ITXPRI, ITXSEC, ITITDT(3), L
     *ENCRD, IPROP, IHTEX, IBLINK, IERASE, ITCNTR, IUNUSD, NXYZ1(3), 
     *NXYZ2(3), LBLFMT(3), LBLCHR(3), NDIMNS(3), IBLKTP, IDIMNS, NMES
     *H0, NMESH1, NMESH2, MESH1, MESH2, MESH3, MESH2D, MESHN(3), NMESHN(
     *2), NFIELD, IFIELD(19), NINCR, NPOINT, IVARBL(19), IVPTR(19), I_
     *VORDER(19,2), LINEAR(4), NONLIN(4), MXECHO, LINES, MAXLNS, USRK
     *BD, USRSCR, PLTFIL, LINWID, LINCOL, LINTEX, ICPOIN(3), IREPCT(MA
     *XREP), LEVREP, GRDTYP, GRDTEX, OUTTEX, IAXTEX, TITEX, LETSET, LAB
     *TEX, TICTEX, SHADOWTYP,SHADOWTEX, NXYZDEF1(10), NXYZDEF2(10), IF
     *ILE_CASE ,MAX_SUBST
      INTEGER MAX_CYCLE
      PARAMETER (MAX_CYCLE=20)
      INTEGER N_CYCLE, ITX_CYCLE(MAX_CYCLE)
      REAL SYM_CYCLE(MAX_CYCLE)
      EQUIVALENCE (NMESH1,NMESHN)
      EQUIVALENCE (MESH1,MESHN)
      INTEGER IBUFFR(400)
      REAL BUFFER(400)
      INTEGER NCHSAVE 
      PARAMETER (NCHSAVE=2*512) 
      INTEGER*4 ICHSAVE(NCHSAVE)
      INTEGER*4 IVRPTR(15)
      CHARACTER*512 OUTSTR,C_FILE, C_NAME, C_SELECT
      CHARACTER C_TIT_ESCAPE*1,C_TIT_SUBSTITUTE*2
      INTEGER N_FILE, N_NAME, N_SELECT
      CHARACTER*8 PXNAME
      CHARACTER*64 INPFMT
      LOGICAL LTDATA, OUTSID(4)
      COMMON /T2COM/ PXNAME, REDUCE, TITX, TITY ,XFRM12, XFRM13, XFRM1
     *4, XFRM23 ,XFRM24, XFRM34 ,XVARSX ,TITSIZ, GRDSYM, GRDSIZ, CIRS
     *IZ, ASIZE, AFLARE ,SMSZDF, ORAXES, EYEDIR, VUEDIR, VUECEN ,VERTC
     *L, EYESEP, SCRD, SCRZ, EYEDIS, EYEPNT ,XYPART, BARSIZ, TIKSIZ, XY
     *ZBAS, TTHETA ,TPHI, FRELBL, IPATRN, NPATRN, PATRN ,SCLPRM, WINDO
     *W, SCREEN, SYMBOL, NOSYMB ,FACTXY, LBLSIZ, SYMSIZ, XYZLIM, WORLD 
     *,RADRMX, RADRMN, RADAMN, RADANG, RADX0, RADY0, XUNUSD ,USRKBD, U
     *SRSCR, PLTFIL ,ITITDT, LENCRD ,INPFMT, GRDTYP, LINWID, LINCOL, L
     *INTEX, TITCON, ITCNTR ,IUNUSD, NXYZ1, NXYZ2 ,LBLCHR, NDIMNS, IBL
     *KTP, IDIMNS ,NMESH1, NMESH2, MESH1, MESH2, MESH3, NFIELD ,IFIELD
     *, NINCR ,IVARBL, IVRPTR ,LINEAR, NONLIN ,NPOINT, LETSET ,MXECH
     *O, LINES, MAXLNS ,AXANG, MESH2D, REDFAC, GRDTEX, OUTTEX, IAXTEX, 
     *TITEX, DSCAL ,OUTSTR, IPROP, IHTEX, IBLINK, IERASE, LABTEX, TICTE
     *X, NXYLIM, PATSZ ,MARGIN, PSCR, ITXPRI, ITXSEC, OREAL, OCPU, CSCR
     *D, OUTSID ,TITLIN, TITINX, TITZ, TITX1, TITY1, LTDATA, NPLOTS, RE
     *VLEV ,LBLFMT, IYEAR, IMONTH, IDAY, ISIGFG ,DATPTS, ERRPTS, DATXM
     *N, DATXMX, DATYMN, DATYMX, DATZMN, DATZMX ,DATSUM, ERRSUM, DATAVE
     *, ERRAVE, DATCEN, ERRCEN, DATSTD, ERRSTD ,NCSETS, NCCOL, NCROW, F
     *MARKER, H2STAT, TITFAC, TITLOC, TITMAR ,TIKFAC, IWINLEV, WINREL, 
     *WINABS, WINLIM ,ICPOIN, LEVREP, IREPCT, SYDIR, GRDIR, NMESH0, EXY
     *ZLIM, IVPTR ,TITLMX, NXYZDEF1, NXYZDEF2, IFILE_CASE, N_CYCLE, ITX
     *_CYCLE ,SYM_CYCLE, PLOT_EXTENT, FILL_ANGLE, FILL_WIDTH, FILL_TEX 
     *,FILL_INDEX ,N_LINES ,DSLOPE ,MAX_SUBST, BARBRK ,I_VORDER,SHADOW
     *TYP,SHADOWTEX
      COMMON /T2SCRT/ BUFFER, IBUFFR, N_FILE,N_NAME,N_SELECT, ICHSAVE
      COMMON /T2_CHAR/ C_TIT_ESCAPE,C_TIT_SUBSTITUTE
      COMMON /T2_SCRT/ C_FILE, C_NAME, C_SELECT
      INTEGER JOUFIL, ERRFIL, OUTFIL, DBGFIL, INPFIL, NINMAX
      PARAMETER (NINMAX=20)
      INTEGER NINP(NINMAX)
      COMMON /T2TRBK/NINP, JOUFIL, ERRFIL, OUTFIL, DBGFIL, INPFIL
      CHARACTER*512 STRNG, STJOU
      LOGICAL LTOKEN
      REAL FLOTNG
      INTEGER INTERP, KEYORD, NSTRNG, MAXSTR, NSTJOU, LSTJOU, NTOKEN
      INTEGER*4 INTEG
      COMMON /TOKENC/ INTERP, INTEG, FLOTNG, KEYORD, NSTRNG, MAXSTR, ST
     *RNG, NSTJOU, LSTJOU, STJOU, LTOKEN, NTOKEN
      LOGICAL DFLAGS(200),DSCREV(3)
      COMMON /T2FLGD/DFLAGS,DSCREV
      REAL DTITLIN(4), DTITFAC(4), DTITMAR(4)
      INTEGER DGRDTYP, DGRDTEX, DOUTTEX, IDAXTEX, DTITEX, DSHADOWTYP,DS
     *HADOWTEX, IFLDDF(19), NDDIMNS, IDTXPRI, IDTXSEC, LINCLF, LINTXF,
     * LINWDF, DNONLN(3), DNXYZ1(3), DNXYZ2(3), DLABTEX, DTICTEX, DNPAT
     *RN(30), DLBLCHR(3), ND_CYCLE, IDTX_CYCLE(MAX_CYCLE)
      REAL DSYM_CYCLE(MAX_CYCLE)
      REAL DTITSIZ, DGRDSYM, DGRDSIZ, DCIRSIZ(2,3), DASIZE, DAFLARE, D
     *SMSZDF, DORAXES(3), DEYEDIR(3), DVUEDIR(3), DVUECEN(3), DVERTCL(3
     *), DEYESEP, DSCRD, DSCRZ, DEYEDIS, DEYEPNT(3), DBARSIZ(3), DBARBR
     *K(3), DTIKSIZ(3), DXYZBS(3), DTTHETA, DTPHI, DFRELBL(4), DPATRN(2
     *0,30), DSCLPRM(10,3), DWINDOW(4), DSCREEN(2), DSYMBOL, DNOSYMB, 
     *DAXANG(3), DLBLSIZ, DSYMSIZ, DXYZLIM(3,2), DFACTXY(19), DRADANG,
     * DDSCAL, DPATSZ, DTITINX, DTIKFAC, DSYDIR(3), DGRDIR(3)
      COMMON /T2COMD/ DTITSIZ, DGRDSYM, DGRDSIZ, DCIRSIZ, DASIZE, DAFLA
     *RE, DSMSZDF, DORAXES, DEYEDIR, DVUEDIR, DVUECEN, DVERTCL, DEYESE
     *P, DSCRD, DSCRZ, DEYEDIS, DEYEPNT, DBARSIZ, DTIKSIZ, DXYZBS, DTTH
     *ETA, DTPHI, DFRELBL, DNPATRN, DPATRN, DSCLPRM, DWINDOW, DSCREEN,
     * DSYMBOL, DNOSYMB, DAXANG, DLBLSIZ, DSYMSIZ, DXYZLIM, DGRDTYP, D
     *FACTXY, IFLDDF, NDDIMNS, DGRDTEX, DOUTTEX, IDAXTEX, DTITEX, DRADA
     *NG, DDSCAL, DNONLN, DNXYZ1, DNXYZ2, LINCLF, LINTXF, LINWDF, DLABT
     *EX, DTICTEX, DPATSZ, IDTXPRI, IDTXSEC, DTITLIN, DTITINX, DLBLCHR,
     * DTITFAC, DTITMAR, DTIKFAC, DSYDIR, DGRDIR, ND_CYCLE, IDTX_CYCLE,
     * DSYM_CYCLE, DBARBRK,  DSHADOWTYP,DSHADOWTEX
      INTEGER LSYM
      INTEGER I,LCOUNT,ITXTUR
      REAL TXSYM
      INTEGER IAND,IOR
      LSYM=0
      LCOUNT=0
      ITXTUR=0
      IPATRN=4
      GRDTEX=MOD(GRDTEX,4096)+4096*IPATRN
15231 CONTINUE
      LCOUNT=LCOUNT+1
      GOTO 15241
15250 CONTINUE
      IF (LCOUNT.eq.1) THEN
      GRDSIZ=2.0 
      FLAGS(71)=.false.
      GRDSYM=TXSYM('0O')
      GRDTEX=0
      GRDTYP=0
      DO 15261 I=1,3
      GRDIR(I)=0
15261 CONTINUE
15262 CONTINUE
      ENDIF
      RETURN
15290 CONTINUE
      IF (LTOKEN) THEN
      GRDTYP=IOR(GRDTYP,INTEG)
      ELSE
      GRDTYP=IAND(GRDTYP,NOT(INTEG))
      ENDIF
      GOTO 15242
15300 CONTINUE
      GRDTYP=0
      GOTO 15242
15310 CONTINUE
      GRDTYP=IOR(GRDTYP,8)
      LSYM=LCOUNT+1
      GOTO 15242
15320 CONTINUE
      IF (FLOTNG .lt. 0) THEN
      GRDSIZ=FLOTNG 
      FLAGS(71)=.false.
      ELSE
      GRDSIZ=FLOTNG/REDUCE(3)
      FLAGS(71)=.true.
      ENDIF
      GOTO 15242
15330 CONTINUE
      GRDIR(1)=FLOTNG
      GOTO 15242
15340 CONTINUE
      GRDIR(2)=FLOTNG
      GOTO 15242
15350 CONTINUE
      GRDIR(3)=FLOTNG
      GOTO 15242
15360 CONTINUE
      DO 15371 I=1,3
      DGRDIR(I)=GRDIR(I)
15371 CONTINUE
15372 CONTINUE
      DFLAGS(71)=FLAGS(71)
      DGRDTEX=GRDTEX
      DGRDSYM=GRDSYM
      DGRDSIZ=GRDSIZ
      DGRDTYP=GRDTYP
      GOTO 15242
15380 CONTINUE
      GRDTEX=IAND(NOT(512*7),GRDTEX)+INTEG*512
      GOTO 15242
15390 CONTINUE
      CALL T2GTEX(ITXTUR)
      GRDTEX=IAND(NOT(64*7),GRDTEX)+ITXTUR*64
      GOTO 15242
15400 CONTINUE
      GRDTEX=IAND(NOT(8*7),GRDTEX)+INTEG*8
      GOTO 15242
15270 GOTO ( 15290,15290,15290,15290,15290,15290,15290,15290,15290,15290
     *,15290,15290,15300,15310,15320,15330,15340,15350,15360,15380,15380
     *,15380,15380,15380,15380,15380,15380,15390,15390,15390,15390,15390
     *,15390,15390,15390,15390,15390,15390,15390,15390,15390,15390,15400
     *,15400,15380,15245),KEYORD
15245 CONTINUE
      IF( LSYM .EQ. LCOUNT) THEN
      IF(NSTRNG.gt.0) THEN
      GRDSYM=TXSYM(STRNG(1:NSTRNG))
      ELSE
      GRDSYM=NOSYMB
      ENDIF
      ELSE
      CALL T2ERR(INFOIN,CARDIN,' ',5)
      ENDIF
      GOTO 15242
15241 CALL TOKEN(INFOIN,CARDIN,'CYCLE:256Y,OUTLINE:128Y,YZ:16Y,ZX:32Y,XY
     *:64Y,Z:4Y,ALL:7Y,Y:2Y,HORIZONTAL:2Y,X:1Y,VERTICAL:1Y,ON:7,OFF,SYMB
     *OL,SIZE:0.01:25:-2,THETA:-360:360:0,PHI:0:180:0,ANGLE:-360:360::0,
     *PERMANENT,NOCOLOR:0,WHITE:1,RED:2,GREEN:3,BLUE:4,YELLOW:5,MAGENTA:
     *6,CYAN:7,NOTEXTURE:0,DO:1,DOT:1,DOTS:1,DOTTED:1,DA:2,DASHES:2,DASH
     *ED:2,SOLID:4,DOTDASHED:3,DOT-DASH:3,FUNNY:5,DAASHES:7,SPACE:8,PATT
     *ERNED:6,INTENSITY:0:9:2,WIDTH:0:9:2,BLACK:8,;')
      GOTO (15250,15270,15245,15245,15245,15245,15245,15270,15245),INTER
     *P
15242 CONTINUE
      GOTO 15231
15232 CONTINUE
      END
      SUBROUTINE T2_SET_TITLES(INFOIN,CARDIN)
      IMPLICIT NONE
      INTEGER INFOIN(10)
      CHARACTER*(*) CARDIN
      COMMON /T2FLGC/ FLAGS(200), LTRAP,LHANDL,LSYERR,LSCREV
      LOGICAL FLAGS, LTRAP,LHANDL,LSYERR,LSCREV(3)
      INTEGER RELFLAG 
      PARAMETER (RELFLAG=151)
      INTEGER IWINLEV 
      INTEGER NWINLEV , MAX_FILL 
      PARAMETER (NWINLEV =4)
      PARAMETER (MAX_FILL=4)
      REAL GRDSYM, GRDSIZ, DATDAT(2,8), H2STAT(12), TITLIN(4), TITFA
     *C(4), TITLOC(4), TITMAR(4), TITLMX(4), TIKFAC, TITINX, TITX1, TIT
     *Y1, TITX, TITY, TITZ, TITSIZ, TITCON(5), REVLEV, REDUCE(5), XFR
     *M12(12), XFRM13(12), XFRM14(12), XFRM23(12), XFRM24(12), XFRM34(6
     *), XVARSX(20), CIRSIZ(2,3), ASIZE, AFLARE, SMSZDF, ORAXES(3), EY
     *EDIR(3), VUEDIR(3), VUECEN(3), VERTCL(3), EYESEP, SCRD, SCRZ, EYE
     *DIS, EYEPNT(3), XYPART(2, 2), BARSIZ(3), BARBRK(3), TIKSIZ(3), XY
     *ZBAS(3), TTHETA, TPHI, FRELBL(4), PATRN(20,30), SCLPRM(10,3), WI
     *NDOW(4), SCREEN(2), SYMBOL, NOSYMB, FACTXY(19), LBLSIZ, SYMSIZ, X
     *YZLIM(3,2), WORLD(3), RADRMX, RADRMN, RADAMN, RADANG, RADX0, RADY
     *0, XUNUSD(6), AXANG(3), REDFAC, DSCAL, PATSZ, MARGIN(4), PSCR(2
     *), OREAL, OCPU, CSCRD, DATPTS, ERRPTS, DATXMN, DATXMX, DATYMN, DA
     *TYMX, DATZMN, DATZMX, DATSUM, ERRSUM, DATAVE, ERRAVE, DATCEN, ERR
     *CEN, DATSTD, ERRSTD, WINREL(2,2,NWINLEV),WINABS(2,2,NWINLEV),WINL
     *IM(2,2), FMARKER(3,8), SYDIR(3), GRDIR(3), EXYZLIM(3,2), DSLOPE(2
     *,2)
      REAL PLOT_EXTENT(2,2),FILL_ANGLE(MAX_FILL),FILL_WIDTH(MAX_FILL)
      INTEGER FILL_INDEX, FILL_TEX(MAX_FILL), N_LINES(6)
      EQUIVALENCE (DATDAT, DATPTS)
      INTEGER MAXREP
      PARAMETER (MAXREP=5)
      INTEGER IPATRN, NPATRN(30), NXYLIM(3,2), NPLOTS, NCSETS, NCCOL, N
     *CROW, IYEAR, IMONTH, IDAY, ISIGFG, ITXPRI, ITXSEC, ITITDT(3), L
     *ENCRD, IPROP, IHTEX, IBLINK, IERASE, ITCNTR, IUNUSD, NXYZ1(3), 
     *NXYZ2(3), LBLFMT(3), LBLCHR(3), NDIMNS(3), IBLKTP, IDIMNS, NMES
     *H0, NMESH1, NMESH2, MESH1, MESH2, MESH3, MESH2D, MESHN(3), NMESHN(
     *2), NFIELD, IFIELD(19), NINCR, NPOINT, IVARBL(19), IVPTR(19), I_
     *VORDER(19,2), LINEAR(4), NONLIN(4), MXECHO, LINES, MAXLNS, USRK
     *BD, USRSCR, PLTFIL, LINWID, LINCOL, LINTEX, ICPOIN(3), IREPCT(MA
     *XREP), LEVREP, GRDTYP, GRDTEX, OUTTEX, IAXTEX, TITEX, LETSET, LAB
     *TEX, TICTEX, SHADOWTYP,SHADOWTEX, NXYZDEF1(10), NXYZDEF2(10), IF
     *ILE_CASE ,MAX_SUBST
      INTEGER MAX_CYCLE
      PARAMETER (MAX_CYCLE=20)
      INTEGER N_CYCLE, ITX_CYCLE(MAX_CYCLE)
      REAL SYM_CYCLE(MAX_CYCLE)
      EQUIVALENCE (NMESH1,NMESHN)
      EQUIVALENCE (MESH1,MESHN)
      INTEGER IBUFFR(400)
      REAL BUFFER(400)
      INTEGER NCHSAVE 
      PARAMETER (NCHSAVE=2*512) 
      INTEGER*4 ICHSAVE(NCHSAVE)
      INTEGER*4 IVRPTR(15)
      CHARACTER*512 OUTSTR,C_FILE, C_NAME, C_SELECT
      CHARACTER C_TIT_ESCAPE*1,C_TIT_SUBSTITUTE*2
      INTEGER N_FILE, N_NAME, N_SELECT
      CHARACTER*8 PXNAME
      CHARACTER*64 INPFMT
      LOGICAL LTDATA, OUTSID(4)
      COMMON /T2COM/ PXNAME, REDUCE, TITX, TITY ,XFRM12, XFRM13, XFRM1
     *4, XFRM23 ,XFRM24, XFRM34 ,XVARSX ,TITSIZ, GRDSYM, GRDSIZ, CIRS
     *IZ, ASIZE, AFLARE ,SMSZDF, ORAXES, EYEDIR, VUEDIR, VUECEN ,VERTC
     *L, EYESEP, SCRD, SCRZ, EYEDIS, EYEPNT ,XYPART, BARSIZ, TIKSIZ, XY
     *ZBAS, TTHETA ,TPHI, FRELBL, IPATRN, NPATRN, PATRN ,SCLPRM, WINDO
     *W, SCREEN, SYMBOL, NOSYMB ,FACTXY, LBLSIZ, SYMSIZ, XYZLIM, WORLD 
     *,RADRMX, RADRMN, RADAMN, RADANG, RADX0, RADY0, XUNUSD ,USRKBD, U
     *SRSCR, PLTFIL ,ITITDT, LENCRD ,INPFMT, GRDTYP, LINWID, LINCOL, L
     *INTEX, TITCON, ITCNTR ,IUNUSD, NXYZ1, NXYZ2 ,LBLCHR, NDIMNS, IBL
     *KTP, IDIMNS ,NMESH1, NMESH2, MESH1, MESH2, MESH3, NFIELD ,IFIELD
     *, NINCR ,IVARBL, IVRPTR ,LINEAR, NONLIN ,NPOINT, LETSET ,MXECH
     *O, LINES, MAXLNS ,AXANG, MESH2D, REDFAC, GRDTEX, OUTTEX, IAXTEX, 
     *TITEX, DSCAL ,OUTSTR, IPROP, IHTEX, IBLINK, IERASE, LABTEX, TICTE
     *X, NXYLIM, PATSZ ,MARGIN, PSCR, ITXPRI, ITXSEC, OREAL, OCPU, CSCR
     *D, OUTSID ,TITLIN, TITINX, TITZ, TITX1, TITY1, LTDATA, NPLOTS, RE
     *VLEV ,LBLFMT, IYEAR, IMONTH, IDAY, ISIGFG ,DATPTS, ERRPTS, DATXM
     *N, DATXMX, DATYMN, DATYMX, DATZMN, DATZMX ,DATSUM, ERRSUM, DATAVE
     *, ERRAVE, DATCEN, ERRCEN, DATSTD, ERRSTD ,NCSETS, NCCOL, NCROW, F
     *MARKER, H2STAT, TITFAC, TITLOC, TITMAR ,TIKFAC, IWINLEV, WINREL, 
     *WINABS, WINLIM ,ICPOIN, LEVREP, IREPCT, SYDIR, GRDIR, NMESH0, EXY
     *ZLIM, IVPTR ,TITLMX, NXYZDEF1, NXYZDEF2, IFILE_CASE, N_CYCLE, ITX
     *_CYCLE ,SYM_CYCLE, PLOT_EXTENT, FILL_ANGLE, FILL_WIDTH, FILL_TEX 
     *,FILL_INDEX ,N_LINES ,DSLOPE ,MAX_SUBST, BARBRK ,I_VORDER,SHADOW
     *TYP,SHADOWTEX
      COMMON /T2SCRT/ BUFFER, IBUFFR, N_FILE,N_NAME,N_SELECT, ICHSAVE
      COMMON /T2_CHAR/ C_TIT_ESCAPE,C_TIT_SUBSTITUTE
      COMMON /T2_SCRT/ C_FILE, C_NAME, C_SELECT
      INTEGER JOUFIL, ERRFIL, OUTFIL, DBGFIL, INPFIL, NINMAX
      PARAMETER (NINMAX=20)
      INTEGER NINP(NINMAX)
      COMMON /T2TRBK/NINP, JOUFIL, ERRFIL, OUTFIL, DBGFIL, INPFIL
      CHARACTER*512 STRNG, STJOU
      LOGICAL LTOKEN
      REAL FLOTNG
      INTEGER INTERP, KEYORD, NSTRNG, MAXSTR, NSTJOU, LSTJOU, NTOKEN
      INTEGER*4 INTEG
      COMMON /TOKENC/ INTERP, INTEG, FLOTNG, KEYORD, NSTRNG, MAXSTR, ST
     *RNG, NSTJOU, LSTJOU, STJOU, LTOKEN, NTOKEN
      LOGICAL DFLAGS(200),DSCREV(3)
      COMMON /T2FLGD/DFLAGS,DSCREV
      REAL DTITLIN(4), DTITFAC(4), DTITMAR(4)
      INTEGER DGRDTYP, DGRDTEX, DOUTTEX, IDAXTEX, DTITEX, DSHADOWTYP,DS
     *HADOWTEX, IFLDDF(19), NDDIMNS, IDTXPRI, IDTXSEC, LINCLF, LINTXF,
     * LINWDF, DNONLN(3), DNXYZ1(3), DNXYZ2(3), DLABTEX, DTICTEX, DNPAT
     *RN(30), DLBLCHR(3), ND_CYCLE, IDTX_CYCLE(MAX_CYCLE)
      REAL DSYM_CYCLE(MAX_CYCLE)
      REAL DTITSIZ, DGRDSYM, DGRDSIZ, DCIRSIZ(2,3), DASIZE, DAFLARE, D
     *SMSZDF, DORAXES(3), DEYEDIR(3), DVUEDIR(3), DVUECEN(3), DVERTCL(3
     *), DEYESEP, DSCRD, DSCRZ, DEYEDIS, DEYEPNT(3), DBARSIZ(3), DBARBR
     *K(3), DTIKSIZ(3), DXYZBS(3), DTTHETA, DTPHI, DFRELBL(4), DPATRN(2
     *0,30), DSCLPRM(10,3), DWINDOW(4), DSCREEN(2), DSYMBOL, DNOSYMB, 
     *DAXANG(3), DLBLSIZ, DSYMSIZ, DXYZLIM(3,2), DFACTXY(19), DRADANG,
     * DDSCAL, DPATSZ, DTITINX, DTIKFAC, DSYDIR(3), DGRDIR(3)
      COMMON /T2COMD/ DTITSIZ, DGRDSYM, DGRDSIZ, DCIRSIZ, DASIZE, DAFLA
     *RE, DSMSZDF, DORAXES, DEYEDIR, DVUEDIR, DVUECEN, DVERTCL, DEYESE
     *P, DSCRD, DSCRZ, DEYEDIS, DEYEPNT, DBARSIZ, DTIKSIZ, DXYZBS, DTTH
     *ETA, DTPHI, DFRELBL, DNPATRN, DPATRN, DSCLPRM, DWINDOW, DSCREEN,
     * DSYMBOL, DNOSYMB, DAXANG, DLBLSIZ, DSYMSIZ, DXYZLIM, DGRDTYP, D
     *FACTXY, IFLDDF, NDDIMNS, DGRDTEX, DOUTTEX, IDAXTEX, DTITEX, DRADA
     *NG, DDSCAL, DNONLN, DNXYZ1, DNXYZ2, LINCLF, LINTXF, LINWDF, DLABT
     *EX, DTICTEX, DPATSZ, IDTXPRI, IDTXSEC, DTITLIN, DTITINX, DLBLCHR,
     * DTITFAC, DTITMAR, DTIKFAC, DSYDIR, DGRDIR, ND_CYCLE, IDTX_CYCLE,
     * DSYM_CYCLE, DBARBRK,  DSHADOWTYP,DSHADOWTEX
      INTEGER I,J,N1,JMIN,JMAX,JSTP
      REAL TEMP,T
      INTEGER IAND
      N1=0
      JMIN=1
      JMAX=4
      JSTP=1
      GOTO 15411
15440 CONTINUE
      C_TIT_ESCAPE=STRNG(:1)
      IF (C_TIT_ESCAPE .eq. ' ' .or. C_TIT_ESCAPE .eq. '\t' .or. NSTRNG
     *.le. 0) C_TIT_ESCAPE=CHAR(0)
      GOTO 15411
15450 CONTINUE
      C_TIT_SUBSTITUTE=STRNG(:2)
      IF (C_TIT_SUBSTITUTE(:1) .eq. ' ' .or. C_TIT_SUBSTITUTE(:1) .eq. 
     *'\t' .or. NSTRNG .le. 0) C_TIT_SUBSTITUTE=CHAR(0)
      GOTO 15411
15460 CONTINUE
      N1=1
      TITINX=FLOTNG
      GOTO 15411
15470 CONTINUE
      N1=1
      JMIN=INTEG/100
      JMAX=MOD(INTEG/10,10)
      JSTP=MOD(INTEG,10)
      GOTO 15411
15480 CONTINUE
      N1=1
      TEMP=FLOTNG
      DO 15491 J=JMIN,JMAX,JSTP
      IF(FLOTNG.gt.6) THEN
      TEMP=1.2
      IF (J.eq.2) TEMP=2.0
      ENDIF
      TITLIN(J)=TEMP
15491 CONTINUE
15492 CONTINUE
      GOTO 15411
15500 CONTINUE
      N1=1
      DO 15511 J=JMIN,JMAX,JSTP
      TITMAR(J)=FLOTNG
15511 CONTINUE
15512 CONTINUE
      GOTO 15411
15520 CONTINUE
      N1=1
      T=FLOTNG
      IF (T.eq.0) T=1.0
      DO 15531 J=JMIN,JMAX,JSTP
      IF (FLOTNG.eq.0 .and.J.eq.4) T=1.5
      TITFAC(J)=T
15531 CONTINUE
15532 CONTINUE
      GOTO 15411
15540 CONTINUE
      N1=1
      IF (FLOTNG .lt. 0) THEN
      FLAGS(76)=.FALSE.
      TITSIZ=FLOTNG 
      ELSE
      FLAGS(76)=.TRUE.
      TITSIZ=FLOTNG/REDUCE(3)
      ENDIF
      GOTO 15411
15550 CONTINUE
      N1=1
      TITEX=IAND(NOT(512*7),TITEX)+INTEG*512
      GOTO 15411
15560 CONTINUE
      N1=1
      TITEX=IAND(NOT(8*7),TITEX)+INTEG*8
      GOTO 15411
15570 CONTINUE
      N1=1
      DTITSIZ=TITSIZ
      DTITEX=TITEX
      DFLAGS(76)=FLAGS(76)
      DO 15581 I=1,4
      DTITLIN(I)=TITLIN(I)
      DTITFAC(I)=TITFAC(I)
      DTITMAR(I)=TITMAR(I)
15581 CONTINUE
15582 CONTINUE
      DTITINX=TITINX
      GOTO 15411
15411 CALL TOKEN(INFOIN,CARDIN,'ESCAPE:0:1:S,SUBSTITUTE:0:2:S,INDEX:-6:6
     *:2,ALL:141,LEFT:111,BOTTOM:221,RIGHT:331,TOP:441,X:242,Y:142,LINES
     *:-6:6:10,MARGIN:0:0.4:0.025,SCALE:0.1:10:0,SIZE:::-2,NOCOLOR:0,WHI
     *TE:1,RED:2,GREEN:3,BLUE:4,YELLOW:5,MAGENTA:6,CYAN:7,INTENSITY:0:9:
     *0,WIDTH:0:9:0,PERMANENT,BLACK:8,;')
      GOTO (15412,15417,15415,15415,15415,15415,15411,15417, 15415),INTE
     *RP
15415 CALL T2ERR(INFOIN,CARDIN,' ',5)
      GOTO 15411
15417 GOTO ( 15440,15450,15460,15470,15470,15470,15470,15470,15470,15470
     *,15480,15500,15520,15540,15550,15550,15550,15550,15550,15550,15550
     *,15550,15560,15560,15570,15550,15415),KEYORD
15412 CONTINUE
      IF(N1 .eq. 0.AND..not.FLAGS(23)) THEN
      FLAGS(76)=.FALSE.
      TITSIZ=2.0 
      TITEX=256
      DO 15591 I=1,4
      TITLIN(I)=1.
15591 CONTINUE
15592 CONTINUE
      TITINX=2
      ENDIF
      END
      SUBROUTINE T2_SET_UNITS(INFOIN,CARDIN)
      IMPLICIT NONE
      INTEGER INFOIN(10)
      CHARACTER*(*) CARDIN
      REAL PLIM(4,4),ZSCRN(2),XLLINE,YLLINE,XTLINE,YTLINE,XFRMFC, PAT(2
     *0),PATCUM,PATTOT,PATMOD,CCSCIS(4),DISPL, RESOL(2)
      INTEGER NPTS,IDDEVC,IPAT,NPAT,LMOVE,IROTAX,IROTAF
      COMMON/TXCOM/PLIM,ZSCRN, XLLINE,YLLINE,XTLINE,YTLINE,XFRMFC, IPA
     *T,NPAT,PAT,PATTOT, NPTS,IDDEVC,CCSCIS,LMOVE,IROTAX,DISPL,IROTAF,P
     *ATCUM,PATMOD, RESOL
      COMMON /T2FLGC/ FLAGS(200), LTRAP,LHANDL,LSYERR,LSCREV
      LOGICAL FLAGS, LTRAP,LHANDL,LSYERR,LSCREV(3)
      INTEGER RELFLAG 
      PARAMETER (RELFLAG=151)
      INTEGER IWINLEV 
      INTEGER NWINLEV , MAX_FILL 
      PARAMETER (NWINLEV =4)
      PARAMETER (MAX_FILL=4)
      REAL GRDSYM, GRDSIZ, DATDAT(2,8), H2STAT(12), TITLIN(4), TITFA
     *C(4), TITLOC(4), TITMAR(4), TITLMX(4), TIKFAC, TITINX, TITX1, TIT
     *Y1, TITX, TITY, TITZ, TITSIZ, TITCON(5), REVLEV, REDUCE(5), XFR
     *M12(12), XFRM13(12), XFRM14(12), XFRM23(12), XFRM24(12), XFRM34(6
     *), XVARSX(20), CIRSIZ(2,3), ASIZE, AFLARE, SMSZDF, ORAXES(3), EY
     *EDIR(3), VUEDIR(3), VUECEN(3), VERTCL(3), EYESEP, SCRD, SCRZ, EYE
     *DIS, EYEPNT(3), XYPART(2, 2), BARSIZ(3), BARBRK(3), TIKSIZ(3), XY
     *ZBAS(3), TTHETA, TPHI, FRELBL(4), PATRN(20,30), SCLPRM(10,3), WI
     *NDOW(4), SCREEN(2), SYMBOL, NOSYMB, FACTXY(19), LBLSIZ, SYMSIZ, X
     *YZLIM(3,2), WORLD(3), RADRMX, RADRMN, RADAMN, RADANG, RADX0, RADY
     *0, XUNUSD(6), AXANG(3), REDFAC, DSCAL, PATSZ, MARGIN(4), PSCR(2
     *), OREAL, OCPU, CSCRD, DATPTS, ERRPTS, DATXMN, DATXMX, DATYMN, DA
     *TYMX, DATZMN, DATZMX, DATSUM, ERRSUM, DATAVE, ERRAVE, DATCEN, ERR
     *CEN, DATSTD, ERRSTD, WINREL(2,2,NWINLEV),WINABS(2,2,NWINLEV),WINL
     *IM(2,2), FMARKER(3,8), SYDIR(3), GRDIR(3), EXYZLIM(3,2), DSLOPE(2
     *,2)
      REAL PLOT_EXTENT(2,2),FILL_ANGLE(MAX_FILL),FILL_WIDTH(MAX_FILL)
      INTEGER FILL_INDEX, FILL_TEX(MAX_FILL), N_LINES(6)
      EQUIVALENCE (DATDAT, DATPTS)
      INTEGER MAXREP
      PARAMETER (MAXREP=5)
      INTEGER IPATRN, NPATRN(30), NXYLIM(3,2), NPLOTS, NCSETS, NCCOL, N
     *CROW, IYEAR, IMONTH, IDAY, ISIGFG, ITXPRI, ITXSEC, ITITDT(3), L
     *ENCRD, IPROP, IHTEX, IBLINK, IERASE, ITCNTR, IUNUSD, NXYZ1(3), 
     *NXYZ2(3), LBLFMT(3), LBLCHR(3), NDIMNS(3), IBLKTP, IDIMNS, NMES
     *H0, NMESH1, NMESH2, MESH1, MESH2, MESH3, MESH2D, MESHN(3), NMESHN(
     *2), NFIELD, IFIELD(19), NINCR, NPOINT, IVARBL(19), IVPTR(19), I_
     *VORDER(19,2), LINEAR(4), NONLIN(4), MXECHO, LINES, MAXLNS, USRK
     *BD, USRSCR, PLTFIL, LINWID, LINCOL, LINTEX, ICPOIN(3), IREPCT(MA
     *XREP), LEVREP, GRDTYP, GRDTEX, OUTTEX, IAXTEX, TITEX, LETSET, LAB
     *TEX, TICTEX, SHADOWTYP,SHADOWTEX, NXYZDEF1(10), NXYZDEF2(10), IF
     *ILE_CASE ,MAX_SUBST
      INTEGER MAX_CYCLE
      PARAMETER (MAX_CYCLE=20)
      INTEGER N_CYCLE, ITX_CYCLE(MAX_CYCLE)
      REAL SYM_CYCLE(MAX_CYCLE)
      EQUIVALENCE (NMESH1,NMESHN)
      EQUIVALENCE (MESH1,MESHN)
      INTEGER IBUFFR(400)
      REAL BUFFER(400)
      INTEGER NCHSAVE 
      PARAMETER (NCHSAVE=2*512) 
      INTEGER*4 ICHSAVE(NCHSAVE)
      INTEGER*4 IVRPTR(15)
      CHARACTER*512 OUTSTR,C_FILE, C_NAME, C_SELECT
      CHARACTER C_TIT_ESCAPE*1,C_TIT_SUBSTITUTE*2
      INTEGER N_FILE, N_NAME, N_SELECT
      CHARACTER*8 PXNAME
      CHARACTER*64 INPFMT
      LOGICAL LTDATA, OUTSID(4)
      COMMON /T2COM/ PXNAME, REDUCE, TITX, TITY ,XFRM12, XFRM13, XFRM1
     *4, XFRM23 ,XFRM24, XFRM34 ,XVARSX ,TITSIZ, GRDSYM, GRDSIZ, CIRS
     *IZ, ASIZE, AFLARE ,SMSZDF, ORAXES, EYEDIR, VUEDIR, VUECEN ,VERTC
     *L, EYESEP, SCRD, SCRZ, EYEDIS, EYEPNT ,XYPART, BARSIZ, TIKSIZ, XY
     *ZBAS, TTHETA ,TPHI, FRELBL, IPATRN, NPATRN, PATRN ,SCLPRM, WINDO
     *W, SCREEN, SYMBOL, NOSYMB ,FACTXY, LBLSIZ, SYMSIZ, XYZLIM, WORLD 
     *,RADRMX, RADRMN, RADAMN, RADANG, RADX0, RADY0, XUNUSD ,USRKBD, U
     *SRSCR, PLTFIL ,ITITDT, LENCRD ,INPFMT, GRDTYP, LINWID, LINCOL, L
     *INTEX, TITCON, ITCNTR ,IUNUSD, NXYZ1, NXYZ2 ,LBLCHR, NDIMNS, IBL
     *KTP, IDIMNS ,NMESH1, NMESH2, MESH1, MESH2, MESH3, NFIELD ,IFIELD
     *, NINCR ,IVARBL, IVRPTR ,LINEAR, NONLIN ,NPOINT, LETSET ,MXECH
     *O, LINES, MAXLNS ,AXANG, MESH2D, REDFAC, GRDTEX, OUTTEX, IAXTEX, 
     *TITEX, DSCAL ,OUTSTR, IPROP, IHTEX, IBLINK, IERASE, LABTEX, TICTE
     *X, NXYLIM, PATSZ ,MARGIN, PSCR, ITXPRI, ITXSEC, OREAL, OCPU, CSCR
     *D, OUTSID ,TITLIN, TITINX, TITZ, TITX1, TITY1, LTDATA, NPLOTS, RE
     *VLEV ,LBLFMT, IYEAR, IMONTH, IDAY, ISIGFG ,DATPTS, ERRPTS, DATXM
     *N, DATXMX, DATYMN, DATYMX, DATZMN, DATZMX ,DATSUM, ERRSUM, DATAVE
     *, ERRAVE, DATCEN, ERRCEN, DATSTD, ERRSTD ,NCSETS, NCCOL, NCROW, F
     *MARKER, H2STAT, TITFAC, TITLOC, TITMAR ,TIKFAC, IWINLEV, WINREL, 
     *WINABS, WINLIM ,ICPOIN, LEVREP, IREPCT, SYDIR, GRDIR, NMESH0, EXY
     *ZLIM, IVPTR ,TITLMX, NXYZDEF1, NXYZDEF2, IFILE_CASE, N_CYCLE, ITX
     *_CYCLE ,SYM_CYCLE, PLOT_EXTENT, FILL_ANGLE, FILL_WIDTH, FILL_TEX 
     *,FILL_INDEX ,N_LINES ,DSLOPE ,MAX_SUBST, BARBRK ,I_VORDER,SHADOW
     *TYP,SHADOWTEX
      COMMON /T2SCRT/ BUFFER, IBUFFR, N_FILE,N_NAME,N_SELECT, ICHSAVE
      COMMON /T2_CHAR/ C_TIT_ESCAPE,C_TIT_SUBSTITUTE
      COMMON /T2_SCRT/ C_FILE, C_NAME, C_SELECT
      INTEGER JOUFIL, ERRFIL, OUTFIL, DBGFIL, INPFIL, NINMAX
      PARAMETER (NINMAX=20)
      INTEGER NINP(NINMAX)
      COMMON /T2TRBK/NINP, JOUFIL, ERRFIL, OUTFIL, DBGFIL, INPFIL
      CHARACTER*512 STRNG, STJOU
      LOGICAL LTOKEN
      REAL FLOTNG
      INTEGER INTERP, KEYORD, NSTRNG, MAXSTR, NSTJOU, LSTJOU, NTOKEN
      INTEGER*4 INTEG
      COMMON /TOKENC/ INTERP, INTEG, FLOTNG, KEYORD, NSTRNG, MAXSTR, ST
     *RNG, NSTJOU, LSTJOU, STJOU, LTOKEN, NTOKEN
      INTEGER I,J,IMIN,IMAX
      REAL DUNIT(3)
      REAL CM 
      PARAMETER (CM=2.54)
      REAL INCHES, MM, DM, METERS, MILS, POINTS, FEET, YARDS 
      REAL FATHOMS, RODS, FURLONGS, MILES, LEAGUES 
      INTEGER MAXUNITS 
      PARAMETER ( INCHES = CM/2.54) 
      PARAMETER ( MM = CM*10) 
      PARAMETER ( DM = CM/10) 
      PARAMETER ( METERS = CM/100) 
      PARAMETER ( MILS = INCHES*1000)
      PARAMETER ( POINTS = INCHES*72) 
      PARAMETER ( FEET = INCHES/12) 
      PARAMETER ( YARDS = FEET/3) 
      PARAMETER ( FATHOMS = FEET/6) 
      PARAMETER ( RODS = FEET/16.5) 
      PARAMETER ( FURLONGS = RODS/40) 
      PARAMETER ( MILES = FURLONGS/8) 
      PARAMETER ( LEAGUES = MILES/3) 
      PARAMETER ( MAXUNITS = 14) 
      REAL UNITS(MAXUNITS)
      DATA UNITS/INCHES,MM,CM,METERS,POINTS,MILS,DM, FEET,YARDS,
     *FATHOMS,RODS,FURLONGS,MILES,LEAGUES/
      DATA DUNIT/0.,1.,.1/
      DO 15601 I=1,2
      SCREEN(I)=SCREEN(I)/REDUCE(2)
15601 CONTINUE
15602 CONTINUE
      DO 15611 I=1,4
      MARGIN(I)=MARGIN(I)/REDUCE(2)
      WINDOW(I)=WINDOW(I)/REDUCE(2)
15611 CONTINUE
15612 CONTINUE
      IMIN=2
      IMAX=2
      I=0
      GOTO 15621
15650 CONTINUE
      IMIN=INTEG/10
      IMAX=MOD(INTEG,10)
      GOTO 15621
15660 CONTINUE
      FLOTNG=UNITS(INTEG)
      GOTO 15670
15680 CONTINUE
15670 CONTINUE
      DO 15671 I=IMIN,IMAX
      REDUCE(I)=FLOTNG*DUNIT(I)
15671 CONTINUE
15672 CONTINUE
      GOTO 15621
15621 CALL TOKEN(INFOIN,CARDIN,'TEXT:22,CHARACTER:33,ALL:23,INCHES:1,MM:
     *2,MILLIMETERS:2,CM:3,CENTIMETERS,METERS:4,POINTS:5,MILS:6,DM:7,DEC
     *IMETERS:7,FEET:8,YARDS:9,FATHOMS:10,RODS:11,FURLONGS:12,MILES:13,L
     *EAGUES:14,REDUCE:.00001:100000.:1,;')
      GOTO (15622,15627,15625,15625,15625,15625,15621,15627, 15625),INTE
     *RP
15625 CALL T2ERR(INFOIN,CARDIN,' ',5)
      GOTO 15621
15627 GOTO ( 15650,15650,15650,15660,15660,15660,15660,15660,15660,15660
     *,15660,15660,15660,15660,15660,15660,15660,15660,15660,15660,15680
     *,15625),KEYORD
15622 CONTINUE
      IF (I .eq. 0) THEN
      DO 15691 I=2,3
      REDUCE(I)=1
15691 CONTINUE
15692 CONTINUE
      ENDIF
      DO 15701 I=1,2
      SCREEN(I)=SCREEN(I)*REDUCE(2)
15701 CONTINUE
15702 CONTINUE
      DO 15711 I=1,4
      MARGIN(I)=MARGIN(I)*REDUCE(2)
      WINDOW(I)=WINDOW(I)*REDUCE(2)
15711 CONTINUE
15712 CONTINUE
      END
      SUBROUTINE T2_SET_THREE(INFOIN,CARDIN)
      IMPLICIT NONE
      REAL BUFFR(3)
      INTEGER INFOIN(10)
      CHARACTER*(*) CARDIN
      COMMON /T2FLGC/ FLAGS(200), LTRAP,LHANDL,LSYERR,LSCREV
      LOGICAL FLAGS, LTRAP,LHANDL,LSYERR,LSCREV(3)
      INTEGER RELFLAG 
      PARAMETER (RELFLAG=151)
      INTEGER IWINLEV 
      INTEGER NWINLEV , MAX_FILL 
      PARAMETER (NWINLEV =4)
      PARAMETER (MAX_FILL=4)
      REAL GRDSYM, GRDSIZ, DATDAT(2,8), H2STAT(12), TITLIN(4), TITFA
     *C(4), TITLOC(4), TITMAR(4), TITLMX(4), TIKFAC, TITINX, TITX1, TIT
     *Y1, TITX, TITY, TITZ, TITSIZ, TITCON(5), REVLEV, REDUCE(5), XFR
     *M12(12), XFRM13(12), XFRM14(12), XFRM23(12), XFRM24(12), XFRM34(6
     *), XVARSX(20), CIRSIZ(2,3), ASIZE, AFLARE, SMSZDF, ORAXES(3), EY
     *EDIR(3), VUEDIR(3), VUECEN(3), VERTCL(3), EYESEP, SCRD, SCRZ, EYE
     *DIS, EYEPNT(3), XYPART(2, 2), BARSIZ(3), BARBRK(3), TIKSIZ(3), XY
     *ZBAS(3), TTHETA, TPHI, FRELBL(4), PATRN(20,30), SCLPRM(10,3), WI
     *NDOW(4), SCREEN(2), SYMBOL, NOSYMB, FACTXY(19), LBLSIZ, SYMSIZ, X
     *YZLIM(3,2), WORLD(3), RADRMX, RADRMN, RADAMN, RADANG, RADX0, RADY
     *0, XUNUSD(6), AXANG(3), REDFAC, DSCAL, PATSZ, MARGIN(4), PSCR(2
     *), OREAL, OCPU, CSCRD, DATPTS, ERRPTS, DATXMN, DATXMX, DATYMN, DA
     *TYMX, DATZMN, DATZMX, DATSUM, ERRSUM, DATAVE, ERRAVE, DATCEN, ERR
     *CEN, DATSTD, ERRSTD, WINREL(2,2,NWINLEV),WINABS(2,2,NWINLEV),WINL
     *IM(2,2), FMARKER(3,8), SYDIR(3), GRDIR(3), EXYZLIM(3,2), DSLOPE(2
     *,2)
      REAL PLOT_EXTENT(2,2),FILL_ANGLE(MAX_FILL),FILL_WIDTH(MAX_FILL)
      INTEGER FILL_INDEX, FILL_TEX(MAX_FILL), N_LINES(6)
      EQUIVALENCE (DATDAT, DATPTS)
      INTEGER MAXREP
      PARAMETER (MAXREP=5)
      INTEGER IPATRN, NPATRN(30), NXYLIM(3,2), NPLOTS, NCSETS, NCCOL, N
     *CROW, IYEAR, IMONTH, IDAY, ISIGFG, ITXPRI, ITXSEC, ITITDT(3), L
     *ENCRD, IPROP, IHTEX, IBLINK, IERASE, ITCNTR, IUNUSD, NXYZ1(3), 
     *NXYZ2(3), LBLFMT(3), LBLCHR(3), NDIMNS(3), IBLKTP, IDIMNS, NMES
     *H0, NMESH1, NMESH2, MESH1, MESH2, MESH3, MESH2D, MESHN(3), NMESHN(
     *2), NFIELD, IFIELD(19), NINCR, NPOINT, IVARBL(19), IVPTR(19), I_
     *VORDER(19,2), LINEAR(4), NONLIN(4), MXECHO, LINES, MAXLNS, USRK
     *BD, USRSCR, PLTFIL, LINWID, LINCOL, LINTEX, ICPOIN(3), IREPCT(MA
     *XREP), LEVREP, GRDTYP, GRDTEX, OUTTEX, IAXTEX, TITEX, LETSET, LAB
     *TEX, TICTEX, SHADOWTYP,SHADOWTEX, NXYZDEF1(10), NXYZDEF2(10), IF
     *ILE_CASE ,MAX_SUBST
      INTEGER MAX_CYCLE
      PARAMETER (MAX_CYCLE=20)
      INTEGER N_CYCLE, ITX_CYCLE(MAX_CYCLE)
      REAL SYM_CYCLE(MAX_CYCLE)
      EQUIVALENCE (NMESH1,NMESHN)
      EQUIVALENCE (MESH1,MESHN)
      INTEGER IBUFFR(400)
      REAL BUFFER(400)
      INTEGER NCHSAVE 
      PARAMETER (NCHSAVE=2*512) 
      INTEGER*4 ICHSAVE(NCHSAVE)
      INTEGER*4 IVRPTR(15)
      CHARACTER*512 OUTSTR,C_FILE, C_NAME, C_SELECT
      CHARACTER C_TIT_ESCAPE*1,C_TIT_SUBSTITUTE*2
      INTEGER N_FILE, N_NAME, N_SELECT
      CHARACTER*8 PXNAME
      CHARACTER*64 INPFMT
      LOGICAL LTDATA, OUTSID(4)
      COMMON /T2COM/ PXNAME, REDUCE, TITX, TITY ,XFRM12, XFRM13, XFRM1
     *4, XFRM23 ,XFRM24, XFRM34 ,XVARSX ,TITSIZ, GRDSYM, GRDSIZ, CIRS
     *IZ, ASIZE, AFLARE ,SMSZDF, ORAXES, EYEDIR, VUEDIR, VUECEN ,VERTC
     *L, EYESEP, SCRD, SCRZ, EYEDIS, EYEPNT ,XYPART, BARSIZ, TIKSIZ, XY
     *ZBAS, TTHETA ,TPHI, FRELBL, IPATRN, NPATRN, PATRN ,SCLPRM, WINDO
     *W, SCREEN, SYMBOL, NOSYMB ,FACTXY, LBLSIZ, SYMSIZ, XYZLIM, WORLD 
     *,RADRMX, RADRMN, RADAMN, RADANG, RADX0, RADY0, XUNUSD ,USRKBD, U
     *SRSCR, PLTFIL ,ITITDT, LENCRD ,INPFMT, GRDTYP, LINWID, LINCOL, L
     *INTEX, TITCON, ITCNTR ,IUNUSD, NXYZ1, NXYZ2 ,LBLCHR, NDIMNS, IBL
     *KTP, IDIMNS ,NMESH1, NMESH2, MESH1, MESH2, MESH3, NFIELD ,IFIELD
     *, NINCR ,IVARBL, IVRPTR ,LINEAR, NONLIN ,NPOINT, LETSET ,MXECH
     *O, LINES, MAXLNS ,AXANG, MESH2D, REDFAC, GRDTEX, OUTTEX, IAXTEX, 
     *TITEX, DSCAL ,OUTSTR, IPROP, IHTEX, IBLINK, IERASE, LABTEX, TICTE
     *X, NXYLIM, PATSZ ,MARGIN, PSCR, ITXPRI, ITXSEC, OREAL, OCPU, CSCR
     *D, OUTSID ,TITLIN, TITINX, TITZ, TITX1, TITY1, LTDATA, NPLOTS, RE
     *VLEV ,LBLFMT, IYEAR, IMONTH, IDAY, ISIGFG ,DATPTS, ERRPTS, DATXM
     *N, DATXMX, DATYMN, DATYMX, DATZMN, DATZMX ,DATSUM, ERRSUM, DATAVE
     *, ERRAVE, DATCEN, ERRCEN, DATSTD, ERRSTD ,NCSETS, NCCOL, NCROW, F
     *MARKER, H2STAT, TITFAC, TITLOC, TITMAR ,TIKFAC, IWINLEV, WINREL, 
     *WINABS, WINLIM ,ICPOIN, LEVREP, IREPCT, SYDIR, GRDIR, NMESH0, EXY
     *ZLIM, IVPTR ,TITLMX, NXYZDEF1, NXYZDEF2, IFILE_CASE, N_CYCLE, ITX
     *_CYCLE ,SYM_CYCLE, PLOT_EXTENT, FILL_ANGLE, FILL_WIDTH, FILL_TEX 
     *,FILL_INDEX ,N_LINES ,DSLOPE ,MAX_SUBST, BARBRK ,I_VORDER,SHADOW
     *TYP,SHADOWTEX
      COMMON /T2SCRT/ BUFFER, IBUFFR, N_FILE,N_NAME,N_SELECT, ICHSAVE
      COMMON /T2_CHAR/ C_TIT_ESCAPE,C_TIT_SUBSTITUTE
      COMMON /T2_SCRT/ C_FILE, C_NAME, C_SELECT
      INTEGER JOUFIL, ERRFIL, OUTFIL, DBGFIL, INPFIL, NINMAX
      PARAMETER (NINMAX=20)
      INTEGER NINP(NINMAX)
      COMMON /T2TRBK/NINP, JOUFIL, ERRFIL, OUTFIL, DBGFIL, INPFIL
      CHARACTER*512 STRNG, STJOU
      LOGICAL LTOKEN
      REAL FLOTNG
      INTEGER INTERP, KEYORD, NSTRNG, MAXSTR, NSTJOU, LSTJOU, NTOKEN
      INTEGER*4 INTEG
      COMMON /TOKENC/ INTERP, INTEG, FLOTNG, KEYORD, NSTRNG, MAXSTR, ST
     *RNG, NSTJOU, LSTJOU, STJOU, LTOKEN, NTOKEN
      LOGICAL DFLAGS(200),DSCREV(3)
      COMMON /T2FLGD/DFLAGS,DSCREV
      REAL DTITLIN(4), DTITFAC(4), DTITMAR(4)
      INTEGER DGRDTYP, DGRDTEX, DOUTTEX, IDAXTEX, DTITEX, DSHADOWTYP,DS
     *HADOWTEX, IFLDDF(19), NDDIMNS, IDTXPRI, IDTXSEC, LINCLF, LINTXF,
     * LINWDF, DNONLN(3), DNXYZ1(3), DNXYZ2(3), DLABTEX, DTICTEX, DNPAT
     *RN(30), DLBLCHR(3), ND_CYCLE, IDTX_CYCLE(MAX_CYCLE)
      REAL DSYM_CYCLE(MAX_CYCLE)
      REAL DTITSIZ, DGRDSYM, DGRDSIZ, DCIRSIZ(2,3), DASIZE, DAFLARE, D
     *SMSZDF, DORAXES(3), DEYEDIR(3), DVUEDIR(3), DVUECEN(3), DVERTCL(3
     *), DEYESEP, DSCRD, DSCRZ, DEYEDIS, DEYEPNT(3), DBARSIZ(3), DBARBR
     *K(3), DTIKSIZ(3), DXYZBS(3), DTTHETA, DTPHI, DFRELBL(4), DPATRN(2
     *0,30), DSCLPRM(10,3), DWINDOW(4), DSCREEN(2), DSYMBOL, DNOSYMB, 
     *DAXANG(3), DLBLSIZ, DSYMSIZ, DXYZLIM(3,2), DFACTXY(19), DRADANG,
     * DDSCAL, DPATSZ, DTITINX, DTIKFAC, DSYDIR(3), DGRDIR(3)
      COMMON /T2COMD/ DTITSIZ, DGRDSYM, DGRDSIZ, DCIRSIZ, DASIZE, DAFLA
     *RE, DSMSZDF, DORAXES, DEYEDIR, DVUEDIR, DVUECEN, DVERTCL, DEYESE
     *P, DSCRD, DSCRZ, DEYEDIS, DEYEPNT, DBARSIZ, DTIKSIZ, DXYZBS, DTTH
     *ETA, DTPHI, DFRELBL, DNPATRN, DPATRN, DSCLPRM, DWINDOW, DSCREEN,
     * DSYMBOL, DNOSYMB, DAXANG, DLBLSIZ, DSYMSIZ, DXYZLIM, DGRDTYP, D
     *FACTXY, IFLDDF, NDDIMNS, DGRDTEX, DOUTTEX, IDAXTEX, DTITEX, DRADA
     *NG, DDSCAL, DNONLN, DNXYZ1, DNXYZ2, LINCLF, LINTXF, LINWDF, DLABT
     *EX, DTICTEX, DPATSZ, IDTXPRI, IDTXSEC, DTITLIN, DTITINX, DLBLCHR,
     * DTITFAC, DTITMAR, DTIKFAC, DSYDIR, DGRDIR, ND_CYCLE, IDTX_CYCLE,
     * DSYM_CYCLE, DBARBRK,  DSHADOWTYP,DSHADOWTEX
      INTEGER I,J,IXY
      FLAGS(61)=.FALSE.
      NDIMNS(1)=3
      FLAGS(75)=.FALSE.
      GOTO 15721
15750 CONTINUE
      FLAGS(120)=LTOKEN
      GOTO 15721
15760 CONTINUE
      IXY=INTEG
      CALL TOKEN(INFOIN,CARDIN,';')
      IF(INTERP.NE.3.AND.INTERP.NE.4)THEN
      CALL T2ERR(INFOIN,CARDIN,' ',5)
      ELSE
      AXANG(IXY)=FLOTNG
      ENDIF
      GOTO 15721
15780 CONTINUE
      DO 15791 I=1,3
      DEYEDIR(I)=EYEDIR(I)
      DORAXES(I)=ORAXES(I)
      DVUECEN(I)=VUECEN(I)
      DAXANG(I)=AXANG(I)
      DVERTCL(I)=VERTCL(I)
15791 CONTINUE
15792 CONTINUE
      DTTHETA=TTHETA
      DTPHI=TPHI
      DSCRD=SCRD
      DEYEDIS=EYEDIS
      DEYESEP=EYESEP
      DFLAGS(55)=FLAGS(55)
      DFLAGS(82)=FLAGS(82)
      DFLAGS(120)=FLAGS(120)
      NDDIMNS=NDIMNS(1)
      GOTO 15721
15800 CONTINUE
      DO 15811 I=1,3
      CALL TOKEN(INFOIN,CARDIN,';')
      IF(INTERP.NE.3.AND.INTERP.NE.4)THEN
      CALL T2ERR(INFOIN,CARDIN,' ',5)
      ELSE
      VUECEN(I)=FLOTNG
      ENDIF
15811 CONTINUE
15812 CONTINUE
      GOTO 15721
15830 CONTINUE
      DO 15841 I=1,3
      CALL TOKEN(INFOIN,CARDIN,';')
      IF(INTERP.NE.3.AND.INTERP.NE.4)THEN
      CALL T2ERR(INFOIN,CARDIN,' ',5)
      ELSE
      EYEDIR(I)=FLOTNG
      ENDIF
15841 CONTINUE
15842 CONTINUE
      FLAGS(55)=.TRUE.
      GOTO 15721
15860 CONTINUE
      IF (FLOTNG.ne.0) EYEDIS=ABS(FLOTNG)
      GOTO 15721
15870 CONTINUE
      SCRD=SCRD*FLOTNG
      GOTO 15721
15880 CONTINUE
      DO 15891 I=1,3
      CALL TOKEN(INFOIN,CARDIN,';')
      IF(INTERP.NE.3.AND.INTERP.NE.4)THEN
      CALL T2ERR(INFOIN,CARDIN,' ',5)
      ELSE
      ORAXES(I)=FLOTNG
      ENDIF
15891 CONTINUE
15892 CONTINUE
      FLAGS(82)=.TRUE.  
      GOTO 15721
15910 CONTINUE
      TPHI=FLOTNG
      IF (FLAGS(55))TTHETA=DTTHETA
      FLAGS(55)=.FALSE.
      GOTO 15721
15920 CONTINUE
      SCRD=SCRD/FLOTNG
      GOTO 15721
15930 CONTINUE
      IF(FLOTNG.ne.0) THEN
      SCRD=SCRD*FLOTNG/EYEDIS
      EYEDIS=FLOTNG
      ENDIF
      GOTO 15721
15940 CONTINUE
      IF(SCRD.ne.0)SCRD=FLOTNG
      GOTO 15721
15950 CONTINUE
      EYESEP=FLOTNG
      GOTO 15721
15960 CONTINUE
      TTHETA=FLOTNG
      IF (FLAGS(55))TPHI=DTPHI
      FLAGS(55)=.FALSE.
      GOTO 15721
15970 CONTINUE
      EYESEP=1.5*INTEG
      GOTO 15721
15980 CONTINUE
      DO 15991 I=1,3
      CALL TOKEN(INFOIN,CARDIN,';')
      IF(INTERP.NE.3.AND.INTERP.NE.4)THEN
      CALL T2ERR(INFOIN,CARDIN,' ',5)
      ELSE
      VERTCL(I)=FLOTNG
      ENDIF
15991 CONTINUE
15992 CONTINUE
      GOTO 15721
16010 CONTINUE
      I=0
      DO 16021 J=1,3
      CALL TOKEN(INFOIN,CARDIN,'BY,;')
      IF(INTERP.NE.2)THEN
      INFOIN(9)=-1
      ENDIF
      CALL TOKEN(INFOIN,CARDIN,';')
      IF(INTERP.NE.3.AND.INTERP.NE.4)THEN
      CALL T2ERR(INFOIN,CARDIN,' ',5)
      ELSE
      I=I+1
      BUFFR(I)=FLOTNG
      ENDIF
16021 CONTINUE
16022 CONTINUE
      IF (I.EQ.3) THEN
      DO 16051 J=1,3
      WORLD(J)=BUFFR(J)
16051 CONTINUE
16052 CONTINUE
      ENDIF
      GOTO 15721
16060 CONTINUE
      NDIMNS(1)=INTEG
      GOTO 15721
15721 CALL TOKEN(INFOIN,CARDIN,'PERSPECTIVE:Y,XAXIS:1,YAXIS:2,ZAXIS:3,PE
     *RMANENT,CENTER,DIRECTION,DISTANCE:::35,MAGNIFY:.00001:100000:1,ORI
     *GIN,PHI:0:180:60,REDUCE:.00001:100000:1,RDISTANCE:::35,SCRD:::-18,
     *SEPARATION:::0,THETA:-360:360:60,LEFT:-1,MIDDLE:0,RIGHT:1,VERTICAL
     *,WORLD,OFF:2,ON:3,AUTOMATIC,;')
      GOTO (15722,15727,15725,15725,15725,15725,15721,15727, 15725),INTE
     *RP
15725 CALL T2ERR(INFOIN,CARDIN,' ',5)
      GOTO 15721
15727 GOTO ( 15750,15760,15760,15760,15780,15800,15830,15860,15870,15880
     *,15910,15920,15930,15940,15950,15960,15970,15970,15970,15980,16010
     *,16060,16060,16060,15725),KEYORD
15722 CONTINUE
      FLAGS(56)=(IDIMNS.eq.3.or.NDIMNS(1).eq.3)  .and.NDIMNS(1).ne.2
      END
      SUBROUTINE T2_SET_PRI_SEC(INFOIN,CARDIN)
      IMPLICIT NONE
      INTEGER INFOIN(10)
      CHARACTER*(*) CARDIN
      COMMON /T2FLGC/ FLAGS(200), LTRAP,LHANDL,LSYERR,LSCREV
      LOGICAL FLAGS, LTRAP,LHANDL,LSYERR,LSCREV(3)
      INTEGER RELFLAG 
      PARAMETER (RELFLAG=151)
      INTEGER IWINLEV 
      INTEGER NWINLEV , MAX_FILL 
      PARAMETER (NWINLEV =4)
      PARAMETER (MAX_FILL=4)
      REAL GRDSYM, GRDSIZ, DATDAT(2,8), H2STAT(12), TITLIN(4), TITFA
     *C(4), TITLOC(4), TITMAR(4), TITLMX(4), TIKFAC, TITINX, TITX1, TIT
     *Y1, TITX, TITY, TITZ, TITSIZ, TITCON(5), REVLEV, REDUCE(5), XFR
     *M12(12), XFRM13(12), XFRM14(12), XFRM23(12), XFRM24(12), XFRM34(6
     *), XVARSX(20), CIRSIZ(2,3), ASIZE, AFLARE, SMSZDF, ORAXES(3), EY
     *EDIR(3), VUEDIR(3), VUECEN(3), VERTCL(3), EYESEP, SCRD, SCRZ, EYE
     *DIS, EYEPNT(3), XYPART(2, 2), BARSIZ(3), BARBRK(3), TIKSIZ(3), XY
     *ZBAS(3), TTHETA, TPHI, FRELBL(4), PATRN(20,30), SCLPRM(10,3), WI
     *NDOW(4), SCREEN(2), SYMBOL, NOSYMB, FACTXY(19), LBLSIZ, SYMSIZ, X
     *YZLIM(3,2), WORLD(3), RADRMX, RADRMN, RADAMN, RADANG, RADX0, RADY
     *0, XUNUSD(6), AXANG(3), REDFAC, DSCAL, PATSZ, MARGIN(4), PSCR(2
     *), OREAL, OCPU, CSCRD, DATPTS, ERRPTS, DATXMN, DATXMX, DATYMN, DA
     *TYMX, DATZMN, DATZMX, DATSUM, ERRSUM, DATAVE, ERRAVE, DATCEN, ERR
     *CEN, DATSTD, ERRSTD, WINREL(2,2,NWINLEV),WINABS(2,2,NWINLEV),WINL
     *IM(2,2), FMARKER(3,8), SYDIR(3), GRDIR(3), EXYZLIM(3,2), DSLOPE(2
     *,2)
      REAL PLOT_EXTENT(2,2),FILL_ANGLE(MAX_FILL),FILL_WIDTH(MAX_FILL)
      INTEGER FILL_INDEX, FILL_TEX(MAX_FILL), N_LINES(6)
      EQUIVALENCE (DATDAT, DATPTS)
      INTEGER MAXREP
      PARAMETER (MAXREP=5)
      INTEGER IPATRN, NPATRN(30), NXYLIM(3,2), NPLOTS, NCSETS, NCCOL, N
     *CROW, IYEAR, IMONTH, IDAY, ISIGFG, ITXPRI, ITXSEC, ITITDT(3), L
     *ENCRD, IPROP, IHTEX, IBLINK, IERASE, ITCNTR, IUNUSD, NXYZ1(3), 
     *NXYZ2(3), LBLFMT(3), LBLCHR(3), NDIMNS(3), IBLKTP, IDIMNS, NMES
     *H0, NMESH1, NMESH2, MESH1, MESH2, MESH3, MESH2D, MESHN(3), NMESHN(
     *2), NFIELD, IFIELD(19), NINCR, NPOINT, IVARBL(19), IVPTR(19), I_
     *VORDER(19,2), LINEAR(4), NONLIN(4), MXECHO, LINES, MAXLNS, USRK
     *BD, USRSCR, PLTFIL, LINWID, LINCOL, LINTEX, ICPOIN(3), IREPCT(MA
     *XREP), LEVREP, GRDTYP, GRDTEX, OUTTEX, IAXTEX, TITEX, LETSET, LAB
     *TEX, TICTEX, SHADOWTYP,SHADOWTEX, NXYZDEF1(10), NXYZDEF2(10), IF
     *ILE_CASE ,MAX_SUBST
      INTEGER MAX_CYCLE
      PARAMETER (MAX_CYCLE=20)
      INTEGER N_CYCLE, ITX_CYCLE(MAX_CYCLE)
      REAL SYM_CYCLE(MAX_CYCLE)
      EQUIVALENCE (NMESH1,NMESHN)
      EQUIVALENCE (MESH1,MESHN)
      INTEGER IBUFFR(400)
      REAL BUFFER(400)
      INTEGER NCHSAVE 
      PARAMETER (NCHSAVE=2*512) 
      INTEGER*4 ICHSAVE(NCHSAVE)
      INTEGER*4 IVRPTR(15)
      CHARACTER*512 OUTSTR,C_FILE, C_NAME, C_SELECT
      CHARACTER C_TIT_ESCAPE*1,C_TIT_SUBSTITUTE*2
      INTEGER N_FILE, N_NAME, N_SELECT
      CHARACTER*8 PXNAME
      CHARACTER*64 INPFMT
      LOGICAL LTDATA, OUTSID(4)
      COMMON /T2COM/ PXNAME, REDUCE, TITX, TITY ,XFRM12, XFRM13, XFRM1
     *4, XFRM23 ,XFRM24, XFRM34 ,XVARSX ,TITSIZ, GRDSYM, GRDSIZ, CIRS
     *IZ, ASIZE, AFLARE ,SMSZDF, ORAXES, EYEDIR, VUEDIR, VUECEN ,VERTC
     *L, EYESEP, SCRD, SCRZ, EYEDIS, EYEPNT ,XYPART, BARSIZ, TIKSIZ, XY
     *ZBAS, TTHETA ,TPHI, FRELBL, IPATRN, NPATRN, PATRN ,SCLPRM, WINDO
     *W, SCREEN, SYMBOL, NOSYMB ,FACTXY, LBLSIZ, SYMSIZ, XYZLIM, WORLD 
     *,RADRMX, RADRMN, RADAMN, RADANG, RADX0, RADY0, XUNUSD ,USRKBD, U
     *SRSCR, PLTFIL ,ITITDT, LENCRD ,INPFMT, GRDTYP, LINWID, LINCOL, L
     *INTEX, TITCON, ITCNTR ,IUNUSD, NXYZ1, NXYZ2 ,LBLCHR, NDIMNS, IBL
     *KTP, IDIMNS ,NMESH1, NMESH2, MESH1, MESH2, MESH3, NFIELD ,IFIELD
     *, NINCR ,IVARBL, IVRPTR ,LINEAR, NONLIN ,NPOINT, LETSET ,MXECH
     *O, LINES, MAXLNS ,AXANG, MESH2D, REDFAC, GRDTEX, OUTTEX, IAXTEX, 
     *TITEX, DSCAL ,OUTSTR, IPROP, IHTEX, IBLINK, IERASE, LABTEX, TICTE
     *X, NXYLIM, PATSZ ,MARGIN, PSCR, ITXPRI, ITXSEC, OREAL, OCPU, CSCR
     *D, OUTSID ,TITLIN, TITINX, TITZ, TITX1, TITY1, LTDATA, NPLOTS, RE
     *VLEV ,LBLFMT, IYEAR, IMONTH, IDAY, ISIGFG ,DATPTS, ERRPTS, DATXM
     *N, DATXMX, DATYMN, DATYMX, DATZMN, DATZMX ,DATSUM, ERRSUM, DATAVE
     *, ERRAVE, DATCEN, ERRCEN, DATSTD, ERRSTD ,NCSETS, NCCOL, NCROW, F
     *MARKER, H2STAT, TITFAC, TITLOC, TITMAR ,TIKFAC, IWINLEV, WINREL, 
     *WINABS, WINLIM ,ICPOIN, LEVREP, IREPCT, SYDIR, GRDIR, NMESH0, EXY
     *ZLIM, IVPTR ,TITLMX, NXYZDEF1, NXYZDEF2, IFILE_CASE, N_CYCLE, ITX
     *_CYCLE ,SYM_CYCLE, PLOT_EXTENT, FILL_ANGLE, FILL_WIDTH, FILL_TEX 
     *,FILL_INDEX ,N_LINES ,DSLOPE ,MAX_SUBST, BARBRK ,I_VORDER,SHADOW
     *TYP,SHADOWTEX
      COMMON /T2SCRT/ BUFFER, IBUFFR, N_FILE,N_NAME,N_SELECT, ICHSAVE
      COMMON /T2_CHAR/ C_TIT_ESCAPE,C_TIT_SUBSTITUTE
      COMMON /T2_SCRT/ C_FILE, C_NAME, C_SELECT
      INTEGER JOUFIL, ERRFIL, OUTFIL, DBGFIL, INPFIL, NINMAX
      PARAMETER (NINMAX=20)
      INTEGER NINP(NINMAX)
      COMMON /T2TRBK/NINP, JOUFIL, ERRFIL, OUTFIL, DBGFIL, INPFIL
      CHARACTER*512 STRNG, STJOU
      LOGICAL LTOKEN
      REAL FLOTNG
      INTEGER INTERP, KEYORD, NSTRNG, MAXSTR, NSTJOU, LSTJOU, NTOKEN
      INTEGER*4 INTEG
      COMMON /TOKENC/ INTERP, INTEG, FLOTNG, KEYORD, NSTRNG, MAXSTR, ST
     *RNG, NSTJOU, LSTJOU, STJOU, LTOKEN, NTOKEN
      LOGICAL DFLAGS(200),DSCREV(3)
      COMMON /T2FLGD/DFLAGS,DSCREV
      REAL DTITLIN(4), DTITFAC(4), DTITMAR(4)
      INTEGER DGRDTYP, DGRDTEX, DOUTTEX, IDAXTEX, DTITEX, DSHADOWTYP,DS
     *HADOWTEX, IFLDDF(19), NDDIMNS, IDTXPRI, IDTXSEC, LINCLF, LINTXF,
     * LINWDF, DNONLN(3), DNXYZ1(3), DNXYZ2(3), DLABTEX, DTICTEX, DNPAT
     *RN(30), DLBLCHR(3), ND_CYCLE, IDTX_CYCLE(MAX_CYCLE)
      REAL DSYM_CYCLE(MAX_CYCLE)
      REAL DTITSIZ, DGRDSYM, DGRDSIZ, DCIRSIZ(2,3), DASIZE, DAFLARE, D
     *SMSZDF, DORAXES(3), DEYEDIR(3), DVUEDIR(3), DVUECEN(3), DVERTCL(3
     *), DEYESEP, DSCRD, DSCRZ, DEYEDIS, DEYEPNT(3), DBARSIZ(3), DBARBR
     *K(3), DTIKSIZ(3), DXYZBS(3), DTTHETA, DTPHI, DFRELBL(4), DPATRN(2
     *0,30), DSCLPRM(10,3), DWINDOW(4), DSCREEN(2), DSYMBOL, DNOSYMB, 
     *DAXANG(3), DLBLSIZ, DSYMSIZ, DXYZLIM(3,2), DFACTXY(19), DRADANG,
     * DDSCAL, DPATSZ, DTITINX, DTIKFAC, DSYDIR(3), DGRDIR(3)
      COMMON /T2COMD/ DTITSIZ, DGRDSYM, DGRDSIZ, DCIRSIZ, DASIZE, DAFLA
     *RE, DSMSZDF, DORAXES, DEYEDIR, DVUEDIR, DVUECEN, DVERTCL, DEYESE
     *P, DSCRD, DSCRZ, DEYEDIS, DEYEPNT, DBARSIZ, DTIKSIZ, DXYZBS, DTTH
     *ETA, DTPHI, DFRELBL, DNPATRN, DPATRN, DSCLPRM, DWINDOW, DSCREEN,
     * DSYMBOL, DNOSYMB, DAXANG, DLBLSIZ, DSYMSIZ, DXYZLIM, DGRDTYP, D
     *FACTXY, IFLDDF, NDDIMNS, DGRDTEX, DOUTTEX, IDAXTEX, DTITEX, DRADA
     *NG, DDSCAL, DNONLN, DNXYZ1, DNXYZ2, LINCLF, LINTXF, LINWDF, DLABT
     *EX, DTICTEX, DPATSZ, IDTXPRI, IDTXSEC, DTITLIN, DTITINX, DLBLCHR,
     * DTITFAC, DTITMAR, DTIKFAC, DSYDIR, DGRDIR, ND_CYCLE, IDTX_CYCLE,
     * DSYM_CYCLE, DBARBRK,  DSHADOWTYP,DSHADOWTEX
      INTEGER I,IPRI,INTEN,JTXTUR,ITXTUR,ICOL
      IPRI=INTEG
      IF (IPRI.eq.1) THEN
      I=ITXPRI
      ELSE
      I=ITXSEC
      ENDIF
      INTEN=MOD(I/8,8)
      JTXTUR=MOD(I/64,8)
      ITXTUR=0
      ICOL=I/512
      GOTO 16071
16100 CONTINUE
      CALL T2GTEX(ITXTUR)
      JTXTUR=ITXTUR
      GOTO 16071
16110 CONTINUE
      INTEN=INTEG
      GOTO 16071
16120 CONTINUE
      ICOL=INTEG
      GOTO 16071
16130 CONTINUE
      I=8*INTEN+64*JTXTUR+512*ICOL
      IF (IPRI.eq.1) THEN
      IDTXPRI=I
      ELSE
      IDTXSEC=I
      ENDIF
      GOTO 16071
16071 CALL TOKEN(INFOIN,CARDIN,'NOTEXTURE:0,DO:1,DOT:1,DOTS:1,DOTTED:1,D
     *ASHES:2,DA:2,DOT-DASH:3,DOTDASHED:3,SOLID:4,FUNNY:5,PATTERNED:6,DA
     *ASHES:7,SPACE:8,INTENSITY:0:7:0,WIDTH:0:7:0,WHITE:1,RED:2,GREEN:3,
     *BLUE:4,YELLOW:5,MAGENTA:6,CYAN:7,PERMANENT,BLACK:8,;')
      GOTO (16072,16077,16075,16075,16075,16075,16071,16077, 16075),INTE
     *RP
16075 CALL T2ERR(INFOIN,CARDIN,' ',5)
      GOTO 16071
16077 GOTO ( 16100,16100,16100,16100,16100,16100,16100,16100,16100,16100
     *,16100,16100,16100,16100,16110,16110,16120,16120,16120,16120,16120
     *,16120,16120,16130,16120,16075),KEYORD
16072 CONTINUE
      I=8*INTEN+64*JTXTUR+512*ICOL
      IF(IPRI.eq.1) THEN
      ITXPRI=I
      ELSE
      ITXSEC=I
      ENDIF
      END
      SUBROUTINE T2_SET_FILE(INFOIN,CARDIN)
      IMPLICIT NONE
      INTEGER INFOIN(10)
      CHARACTER*(*) CARDIN
      COMMON /T2FLGC/ FLAGS(200), LTRAP,LHANDL,LSYERR,LSCREV
      LOGICAL FLAGS, LTRAP,LHANDL,LSYERR,LSCREV(3)
      INTEGER RELFLAG 
      PARAMETER (RELFLAG=151)
      INTEGER IWINLEV 
      INTEGER NWINLEV , MAX_FILL 
      PARAMETER (NWINLEV =4)
      PARAMETER (MAX_FILL=4)
      REAL GRDSYM, GRDSIZ, DATDAT(2,8), H2STAT(12), TITLIN(4), TITFA
     *C(4), TITLOC(4), TITMAR(4), TITLMX(4), TIKFAC, TITINX, TITX1, TIT
     *Y1, TITX, TITY, TITZ, TITSIZ, TITCON(5), REVLEV, REDUCE(5), XFR
     *M12(12), XFRM13(12), XFRM14(12), XFRM23(12), XFRM24(12), XFRM34(6
     *), XVARSX(20), CIRSIZ(2,3), ASIZE, AFLARE, SMSZDF, ORAXES(3), EY
     *EDIR(3), VUEDIR(3), VUECEN(3), VERTCL(3), EYESEP, SCRD, SCRZ, EYE
     *DIS, EYEPNT(3), XYPART(2, 2), BARSIZ(3), BARBRK(3), TIKSIZ(3), XY
     *ZBAS(3), TTHETA, TPHI, FRELBL(4), PATRN(20,30), SCLPRM(10,3), WI
     *NDOW(4), SCREEN(2), SYMBOL, NOSYMB, FACTXY(19), LBLSIZ, SYMSIZ, X
     *YZLIM(3,2), WORLD(3), RADRMX, RADRMN, RADAMN, RADANG, RADX0, RADY
     *0, XUNUSD(6), AXANG(3), REDFAC, DSCAL, PATSZ, MARGIN(4), PSCR(2
     *), OREAL, OCPU, CSCRD, DATPTS, ERRPTS, DATXMN, DATXMX, DATYMN, DA
     *TYMX, DATZMN, DATZMX, DATSUM, ERRSUM, DATAVE, ERRAVE, DATCEN, ERR
     *CEN, DATSTD, ERRSTD, WINREL(2,2,NWINLEV),WINABS(2,2,NWINLEV),WINL
     *IM(2,2), FMARKER(3,8), SYDIR(3), GRDIR(3), EXYZLIM(3,2), DSLOPE(2
     *,2)
      REAL PLOT_EXTENT(2,2),FILL_ANGLE(MAX_FILL),FILL_WIDTH(MAX_FILL)
      INTEGER FILL_INDEX, FILL_TEX(MAX_FILL), N_LINES(6)
      EQUIVALENCE (DATDAT, DATPTS)
      INTEGER MAXREP
      PARAMETER (MAXREP=5)
      INTEGER IPATRN, NPATRN(30), NXYLIM(3,2), NPLOTS, NCSETS, NCCOL, N
     *CROW, IYEAR, IMONTH, IDAY, ISIGFG, ITXPRI, ITXSEC, ITITDT(3), L
     *ENCRD, IPROP, IHTEX, IBLINK, IERASE, ITCNTR, IUNUSD, NXYZ1(3), 
     *NXYZ2(3), LBLFMT(3), LBLCHR(3), NDIMNS(3), IBLKTP, IDIMNS, NMES
     *H0, NMESH1, NMESH2, MESH1, MESH2, MESH3, MESH2D, MESHN(3), NMESHN(
     *2), NFIELD, IFIELD(19), NINCR, NPOINT, IVARBL(19), IVPTR(19), I_
     *VORDER(19,2), LINEAR(4), NONLIN(4), MXECHO, LINES, MAXLNS, USRK
     *BD, USRSCR, PLTFIL, LINWID, LINCOL, LINTEX, ICPOIN(3), IREPCT(MA
     *XREP), LEVREP, GRDTYP, GRDTEX, OUTTEX, IAXTEX, TITEX, LETSET, LAB
     *TEX, TICTEX, SHADOWTYP,SHADOWTEX, NXYZDEF1(10), NXYZDEF2(10), IF
     *ILE_CASE ,MAX_SUBST
      INTEGER MAX_CYCLE
      PARAMETER (MAX_CYCLE=20)
      INTEGER N_CYCLE, ITX_CYCLE(MAX_CYCLE)
      REAL SYM_CYCLE(MAX_CYCLE)
      EQUIVALENCE (NMESH1,NMESHN)
      EQUIVALENCE (MESH1,MESHN)
      INTEGER IBUFFR(400)
      REAL BUFFER(400)
      INTEGER NCHSAVE 
      PARAMETER (NCHSAVE=2*512) 
      INTEGER*4 ICHSAVE(NCHSAVE)
      INTEGER*4 IVRPTR(15)
      CHARACTER*512 OUTSTR,C_FILE, C_NAME, C_SELECT
      CHARACTER C_TIT_ESCAPE*1,C_TIT_SUBSTITUTE*2
      INTEGER N_FILE, N_NAME, N_SELECT
      CHARACTER*8 PXNAME
      CHARACTER*64 INPFMT
      LOGICAL LTDATA, OUTSID(4)
      COMMON /T2COM/ PXNAME, REDUCE, TITX, TITY ,XFRM12, XFRM13, XFRM1
     *4, XFRM23 ,XFRM24, XFRM34 ,XVARSX ,TITSIZ, GRDSYM, GRDSIZ, CIRS
     *IZ, ASIZE, AFLARE ,SMSZDF, ORAXES, EYEDIR, VUEDIR, VUECEN ,VERTC
     *L, EYESEP, SCRD, SCRZ, EYEDIS, EYEPNT ,XYPART, BARSIZ, TIKSIZ, XY
     *ZBAS, TTHETA ,TPHI, FRELBL, IPATRN, NPATRN, PATRN ,SCLPRM, WINDO
     *W, SCREEN, SYMBOL, NOSYMB ,FACTXY, LBLSIZ, SYMSIZ, XYZLIM, WORLD 
     *,RADRMX, RADRMN, RADAMN, RADANG, RADX0, RADY0, XUNUSD ,USRKBD, U
     *SRSCR, PLTFIL ,ITITDT, LENCRD ,INPFMT, GRDTYP, LINWID, LINCOL, L
     *INTEX, TITCON, ITCNTR ,IUNUSD, NXYZ1, NXYZ2 ,LBLCHR, NDIMNS, IBL
     *KTP, IDIMNS ,NMESH1, NMESH2, MESH1, MESH2, MESH3, NFIELD ,IFIELD
     *, NINCR ,IVARBL, IVRPTR ,LINEAR, NONLIN ,NPOINT, LETSET ,MXECH
     *O, LINES, MAXLNS ,AXANG, MESH2D, REDFAC, GRDTEX, OUTTEX, IAXTEX, 
     *TITEX, DSCAL ,OUTSTR, IPROP, IHTEX, IBLINK, IERASE, LABTEX, TICTE
     *X, NXYLIM, PATSZ ,MARGIN, PSCR, ITXPRI, ITXSEC, OREAL, OCPU, CSCR
     *D, OUTSID ,TITLIN, TITINX, TITZ, TITX1, TITY1, LTDATA, NPLOTS, RE
     *VLEV ,LBLFMT, IYEAR, IMONTH, IDAY, ISIGFG ,DATPTS, ERRPTS, DATXM
     *N, DATXMX, DATYMN, DATYMX, DATZMN, DATZMX ,DATSUM, ERRSUM, DATAVE
     *, ERRAVE, DATCEN, ERRCEN, DATSTD, ERRSTD ,NCSETS, NCCOL, NCROW, F
     *MARKER, H2STAT, TITFAC, TITLOC, TITMAR ,TIKFAC, IWINLEV, WINREL, 
     *WINABS, WINLIM ,ICPOIN, LEVREP, IREPCT, SYDIR, GRDIR, NMESH0, EXY
     *ZLIM, IVPTR ,TITLMX, NXYZDEF1, NXYZDEF2, IFILE_CASE, N_CYCLE, ITX
     *_CYCLE ,SYM_CYCLE, PLOT_EXTENT, FILL_ANGLE, FILL_WIDTH, FILL_TEX 
     *,FILL_INDEX ,N_LINES ,DSLOPE ,MAX_SUBST, BARBRK ,I_VORDER,SHADOW
     *TYP,SHADOWTEX
      COMMON /T2SCRT/ BUFFER, IBUFFR, N_FILE,N_NAME,N_SELECT, ICHSAVE
      COMMON /T2_CHAR/ C_TIT_ESCAPE,C_TIT_SUBSTITUTE
      COMMON /T2_SCRT/ C_FILE, C_NAME, C_SELECT
      INTEGER JOUFIL, ERRFIL, OUTFIL, DBGFIL, INPFIL, NINMAX
      PARAMETER (NINMAX=20)
      INTEGER NINP(NINMAX)
      COMMON /T2TRBK/NINP, JOUFIL, ERRFIL, OUTFIL, DBGFIL, INPFIL
      CHARACTER*512 STRNG, STJOU
      LOGICAL LTOKEN
      REAL FLOTNG
      INTEGER INTERP, KEYORD, NSTRNG, MAXSTR, NSTJOU, LSTJOU, NTOKEN
      INTEGER*4 INTEG
      COMMON /TOKENC/ INTERP, INTEG, FLOTNG, KEYORD, NSTRNG, MAXSTR, ST
     *RNG, NSTJOU, LSTJOU, STJOU, LTOKEN, NTOKEN
      LOGICAL DFLAGS(200),DSCREV(3)
      COMMON /T2FLGD/DFLAGS,DSCREV
      REAL DTITLIN(4), DTITFAC(4), DTITMAR(4)
      INTEGER DGRDTYP, DGRDTEX, DOUTTEX, IDAXTEX, DTITEX, DSHADOWTYP,DS
     *HADOWTEX, IFLDDF(19), NDDIMNS, IDTXPRI, IDTXSEC, LINCLF, LINTXF,
     * LINWDF, DNONLN(3), DNXYZ1(3), DNXYZ2(3), DLABTEX, DTICTEX, DNPAT
     *RN(30), DLBLCHR(3), ND_CYCLE, IDTX_CYCLE(MAX_CYCLE)
      REAL DSYM_CYCLE(MAX_CYCLE)
      REAL DTITSIZ, DGRDSYM, DGRDSIZ, DCIRSIZ(2,3), DASIZE, DAFLARE, D
     *SMSZDF, DORAXES(3), DEYEDIR(3), DVUEDIR(3), DVUECEN(3), DVERTCL(3
     *), DEYESEP, DSCRD, DSCRZ, DEYEDIS, DEYEPNT(3), DBARSIZ(3), DBARBR
     *K(3), DTIKSIZ(3), DXYZBS(3), DTTHETA, DTPHI, DFRELBL(4), DPATRN(2
     *0,30), DSCLPRM(10,3), DWINDOW(4), DSCREEN(2), DSYMBOL, DNOSYMB, 
     *DAXANG(3), DLBLSIZ, DSYMSIZ, DXYZLIM(3,2), DFACTXY(19), DRADANG,
     * DDSCAL, DPATSZ, DTITINX, DTIKFAC, DSYDIR(3), DGRDIR(3)
      COMMON /T2COMD/ DTITSIZ, DGRDSYM, DGRDSIZ, DCIRSIZ, DASIZE, DAFLA
     *RE, DSMSZDF, DORAXES, DEYEDIR, DVUEDIR, DVUECEN, DVERTCL, DEYESE
     *P, DSCRD, DSCRZ, DEYEDIS, DEYEPNT, DBARSIZ, DTIKSIZ, DXYZBS, DTTH
     *ETA, DTPHI, DFRELBL, DNPATRN, DPATRN, DSCLPRM, DWINDOW, DSCREEN,
     * DSYMBOL, DNOSYMB, DAXANG, DLBLSIZ, DSYMSIZ, DXYZLIM, DGRDTYP, D
     *FACTXY, IFLDDF, NDDIMNS, DGRDTEX, DOUTTEX, IDAXTEX, DTITEX, DRADA
     *NG, DDSCAL, DNONLN, DNXYZ1, DNXYZ2, LINCLF, LINTXF, LINWDF, DLABT
     *EX, DTICTEX, DPATSZ, IDTXPRI, IDTXSEC, DTITLIN, DTITINX, DLBLCHR,
     * DTITFAC, DTITMAR, DTIKFAC, DSYDIR, DGRDIR, ND_CYCLE, IDTX_CYCLE,
     * DSYM_CYCLE, DBARBRK,  DSHADOWTYP,DSHADOWTEX
      INTEGER I,ITEMP,ISTAT
      LOGICAL INTRAC
      ITEMP=INPFIL
      GOTO 16141
16170 CONTINUE
      C_FILE=STRNG
      N_FILE=NSTRNG
      I=INDEX(C_FILE(:N_FILE),'|')
      IF (I.EQ.1.OR.(I.GT.1.AND.C_FILE(:I-1).EQ.' ')) THEN
      CALL T2_SET_POPEN(ITEMP+1,C_FILE(I+1:N_FILE),*16180)
      ELSE
      CALL T2_SET_DEFAULT_FILE(C_FILE,N_FILE,' ')	! 'topdrawer.top')
      OPEN(UNIT=ITEMP+1, FILE=C_FILE(:N_FILE), STATUS='OLD', IOSTAT=ISTA
     *T,      ERR=16180)
      ENDIF
      ITEMP=ITEMP+1
      IF(ITEMP.le.20)NINP(ITEMP)=0
      GOTO 16141
16190 CONTINUE
      C_FILE=STRNG
      N_FILE=NSTRNG
      CALL T2_SET_DEFAULT_FILE(C_FILE,N_FILE,'td.lis')
      OUTFIL=0
      OPEN(UNIT=8, FILE=C_FILE(:N_FILE), STATUS='NEW', IOSTAT=ISTAT,    
     *ERR=16180)
      OUTFIL=8
      IF(OUTFIL.le.20)NINP(OUTFIL)=0
      GOTO 16141
16200 CONTINUE
      C_FILE=STRNG
      N_FILE=NSTRNG
      CALL T2_SET_DEFAULT_FILE(C_FILE,N_FILE,'td.tdj')
      JOUFIL=0
      IF (INTRAC(I)) THEN
      OPEN(UNIT=7, FILE=C_FILE(:N_FILE), STATUS='NEW', IOSTAT=ISTAT,    
     *   ERR=16180)
      JOUFIL=7
      IF(JOUFIL.le.20)NINP(JOUFIL)=0
      ENDIF
      GOTO 16142
16180 CONTINUE
      CALL T2_TYPE_ERROR(INFOIN,CARDIN,C_FILE(:N_FILE),ISTAT)
      GOTO 16141
16141 CALL TOKEN(INFOIN,CARDIN,'INPUT:F,OUTPUT:F,LIST:F,JOURNAL:F,;')
      GOTO (16142,16147,16145,16145,16145,16145,16141,16147, 16145),INTE
     *RP
16145 CALL T2ERR(INFOIN,CARDIN,' ',5)
      GOTO 16141
16147 GOTO ( 16170,16190,16190,16200,16145),KEYORD
16142 CONTINUE
      IF (ITEMP.ne.INPFIL) THEN
      CALL T2JOUR
      INPFIL=ITEMP
      ENDIF
      END
      SUBROUTINE T2_SET_FILL(INFOIN,CARDIN)
      IMPLICIT NONE
      INTEGER INFOIN(10)
      CHARACTER*(*) CARDIN
      COMMON /T2FLGC/ FLAGS(200), LTRAP,LHANDL,LSYERR,LSCREV
      LOGICAL FLAGS, LTRAP,LHANDL,LSYERR,LSCREV(3)
      INTEGER RELFLAG 
      PARAMETER (RELFLAG=151)
      INTEGER IWINLEV 
      INTEGER NWINLEV , MAX_FILL 
      PARAMETER (NWINLEV =4)
      PARAMETER (MAX_FILL=4)
      REAL GRDSYM, GRDSIZ, DATDAT(2,8), H2STAT(12), TITLIN(4), TITFA
     *C(4), TITLOC(4), TITMAR(4), TITLMX(4), TIKFAC, TITINX, TITX1, TIT
     *Y1, TITX, TITY, TITZ, TITSIZ, TITCON(5), REVLEV, REDUCE(5), XFR
     *M12(12), XFRM13(12), XFRM14(12), XFRM23(12), XFRM24(12), XFRM34(6
     *), XVARSX(20), CIRSIZ(2,3), ASIZE, AFLARE, SMSZDF, ORAXES(3), EY
     *EDIR(3), VUEDIR(3), VUECEN(3), VERTCL(3), EYESEP, SCRD, SCRZ, EYE
     *DIS, EYEPNT(3), XYPART(2, 2), BARSIZ(3), BARBRK(3), TIKSIZ(3), XY
     *ZBAS(3), TTHETA, TPHI, FRELBL(4), PATRN(20,30), SCLPRM(10,3), WI
     *NDOW(4), SCREEN(2), SYMBOL, NOSYMB, FACTXY(19), LBLSIZ, SYMSIZ, X
     *YZLIM(3,2), WORLD(3), RADRMX, RADRMN, RADAMN, RADANG, RADX0, RADY
     *0, XUNUSD(6), AXANG(3), REDFAC, DSCAL, PATSZ, MARGIN(4), PSCR(2
     *), OREAL, OCPU, CSCRD, DATPTS, ERRPTS, DATXMN, DATXMX, DATYMN, DA
     *TYMX, DATZMN, DATZMX, DATSUM, ERRSUM, DATAVE, ERRAVE, DATCEN, ERR
     *CEN, DATSTD, ERRSTD, WINREL(2,2,NWINLEV),WINABS(2,2,NWINLEV),WINL
     *IM(2,2), FMARKER(3,8), SYDIR(3), GRDIR(3), EXYZLIM(3,2), DSLOPE(2
     *,2)
      REAL PLOT_EXTENT(2,2),FILL_ANGLE(MAX_FILL),FILL_WIDTH(MAX_FILL)
      INTEGER FILL_INDEX, FILL_TEX(MAX_FILL), N_LINES(6)
      EQUIVALENCE (DATDAT, DATPTS)
      INTEGER MAXREP
      PARAMETER (MAXREP=5)
      INTEGER IPATRN, NPATRN(30), NXYLIM(3,2), NPLOTS, NCSETS, NCCOL, N
     *CROW, IYEAR, IMONTH, IDAY, ISIGFG, ITXPRI, ITXSEC, ITITDT(3), L
     *ENCRD, IPROP, IHTEX, IBLINK, IERASE, ITCNTR, IUNUSD, NXYZ1(3), 
     *NXYZ2(3), LBLFMT(3), LBLCHR(3), NDIMNS(3), IBLKTP, IDIMNS, NMES
     *H0, NMESH1, NMESH2, MESH1, MESH2, MESH3, MESH2D, MESHN(3), NMESHN(
     *2), NFIELD, IFIELD(19), NINCR, NPOINT, IVARBL(19), IVPTR(19), I_
     *VORDER(19,2), LINEAR(4), NONLIN(4), MXECHO, LINES, MAXLNS, USRK
     *BD, USRSCR, PLTFIL, LINWID, LINCOL, LINTEX, ICPOIN(3), IREPCT(MA
     *XREP), LEVREP, GRDTYP, GRDTEX, OUTTEX, IAXTEX, TITEX, LETSET, LAB
     *TEX, TICTEX, SHADOWTYP,SHADOWTEX, NXYZDEF1(10), NXYZDEF2(10), IF
     *ILE_CASE ,MAX_SUBST
      INTEGER MAX_CYCLE
      PARAMETER (MAX_CYCLE=20)
      INTEGER N_CYCLE, ITX_CYCLE(MAX_CYCLE)
      REAL SYM_CYCLE(MAX_CYCLE)
      EQUIVALENCE (NMESH1,NMESHN)
      EQUIVALENCE (MESH1,MESHN)
      INTEGER IBUFFR(400)
      REAL BUFFER(400)
      INTEGER NCHSAVE 
      PARAMETER (NCHSAVE=2*512) 
      INTEGER*4 ICHSAVE(NCHSAVE)
      INTEGER*4 IVRPTR(15)
      CHARACTER*512 OUTSTR,C_FILE, C_NAME, C_SELECT
      CHARACTER C_TIT_ESCAPE*1,C_TIT_SUBSTITUTE*2
      INTEGER N_FILE, N_NAME, N_SELECT
      CHARACTER*8 PXNAME
      CHARACTER*64 INPFMT
      LOGICAL LTDATA, OUTSID(4)
      COMMON /T2COM/ PXNAME, REDUCE, TITX, TITY ,XFRM12, XFRM13, XFRM1
     *4, XFRM23 ,XFRM24, XFRM34 ,XVARSX ,TITSIZ, GRDSYM, GRDSIZ, CIRS
     *IZ, ASIZE, AFLARE ,SMSZDF, ORAXES, EYEDIR, VUEDIR, VUECEN ,VERTC
     *L, EYESEP, SCRD, SCRZ, EYEDIS, EYEPNT ,XYPART, BARSIZ, TIKSIZ, XY
     *ZBAS, TTHETA ,TPHI, FRELBL, IPATRN, NPATRN, PATRN ,SCLPRM, WINDO
     *W, SCREEN, SYMBOL, NOSYMB ,FACTXY, LBLSIZ, SYMSIZ, XYZLIM, WORLD 
     *,RADRMX, RADRMN, RADAMN, RADANG, RADX0, RADY0, XUNUSD ,USRKBD, U
     *SRSCR, PLTFIL ,ITITDT, LENCRD ,INPFMT, GRDTYP, LINWID, LINCOL, L
     *INTEX, TITCON, ITCNTR ,IUNUSD, NXYZ1, NXYZ2 ,LBLCHR, NDIMNS, IBL
     *KTP, IDIMNS ,NMESH1, NMESH2, MESH1, MESH2, MESH3, NFIELD ,IFIELD
     *, NINCR ,IVARBL, IVRPTR ,LINEAR, NONLIN ,NPOINT, LETSET ,MXECH
     *O, LINES, MAXLNS ,AXANG, MESH2D, REDFAC, GRDTEX, OUTTEX, IAXTEX, 
     *TITEX, DSCAL ,OUTSTR, IPROP, IHTEX, IBLINK, IERASE, LABTEX, TICTE
     *X, NXYLIM, PATSZ ,MARGIN, PSCR, ITXPRI, ITXSEC, OREAL, OCPU, CSCR
     *D, OUTSID ,TITLIN, TITINX, TITZ, TITX1, TITY1, LTDATA, NPLOTS, RE
     *VLEV ,LBLFMT, IYEAR, IMONTH, IDAY, ISIGFG ,DATPTS, ERRPTS, DATXM
     *N, DATXMX, DATYMN, DATYMX, DATZMN, DATZMX ,DATSUM, ERRSUM, DATAVE
     *, ERRAVE, DATCEN, ERRCEN, DATSTD, ERRSTD ,NCSETS, NCCOL, NCROW, F
     *MARKER, H2STAT, TITFAC, TITLOC, TITMAR ,TIKFAC, IWINLEV, WINREL, 
     *WINABS, WINLIM ,ICPOIN, LEVREP, IREPCT, SYDIR, GRDIR, NMESH0, EXY
     *ZLIM, IVPTR ,TITLMX, NXYZDEF1, NXYZDEF2, IFILE_CASE, N_CYCLE, ITX
     *_CYCLE ,SYM_CYCLE, PLOT_EXTENT, FILL_ANGLE, FILL_WIDTH, FILL_TEX 
     *,FILL_INDEX ,N_LINES ,DSLOPE ,MAX_SUBST, BARBRK ,I_VORDER,SHADOW
     *TYP,SHADOWTEX
      COMMON /T2SCRT/ BUFFER, IBUFFR, N_FILE,N_NAME,N_SELECT, ICHSAVE
      COMMON /T2_CHAR/ C_TIT_ESCAPE,C_TIT_SUBSTITUTE
      COMMON /T2_SCRT/ C_FILE, C_NAME, C_SELECT
      INTEGER JOUFIL, ERRFIL, OUTFIL, DBGFIL, INPFIL, NINMAX
      PARAMETER (NINMAX=20)
      INTEGER NINP(NINMAX)
      COMMON /T2TRBK/NINP, JOUFIL, ERRFIL, OUTFIL, DBGFIL, INPFIL
      CHARACTER*512 STRNG, STJOU
      LOGICAL LTOKEN
      REAL FLOTNG
      INTEGER INTERP, KEYORD, NSTRNG, MAXSTR, NSTJOU, LSTJOU, NTOKEN
      INTEGER*4 INTEG
      COMMON /TOKENC/ INTERP, INTEG, FLOTNG, KEYORD, NSTRNG, MAXSTR, ST
     *RNG, NSTJOU, LSTJOU, STJOU, LTOKEN, NTOKEN
      LOGICAL DFLAGS(200),DSCREV(3)
      COMMON /T2FLGD/DFLAGS,DSCREV
      REAL DTITLIN(4), DTITFAC(4), DTITMAR(4)
      INTEGER DGRDTYP, DGRDTEX, DOUTTEX, IDAXTEX, DTITEX, DSHADOWTYP,DS
     *HADOWTEX, IFLDDF(19), NDDIMNS, IDTXPRI, IDTXSEC, LINCLF, LINTXF,
     * LINWDF, DNONLN(3), DNXYZ1(3), DNXYZ2(3), DLABTEX, DTICTEX, DNPAT
     *RN(30), DLBLCHR(3), ND_CYCLE, IDTX_CYCLE(MAX_CYCLE)
      REAL DSYM_CYCLE(MAX_CYCLE)
      REAL DTITSIZ, DGRDSYM, DGRDSIZ, DCIRSIZ(2,3), DASIZE, DAFLARE, D
     *SMSZDF, DORAXES(3), DEYEDIR(3), DVUEDIR(3), DVUECEN(3), DVERTCL(3
     *), DEYESEP, DSCRD, DSCRZ, DEYEDIS, DEYEPNT(3), DBARSIZ(3), DBARBR
     *K(3), DTIKSIZ(3), DXYZBS(3), DTTHETA, DTPHI, DFRELBL(4), DPATRN(2
     *0,30), DSCLPRM(10,3), DWINDOW(4), DSCREEN(2), DSYMBOL, DNOSYMB, 
     *DAXANG(3), DLBLSIZ, DSYMSIZ, DXYZLIM(3,2), DFACTXY(19), DRADANG,
     * DDSCAL, DPATSZ, DTITINX, DTIKFAC, DSYDIR(3), DGRDIR(3)
      COMMON /T2COMD/ DTITSIZ, DGRDSYM, DGRDSIZ, DCIRSIZ, DASIZE, DAFLA
     *RE, DSMSZDF, DORAXES, DEYEDIR, DVUEDIR, DVUECEN, DVERTCL, DEYESE
     *P, DSCRD, DSCRZ, DEYEDIS, DEYEPNT, DBARSIZ, DTIKSIZ, DXYZBS, DTTH
     *ETA, DTPHI, DFRELBL, DNPATRN, DPATRN, DSCLPRM, DWINDOW, DSCREEN,
     * DSYMBOL, DNOSYMB, DAXANG, DLBLSIZ, DSYMSIZ, DXYZLIM, DGRDTYP, D
     *FACTXY, IFLDDF, NDDIMNS, DGRDTEX, DOUTTEX, IDAXTEX, DTITEX, DRADA
     *NG, DDSCAL, DNONLN, DNXYZ1, DNXYZ2, LINCLF, LINTXF, LINWDF, DLABT
     *EX, DTICTEX, DPATSZ, IDTXPRI, IDTXSEC, DTITLIN, DTITINX, DLBLCHR,
     * DTITFAC, DTITMAR, DTIKFAC, DSYDIR, DGRDIR, ND_CYCLE, IDTX_CYCLE,
     * DSYM_CYCLE, DBARBRK,  DSHADOWTYP,DSHADOWTEX
      REAL PLIM(4,4),ZSCRN(2),XLLINE,YLLINE,XTLINE,YTLINE,XFRMFC, PAT(2
     *0),PATCUM,PATTOT,PATMOD,CCSCIS(4),DISPL, RESOL(2)
      INTEGER NPTS,IDDEVC,IPAT,NPAT,LMOVE,IROTAX,IROTAF
      COMMON/TXCOM/PLIM,ZSCRN, XLLINE,YLLINE,XTLINE,YTLINE,XFRMFC, IPA
     *T,NPAT,PAT,PATTOT, NPTS,IDDEVC,CCSCIS,LMOVE,IROTAX,DISPL,IROTAF,P
     *ATCUM,PATMOD, RESOL
      INTEGER I, J, ITXTUR
      INTEGER IAND
      REAL RAD
      PARAMETER (RAD=3.14159265/180.)
      I=1
      J=0
      ITXTUR=0
      GOTO 16211
16240 CONTINUE
      LTOKEN=.not. LTOKEN
      J=1
      GOTO 16250
16260 CONTINUE
      J=1
      IF (INTEG .eq. -999) FLOTNG=45*(2*I-1)
      FILL_ANGLE(I)=SIN(FLOTNG*RAD)
      GOTO 16211
16270 CONTINUE
      IF (INTEG .ne. 0) I=INTEG-1
      I=MIN(MAX_FILL,I+1)
      GOTO 16211
16280 CONTINUE
      FILL_WIDTH(I)=-1
      FILL_ANGLE(I)=1
      INTEG=1
      J=8
      GOTO 16250
16290 CONTINUE
      FILL_WIDTH(I)=FLOTNG
      J=1
      IF (FLOTNG .lt. 0) FILL_WIDTH(I)=FLOTNG 
      GOTO 16211
16300 CONTINUE
      J=512
      GOTO 16250
16310 CONTINUE
      IF (ITXTUR .lt. 0) ITXTUR=0
      CALL T2GTEX(ITXTUR)
      J=64
      INTEG=ITXTUR
      GOTO 16250
16320 CONTINUE
      J=8
16250 CONTINUE
      FILL_TEX(I)=IAND(FILL_TEX(I),NOT(7*J))
      IF (LTOKEN) FILL_TEX(I)=FILL_TEX(I)+INTEG*J
      GOTO 16211
16211 CALL TOKEN(INFOIN,CARDIN,'ALTERNATE:1:Y,ANGLE:-360:360:-999,ENTRY:
     *1:4:0,FULL:Y,SIZE:0::-.1,NOCOLOR:0,WHITE:1,RED:2,GREEN:3,BLUE:4,YE
     *LLOW:5,MAGENTA:6,CYAN:7,NOTEXTURE:0,DO:1,DOT:1,DOTS:1,DOTTED:1,DA:
     *2,DASHES:2,DASHED:2,DOTDASHED:3,DOT-DASH:3,SOLID:4,FUNNY:5,DAASHES
     *:7,SPACE:8,PATTERNED:6,INTENSITY:0:9:0,WIDTH:0:9:0,BLACK:8,;')
      GOTO (16212,16217,16215,16215,16215,16215,16211,16217, 16215),INTE
     *RP
16215 CALL T2ERR(INFOIN,CARDIN,' ',5)
      GOTO 16211
16217 GOTO ( 16240,16260,16270,16280,16290,16300,16300,16300,16300,16300
     *,16300,16300,16300,16310,16310,16310,16310,16310,16310,16310,16310
     *,16310,16310,16310,16310,16310,16310,16310,16320,16320,16300,16215
     *),KEYORD
16212 CONTINUE
      IF (J .eq. 0) THEN
      DO 16331 I=1,MAX_FILL
      FILL_ANGLE(I)=SIN(45.*(2*I-3)*RAD)
      FILL_WIDTH(I)=1 
      FILL_TEX(I)=0
16331 CONTINUE
16332 CONTINUE
      DO 16341 I=3,MAX_FILL
      FILL_WIDTH(I)=0
16341 CONTINUE
16342 CONTINUE
      ENDIF
      END
      SUBROUTINE T2_TYPE_ERROR(INFOIN,CARDIN,STR,ISTAT)
      IMPLICIT NONE
      INTEGER INFOIN(10)
      CHARACTER*(*) CARDIN
      CHARACTER*(*) STR
      INTEGER N_str,ISTAT,I,J,K,IUNIT,T2BTRIM,ISTS(3)
      LOGICAL LTEST
      COMMON /T2FLGC/ FLAGS(200), LTRAP,LHANDL,LSYERR,LSCREV
      LOGICAL FLAGS, LTRAP,LHANDL,LSYERR,LSCREV(3)
      INTEGER RELFLAG 
      PARAMETER (RELFLAG=151)
      INTEGER IWINLEV 
      INTEGER NWINLEV , MAX_FILL 
      PARAMETER (NWINLEV =4)
      PARAMETER (MAX_FILL=4)
      REAL GRDSYM, GRDSIZ, DATDAT(2,8), H2STAT(12), TITLIN(4), TITFA
     *C(4), TITLOC(4), TITMAR(4), TITLMX(4), TIKFAC, TITINX, TITX1, TIT
     *Y1, TITX, TITY, TITZ, TITSIZ, TITCON(5), REVLEV, REDUCE(5), XFR
     *M12(12), XFRM13(12), XFRM14(12), XFRM23(12), XFRM24(12), XFRM34(6
     *), XVARSX(20), CIRSIZ(2,3), ASIZE, AFLARE, SMSZDF, ORAXES(3), EY
     *EDIR(3), VUEDIR(3), VUECEN(3), VERTCL(3), EYESEP, SCRD, SCRZ, EYE
     *DIS, EYEPNT(3), XYPART(2, 2), BARSIZ(3), BARBRK(3), TIKSIZ(3), XY
     *ZBAS(3), TTHETA, TPHI, FRELBL(4), PATRN(20,30), SCLPRM(10,3), WI
     *NDOW(4), SCREEN(2), SYMBOL, NOSYMB, FACTXY(19), LBLSIZ, SYMSIZ, X
     *YZLIM(3,2), WORLD(3), RADRMX, RADRMN, RADAMN, RADANG, RADX0, RADY
     *0, XUNUSD(6), AXANG(3), REDFAC, DSCAL, PATSZ, MARGIN(4), PSCR(2
     *), OREAL, OCPU, CSCRD, DATPTS, ERRPTS, DATXMN, DATXMX, DATYMN, DA
     *TYMX, DATZMN, DATZMX, DATSUM, ERRSUM, DATAVE, ERRAVE, DATCEN, ERR
     *CEN, DATSTD, ERRSTD, WINREL(2,2,NWINLEV),WINABS(2,2,NWINLEV),WINL
     *IM(2,2), FMARKER(3,8), SYDIR(3), GRDIR(3), EXYZLIM(3,2), DSLOPE(2
     *,2)
      REAL PLOT_EXTENT(2,2),FILL_ANGLE(MAX_FILL),FILL_WIDTH(MAX_FILL)
      INTEGER FILL_INDEX, FILL_TEX(MAX_FILL), N_LINES(6)
      EQUIVALENCE (DATDAT, DATPTS)
      INTEGER MAXREP
      PARAMETER (MAXREP=5)
      INTEGER IPATRN, NPATRN(30), NXYLIM(3,2), NPLOTS, NCSETS, NCCOL, N
     *CROW, IYEAR, IMONTH, IDAY, ISIGFG, ITXPRI, ITXSEC, ITITDT(3), L
     *ENCRD, IPROP, IHTEX, IBLINK, IERASE, ITCNTR, IUNUSD, NXYZ1(3), 
     *NXYZ2(3), LBLFMT(3), LBLCHR(3), NDIMNS(3), IBLKTP, IDIMNS, NMES
     *H0, NMESH1, NMESH2, MESH1, MESH2, MESH3, MESH2D, MESHN(3), NMESHN(
     *2), NFIELD, IFIELD(19), NINCR, NPOINT, IVARBL(19), IVPTR(19), I_
     *VORDER(19,2), LINEAR(4), NONLIN(4), MXECHO, LINES, MAXLNS, USRK
     *BD, USRSCR, PLTFIL, LINWID, LINCOL, LINTEX, ICPOIN(3), IREPCT(MA
     *XREP), LEVREP, GRDTYP, GRDTEX, OUTTEX, IAXTEX, TITEX, LETSET, LAB
     *TEX, TICTEX, SHADOWTYP,SHADOWTEX, NXYZDEF1(10), NXYZDEF2(10), IF
     *ILE_CASE ,MAX_SUBST
      INTEGER MAX_CYCLE
      PARAMETER (MAX_CYCLE=20)
      INTEGER N_CYCLE, ITX_CYCLE(MAX_CYCLE)
      REAL SYM_CYCLE(MAX_CYCLE)
      EQUIVALENCE (NMESH1,NMESHN)
      EQUIVALENCE (MESH1,MESHN)
      INTEGER IBUFFR(400)
      REAL BUFFER(400)
      INTEGER NCHSAVE 
      PARAMETER (NCHSAVE=2*512) 
      INTEGER*4 ICHSAVE(NCHSAVE)
      INTEGER*4 IVRPTR(15)
      CHARACTER*512 OUTSTR,C_FILE, C_NAME, C_SELECT
      CHARACTER C_TIT_ESCAPE*1,C_TIT_SUBSTITUTE*2
      INTEGER N_FILE, N_NAME, N_SELECT
      CHARACTER*8 PXNAME
      CHARACTER*64 INPFMT
      LOGICAL LTDATA, OUTSID(4)
      COMMON /T2COM/ PXNAME, REDUCE, TITX, TITY ,XFRM12, XFRM13, XFRM1
     *4, XFRM23 ,XFRM24, XFRM34 ,XVARSX ,TITSIZ, GRDSYM, GRDSIZ, CIRS
     *IZ, ASIZE, AFLARE ,SMSZDF, ORAXES, EYEDIR, VUEDIR, VUECEN ,VERTC
     *L, EYESEP, SCRD, SCRZ, EYEDIS, EYEPNT ,XYPART, BARSIZ, TIKSIZ, XY
     *ZBAS, TTHETA ,TPHI, FRELBL, IPATRN, NPATRN, PATRN ,SCLPRM, WINDO
     *W, SCREEN, SYMBOL, NOSYMB ,FACTXY, LBLSIZ, SYMSIZ, XYZLIM, WORLD 
     *,RADRMX, RADRMN, RADAMN, RADANG, RADX0, RADY0, XUNUSD ,USRKBD, U
     *SRSCR, PLTFIL ,ITITDT, LENCRD ,INPFMT, GRDTYP, LINWID, LINCOL, L
     *INTEX, TITCON, ITCNTR ,IUNUSD, NXYZ1, NXYZ2 ,LBLCHR, NDIMNS, IBL
     *KTP, IDIMNS ,NMESH1, NMESH2, MESH1, MESH2, MESH3, NFIELD ,IFIELD
     *, NINCR ,IVARBL, IVRPTR ,LINEAR, NONLIN ,NPOINT, LETSET ,MXECH
     *O, LINES, MAXLNS ,AXANG, MESH2D, REDFAC, GRDTEX, OUTTEX, IAXTEX, 
     *TITEX, DSCAL ,OUTSTR, IPROP, IHTEX, IBLINK, IERASE, LABTEX, TICTE
     *X, NXYLIM, PATSZ ,MARGIN, PSCR, ITXPRI, ITXSEC, OREAL, OCPU, CSCR
     *D, OUTSID ,TITLIN, TITINX, TITZ, TITX1, TITY1, LTDATA, NPLOTS, RE
     *VLEV ,LBLFMT, IYEAR, IMONTH, IDAY, ISIGFG ,DATPTS, ERRPTS, DATXM
     *N, DATXMX, DATYMN, DATYMX, DATZMN, DATZMX ,DATSUM, ERRSUM, DATAVE
     *, ERRAVE, DATCEN, ERRCEN, DATSTD, ERRSTD ,NCSETS, NCCOL, NCROW, F
     *MARKER, H2STAT, TITFAC, TITLOC, TITMAR ,TIKFAC, IWINLEV, WINREL, 
     *WINABS, WINLIM ,ICPOIN, LEVREP, IREPCT, SYDIR, GRDIR, NMESH0, EXY
     *ZLIM, IVPTR ,TITLMX, NXYZDEF1, NXYZDEF2, IFILE_CASE, N_CYCLE, ITX
     *_CYCLE ,SYM_CYCLE, PLOT_EXTENT, FILL_ANGLE, FILL_WIDTH, FILL_TEX 
     *,FILL_INDEX ,N_LINES ,DSLOPE ,MAX_SUBST, BARBRK ,I_VORDER,SHADOW
     *TYP,SHADOWTEX
      COMMON /T2SCRT/ BUFFER, IBUFFR, N_FILE,N_NAME,N_SELECT, ICHSAVE
      COMMON /T2_CHAR/ C_TIT_ESCAPE,C_TIT_SUBSTITUTE
      COMMON /T2_SCRT/ C_FILE, C_NAME, C_SELECT
      INTEGER JOUFIL, ERRFIL, OUTFIL, DBGFIL, INPFIL, NINMAX
      PARAMETER (NINMAX=20)
      INTEGER NINP(NINMAX)
      COMMON /T2TRBK/NINP, JOUFIL, ERRFIL, OUTFIL, DBGFIL, INPFIL
      CHARACTER*512 STRNG, STJOU
      LOGICAL LTOKEN
      REAL FLOTNG
      INTEGER INTERP, KEYORD, NSTRNG, MAXSTR, NSTJOU, LSTJOU, NTOKEN
      INTEGER*4 INTEG
      COMMON /TOKENC/ INTERP, INTEG, FLOTNG, KEYORD, NSTRNG, MAXSTR, ST
     *RNG, NSTJOU, LSTJOU, STJOU, LTOKEN, NTOKEN
      IF (STR.ne.' ' .or. ISTAT.eq.0) THEN
      outstr=str
      n_str=len(str)
      CALL T2ERR(INFOIN,CARDIN,'*** ERROR *** Failure to open file:'//OU
     *TSTR(:N_STR),4)
      ELSE
      CALL T2ERR(INFOIN,CARDIN,'*** ERROR *** I/O error',4)
      ENDIF
      IF (ISTAT.ne.0) THEN
      WRITE(OUTSTR,*)'Code=',ISTAT
      I=T2BTRIM(OUTSTR)
      CALL T2ERR(0,' ',OUTSTR(:I),3)
      ENDIF
      END
      SUBROUTINE T2_SET_CHARACTERS(INFOIN,CARDIN)
      IMPLICIT NONE
      INTEGER INFOIN(10)
      CHARACTER*(*) CARDIN
      COMMON /T2FLGC/ FLAGS(200), LTRAP,LHANDL,LSYERR,LSCREV
      LOGICAL FLAGS, LTRAP,LHANDL,LSYERR,LSCREV(3)
      INTEGER RELFLAG 
      PARAMETER (RELFLAG=151)
      INTEGER IWINLEV 
      INTEGER NWINLEV , MAX_FILL 
      PARAMETER (NWINLEV =4)
      PARAMETER (MAX_FILL=4)
      REAL GRDSYM, GRDSIZ, DATDAT(2,8), H2STAT(12), TITLIN(4), TITFA
     *C(4), TITLOC(4), TITMAR(4), TITLMX(4), TIKFAC, TITINX, TITX1, TIT
     *Y1, TITX, TITY, TITZ, TITSIZ, TITCON(5), REVLEV, REDUCE(5), XFR
     *M12(12), XFRM13(12), XFRM14(12), XFRM23(12), XFRM24(12), XFRM34(6
     *), XVARSX(20), CIRSIZ(2,3), ASIZE, AFLARE, SMSZDF, ORAXES(3), EY
     *EDIR(3), VUEDIR(3), VUECEN(3), VERTCL(3), EYESEP, SCRD, SCRZ, EYE
     *DIS, EYEPNT(3), XYPART(2, 2), BARSIZ(3), BARBRK(3), TIKSIZ(3), XY
     *ZBAS(3), TTHETA, TPHI, FRELBL(4), PATRN(20,30), SCLPRM(10,3), WI
     *NDOW(4), SCREEN(2), SYMBOL, NOSYMB, FACTXY(19), LBLSIZ, SYMSIZ, X
     *YZLIM(3,2), WORLD(3), RADRMX, RADRMN, RADAMN, RADANG, RADX0, RADY
     *0, XUNUSD(6), AXANG(3), REDFAC, DSCAL, PATSZ, MARGIN(4), PSCR(2
     *), OREAL, OCPU, CSCRD, DATPTS, ERRPTS, DATXMN, DATXMX, DATYMN, DA
     *TYMX, DATZMN, DATZMX, DATSUM, ERRSUM, DATAVE, ERRAVE, DATCEN, ERR
     *CEN, DATSTD, ERRSTD, WINREL(2,2,NWINLEV),WINABS(2,2,NWINLEV),WINL
     *IM(2,2), FMARKER(3,8), SYDIR(3), GRDIR(3), EXYZLIM(3,2), DSLOPE(2
     *,2)
      REAL PLOT_EXTENT(2,2),FILL_ANGLE(MAX_FILL),FILL_WIDTH(MAX_FILL)
      INTEGER FILL_INDEX, FILL_TEX(MAX_FILL), N_LINES(6)
      EQUIVALENCE (DATDAT, DATPTS)
      INTEGER MAXREP
      PARAMETER (MAXREP=5)
      INTEGER IPATRN, NPATRN(30), NXYLIM(3,2), NPLOTS, NCSETS, NCCOL, N
     *CROW, IYEAR, IMONTH, IDAY, ISIGFG, ITXPRI, ITXSEC, ITITDT(3), L
     *ENCRD, IPROP, IHTEX, IBLINK, IERASE, ITCNTR, IUNUSD, NXYZ1(3), 
     *NXYZ2(3), LBLFMT(3), LBLCHR(3), NDIMNS(3), IBLKTP, IDIMNS, NMES
     *H0, NMESH1, NMESH2, MESH1, MESH2, MESH3, MESH2D, MESHN(3), NMESHN(
     *2), NFIELD, IFIELD(19), NINCR, NPOINT, IVARBL(19), IVPTR(19), I_
     *VORDER(19,2), LINEAR(4), NONLIN(4), MXECHO, LINES, MAXLNS, USRK
     *BD, USRSCR, PLTFIL, LINWID, LINCOL, LINTEX, ICPOIN(3), IREPCT(MA
     *XREP), LEVREP, GRDTYP, GRDTEX, OUTTEX, IAXTEX, TITEX, LETSET, LAB
     *TEX, TICTEX, SHADOWTYP,SHADOWTEX, NXYZDEF1(10), NXYZDEF2(10), IF
     *ILE_CASE ,MAX_SUBST
      INTEGER MAX_CYCLE
      PARAMETER (MAX_CYCLE=20)
      INTEGER N_CYCLE, ITX_CYCLE(MAX_CYCLE)
      REAL SYM_CYCLE(MAX_CYCLE)
      EQUIVALENCE (NMESH1,NMESHN)
      EQUIVALENCE (MESH1,MESHN)
      INTEGER IBUFFR(400)
      REAL BUFFER(400)
      INTEGER NCHSAVE 
      PARAMETER (NCHSAVE=2*512) 
      INTEGER*4 ICHSAVE(NCHSAVE)
      INTEGER*4 IVRPTR(15)
      CHARACTER*512 OUTSTR,C_FILE, C_NAME, C_SELECT
      CHARACTER C_TIT_ESCAPE*1,C_TIT_SUBSTITUTE*2
      INTEGER N_FILE, N_NAME, N_SELECT
      CHARACTER*8 PXNAME
      CHARACTER*64 INPFMT
      LOGICAL LTDATA, OUTSID(4)
      COMMON /T2COM/ PXNAME, REDUCE, TITX, TITY ,XFRM12, XFRM13, XFRM1
     *4, XFRM23 ,XFRM24, XFRM34 ,XVARSX ,TITSIZ, GRDSYM, GRDSIZ, CIRS
     *IZ, ASIZE, AFLARE ,SMSZDF, ORAXES, EYEDIR, VUEDIR, VUECEN ,VERTC
     *L, EYESEP, SCRD, SCRZ, EYEDIS, EYEPNT ,XYPART, BARSIZ, TIKSIZ, XY
     *ZBAS, TTHETA ,TPHI, FRELBL, IPATRN, NPATRN, PATRN ,SCLPRM, WINDO
     *W, SCREEN, SYMBOL, NOSYMB ,FACTXY, LBLSIZ, SYMSIZ, XYZLIM, WORLD 
     *,RADRMX, RADRMN, RADAMN, RADANG, RADX0, RADY0, XUNUSD ,USRKBD, U
     *SRSCR, PLTFIL ,ITITDT, LENCRD ,INPFMT, GRDTYP, LINWID, LINCOL, L
     *INTEX, TITCON, ITCNTR ,IUNUSD, NXYZ1, NXYZ2 ,LBLCHR, NDIMNS, IBL
     *KTP, IDIMNS ,NMESH1, NMESH2, MESH1, MESH2, MESH3, NFIELD ,IFIELD
     *, NINCR ,IVARBL, IVRPTR ,LINEAR, NONLIN ,NPOINT, LETSET ,MXECH
     *O, LINES, MAXLNS ,AXANG, MESH2D, REDFAC, GRDTEX, OUTTEX, IAXTEX, 
     *TITEX, DSCAL ,OUTSTR, IPROP, IHTEX, IBLINK, IERASE, LABTEX, TICTE
     *X, NXYLIM, PATSZ ,MARGIN, PSCR, ITXPRI, ITXSEC, OREAL, OCPU, CSCR
     *D, OUTSID ,TITLIN, TITINX, TITZ, TITX1, TITY1, LTDATA, NPLOTS, RE
     *VLEV ,LBLFMT, IYEAR, IMONTH, IDAY, ISIGFG ,DATPTS, ERRPTS, DATXM
     *N, DATXMX, DATYMN, DATYMX, DATZMN, DATZMX ,DATSUM, ERRSUM, DATAVE
     *, ERRAVE, DATCEN, ERRCEN, DATSTD, ERRSTD ,NCSETS, NCCOL, NCROW, F
     *MARKER, H2STAT, TITFAC, TITLOC, TITMAR ,TIKFAC, IWINLEV, WINREL, 
     *WINABS, WINLIM ,ICPOIN, LEVREP, IREPCT, SYDIR, GRDIR, NMESH0, EXY
     *ZLIM, IVPTR ,TITLMX, NXYZDEF1, NXYZDEF2, IFILE_CASE, N_CYCLE, ITX
     *_CYCLE ,SYM_CYCLE, PLOT_EXTENT, FILL_ANGLE, FILL_WIDTH, FILL_TEX 
     *,FILL_INDEX ,N_LINES ,DSLOPE ,MAX_SUBST, BARBRK ,I_VORDER,SHADOW
     *TYP,SHADOWTEX
      COMMON /T2SCRT/ BUFFER, IBUFFR, N_FILE,N_NAME,N_SELECT, ICHSAVE
      COMMON /T2_CHAR/ C_TIT_ESCAPE,C_TIT_SUBSTITUTE
      COMMON /T2_SCRT/ C_FILE, C_NAME, C_SELECT
      INTEGER JOUFIL, ERRFIL, OUTFIL, DBGFIL, INPFIL, NINMAX
      PARAMETER (NINMAX=20)
      INTEGER NINP(NINMAX)
      COMMON /T2TRBK/NINP, JOUFIL, ERRFIL, OUTFIL, DBGFIL, INPFIL
      CHARACTER*512 STRNG, STJOU
      LOGICAL LTOKEN
      REAL FLOTNG
      INTEGER INTERP, KEYORD, NSTRNG, MAXSTR, NSTJOU, LSTJOU, NTOKEN
      INTEGER*4 INTEG
      COMMON /TOKENC/ INTERP, INTEG, FLOTNG, KEYORD, NSTRNG, MAXSTR, ST
     *RNG, NSTJOU, LSTJOU, STJOU, LTOKEN, NTOKEN
      BYTE TYPTAB(256),TYPTB2(256)
      CHARACTER*256 UPCHAR,OKCHAR,DNCHAR
      INTEGER INFOTOKK(3),IINDEX(3)
      COMMON /T2TOKNC/ TYPTAB,TYPTB2,INFOTOKK,IINDEX
      COMMON /T2UPCH/ UPCHAR,OKCHAR,DNCHAR
      INTEGER I,J,ITYPE
      GOTO 16361
16390 CONTINUE
      ITYPE=INTEG
      CALL TOKEN(INFOIN,CARDIN,';')
      IF(INTERP.NE.5)THEN
      CALL T2ERR(INFOIN,CARDIN,' ',5)
      ELSE
      IF (NSTRNG.gt.0) CALL T2UPCS(STRNG(1:NSTRNG))
      DO 16411 I=1,NSTRNG
      IF (INDEX(' ABCDEFGHIJKLMNOPQRSTUVWXYZ1234567890-+.' ,STRNG(I:I))
     * .ne. 0) THEN
      WRITE(OUTSTR,*)'*** ERROR *** "',STRNG(I:I),'" may not be redefine
     *d'
      CALL T2ERR(INFOIN,CARDIN,OUTSTR,-4)
      ELSE
      J=ICHAR(STRNG(I:I))+1
      TYPTAB(J)=ITYPE
      ENDIF
16411 CONTINUE
16412 CONTINUE
      ENDIF
      GOTO 16362
16361 CALL TOKEN(INFOIN,CARDIN,'SPECIAL:12,ILLEGAL:13,ALPHA:5,TERMINATOR
     *:8,SEPARATOR:7,COMMENT:10,ENDCOMMENT:11,;')
      GOTO (16365,16367,16365,16365,16365,16365,16362,16367, 16365),INTE
     *RP
16365 CALL T2ERR(INFOIN,CARDIN,' ',5)
      GOTO 16362
16367 GOTO ( 16390,16390,16390,16390,16390,16390,16390,16365),KEYORD
16362 CONTINUE
      END
      SUBROUTINE T2_SET_DATE(INFOIN,CARDIN)
      IMPLICIT NONE
      INTEGER INFOIN(10)
      CHARACTER*(*) CARDIN
      COMMON /T2FLGC/ FLAGS(200), LTRAP,LHANDL,LSYERR,LSCREV
      LOGICAL FLAGS, LTRAP,LHANDL,LSYERR,LSCREV(3)
      INTEGER RELFLAG 
      PARAMETER (RELFLAG=151)
      INTEGER IWINLEV 
      INTEGER NWINLEV , MAX_FILL 
      PARAMETER (NWINLEV =4)
      PARAMETER (MAX_FILL=4)
      REAL GRDSYM, GRDSIZ, DATDAT(2,8), H2STAT(12), TITLIN(4), TITFA
     *C(4), TITLOC(4), TITMAR(4), TITLMX(4), TIKFAC, TITINX, TITX1, TIT
     *Y1, TITX, TITY, TITZ, TITSIZ, TITCON(5), REVLEV, REDUCE(5), XFR
     *M12(12), XFRM13(12), XFRM14(12), XFRM23(12), XFRM24(12), XFRM34(6
     *), XVARSX(20), CIRSIZ(2,3), ASIZE, AFLARE, SMSZDF, ORAXES(3), EY
     *EDIR(3), VUEDIR(3), VUECEN(3), VERTCL(3), EYESEP, SCRD, SCRZ, EYE
     *DIS, EYEPNT(3), XYPART(2, 2), BARSIZ(3), BARBRK(3), TIKSIZ(3), XY
     *ZBAS(3), TTHETA, TPHI, FRELBL(4), PATRN(20,30), SCLPRM(10,3), WI
     *NDOW(4), SCREEN(2), SYMBOL, NOSYMB, FACTXY(19), LBLSIZ, SYMSIZ, X
     *YZLIM(3,2), WORLD(3), RADRMX, RADRMN, RADAMN, RADANG, RADX0, RADY
     *0, XUNUSD(6), AXANG(3), REDFAC, DSCAL, PATSZ, MARGIN(4), PSCR(2
     *), OREAL, OCPU, CSCRD, DATPTS, ERRPTS, DATXMN, DATXMX, DATYMN, DA
     *TYMX, DATZMN, DATZMX, DATSUM, ERRSUM, DATAVE, ERRAVE, DATCEN, ERR
     *CEN, DATSTD, ERRSTD, WINREL(2,2,NWINLEV),WINABS(2,2,NWINLEV),WINL
     *IM(2,2), FMARKER(3,8), SYDIR(3), GRDIR(3), EXYZLIM(3,2), DSLOPE(2
     *,2)
      REAL PLOT_EXTENT(2,2),FILL_ANGLE(MAX_FILL),FILL_WIDTH(MAX_FILL)
      INTEGER FILL_INDEX, FILL_TEX(MAX_FILL), N_LINES(6)
      EQUIVALENCE (DATDAT, DATPTS)
      INTEGER MAXREP
      PARAMETER (MAXREP=5)
      INTEGER IPATRN, NPATRN(30), NXYLIM(3,2), NPLOTS, NCSETS, NCCOL, N
     *CROW, IYEAR, IMONTH, IDAY, ISIGFG, ITXPRI, ITXSEC, ITITDT(3), L
     *ENCRD, IPROP, IHTEX, IBLINK, IERASE, ITCNTR, IUNUSD, NXYZ1(3), 
     *NXYZ2(3), LBLFMT(3), LBLCHR(3), NDIMNS(3), IBLKTP, IDIMNS, NMES
     *H0, NMESH1, NMESH2, MESH1, MESH2, MESH3, MESH2D, MESHN(3), NMESHN(
     *2), NFIELD, IFIELD(19), NINCR, NPOINT, IVARBL(19), IVPTR(19), I_
     *VORDER(19,2), LINEAR(4), NONLIN(4), MXECHO, LINES, MAXLNS, USRK
     *BD, USRSCR, PLTFIL, LINWID, LINCOL, LINTEX, ICPOIN(3), IREPCT(MA
     *XREP), LEVREP, GRDTYP, GRDTEX, OUTTEX, IAXTEX, TITEX, LETSET, LAB
     *TEX, TICTEX, SHADOWTYP,SHADOWTEX, NXYZDEF1(10), NXYZDEF2(10), IF
     *ILE_CASE ,MAX_SUBST
      INTEGER MAX_CYCLE
      PARAMETER (MAX_CYCLE=20)
      INTEGER N_CYCLE, ITX_CYCLE(MAX_CYCLE)
      REAL SYM_CYCLE(MAX_CYCLE)
      EQUIVALENCE (NMESH1,NMESHN)
      EQUIVALENCE (MESH1,MESHN)
      INTEGER IBUFFR(400)
      REAL BUFFER(400)
      INTEGER NCHSAVE 
      PARAMETER (NCHSAVE=2*512) 
      INTEGER*4 ICHSAVE(NCHSAVE)
      INTEGER*4 IVRPTR(15)
      CHARACTER*512 OUTSTR,C_FILE, C_NAME, C_SELECT
      CHARACTER C_TIT_ESCAPE*1,C_TIT_SUBSTITUTE*2
      INTEGER N_FILE, N_NAME, N_SELECT
      CHARACTER*8 PXNAME
      CHARACTER*64 INPFMT
      LOGICAL LTDATA, OUTSID(4)
      COMMON /T2COM/ PXNAME, REDUCE, TITX, TITY ,XFRM12, XFRM13, XFRM1
     *4, XFRM23 ,XFRM24, XFRM34 ,XVARSX ,TITSIZ, GRDSYM, GRDSIZ, CIRS
     *IZ, ASIZE, AFLARE ,SMSZDF, ORAXES, EYEDIR, VUEDIR, VUECEN ,VERTC
     *L, EYESEP, SCRD, SCRZ, EYEDIS, EYEPNT ,XYPART, BARSIZ, TIKSIZ, XY
     *ZBAS, TTHETA ,TPHI, FRELBL, IPATRN, NPATRN, PATRN ,SCLPRM, WINDO
     *W, SCREEN, SYMBOL, NOSYMB ,FACTXY, LBLSIZ, SYMSIZ, XYZLIM, WORLD 
     *,RADRMX, RADRMN, RADAMN, RADANG, RADX0, RADY0, XUNUSD ,USRKBD, U
     *SRSCR, PLTFIL ,ITITDT, LENCRD ,INPFMT, GRDTYP, LINWID, LINCOL, L
     *INTEX, TITCON, ITCNTR ,IUNUSD, NXYZ1, NXYZ2 ,LBLCHR, NDIMNS, IBL
     *KTP, IDIMNS ,NMESH1, NMESH2, MESH1, MESH2, MESH3, NFIELD ,IFIELD
     *, NINCR ,IVARBL, IVRPTR ,LINEAR, NONLIN ,NPOINT, LETSET ,MXECH
     *O, LINES, MAXLNS ,AXANG, MESH2D, REDFAC, GRDTEX, OUTTEX, IAXTEX, 
     *TITEX, DSCAL ,OUTSTR, IPROP, IHTEX, IBLINK, IERASE, LABTEX, TICTE
     *X, NXYLIM, PATSZ ,MARGIN, PSCR, ITXPRI, ITXSEC, OREAL, OCPU, CSCR
     *D, OUTSID ,TITLIN, TITINX, TITZ, TITX1, TITY1, LTDATA, NPLOTS, RE
     *VLEV ,LBLFMT, IYEAR, IMONTH, IDAY, ISIGFG ,DATPTS, ERRPTS, DATXM
     *N, DATXMX, DATYMN, DATYMX, DATZMN, DATZMX ,DATSUM, ERRSUM, DATAVE
     *, ERRAVE, DATCEN, ERRCEN, DATSTD, ERRSTD ,NCSETS, NCCOL, NCROW, F
     *MARKER, H2STAT, TITFAC, TITLOC, TITMAR ,TIKFAC, IWINLEV, WINREL, 
     *WINABS, WINLIM ,ICPOIN, LEVREP, IREPCT, SYDIR, GRDIR, NMESH0, EXY
     *ZLIM, IVPTR ,TITLMX, NXYZDEF1, NXYZDEF2, IFILE_CASE, N_CYCLE, ITX
     *_CYCLE ,SYM_CYCLE, PLOT_EXTENT, FILL_ANGLE, FILL_WIDTH, FILL_TEX 
     *,FILL_INDEX ,N_LINES ,DSLOPE ,MAX_SUBST, BARBRK ,I_VORDER,SHADOW
     *TYP,SHADOWTEX
      COMMON /T2SCRT/ BUFFER, IBUFFR, N_FILE,N_NAME,N_SELECT, ICHSAVE
      COMMON /T2_CHAR/ C_TIT_ESCAPE,C_TIT_SUBSTITUTE
      COMMON /T2_SCRT/ C_FILE, C_NAME, C_SELECT
      INTEGER JOUFIL, ERRFIL, OUTFIL, DBGFIL, INPFIL, NINMAX
      PARAMETER (NINMAX=20)
      INTEGER NINP(NINMAX)
      COMMON /T2TRBK/NINP, JOUFIL, ERRFIL, OUTFIL, DBGFIL, INPFIL
      CHARACTER*512 STRNG, STJOU
      LOGICAL LTOKEN
      REAL FLOTNG
      INTEGER INTERP, KEYORD, NSTRNG, MAXSTR, NSTJOU, LSTJOU, NTOKEN
      INTEGER*4 INTEG
      COMMON /TOKENC/ INTERP, INTEG, FLOTNG, KEYORD, NSTRNG, MAXSTR, ST
     *RNG, NSTJOU, LSTJOU, STJOU, LTOKEN, NTOKEN
      LOGICAL LDONE
      DOUBLE PRECISION DTIM
      REAL YEAR,FMON,DAY,HOUR,FMIN,SEC
      LDONE=.false.
      GOTO 16421
16450 CONTINUE
      IDAY=INTEG
      LDONE=.true.
      GOTO 16421
16460 CONTINUE
      IMONTH=INTEG
      LDONE=.true.
      GOTO 16421
16470 CONTINUE
      IYEAR=INTEG
      LDONE=.true.
      GOTO 16421
16480 CONTINUE
      IMONTH=INTEG
      LDONE=.true.
      GOTO 16421
16430 GOTO ( 16450,16460,16470,16480,16480,16480,16480,16480,16480,16480
     *,16480,16480,16480,16480,16480,16425),KEYORD
16490 CONTINUE
      DTIM=FLOTNG
      DTIM=(DTIM+12)*3600
      CALL T2NTIM(DTIM,YEAR,FMON,DAY,HOUR,FMIN,SEC)
      IDAY=NINT(DAY)
      IMONTH=NINT(FMON)
      IYEAR=NINT(YEAR)
      LDONE=.true.
      GOTO 16421
16421 CALL TOKEN(INFOIN,CARDIN,'DAY:1:31:0,MONTH:1:12:1,YEAR:::1900,JANU
     *ARY:1,FEBRUARY:2,MARCH:3,APRIL:4,MAY:5,JUNE:6,JULY:7,AUGUST:8,SEPT
     *EMBER:9,OCTOBER:10,NOVEMBER:11,DECEMBER:12,;')
      GOTO (16422,16430,16490,16490,16425,16425,16425,16430,16425),INTER
     *P
16425 CALL T2ERR(INFOIN,CARDIN,' ',5)
      GOTO 16421
16422 CONTINUE
      IF (.not.LDONE.and..not.FLAGS(23)) THEN
      IYEAR=0
      IMONTH=1
      IDAY=1
      ENDIF
      END
      SUBROUTINE T2_SET_MODE(INFOIN,CARDIN)
      IMPLICIT NONE
      INTEGER INFOIN(10)
      CHARACTER*(*) CARDIN
      COMMON /T2FLGC/ FLAGS(200), LTRAP,LHANDL,LSYERR,LSCREV
      LOGICAL FLAGS, LTRAP,LHANDL,LSYERR,LSCREV(3)
      INTEGER RELFLAG 
      PARAMETER (RELFLAG=151)
      INTEGER IWINLEV 
      INTEGER NWINLEV , MAX_FILL 
      PARAMETER (NWINLEV =4)
      PARAMETER (MAX_FILL=4)
      REAL GRDSYM, GRDSIZ, DATDAT(2,8), H2STAT(12), TITLIN(4), TITFA
     *C(4), TITLOC(4), TITMAR(4), TITLMX(4), TIKFAC, TITINX, TITX1, TIT
     *Y1, TITX, TITY, TITZ, TITSIZ, TITCON(5), REVLEV, REDUCE(5), XFR
     *M12(12), XFRM13(12), XFRM14(12), XFRM23(12), XFRM24(12), XFRM34(6
     *), XVARSX(20), CIRSIZ(2,3), ASIZE, AFLARE, SMSZDF, ORAXES(3), EY
     *EDIR(3), VUEDIR(3), VUECEN(3), VERTCL(3), EYESEP, SCRD, SCRZ, EYE
     *DIS, EYEPNT(3), XYPART(2, 2), BARSIZ(3), BARBRK(3), TIKSIZ(3), XY
     *ZBAS(3), TTHETA, TPHI, FRELBL(4), PATRN(20,30), SCLPRM(10,3), WI
     *NDOW(4), SCREEN(2), SYMBOL, NOSYMB, FACTXY(19), LBLSIZ, SYMSIZ, X
     *YZLIM(3,2), WORLD(3), RADRMX, RADRMN, RADAMN, RADANG, RADX0, RADY
     *0, XUNUSD(6), AXANG(3), REDFAC, DSCAL, PATSZ, MARGIN(4), PSCR(2
     *), OREAL, OCPU, CSCRD, DATPTS, ERRPTS, DATXMN, DATXMX, DATYMN, DA
     *TYMX, DATZMN, DATZMX, DATSUM, ERRSUM, DATAVE, ERRAVE, DATCEN, ERR
     *CEN, DATSTD, ERRSTD, WINREL(2,2,NWINLEV),WINABS(2,2,NWINLEV),WINL
     *IM(2,2), FMARKER(3,8), SYDIR(3), GRDIR(3), EXYZLIM(3,2), DSLOPE(2
     *,2)
      REAL PLOT_EXTENT(2,2),FILL_ANGLE(MAX_FILL),FILL_WIDTH(MAX_FILL)
      INTEGER FILL_INDEX, FILL_TEX(MAX_FILL), N_LINES(6)
      EQUIVALENCE (DATDAT, DATPTS)
      INTEGER MAXREP
      PARAMETER (MAXREP=5)
      INTEGER IPATRN, NPATRN(30), NXYLIM(3,2), NPLOTS, NCSETS, NCCOL, N
     *CROW, IYEAR, IMONTH, IDAY, ISIGFG, ITXPRI, ITXSEC, ITITDT(3), L
     *ENCRD, IPROP, IHTEX, IBLINK, IERASE, ITCNTR, IUNUSD, NXYZ1(3), 
     *NXYZ2(3), LBLFMT(3), LBLCHR(3), NDIMNS(3), IBLKTP, IDIMNS, NMES
     *H0, NMESH1, NMESH2, MESH1, MESH2, MESH3, MESH2D, MESHN(3), NMESHN(
     *2), NFIELD, IFIELD(19), NINCR, NPOINT, IVARBL(19), IVPTR(19), I_
     *VORDER(19,2), LINEAR(4), NONLIN(4), MXECHO, LINES, MAXLNS, USRK
     *BD, USRSCR, PLTFIL, LINWID, LINCOL, LINTEX, ICPOIN(3), IREPCT(MA
     *XREP), LEVREP, GRDTYP, GRDTEX, OUTTEX, IAXTEX, TITEX, LETSET, LAB
     *TEX, TICTEX, SHADOWTYP,SHADOWTEX, NXYZDEF1(10), NXYZDEF2(10), IF
     *ILE_CASE ,MAX_SUBST
      INTEGER MAX_CYCLE
      PARAMETER (MAX_CYCLE=20)
      INTEGER N_CYCLE, ITX_CYCLE(MAX_CYCLE)
      REAL SYM_CYCLE(MAX_CYCLE)
      EQUIVALENCE (NMESH1,NMESHN)
      EQUIVALENCE (MESH1,MESHN)
      INTEGER IBUFFR(400)
      REAL BUFFER(400)
      INTEGER NCHSAVE 
      PARAMETER (NCHSAVE=2*512) 
      INTEGER*4 ICHSAVE(NCHSAVE)
      INTEGER*4 IVRPTR(15)
      CHARACTER*512 OUTSTR,C_FILE, C_NAME, C_SELECT
      CHARACTER C_TIT_ESCAPE*1,C_TIT_SUBSTITUTE*2
      INTEGER N_FILE, N_NAME, N_SELECT
      CHARACTER*8 PXNAME
      CHARACTER*64 INPFMT
      LOGICAL LTDATA, OUTSID(4)
      COMMON /T2COM/ PXNAME, REDUCE, TITX, TITY ,XFRM12, XFRM13, XFRM1
     *4, XFRM23 ,XFRM24, XFRM34 ,XVARSX ,TITSIZ, GRDSYM, GRDSIZ, CIRS
     *IZ, ASIZE, AFLARE ,SMSZDF, ORAXES, EYEDIR, VUEDIR, VUECEN ,VERTC
     *L, EYESEP, SCRD, SCRZ, EYEDIS, EYEPNT ,XYPART, BARSIZ, TIKSIZ, XY
     *ZBAS, TTHETA ,TPHI, FRELBL, IPATRN, NPATRN, PATRN ,SCLPRM, WINDO
     *W, SCREEN, SYMBOL, NOSYMB ,FACTXY, LBLSIZ, SYMSIZ, XYZLIM, WORLD 
     *,RADRMX, RADRMN, RADAMN, RADANG, RADX0, RADY0, XUNUSD ,USRKBD, U
     *SRSCR, PLTFIL ,ITITDT, LENCRD ,INPFMT, GRDTYP, LINWID, LINCOL, L
     *INTEX, TITCON, ITCNTR ,IUNUSD, NXYZ1, NXYZ2 ,LBLCHR, NDIMNS, IBL
     *KTP, IDIMNS ,NMESH1, NMESH2, MESH1, MESH2, MESH3, NFIELD ,IFIELD
     *, NINCR ,IVARBL, IVRPTR ,LINEAR, NONLIN ,NPOINT, LETSET ,MXECH
     *O, LINES, MAXLNS ,AXANG, MESH2D, REDFAC, GRDTEX, OUTTEX, IAXTEX, 
     *TITEX, DSCAL ,OUTSTR, IPROP, IHTEX, IBLINK, IERASE, LABTEX, TICTE
     *X, NXYLIM, PATSZ ,MARGIN, PSCR, ITXPRI, ITXSEC, OREAL, OCPU, CSCR
     *D, OUTSID ,TITLIN, TITINX, TITZ, TITX1, TITY1, LTDATA, NPLOTS, RE
     *VLEV ,LBLFMT, IYEAR, IMONTH, IDAY, ISIGFG ,DATPTS, ERRPTS, DATXM
     *N, DATXMX, DATYMN, DATYMX, DATZMN, DATZMX ,DATSUM, ERRSUM, DATAVE
     *, ERRAVE, DATCEN, ERRCEN, DATSTD, ERRSTD ,NCSETS, NCCOL, NCROW, F
     *MARKER, H2STAT, TITFAC, TITLOC, TITMAR ,TIKFAC, IWINLEV, WINREL, 
     *WINABS, WINLIM ,ICPOIN, LEVREP, IREPCT, SYDIR, GRDIR, NMESH0, EXY
     *ZLIM, IVPTR ,TITLMX, NXYZDEF1, NXYZDEF2, IFILE_CASE, N_CYCLE, ITX
     *_CYCLE ,SYM_CYCLE, PLOT_EXTENT, FILL_ANGLE, FILL_WIDTH, FILL_TEX 
     *,FILL_INDEX ,N_LINES ,DSLOPE ,MAX_SUBST, BARBRK ,I_VORDER,SHADOW
     *TYP,SHADOWTEX
      COMMON /T2SCRT/ BUFFER, IBUFFR, N_FILE,N_NAME,N_SELECT, ICHSAVE
      COMMON /T2_CHAR/ C_TIT_ESCAPE,C_TIT_SUBSTITUTE
      COMMON /T2_SCRT/ C_FILE, C_NAME, C_SELECT
      INTEGER JOUFIL, ERRFIL, OUTFIL, DBGFIL, INPFIL, NINMAX
      PARAMETER (NINMAX=20)
      INTEGER NINP(NINMAX)
      COMMON /T2TRBK/NINP, JOUFIL, ERRFIL, OUTFIL, DBGFIL, INPFIL
      CHARACTER*512 STRNG, STJOU
      LOGICAL LTOKEN
      REAL FLOTNG
      INTEGER INTERP, KEYORD, NSTRNG, MAXSTR, NSTJOU, LSTJOU, NTOKEN
      INTEGER*4 INTEG
      COMMON /TOKENC/ INTERP, INTEG, FLOTNG, KEYORD, NSTRNG, MAXSTR, ST
     *RNG, NSTJOU, LSTJOU, STJOU, LTOKEN, NTOKEN
      LOGICAL DFLAGS(200),DSCREV(3)
      COMMON /T2FLGD/DFLAGS,DSCREV
      REAL DTITLIN(4), DTITFAC(4), DTITMAR(4)
      INTEGER DGRDTYP, DGRDTEX, DOUTTEX, IDAXTEX, DTITEX, DSHADOWTYP,DS
     *HADOWTEX, IFLDDF(19), NDDIMNS, IDTXPRI, IDTXSEC, LINCLF, LINTXF,
     * LINWDF, DNONLN(3), DNXYZ1(3), DNXYZ2(3), DLABTEX, DTICTEX, DNPAT
     *RN(30), DLBLCHR(3), ND_CYCLE, IDTX_CYCLE(MAX_CYCLE)
      REAL DSYM_CYCLE(MAX_CYCLE)
      REAL DTITSIZ, DGRDSYM, DGRDSIZ, DCIRSIZ(2,3), DASIZE, DAFLARE, D
     *SMSZDF, DORAXES(3), DEYEDIR(3), DVUEDIR(3), DVUECEN(3), DVERTCL(3
     *), DEYESEP, DSCRD, DSCRZ, DEYEDIS, DEYEPNT(3), DBARSIZ(3), DBARBR
     *K(3), DTIKSIZ(3), DXYZBS(3), DTTHETA, DTPHI, DFRELBL(4), DPATRN(2
     *0,30), DSCLPRM(10,3), DWINDOW(4), DSCREEN(2), DSYMBOL, DNOSYMB, 
     *DAXANG(3), DLBLSIZ, DSYMSIZ, DXYZLIM(3,2), DFACTXY(19), DRADANG,
     * DDSCAL, DPATSZ, DTITINX, DTIKFAC, DSYDIR(3), DGRDIR(3)
      COMMON /T2COMD/ DTITSIZ, DGRDSYM, DGRDSIZ, DCIRSIZ, DASIZE, DAFLA
     *RE, DSMSZDF, DORAXES, DEYEDIR, DVUEDIR, DVUECEN, DVERTCL, DEYESE
     *P, DSCRD, DSCRZ, DEYEDIS, DEYEPNT, DBARSIZ, DTIKSIZ, DXYZBS, DTTH
     *ETA, DTPHI, DFRELBL, DNPATRN, DPATRN, DSCLPRM, DWINDOW, DSCREEN,
     * DSYMBOL, DNOSYMB, DAXANG, DLBLSIZ, DSYMSIZ, DXYZLIM, DGRDTYP, D
     *FACTXY, IFLDDF, NDDIMNS, DGRDTEX, DOUTTEX, IDAXTEX, DTITEX, DRADA
     *NG, DDSCAL, DNONLN, DNXYZ1, DNXYZ2, LINCLF, LINTXF, LINWDF, DLABT
     *EX, DTICTEX, DPATSZ, IDTXPRI, IDTXSEC, DTITLIN, DTITINX, DLBLCHR,
     * DTITFAC, DTITMAR, DTIKFAC, DSYDIR, DGRDIR, ND_CYCLE, IDTX_CYCLE,
     * DSYM_CYCLE, DBARBRK,  DSHADOWTYP,DSHADOWTEX
      INTEGER I1,I,J,DUM
      GOTO 16501
16530 CONTINUE
      FLAGS(92)=LTOKEN
      GOTO 16501
16540 CONTINUE
      FLAGS(106)=LTOKEN
      GOTO 16501
16550 CONTINUE
      FLAGS(97)=LTOKEN
      GOTO 16501
16560 CONTINUE
      FLAGS(104)=LTOKEN
      GOTO 16501
16570 CONTINUE
      FLAGS(102)=LTOKEN
      GOTO 16501
16580 CONTINUE
      FLAGS(29)=LTOKEN
      GOTO 16501
16590 CONTINUE
      MXECHO=INTEG
      GOTO 16501
16600 CONTINUE
      FLAGS(17)=LTOKEN
      GOTO 16501
16610 CONTINUE
      IERASE=0
      IF(LTOKEN)IERASE=1
      CALL TXXOPT(11,IERASE,DUM,I)
      GOTO 16501
16620 CONTINUE
      GOTO 16631
16660 CONTINUE
      IFILE_CASE=INTEG
      GOTO 16632
16631 CALL TOKEN(INFOIN,CARDIN,'UPPER:0,LOWER:1,MIXED:2,;')
      GOTO (16635,16637,16635,16635,16635,16635,16632,16637, 16635),INTE
     *RP
16635 CALL T2ERR(INFOIN,CARDIN,' ',5)
      GOTO 16632
16637 GOTO ( 16660,16660,16660,16635),KEYORD
16632 CONTINUE
      GOTO 16501
16670 CONTINUE
      IHTEX=1
      IF(LTOKEN) IHTEX=0
      CALL TXXOPT(8,IPROP,DUM,I)
      GOTO 16501
16680 CONTINUE
      IF(LTOKEN) THEN
      JOUFIL=ABS(JOUFIL)
      ELSE
      JOUFIL=-ABS(JOUFIL)
      ENDIF
      GOTO 16501
16690 CONTINUE
      IF(LTOKEN) THEN
      OUTFIL=ABS(OUTFIL)
      ELSE
      OUTFIL=-ABS(OUTFIL)
      ENDIF
      GOTO 16501
16700 CONTINUE
      FLAGS(95)=LTOKEN
      GOTO 16501
16710 CONTINUE
      FLAGS(107)=LTOKEN
      GOTO 16501
16720 CONTINUE
      FLAGS(109)=LTOKEN
      GOTO 16501
16730 CONTINUE
      IPROP=1
      IF(LTOKEN) IPROP=0
      CALL TXXOPT(9,IPROP,DUM,I)
      GOTO 16501
16740 CONTINUE
      FLAGS(16)=LTOKEN
      GOTO 16501
16750 CONTINUE
      FLAGS(108)=LTOKEN
      GOTO 16501
16760 CONTINUE
      FLAGS(18)=LTOKEN
      GOTO 16501
16770 CONTINUE
      FLAGS(103)=LTOKEN
      GOTO 16501
16780 CONTINUE
      FLAGS(83)=INTEG.NE.0
      CALL TXXOPT(4,INTEG,DUM,I)
      GOTO 16501
16790 CONTINUE
      FLAGS(96)=LTOKEN
      GOTO 16501
16800 CONTINUE
      FLAGS(25)=LTOKEN
      J=1
      IF (FLAGS(25)) J=0
      CALL TXXOPT(12,J,DUM,I)
      GOTO 16501
16810 CONTINUE
      FLAGS(101)=LTOKEN
      GOTO 16501
16501 CALL TOKEN(INFOIN,CARDIN,'ABORT:Y,APPEND:Y,AUTOPLOT:Y,CONFIRM:Y,DA
     *TAVECTOR:Y,DEBUG:Y,NODEBUG:N,ECHO:::1000,NOECHO:0,EXPAND:Y,ERASE:Y
     *,FILECASE,HARD:Y,HARDSTRUCTURE:Y,HARDTEXTURE:Y,JOURNALING:Y,LISTIN
     *G:Y,OUTPUT:Y,LOG:Y,MONITOR:Y,NEW:Y,PROPORTIONAL:Y,SHOW:Y,TITLE:Y,T
     *RACE:Y,NOTRACE:N,TREE:Y,QUICK:1,SLOW,VLOG:Y,VECTOR:Y,NOVECTOR:N,PA
     *TTERNED:Y,;')
      GOTO (16502,16507,16505,16505,16505,16505,16501,16507, 16505),INTE
     *RP
16505 CALL T2ERR(INFOIN,CARDIN,' ',5)
      GOTO 16501
16507 GOTO ( 16530,16540,16550,16560,16570,16580,16580,16590,16590,16600
     *,16610,16620,16670,16670,16670,16680,16690,16690,16700,16710,16720
     *,16730,16740,16750,16760,16760,16770,16780,16780,16790,16800,16800
     *,16810,16505),KEYORD
16502 CONTINUE
      END
      SUBROUTINE T2_SET_STATISTICS(INFOIN,CARDIN)
      IMPLICIT NONE
      INTEGER INFOIN(10)
      CHARACTER*(*) CARDIN
      COMMON /T2FLGC/ FLAGS(200), LTRAP,LHANDL,LSYERR,LSCREV
      LOGICAL FLAGS, LTRAP,LHANDL,LSYERR,LSCREV(3)
      INTEGER RELFLAG 
      PARAMETER (RELFLAG=151)
      INTEGER IWINLEV 
      INTEGER NWINLEV , MAX_FILL 
      PARAMETER (NWINLEV =4)
      PARAMETER (MAX_FILL=4)
      REAL GRDSYM, GRDSIZ, DATDAT(2,8), H2STAT(12), TITLIN(4), TITFA
     *C(4), TITLOC(4), TITMAR(4), TITLMX(4), TIKFAC, TITINX, TITX1, TIT
     *Y1, TITX, TITY, TITZ, TITSIZ, TITCON(5), REVLEV, REDUCE(5), XFR
     *M12(12), XFRM13(12), XFRM14(12), XFRM23(12), XFRM24(12), XFRM34(6
     *), XVARSX(20), CIRSIZ(2,3), ASIZE, AFLARE, SMSZDF, ORAXES(3), EY
     *EDIR(3), VUEDIR(3), VUECEN(3), VERTCL(3), EYESEP, SCRD, SCRZ, EYE
     *DIS, EYEPNT(3), XYPART(2, 2), BARSIZ(3), BARBRK(3), TIKSIZ(3), XY
     *ZBAS(3), TTHETA, TPHI, FRELBL(4), PATRN(20,30), SCLPRM(10,3), WI
     *NDOW(4), SCREEN(2), SYMBOL, NOSYMB, FACTXY(19), LBLSIZ, SYMSIZ, X
     *YZLIM(3,2), WORLD(3), RADRMX, RADRMN, RADAMN, RADANG, RADX0, RADY
     *0, XUNUSD(6), AXANG(3), REDFAC, DSCAL, PATSZ, MARGIN(4), PSCR(2
     *), OREAL, OCPU, CSCRD, DATPTS, ERRPTS, DATXMN, DATXMX, DATYMN, DA
     *TYMX, DATZMN, DATZMX, DATSUM, ERRSUM, DATAVE, ERRAVE, DATCEN, ERR
     *CEN, DATSTD, ERRSTD, WINREL(2,2,NWINLEV),WINABS(2,2,NWINLEV),WINL
     *IM(2,2), FMARKER(3,8), SYDIR(3), GRDIR(3), EXYZLIM(3,2), DSLOPE(2
     *,2)
      REAL PLOT_EXTENT(2,2),FILL_ANGLE(MAX_FILL),FILL_WIDTH(MAX_FILL)
      INTEGER FILL_INDEX, FILL_TEX(MAX_FILL), N_LINES(6)
      EQUIVALENCE (DATDAT, DATPTS)
      INTEGER MAXREP
      PARAMETER (MAXREP=5)
      INTEGER IPATRN, NPATRN(30), NXYLIM(3,2), NPLOTS, NCSETS, NCCOL, N
     *CROW, IYEAR, IMONTH, IDAY, ISIGFG, ITXPRI, ITXSEC, ITITDT(3), L
     *ENCRD, IPROP, IHTEX, IBLINK, IERASE, ITCNTR, IUNUSD, NXYZ1(3), 
     *NXYZ2(3), LBLFMT(3), LBLCHR(3), NDIMNS(3), IBLKTP, IDIMNS, NMES
     *H0, NMESH1, NMESH2, MESH1, MESH2, MESH3, MESH2D, MESHN(3), NMESHN(
     *2), NFIELD, IFIELD(19), NINCR, NPOINT, IVARBL(19), IVPTR(19), I_
     *VORDER(19,2), LINEAR(4), NONLIN(4), MXECHO, LINES, MAXLNS, USRK
     *BD, USRSCR, PLTFIL, LINWID, LINCOL, LINTEX, ICPOIN(3), IREPCT(MA
     *XREP), LEVREP, GRDTYP, GRDTEX, OUTTEX, IAXTEX, TITEX, LETSET, LAB
     *TEX, TICTEX, SHADOWTYP,SHADOWTEX, NXYZDEF1(10), NXYZDEF2(10), IF
     *ILE_CASE ,MAX_SUBST
      INTEGER MAX_CYCLE
      PARAMETER (MAX_CYCLE=20)
      INTEGER N_CYCLE, ITX_CYCLE(MAX_CYCLE)
      REAL SYM_CYCLE(MAX_CYCLE)
      EQUIVALENCE (NMESH1,NMESHN)
      EQUIVALENCE (MESH1,MESHN)
      INTEGER IBUFFR(400)
      REAL BUFFER(400)
      INTEGER NCHSAVE 
      PARAMETER (NCHSAVE=2*512) 
      INTEGER*4 ICHSAVE(NCHSAVE)
      INTEGER*4 IVRPTR(15)
      CHARACTER*512 OUTSTR,C_FILE, C_NAME, C_SELECT
      CHARACTER C_TIT_ESCAPE*1,C_TIT_SUBSTITUTE*2
      INTEGER N_FILE, N_NAME, N_SELECT
      CHARACTER*8 PXNAME
      CHARACTER*64 INPFMT
      LOGICAL LTDATA, OUTSID(4)
      COMMON /T2COM/ PXNAME, REDUCE, TITX, TITY ,XFRM12, XFRM13, XFRM1
     *4, XFRM23 ,XFRM24, XFRM34 ,XVARSX ,TITSIZ, GRDSYM, GRDSIZ, CIRS
     *IZ, ASIZE, AFLARE ,SMSZDF, ORAXES, EYEDIR, VUEDIR, VUECEN ,VERTC
     *L, EYESEP, SCRD, SCRZ, EYEDIS, EYEPNT ,XYPART, BARSIZ, TIKSIZ, XY
     *ZBAS, TTHETA ,TPHI, FRELBL, IPATRN, NPATRN, PATRN ,SCLPRM, WINDO
     *W, SCREEN, SYMBOL, NOSYMB ,FACTXY, LBLSIZ, SYMSIZ, XYZLIM, WORLD 
     *,RADRMX, RADRMN, RADAMN, RADANG, RADX0, RADY0, XUNUSD ,USRKBD, U
     *SRSCR, PLTFIL ,ITITDT, LENCRD ,INPFMT, GRDTYP, LINWID, LINCOL, L
     *INTEX, TITCON, ITCNTR ,IUNUSD, NXYZ1, NXYZ2 ,LBLCHR, NDIMNS, IBL
     *KTP, IDIMNS ,NMESH1, NMESH2, MESH1, MESH2, MESH3, NFIELD ,IFIELD
     *, NINCR ,IVARBL, IVRPTR ,LINEAR, NONLIN ,NPOINT, LETSET ,MXECH
     *O, LINES, MAXLNS ,AXANG, MESH2D, REDFAC, GRDTEX, OUTTEX, IAXTEX, 
     *TITEX, DSCAL ,OUTSTR, IPROP, IHTEX, IBLINK, IERASE, LABTEX, TICTE
     *X, NXYLIM, PATSZ ,MARGIN, PSCR, ITXPRI, ITXSEC, OREAL, OCPU, CSCR
     *D, OUTSID ,TITLIN, TITINX, TITZ, TITX1, TITY1, LTDATA, NPLOTS, RE
     *VLEV ,LBLFMT, IYEAR, IMONTH, IDAY, ISIGFG ,DATPTS, ERRPTS, DATXM
     *N, DATXMX, DATYMN, DATYMX, DATZMN, DATZMX ,DATSUM, ERRSUM, DATAVE
     *, ERRAVE, DATCEN, ERRCEN, DATSTD, ERRSTD ,NCSETS, NCCOL, NCROW, F
     *MARKER, H2STAT, TITFAC, TITLOC, TITMAR ,TIKFAC, IWINLEV, WINREL, 
     *WINABS, WINLIM ,ICPOIN, LEVREP, IREPCT, SYDIR, GRDIR, NMESH0, EXY
     *ZLIM, IVPTR ,TITLMX, NXYZDEF1, NXYZDEF2, IFILE_CASE, N_CYCLE, ITX
     *_CYCLE ,SYM_CYCLE, PLOT_EXTENT, FILL_ANGLE, FILL_WIDTH, FILL_TEX 
     *,FILL_INDEX ,N_LINES ,DSLOPE ,MAX_SUBST, BARBRK ,I_VORDER,SHADOW
     *TYP,SHADOWTEX
      COMMON /T2SCRT/ BUFFER, IBUFFR, N_FILE,N_NAME,N_SELECT, ICHSAVE
      COMMON /T2_CHAR/ C_TIT_ESCAPE,C_TIT_SUBSTITUTE
      COMMON /T2_SCRT/ C_FILE, C_NAME, C_SELECT
      INTEGER JOUFIL, ERRFIL, OUTFIL, DBGFIL, INPFIL, NINMAX
      PARAMETER (NINMAX=20)
      INTEGER NINP(NINMAX)
      COMMON /T2TRBK/NINP, JOUFIL, ERRFIL, OUTFIL, DBGFIL, INPFIL
      CHARACTER*512 STRNG, STJOU
      LOGICAL LTOKEN
      REAL FLOTNG
      INTEGER INTERP, KEYORD, NSTRNG, MAXSTR, NSTJOU, LSTJOU, NTOKEN
      INTEGER*4 INTEG
      COMMON /TOKENC/ INTERP, INTEG, FLOTNG, KEYORD, NSTRNG, MAXSTR, ST
     *RNG, NSTJOU, LSTJOU, STJOU, LTOKEN, NTOKEN
      REAL HNONE
      LOGICAL LTEMP
      INTEGER LISTPT,NPTMAX,NDSETS
      REAL DATBUF(10248)
      COMMON /T2XPNT/ LISTPT,NPTMAX,NDSETS,DATBUF
      INTEGER NLIM
      INTEGER N1,N2,N3,N4,NS1,NS2
      REAL TLIM(2,2)
      DATA HNONE /-666.666/
      NLIM=2
      NS1=1
      NS2=NDSETS
      N_SELECT=1
      C_SELECT(1:1)='*'
      N1=1
      N2= 2 147 483 647
      N3=1
      N4= 2 147 483 647
      TLIM(1,1)=HNONE
      GOTO 16821
16850 CONTINUE
      CALL T2XYZC(INFOIN,CARDIN,TLIM,2,NLIM)
      GOTO 16821
16860 CONTINUE
      CALL T2ROWS(INFOIN,CARDIN,N3,N4)
      GOTO 16821
16870 CONTINUE
      CALL T2PNTS(INFOIN,CARDIN,N1,N2)
      GOTO 16821
16880 CONTINUE
      CALL T2NSET(INFOIN,CARDIN,NS1,NS2)
      GOTO 16821
16890 CONTINUE
      C_SELECT=STRNG
      N_SELECT=MAX(1,NSTRNG)
      GOTO 16821
16900 CONTINUE
      LTEMP=LTOKEN
      GOTO 16821
16821 CALL TOKEN(INFOIN,CARDIN,'LIMITED,LINES,ROWS,POINTS,COLUMNS,SETS,S
     *ELECT:S,WEIGHTED:Y,;')
      GOTO (16822,16827,16825,16825,16825,16825,16821,16827, 16825),INTE
     *RP
16825 CALL T2ERR(INFOIN,CARDIN,' ',5)
      GOTO 16821
16827 GOTO ( 16850,16860,16860,16870,16870,16880,16890,16900,16825),KEYO
     *RD
16822 CONTINUE
      IF (FLAGS(23) .and. FLAGS(92)) RETURN
      CALL TDSTAT(TLIM,N1,N2,N3,N4,NS1,NS2,LTEMP,NLIM,C_SELECT(:N_SELECT
     *))
      END
      SUBROUTINE T2_SET_POPEN(UNIT,COM,*)
      INTEGER UNIT,L,SYSTEM
      CHARACTER COM*(*),TMP*512
      L=LEN(COM)
      TMP=COM
      TMP(L+1:L+3)=' > '
      OPEN(UNIT,STATUS='SCRATCH',ERR=90000) 
      INQUIRE(UNIT,NAME=TMP(L+4:))
      IF (SYSTEM(TMP).EQ.0) RETURN
90000 RETURN 1
      END
