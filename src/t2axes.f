C        MORTRAN 2.79 (BRACKETED KEYWORD MACROS OF 09/28/81)          
      SUBROUTINE T2AXES
      IMPLICIT NONE
      COMMON /T2FLGC/ FLAGS(200), LTRAP,LHANDL,LSYERR,LSCREV
      LOGICAL FLAGS, LTRAP,LHANDL,LSYERR,LSCREV(3)
      INTEGER RELFLAG 
      PARAMETER (RELFLAG=151)
      INTEGER IWINLEV 
      INTEGER NWINLEV , MAX_FILL 
      PARAMETER (NWINLEV =4)
      PARAMETER (MAX_FILL=4)
      REAL GRDSYM, GRDSIZ, DATDAT(2,8), H2STAT(12), TITLIN(4), TITFA
     *C(4), TITLOC(4), TITMAR(4), TITLMX(4), TIKFAC, TITINX, TITX1, TIT
     *Y1, TITX, TITY, TITZ, TITSIZ, TITCON(5), REVLEV, REDUCE(5), XFR
     *M12(12), XFRM13(12), XFRM14(12), XFRM23(12), XFRM24(12), XFRM34(6
     *), XVARSX(20), CIRSIZ(2,3), ASIZE, AFLARE, SMSZDF, ORAXES(3), EY
     *EDIR(3), VUEDIR(3), VUECEN(3), VERTCL(3), EYESEP, SCRD, SCRZ, EYE
     *DIS, EYEPNT(3), XYPART(2, 2), BARSIZ(3), BARBRK(3), TIKSIZ(3), XY
     *ZBAS(3), TTHETA, TPHI, FRELBL(4), PATRN(20,30), SCLPRM(10,3), WI
     *NDOW(4), SCREEN(2), SYMBOL, NOSYMB, FACTXY(19), LBLSIZ, SYMSIZ, X
     *YZLIM(3,2), WORLD(3), RADRMX, RADRMN, RADAMN, RADANG, RADX0, RADY
     *0, XUNUSD(6), AXANG(3), REDFAC, DSCAL, PATSZ, MARGIN(4), PSCR(2
     *), OREAL, OCPU, CSCRD, DATPTS, ERRPTS, DATXMN, DATXMX, DATYMN, DA
     *TYMX, DATZMN, DATZMX, DATSUM, ERRSUM, DATAVE, ERRAVE, DATCEN, ERR
     *CEN, DATSTD, ERRSTD, WINREL(2,2,NWINLEV),WINABS(2,2,NWINLEV),WINL
     *IM(2,2), FMARKER(3,8), SYDIR(3), GRDIR(3), EXYZLIM(3,2), DSLOPE(2
     *,2)
      REAL PLOT_EXTENT(2,2),FILL_ANGLE(MAX_FILL),FILL_WIDTH(MAX_FILL)
      INTEGER FILL_INDEX, FILL_TEX(MAX_FILL), N_LINES(6)
      EQUIVALENCE (DATDAT, DATPTS)
      INTEGER MAXREP
      PARAMETER (MAXREP=5)
      INTEGER IPATRN, NPATRN(30), NXYLIM(3,2), NPLOTS, NCSETS, NCCOL, N
     *CROW, IYEAR, IMONTH, IDAY, ISIGFG, ITXPRI, ITXSEC, ITITDT(3), L
     *ENCRD, IPROP, IHTEX, IBLINK, IERASE, ITCNTR, IUNUSD, NXYZ1(3), 
     *NXYZ2(3), LBLFMT(3), LBLCHR(3), NDIMNS(3), IBLKTP, IDIMNS, NMES
     *H0, NMESH1, NMESH2, MESH1, MESH2, MESH3, MESH2D, MESHN(3), NMESHN(
     *2), NFIELD, IFIELD(19), NINCR, NPOINT, IVARBL(19), IVPTR(19), I_
     *VORDER(19,2), LINEAR(4), NONLIN(4), MXECHO, LINES, MAXLNS, USRK
     *BD, USRSCR, PLTFIL, LINWID, LINCOL, LINTEX, ICPOIN(3), IREPCT(MA
     *XREP), LEVREP, GRDTYP, GRDTEX, OUTTEX, IAXTEX, TITEX, LETSET, LAB
     *TEX, TICTEX, SHADOWTYP,SHADOWTEX, NXYZDEF1(10), NXYZDEF2(10), IF
     *ILE_CASE ,MAX_SUBST
      INTEGER MAX_CYCLE
      PARAMETER (MAX_CYCLE=20)
      INTEGER N_CYCLE, ITX_CYCLE(MAX_CYCLE)
      REAL SYM_CYCLE(MAX_CYCLE)
      EQUIVALENCE (NMESH1,NMESHN)
      EQUIVALENCE (MESH1,MESHN)
      INTEGER IBUFFR(400)
      REAL BUFFER(400)
      INTEGER NCHSAVE 
      PARAMETER (NCHSAVE=2*512) 
      INTEGER*4 ICHSAVE(NCHSAVE)
      INTEGER*4 IVRPTR(15)
      CHARACTER*512 OUTSTR,C_FILE, C_NAME, C_SELECT
      CHARACTER C_TIT_ESCAPE*1,C_TIT_SUBSTITUTE*2
      INTEGER N_FILE, N_NAME, N_SELECT
      CHARACTER*8 PXNAME
      CHARACTER*64 INPFMT
      LOGICAL LTDATA, OUTSID(4)
      COMMON /T2COM/ PXNAME, REDUCE, TITX, TITY ,XFRM12, XFRM13, XFRM1
     *4, XFRM23 ,XFRM24, XFRM34 ,XVARSX ,TITSIZ, GRDSYM, GRDSIZ, CIRS
     *IZ, ASIZE, AFLARE ,SMSZDF, ORAXES, EYEDIR, VUEDIR, VUECEN ,VERTC
     *L, EYESEP, SCRD, SCRZ, EYEDIS, EYEPNT ,XYPART, BARSIZ, TIKSIZ, XY
     *ZBAS, TTHETA ,TPHI, FRELBL, IPATRN, NPATRN, PATRN ,SCLPRM, WINDO
     *W, SCREEN, SYMBOL, NOSYMB ,FACTXY, LBLSIZ, SYMSIZ, XYZLIM, WORLD 
     *,RADRMX, RADRMN, RADAMN, RADANG, RADX0, RADY0, XUNUSD ,USRKBD, U
     *SRSCR, PLTFIL ,ITITDT, LENCRD ,INPFMT, GRDTYP, LINWID, LINCOL, L
     *INTEX, TITCON, ITCNTR ,IUNUSD, NXYZ1, NXYZ2 ,LBLCHR, NDIMNS, IBL
     *KTP, IDIMNS ,NMESH1, NMESH2, MESH1, MESH2, MESH3, NFIELD ,IFIELD
     *, NINCR ,IVARBL, IVRPTR ,LINEAR, NONLIN ,NPOINT, LETSET ,MXECH
     *O, LINES, MAXLNS ,AXANG, MESH2D, REDFAC, GRDTEX, OUTTEX, IAXTEX, 
     *TITEX, DSCAL ,OUTSTR, IPROP, IHTEX, IBLINK, IERASE, LABTEX, TICTE
     *X, NXYLIM, PATSZ ,MARGIN, PSCR, ITXPRI, ITXSEC, OREAL, OCPU, CSCR
     *D, OUTSID ,TITLIN, TITINX, TITZ, TITX1, TITY1, LTDATA, NPLOTS, RE
     *VLEV ,LBLFMT, IYEAR, IMONTH, IDAY, ISIGFG ,DATPTS, ERRPTS, DATXM
     *N, DATXMX, DATYMN, DATYMX, DATZMN, DATZMX ,DATSUM, ERRSUM, DATAVE
     *, ERRAVE, DATCEN, ERRCEN, DATSTD, ERRSTD ,NCSETS, NCCOL, NCROW, F
     *MARKER, H2STAT, TITFAC, TITLOC, TITMAR ,TIKFAC, IWINLEV, WINREL, 
     *WINABS, WINLIM ,ICPOIN, LEVREP, IREPCT, SYDIR, GRDIR, NMESH0, EXY
     *ZLIM, IVPTR ,TITLMX, NXYZDEF1, NXYZDEF2, IFILE_CASE, N_CYCLE, ITX
     *_CYCLE ,SYM_CYCLE, PLOT_EXTENT, FILL_ANGLE, FILL_WIDTH, FILL_TEX 
     *,FILL_INDEX ,N_LINES ,DSLOPE ,MAX_SUBST, BARBRK ,I_VORDER,SHADOW
     *TYP,SHADOWTEX
      COMMON /T2SCRT/ BUFFER, IBUFFR, N_FILE,N_NAME,N_SELECT, ICHSAVE
      COMMON /T2_CHAR/ C_TIT_ESCAPE,C_TIT_SUBSTITUTE
      COMMON /T2_SCRT/ C_FILE, C_NAME, C_SELECT
      INTEGER JOUFIL, ERRFIL, OUTFIL, DBGFIL, INPFIL, NINMAX
      PARAMETER (NINMAX=20)
      INTEGER NINP(NINMAX)
      COMMON /T2TRBK/NINP, JOUFIL, ERRFIL, OUTFIL, DBGFIL, INPFIL
      CHARACTER*512 STRNG, STJOU
      LOGICAL LTOKEN
      REAL FLOTNG
      INTEGER INTERP, KEYORD, NSTRNG, MAXSTR, NSTJOU, LSTJOU, NTOKEN
      INTEGER*4 INTEG
      COMMON /TOKENC/ INTERP, INTEG, FLOTNG, KEYORD, NSTRNG, MAXSTR, ST
     *RNG, NSTJOU, LSTJOU, STJOU, LTOKEN, NTOKEN
      INTEGER IAXSAV,IDUM
      REAL XYTXT(2,5),XYDEV(2,5)
      INTEGER I
      IF (.NOT.FLAGS(75)) CALL TXDEF2
      IF (.NOT.FLAGS(2)) THEN
      IF (FLAGS(122).or.FLAGS(125)) CALL TXXMT
      CALL T2CWTS(IAXTEX,IAXSAV)
      CALL T2CWTS(OUTTEX,IDUM)
      CALL TXSDEF
      DO 10011 I=1,5
      XYTXT(1,I)=WINDOW(1)
      XYTXT(2,I)=WINDOW(4)
10011 CONTINUE
10012 CONTINUE
      DO 10021 I=2,3
      XYTXT(1,I+1)=WINDOW(3)
      XYTXT(2,I)=WINDOW(2)
10021 CONTINUE
10022 CONTINUE
      CALL T2_SET_EXTENT(XYTXT,5)
      CALL T2XFRM(2,5,XYTXT,LINEAR,XFRM34,2,XYDEV)
      DO 10031 I=1,4
      IF (FLAGS(I+18).AND.FLAGS(I+39)) CALL TXLINX(XYDEV(1,I),2,LINTEX)
      IF (FLAGS(122)) CALL TXXMT
10031 CONTINUE
10032 CONTINUE
      IF (FLAGS(125)) CALL TXXMT
      CALL T2CWTS(IAXSAV,IDUM)
      FLAGS(2)=.true.
      ENDIF
      FLAGS(3)=FLAGS(3) .or. FLAGS(27) .or. (FLAGS(56) .and. .not. FLAGS
     *(134))
      END
      SUBROUTINE T2_SET_EXTENT(XY,N)
      IMPLICIT NONE
      COMMON /T2FLGC/ FLAGS(200), LTRAP,LHANDL,LSYERR,LSCREV
      LOGICAL FLAGS, LTRAP,LHANDL,LSYERR,LSCREV(3)
      INTEGER RELFLAG 
      PARAMETER (RELFLAG=151)
      INTEGER IWINLEV 
      INTEGER NWINLEV , MAX_FILL 
      PARAMETER (NWINLEV =4)
      PARAMETER (MAX_FILL=4)
      REAL GRDSYM, GRDSIZ, DATDAT(2,8), H2STAT(12), TITLIN(4), TITFA
     *C(4), TITLOC(4), TITMAR(4), TITLMX(4), TIKFAC, TITINX, TITX1, TIT
     *Y1, TITX, TITY, TITZ, TITSIZ, TITCON(5), REVLEV, REDUCE(5), XFR
     *M12(12), XFRM13(12), XFRM14(12), XFRM23(12), XFRM24(12), XFRM34(6
     *), XVARSX(20), CIRSIZ(2,3), ASIZE, AFLARE, SMSZDF, ORAXES(3), EY
     *EDIR(3), VUEDIR(3), VUECEN(3), VERTCL(3), EYESEP, SCRD, SCRZ, EYE
     *DIS, EYEPNT(3), XYPART(2, 2), BARSIZ(3), BARBRK(3), TIKSIZ(3), XY
     *ZBAS(3), TTHETA, TPHI, FRELBL(4), PATRN(20,30), SCLPRM(10,3), WI
     *NDOW(4), SCREEN(2), SYMBOL, NOSYMB, FACTXY(19), LBLSIZ, SYMSIZ, X
     *YZLIM(3,2), WORLD(3), RADRMX, RADRMN, RADAMN, RADANG, RADX0, RADY
     *0, XUNUSD(6), AXANG(3), REDFAC, DSCAL, PATSZ, MARGIN(4), PSCR(2
     *), OREAL, OCPU, CSCRD, DATPTS, ERRPTS, DATXMN, DATXMX, DATYMN, DA
     *TYMX, DATZMN, DATZMX, DATSUM, ERRSUM, DATAVE, ERRAVE, DATCEN, ERR
     *CEN, DATSTD, ERRSTD, WINREL(2,2,NWINLEV),WINABS(2,2,NWINLEV),WINL
     *IM(2,2), FMARKER(3,8), SYDIR(3), GRDIR(3), EXYZLIM(3,2), DSLOPE(2
     *,2)
      REAL PLOT_EXTENT(2,2),FILL_ANGLE(MAX_FILL),FILL_WIDTH(MAX_FILL)
      INTEGER FILL_INDEX, FILL_TEX(MAX_FILL), N_LINES(6)
      EQUIVALENCE (DATDAT, DATPTS)
      INTEGER MAXREP
      PARAMETER (MAXREP=5)
      INTEGER IPATRN, NPATRN(30), NXYLIM(3,2), NPLOTS, NCSETS, NCCOL, N
     *CROW, IYEAR, IMONTH, IDAY, ISIGFG, ITXPRI, ITXSEC, ITITDT(3), L
     *ENCRD, IPROP, IHTEX, IBLINK, IERASE, ITCNTR, IUNUSD, NXYZ1(3), 
     *NXYZ2(3), LBLFMT(3), LBLCHR(3), NDIMNS(3), IBLKTP, IDIMNS, NMES
     *H0, NMESH1, NMESH2, MESH1, MESH2, MESH3, MESH2D, MESHN(3), NMESHN(
     *2), NFIELD, IFIELD(19), NINCR, NPOINT, IVARBL(19), IVPTR(19), I_
     *VORDER(19,2), LINEAR(4), NONLIN(4), MXECHO, LINES, MAXLNS, USRK
     *BD, USRSCR, PLTFIL, LINWID, LINCOL, LINTEX, ICPOIN(3), IREPCT(MA
     *XREP), LEVREP, GRDTYP, GRDTEX, OUTTEX, IAXTEX, TITEX, LETSET, LAB
     *TEX, TICTEX, SHADOWTYP,SHADOWTEX, NXYZDEF1(10), NXYZDEF2(10), IF
     *ILE_CASE ,MAX_SUBST
      INTEGER MAX_CYCLE
      PARAMETER (MAX_CYCLE=20)
      INTEGER N_CYCLE, ITX_CYCLE(MAX_CYCLE)
      REAL SYM_CYCLE(MAX_CYCLE)
      EQUIVALENCE (NMESH1,NMESHN)
      EQUIVALENCE (MESH1,MESHN)
      INTEGER IBUFFR(400)
      REAL BUFFER(400)
      INTEGER NCHSAVE 
      PARAMETER (NCHSAVE=2*512) 
      INTEGER*4 ICHSAVE(NCHSAVE)
      INTEGER*4 IVRPTR(15)
      CHARACTER*512 OUTSTR,C_FILE, C_NAME, C_SELECT
      CHARACTER C_TIT_ESCAPE*1,C_TIT_SUBSTITUTE*2
      INTEGER N_FILE, N_NAME, N_SELECT
      CHARACTER*8 PXNAME
      CHARACTER*64 INPFMT
      LOGICAL LTDATA, OUTSID(4)
      COMMON /T2COM/ PXNAME, REDUCE, TITX, TITY ,XFRM12, XFRM13, XFRM1
     *4, XFRM23 ,XFRM24, XFRM34 ,XVARSX ,TITSIZ, GRDSYM, GRDSIZ, CIRS
     *IZ, ASIZE, AFLARE ,SMSZDF, ORAXES, EYEDIR, VUEDIR, VUECEN ,VERTC
     *L, EYESEP, SCRD, SCRZ, EYEDIS, EYEPNT ,XYPART, BARSIZ, TIKSIZ, XY
     *ZBAS, TTHETA ,TPHI, FRELBL, IPATRN, NPATRN, PATRN ,SCLPRM, WINDO
     *W, SCREEN, SYMBOL, NOSYMB ,FACTXY, LBLSIZ, SYMSIZ, XYZLIM, WORLD 
     *,RADRMX, RADRMN, RADAMN, RADANG, RADX0, RADY0, XUNUSD ,USRKBD, U
     *SRSCR, PLTFIL ,ITITDT, LENCRD ,INPFMT, GRDTYP, LINWID, LINCOL, L
     *INTEX, TITCON, ITCNTR ,IUNUSD, NXYZ1, NXYZ2 ,LBLCHR, NDIMNS, IBL
     *KTP, IDIMNS ,NMESH1, NMESH2, MESH1, MESH2, MESH3, NFIELD ,IFIELD
     *, NINCR ,IVARBL, IVRPTR ,LINEAR, NONLIN ,NPOINT, LETSET ,MXECH
     *O, LINES, MAXLNS ,AXANG, MESH2D, REDFAC, GRDTEX, OUTTEX, IAXTEX, 
     *TITEX, DSCAL ,OUTSTR, IPROP, IHTEX, IBLINK, IERASE, LABTEX, TICTE
     *X, NXYLIM, PATSZ ,MARGIN, PSCR, ITXPRI, ITXSEC, OREAL, OCPU, CSCR
     *D, OUTSID ,TITLIN, TITINX, TITZ, TITX1, TITY1, LTDATA, NPLOTS, RE
     *VLEV ,LBLFMT, IYEAR, IMONTH, IDAY, ISIGFG ,DATPTS, ERRPTS, DATXM
     *N, DATXMX, DATYMN, DATYMX, DATZMN, DATZMX ,DATSUM, ERRSUM, DATAVE
     *, ERRAVE, DATCEN, ERRCEN, DATSTD, ERRSTD ,NCSETS, NCCOL, NCROW, F
     *MARKER, H2STAT, TITFAC, TITLOC, TITMAR ,TIKFAC, IWINLEV, WINREL, 
     *WINABS, WINLIM ,ICPOIN, LEVREP, IREPCT, SYDIR, GRDIR, NMESH0, EXY
     *ZLIM, IVPTR ,TITLMX, NXYZDEF1, NXYZDEF2, IFILE_CASE, N_CYCLE, ITX
     *_CYCLE ,SYM_CYCLE, PLOT_EXTENT, FILL_ANGLE, FILL_WIDTH, FILL_TEX 
     *,FILL_INDEX ,N_LINES ,DSLOPE ,MAX_SUBST, BARBRK ,I_VORDER,SHADOW
     *TYP,SHADOWTEX
      COMMON /T2SCRT/ BUFFER, IBUFFR, N_FILE,N_NAME,N_SELECT, ICHSAVE
      COMMON /T2_CHAR/ C_TIT_ESCAPE,C_TIT_SUBSTITUTE
      COMMON /T2_SCRT/ C_FILE, C_NAME, C_SELECT
      INTEGER JOUFIL, ERRFIL, OUTFIL, DBGFIL, INPFIL, NINMAX
      PARAMETER (NINMAX=20)
      INTEGER NINP(NINMAX)
      COMMON /T2TRBK/NINP, JOUFIL, ERRFIL, OUTFIL, DBGFIL, INPFIL
      CHARACTER*512 STRNG, STJOU
      LOGICAL LTOKEN
      REAL FLOTNG
      INTEGER INTERP, KEYORD, NSTRNG, MAXSTR, NSTJOU, LSTJOU, NTOKEN
      INTEGER*4 INTEG
      COMMON /TOKENC/ INTERP, INTEG, FLOTNG, KEYORD, NSTRNG, MAXSTR, ST
     *RNG, NSTJOU, LSTJOU, STJOU, LTOKEN, NTOKEN
      INTEGER N
      REAL XY(2,N)
      INTEGER I,J,K
      DO 10041 I=1,N
      DO 10051 J=1,2
      PLOT_EXTENT(J,1)=MIN(PLOT_EXTENT(J,1),XY(J,I))
      PLOT_EXTENT(J,2)=MAX(PLOT_EXTENT(J,2),XY(J,I))
10051 CONTINUE
10052 CONTINUE
10041 CONTINUE
10042 CONTINUE
      END
      SUBROUTINE T2AXIS(XYZ,IXYZ,VALUES,SCRTCH,NB,NUM,ITICKS,IAXIS,ITICK
     *,ILABEL)
      IMPLICIT NONE
      COMMON /T2FLGC/ FLAGS(200), LTRAP,LHANDL,LSYERR,LSCREV
      LOGICAL FLAGS, LTRAP,LHANDL,LSYERR,LSCREV(3)
      INTEGER RELFLAG 
      PARAMETER (RELFLAG=151)
      INTEGER IWINLEV 
      INTEGER NWINLEV , MAX_FILL 
      PARAMETER (NWINLEV =4)
      PARAMETER (MAX_FILL=4)
      REAL GRDSYM, GRDSIZ, DATDAT(2,8), H2STAT(12), TITLIN(4), TITFA
     *C(4), TITLOC(4), TITMAR(4), TITLMX(4), TIKFAC, TITINX, TITX1, TIT
     *Y1, TITX, TITY, TITZ, TITSIZ, TITCON(5), REVLEV, REDUCE(5), XFR
     *M12(12), XFRM13(12), XFRM14(12), XFRM23(12), XFRM24(12), XFRM34(6
     *), XVARSX(20), CIRSIZ(2,3), ASIZE, AFLARE, SMSZDF, ORAXES(3), EY
     *EDIR(3), VUEDIR(3), VUECEN(3), VERTCL(3), EYESEP, SCRD, SCRZ, EYE
     *DIS, EYEPNT(3), XYPART(2, 2), BARSIZ(3), BARBRK(3), TIKSIZ(3), XY
     *ZBAS(3), TTHETA, TPHI, FRELBL(4), PATRN(20,30), SCLPRM(10,3), WI
     *NDOW(4), SCREEN(2), SYMBOL, NOSYMB, FACTXY(19), LBLSIZ, SYMSIZ, X
     *YZLIM(3,2), WORLD(3), RADRMX, RADRMN, RADAMN, RADANG, RADX0, RADY
     *0, XUNUSD(6), AXANG(3), REDFAC, DSCAL, PATSZ, MARGIN(4), PSCR(2
     *), OREAL, OCPU, CSCRD, DATPTS, ERRPTS, DATXMN, DATXMX, DATYMN, DA
     *TYMX, DATZMN, DATZMX, DATSUM, ERRSUM, DATAVE, ERRAVE, DATCEN, ERR
     *CEN, DATSTD, ERRSTD, WINREL(2,2,NWINLEV),WINABS(2,2,NWINLEV),WINL
     *IM(2,2), FMARKER(3,8), SYDIR(3), GRDIR(3), EXYZLIM(3,2), DSLOPE(2
     *,2)
      REAL PLOT_EXTENT(2,2),FILL_ANGLE(MAX_FILL),FILL_WIDTH(MAX_FILL)
      INTEGER FILL_INDEX, FILL_TEX(MAX_FILL), N_LINES(6)
      EQUIVALENCE (DATDAT, DATPTS)
      INTEGER MAXREP
      PARAMETER (MAXREP=5)
      INTEGER IPATRN, NPATRN(30), NXYLIM(3,2), NPLOTS, NCSETS, NCCOL, N
     *CROW, IYEAR, IMONTH, IDAY, ISIGFG, ITXPRI, ITXSEC, ITITDT(3), L
     *ENCRD, IPROP, IHTEX, IBLINK, IERASE, ITCNTR, IUNUSD, NXYZ1(3), 
     *NXYZ2(3), LBLFMT(3), LBLCHR(3), NDIMNS(3), IBLKTP, IDIMNS, NMES
     *H0, NMESH1, NMESH2, MESH1, MESH2, MESH3, MESH2D, MESHN(3), NMESHN(
     *2), NFIELD, IFIELD(19), NINCR, NPOINT, IVARBL(19), IVPTR(19), I_
     *VORDER(19,2), LINEAR(4), NONLIN(4), MXECHO, LINES, MAXLNS, USRK
     *BD, USRSCR, PLTFIL, LINWID, LINCOL, LINTEX, ICPOIN(3), IREPCT(MA
     *XREP), LEVREP, GRDTYP, GRDTEX, OUTTEX, IAXTEX, TITEX, LETSET, LAB
     *TEX, TICTEX, SHADOWTYP,SHADOWTEX, NXYZDEF1(10), NXYZDEF2(10), IF
     *ILE_CASE ,MAX_SUBST
      INTEGER MAX_CYCLE
      PARAMETER (MAX_CYCLE=20)
      INTEGER N_CYCLE, ITX_CYCLE(MAX_CYCLE)
      REAL SYM_CYCLE(MAX_CYCLE)
      EQUIVALENCE (NMESH1,NMESHN)
      EQUIVALENCE (MESH1,MESHN)
      INTEGER IBUFFR(400)
      REAL BUFFER(400)
      INTEGER NCHSAVE 
      PARAMETER (NCHSAVE=2*512) 
      INTEGER*4 ICHSAVE(NCHSAVE)
      INTEGER*4 IVRPTR(15)
      CHARACTER*512 OUTSTR,C_FILE, C_NAME, C_SELECT
      CHARACTER C_TIT_ESCAPE*1,C_TIT_SUBSTITUTE*2
      INTEGER N_FILE, N_NAME, N_SELECT
      CHARACTER*8 PXNAME
      CHARACTER*64 INPFMT
      LOGICAL LTDATA, OUTSID(4)
      COMMON /T2COM/ PXNAME, REDUCE, TITX, TITY ,XFRM12, XFRM13, XFRM1
     *4, XFRM23 ,XFRM24, XFRM34 ,XVARSX ,TITSIZ, GRDSYM, GRDSIZ, CIRS
     *IZ, ASIZE, AFLARE ,SMSZDF, ORAXES, EYEDIR, VUEDIR, VUECEN ,VERTC
     *L, EYESEP, SCRD, SCRZ, EYEDIS, EYEPNT ,XYPART, BARSIZ, TIKSIZ, XY
     *ZBAS, TTHETA ,TPHI, FRELBL, IPATRN, NPATRN, PATRN ,SCLPRM, WINDO
     *W, SCREEN, SYMBOL, NOSYMB ,FACTXY, LBLSIZ, SYMSIZ, XYZLIM, WORLD 
     *,RADRMX, RADRMN, RADAMN, RADANG, RADX0, RADY0, XUNUSD ,USRKBD, U
     *SRSCR, PLTFIL ,ITITDT, LENCRD ,INPFMT, GRDTYP, LINWID, LINCOL, L
     *INTEX, TITCON, ITCNTR ,IUNUSD, NXYZ1, NXYZ2 ,LBLCHR, NDIMNS, IBL
     *KTP, IDIMNS ,NMESH1, NMESH2, MESH1, MESH2, MESH3, NFIELD ,IFIELD
     *, NINCR ,IVARBL, IVRPTR ,LINEAR, NONLIN ,NPOINT, LETSET ,MXECH
     *O, LINES, MAXLNS ,AXANG, MESH2D, REDFAC, GRDTEX, OUTTEX, IAXTEX, 
     *TITEX, DSCAL ,OUTSTR, IPROP, IHTEX, IBLINK, IERASE, LABTEX, TICTE
     *X, NXYLIM, PATSZ ,MARGIN, PSCR, ITXPRI, ITXSEC, OREAL, OCPU, CSCR
     *D, OUTSID ,TITLIN, TITINX, TITZ, TITX1, TITY1, LTDATA, NPLOTS, RE
     *VLEV ,LBLFMT, IYEAR, IMONTH, IDAY, ISIGFG ,DATPTS, ERRPTS, DATXM
     *N, DATXMX, DATYMN, DATYMX, DATZMN, DATZMX ,DATSUM, ERRSUM, DATAVE
     *, ERRAVE, DATCEN, ERRCEN, DATSTD, ERRSTD ,NCSETS, NCCOL, NCROW, F
     *MARKER, H2STAT, TITFAC, TITLOC, TITMAR ,TIKFAC, IWINLEV, WINREL, 
     *WINABS, WINLIM ,ICPOIN, LEVREP, IREPCT, SYDIR, GRDIR, NMESH0, EXY
     *ZLIM, IVPTR ,TITLMX, NXYZDEF1, NXYZDEF2, IFILE_CASE, N_CYCLE, ITX
     *_CYCLE ,SYM_CYCLE, PLOT_EXTENT, FILL_ANGLE, FILL_WIDTH, FILL_TEX 
     *,FILL_INDEX ,N_LINES ,DSLOPE ,MAX_SUBST, BARBRK ,I_VORDER,SHADOW
     *TYP,SHADOWTEX
      COMMON /T2SCRT/ BUFFER, IBUFFR, N_FILE,N_NAME,N_SELECT, ICHSAVE
      COMMON /T2_CHAR/ C_TIT_ESCAPE,C_TIT_SUBSTITUTE
      COMMON /T2_SCRT/ C_FILE, C_NAME, C_SELECT
      INTEGER JOUFIL, ERRFIL, OUTFIL, DBGFIL, INPFIL, NINMAX
      PARAMETER (NINMAX=20)
      INTEGER NINP(NINMAX)
      COMMON /T2TRBK/NINP, JOUFIL, ERRFIL, OUTFIL, DBGFIL, INPFIL
      CHARACTER*512 STRNG, STJOU
      LOGICAL LTOKEN
      REAL FLOTNG
      INTEGER INTERP, KEYORD, NSTRNG, MAXSTR, NSTJOU, LSTJOU, NTOKEN
      INTEGER*4 INTEG
      COMMON /TOKENC/ INTERP, INTEG, FLOTNG, KEYORD, NSTRNG, MAXSTR, ST
     *RNG, NSTJOU, LSTJOU, STJOU, LTOKEN, NTOKEN
      INTEGER IXYZ,NB,ITICKS(*),ITICK,IAXIS,ILABEL,NUM
      REAL XYZ(3,2),VALUES(*),SCRTCH(*)
      INTEGER MAXLAB
      PARAMETER (MAXLAB=10)
      CHARACTER*20 TEX(2,MAXLAB)
      CHARACTER*20 TEXT,CASE
      EQUIVALENCE (TEXT,TEX(1,1)),(CASE,TEX(2,1))
      INTEGER LEFT(MAXLAB),IHIDE
      REAL SIZLBL(MAXLAB)
      REAL T,TEMP,TICK,COSTX,SINTX,VM,SCHSIZ,CHSIZ,STRLEN,POSX2
      REAL TXXCSZ
      INTEGER II,I,J,K,L,IPLACE,IW,IWID,ITIK,IOFF,IFIRST,LAST,IAXSAV
      INTEGER LSAVTX,IDUM
      INTEGER LFTADJ,NCHAR,NTEXT,NCASE,IFIR,IC1,IC2
      REAL XY(2,4),TVAL(8),PNT(3,4),POSLBL(3),ALONG(3),UPDIR(3), XYZWRL(
     *3,2),XYTXT(2,2),XYPNT(2,2)
      INTEGER IAX1,IAX2,IAX3,IAX(4)
      INTEGER IAND
      REAL RAD
      PARAMETER (RAD=3.14159265/180.)
      DATA IAX/2,3,1,2/  
      IAX1=IAND(3,IXYZ)
      IHIDE=IAND(IXYZ,4)
      IF (FLAGS(122)) CALL TXXMT
      CALL T2CWTS(IAXTEX,IAXSAV)
      TICK=ABS(TIKSIZ(1))
      DO 10061 I=1,3
      POSLBL(I)=XYZ(I,1)
10061 CONTINUE
10062 CONTINUE
      VM= AMAX1(ABS(XYZ(IAX1,1)),ABS(XYZ(IAX1,2)))
      IPLACE=ALOG10(VM)
      IWID=6-1-IPLACE
      IWID=MIN(MAX(IWID,0),9)
      IF (FLAGS(56)) THEN
      CALL T2XFRM(3,2,XYZ,NONLIN,XFRM12,3,XYZWRL)
      COSTX=1.0
      SINTX=0.0
      CALL T2AXST(XYZWRL,IAX1,IAX2,IAX3,COSTX)
      IF (IAX2.GT.0) THEN
      IF (ABS(AXANG(IAX1)) .le. 360.) THEN
      IAX2=IAX(IAX1)
      IAX3=IAX(IAX1+1)
      COSTX=COS(AXANG(IAX1)*RAD)
      SINTX=SIN(AXANG(IAX1)*RAD)
      ENDIF
      DO 10071 I=1,NUM
      POSLBL(IAX1)=VALUES(I)
      CALL T2XFRM(3,1,POSLBL,NONLIN,XFRM12,3,ALONG)
      SCRTCH(I)=ALONG(IAX1)
10071 CONTINUE
10072 CONTINUE
      CALL TXSCIS(2)
      IF (IAXIS.NE.0) THEN
      CALL TXSDEF
      CALL T2XFRM(3,2,XYZWRL,LINEAR,XFRM24,2,XY)
      CALL T2_MESH_DRAW(XY,2,2+IHIDE)
      ENDIF
      IF (ITICK.NE.0) THEN
      IF (FLAGS(124)) CALL TXXMT
      CALL T2CWTS(TICTEX,LSAVTX)
      CALL TXSDEF
      TEMP=TICK*COSTX
      TVAL(1)=XYZWRL(IAX2,1)+TEMP
      TVAL(2)=XYZWRL(IAX2,1)-TEMP
      TVAL(3)=XYZWRL(IAX2,1)+TIKFAC*TEMP
      TVAL(4)=XYZWRL(IAX2,1)-TIKFAC*TEMP
      TEMP=TICK*SINTX
      TVAL(5)=XYZWRL(IAX3,1)+TEMP
      TVAL(6)=XYZWRL(IAX3,1)-TEMP
      TVAL(7)=XYZWRL(IAX3,1)+TIKFAC*TEMP
      TVAL(8)=XYZWRL(IAX3,1)-TIKFAC*TEMP
      DO 10081 I=1,NUM
      IF ((IABS(ITICKS(I)).LT.5 .AND. ITICKS(I).NE.0) .or. IABS(ITICKS(I
     *)).eq.8.or.IABS(ITICKS(I)).eq.9 .or.ITICKS(I).gt.0) THEN
      J=2+ISIGN(1,ITICKS(I))
      PNT(IAX2,1)=TVAL(J)
      PNT(IAX2,2)=TVAL(J+1)
      PNT(IAX3,1)=TVAL(J+4)
      PNT(IAX3,2)=TVAL(J+5)
      PNT(IAX1,1)=SCRTCH(I)
      PNT(IAX1,2)=PNT(IAX1,1)
      CALL T2XFRM(3,2,PNT,LINEAR,XFRM24,2,XY)
      CALL T2_MESH_DRAW(XY,2,2+IHIDE)
      ENDIF
10081 CONTINUE
10082 CONTINUE
      IF (FLAGS(124)) CALL TXXMT
      CALL T2CWTS(LSAVTX,IDUM)
      ENDIF
      IF (ILABEL.GT.0) THEN
      IF (FLAGS(123)) CALL TXXMT
      CALL T2CWTS(LABTEX,IDUM)
      CALL TXSDEF
      POSLBL(IAX2)=XYZWRL(IAX2,1)  -(0.1*ABS(LBLSIZ)+TIKFAC*TICK)*COSTX
      POSLBL(IAX3)=XYZWRL(IAX3,1)  -(0.1*ABS(LBLSIZ)+TIKFAC*TICK)*SINTX
      DO 10091 I=1,3
      ALONG(I)=0.
      UPDIR(I)=0.
10091 CONTINUE
10092 CONTINUE
      ALONG(IAX1)=ABS(LBLSIZ)
      UPDIR(IAX2)=1.*ABS(COSTX)
      UPDIR(IAX3)=1.*ABS(SINTX)
      DO 10101 ITIK=1,NUM
      II=IABS(ITICKS(ITIK))
      IF (II.GT.1) THEN
      IF (II.eq.2) THEN
      IW=IWID
      ELSE
      IW=6
      ENDIF
      CALL T2TLAB(II,VALUES(ITIK),SCLPRM(1,IAX1),IW,1, TEXT,NTEXT,CASE,N
     *CASE,IFIRST)
      POSLBL(IAX1)= SCRTCH(ITIK)
      CALL TX3TXT(POSLBL,ALONG,UPDIR, TEXT(1:NTEXT),CASE(1:NCASE),1+IHID
     *E)
      ENDIF
10101 CONTINUE
10102 CONTINUE
      IF (FLAGS(124)) CALL TXXMT
      ENDIF
      CALL TXSCIS(1)
      ENDIF
      ELSEIF (IAX1.NE.3) THEN
      IAX2=3-IAX1
      CALL T2XFRM(3,2,XYZ,NONLIN,XFRM13,2,XYTXT)
      DO 10111 I=1,NUM
      POSLBL(IAX1)=VALUES(I)
      CALL T2XFRM(3,1,POSLBL,NONLIN,XFRM13,2,ALONG)
      SCRTCH(I)=ALONG(IAX1)
10111 CONTINUE
10112 CONTINUE
      CALL TXSCIS(2)
      DO 10121 I=1,2
      DO 10131 J=1,2
      XYPNT(J,I)=XYTXT(J,I)
10131 CONTINUE
10132 CONTINUE
10121 CONTINUE
10122 CONTINUE
      IF (IAXIS.NE.0) THEN
      CALL T2_SET_EXTENT(XYPNT,2)
      CALL T2XFRM(2,2,XYTXT,LINEAR,XFRM34,2,XY)
      CALL T2_MESH_DRAW(XY,2,2+IHIDE)
      ENDIF
      IF (ITICK.NE.0 .AND. NUM.GT.0) THEN
      CALL T2CWTS(TICTEX,LSAVTX)
      CALL TXSDEF
      DO 10141 I=1,4
      TVAL(I)=XYTXT(IAX2,1)
10141 CONTINUE
10142 CONTINUE
      IF (ABS(ILABEL) .le. 2) THEN
      TVAL(1)=XYTXT(IAX2,1)+TICK
      TVAL(3)=XYTXT(IAX2,1)+TIKFAC*TICK
      ELSE
      TVAL(2)=XYTXT(IAX2,1)-TICK
      TVAL(4)=XYTXT(IAX2,1)-TIKFAC*TICK
      ENDIF
      DO 10151 I=1,NUM
      IF ((IABS(ITICKS(I)).LT.5 .AND. ITICKS(I).NE.0) .or. IABS(ITICKS(I
     *)).eq.8.or.IABS(ITICKS(I)).eq.9 .or. ITICKS(I).gt.0) THEN
      J=2+ISIGN(1,ITICKS(I))
      IOFF=MOD(I,2)
      XYPNT(IAX2,1)=TVAL(J+IOFF)
      XYPNT(IAX2,2)=TVAL(J+1-IOFF)
      XYPNT(IAX1,1)=SCRTCH(I)
      XYPNT(IAX1,2)=XYPNT(IAX1,1)
      CALL T2XFRM(2,2,XYPNT,LINEAR,XFRM34,2,XY)
      CALL T2_MESH_DRAW(XY,2,2+IHIDE)
      ENDIF
10151 CONTINUE
10152 CONTINUE
      CALL T2CWTS(LSAVTX,IDUM)
      ENDIF
      CALL TXSCIS(1)
      IF (ILABEL.GT.0 .AND. NUM.GT.0) THEN
      IF (FLAGS(124)) CALL TXXMT
      CALL T2CWTS(LABTEX,IDUM)
      CALL TXSDEF
      SCHSIZ=0.1*REDUCE(2)*LBLSIZ
      IFIRST=20
      LAST=1
      K=0
      DO 10161 ITIK=1,NUM
      II=IABS(ITICKS(ITIK))
      IF (II.gt.1) THEN
      K=MIN(K+1,MAXLAB)
      IF (II.eq.2) THEN
      LFTADJ=0
      ELSE
      LFTADJ=1
      ENDIF
      CALL T2TLAB(II,VALUES(ITIK),SCLPRM(1,IAX1),IWID,LFTADJ, TEX(1,K),N
     *TEXT,TEX(2,K),NCASE,IFIR)
      IF (II.EQ.2) THEN
      LEFT(K)=IFIR
      IFIRST=MIN(IFIR,IFIRST)
      LAST=MAX(NTEXT,LAST)
      ELSE
      LEFT(K)=NTEXT
      ENDIF
      ENDIF
10161 CONTINUE
10162 CONTINUE
      NCHAR=LAST-IFIRST+1
      CHSIZ=ABS(SCHSIZ)
      STRLEN=0
      IF (ILABEL.EQ.1) THEN
      POSX2=XYTXT(1,1)-FRELBL(1)*CHSIZ
      ELSEIF (ILABEL.EQ.2) THEN
      POSLBL(2)=XYTXT(2,1)-(FRELBL(2)+0.2)*CHSIZ
      ELSEIF (ILABEL.EQ.3) THEN
      POSX2=XYTXT(1,2)+FRELBL(3)*CHSIZ
      STRLEN=(NCHAR-1)*CHSIZ
      ELSE
      POSLBL(2)=XYTXT(2,2)+FRELBL(4)*CHSIZ
      ENDIF
      K=0
      DO 10171 ITIK=1,NUM
      II=IABS(ITICKS(ITIK))
      IF (II.GT.1) THEN
      K=MIN(K+1,MAXLAB)
      IF (K.ge.MAXLAB) THEN
      IF (II.EQ.2) THEN
      J=0
      ELSE
      J=1
      ENDIF
      CALL T2TLAB(II,VALUES(ITIK),SCLPRM(1,IAX1),IWID,J, TEX(1,K),LEFT(K
     *),TEX(2,K),NCASE,IFIR)
      IF (II.EQ.2) THEN
      LEFT(K)=IFIR
      ENDIF
      ENDIF
      IF (II.ne.2) THEN
      IC1=1
      IC2=LEFT(K)
      ELSEIF (IAX1.eq.2) THEN
      IC1=IFIRST
      IC2=LAST
      ELSE
      IC1=LEFT(K)
      IC2=LAST
      ENDIF
      POSLBL(IAX1)=SCRTCH(ITIK)
      T=TXXCSZ(TEX(1,K)(IC1:IC2),TEX(2,K)(IC1:IC2),SCHSIZ)
      STRLEN=MAX(T,STRLEN)
      IF (ILABEL.eq.1) THEN
      POSLBL(1)=POSX2-T
      ELSEIF (ILABEL.eq.3) THEN
      POSLBL(1)=POSX2
      IF (II.eq.2) POSLBL(1)=POSLBL(1)+(NCHAR-1)*CHSIZ-T
      ELSE
      POSLBL(1)=POSLBL(1)-T/2
      ENDIF
      CALL T2XFRM(2,1,POSLBL,LINEAR,XFRM34,2,XY)
      CALL TXTEXT(XY(1,1),XY(2,1),LBLSIZ,0., TEX(1,K)(IC1:IC2), TEX(2,K)
     *(IC1:IC2))
      DO 10181 I=2,3
      DO 10191 J=1,2
      XY(J,I)=POSLBL(J)-SCHSIZ
10191 CONTINUE
10192 CONTINUE
      SCHSIZ=-SCHSIZ
10181 CONTINUE
10182 CONTINUE
      J=2-MOD(ILABEL,2)
      I=(ILABEL+6)/4
      XY(J,I)=XY(J,I)+(2*I-3)*T
      CALL T2_SET_EXTENT(XY(1,2),2)
      ENDIF
10171 CONTINUE
10172 CONTINUE
      IF (IAX1.eq.2 .and. LBLCHR(2).lt.0) THEN
      T= STRLEN/CHSIZ+1
      T= MAX(0.0,CHSIZ*(ABS(LBLCHR(2))-T))
      DO 10201 J=1,3,2
      IF (FLAGS(18+J) .and. FLAGS(35+J).and.TITLOC(J).gt.0) TITLOC(J)=-(
     *TITLOC(J)+T)
      T=-T
10201 CONTINUE
10202 CONTINUE
      ENDIF
      IF (FLAGS(124)) CALL TXXMT
      ENDIF
      ENDIF
      CALL T2_MESH_FLUSH
      IF (FLAGS(122)) CALL TXXMT
      CALL T2CWTS(IAXSAV,IDUM)
      END
      INTEGER FUNCTION T2_GET_AXIS_SIDE(IXYZ)
      IMPLICIT NONE
      INTEGER IXYZ,IXYZ1,I,J
      COMMON /T2FLGC/ FLAGS(200), LTRAP,LHANDL,LSYERR,LSCREV
      LOGICAL FLAGS, LTRAP,LHANDL,LSYERR,LSCREV(3)
      INTEGER RELFLAG 
      PARAMETER (RELFLAG=151)
      INTEGER IWINLEV 
      INTEGER NWINLEV , MAX_FILL 
      PARAMETER (NWINLEV =4)
      PARAMETER (MAX_FILL=4)
      REAL GRDSYM, GRDSIZ, DATDAT(2,8), H2STAT(12), TITLIN(4), TITFA
     *C(4), TITLOC(4), TITMAR(4), TITLMX(4), TIKFAC, TITINX, TITX1, TIT
     *Y1, TITX, TITY, TITZ, TITSIZ, TITCON(5), REVLEV, REDUCE(5), XFR
     *M12(12), XFRM13(12), XFRM14(12), XFRM23(12), XFRM24(12), XFRM34(6
     *), XVARSX(20), CIRSIZ(2,3), ASIZE, AFLARE, SMSZDF, ORAXES(3), EY
     *EDIR(3), VUEDIR(3), VUECEN(3), VERTCL(3), EYESEP, SCRD, SCRZ, EYE
     *DIS, EYEPNT(3), XYPART(2, 2), BARSIZ(3), BARBRK(3), TIKSIZ(3), XY
     *ZBAS(3), TTHETA, TPHI, FRELBL(4), PATRN(20,30), SCLPRM(10,3), WI
     *NDOW(4), SCREEN(2), SYMBOL, NOSYMB, FACTXY(19), LBLSIZ, SYMSIZ, X
     *YZLIM(3,2), WORLD(3), RADRMX, RADRMN, RADAMN, RADANG, RADX0, RADY
     *0, XUNUSD(6), AXANG(3), REDFAC, DSCAL, PATSZ, MARGIN(4), PSCR(2
     *), OREAL, OCPU, CSCRD, DATPTS, ERRPTS, DATXMN, DATXMX, DATYMN, DA
     *TYMX, DATZMN, DATZMX, DATSUM, ERRSUM, DATAVE, ERRAVE, DATCEN, ERR
     *CEN, DATSTD, ERRSTD, WINREL(2,2,NWINLEV),WINABS(2,2,NWINLEV),WINL
     *IM(2,2), FMARKER(3,8), SYDIR(3), GRDIR(3), EXYZLIM(3,2), DSLOPE(2
     *,2)
      REAL PLOT_EXTENT(2,2),FILL_ANGLE(MAX_FILL),FILL_WIDTH(MAX_FILL)
      INTEGER FILL_INDEX, FILL_TEX(MAX_FILL), N_LINES(6)
      EQUIVALENCE (DATDAT, DATPTS)
      INTEGER MAXREP
      PARAMETER (MAXREP=5)
      INTEGER IPATRN, NPATRN(30), NXYLIM(3,2), NPLOTS, NCSETS, NCCOL, N
     *CROW, IYEAR, IMONTH, IDAY, ISIGFG, ITXPRI, ITXSEC, ITITDT(3), L
     *ENCRD, IPROP, IHTEX, IBLINK, IERASE, ITCNTR, IUNUSD, NXYZ1(3), 
     *NXYZ2(3), LBLFMT(3), LBLCHR(3), NDIMNS(3), IBLKTP, IDIMNS, NMES
     *H0, NMESH1, NMESH2, MESH1, MESH2, MESH3, MESH2D, MESHN(3), NMESHN(
     *2), NFIELD, IFIELD(19), NINCR, NPOINT, IVARBL(19), IVPTR(19), I_
     *VORDER(19,2), LINEAR(4), NONLIN(4), MXECHO, LINES, MAXLNS, USRK
     *BD, USRSCR, PLTFIL, LINWID, LINCOL, LINTEX, ICPOIN(3), IREPCT(MA
     *XREP), LEVREP, GRDTYP, GRDTEX, OUTTEX, IAXTEX, TITEX, LETSET, LAB
     *TEX, TICTEX, SHADOWTYP,SHADOWTEX, NXYZDEF1(10), NXYZDEF2(10), IF
     *ILE_CASE ,MAX_SUBST
      INTEGER MAX_CYCLE
      PARAMETER (MAX_CYCLE=20)
      INTEGER N_CYCLE, ITX_CYCLE(MAX_CYCLE)
      REAL SYM_CYCLE(MAX_CYCLE)
      EQUIVALENCE (NMESH1,NMESHN)
      EQUIVALENCE (MESH1,MESHN)
      INTEGER IBUFFR(400)
      REAL BUFFER(400)
      INTEGER NCHSAVE 
      PARAMETER (NCHSAVE=2*512) 
      INTEGER*4 ICHSAVE(NCHSAVE)
      INTEGER*4 IVRPTR(15)
      CHARACTER*512 OUTSTR,C_FILE, C_NAME, C_SELECT
      CHARACTER C_TIT_ESCAPE*1,C_TIT_SUBSTITUTE*2
      INTEGER N_FILE, N_NAME, N_SELECT
      CHARACTER*8 PXNAME
      CHARACTER*64 INPFMT
      LOGICAL LTDATA, OUTSID(4)
      COMMON /T2COM/ PXNAME, REDUCE, TITX, TITY ,XFRM12, XFRM13, XFRM1
     *4, XFRM23 ,XFRM24, XFRM34 ,XVARSX ,TITSIZ, GRDSYM, GRDSIZ, CIRS
     *IZ, ASIZE, AFLARE ,SMSZDF, ORAXES, EYEDIR, VUEDIR, VUECEN ,VERTC
     *L, EYESEP, SCRD, SCRZ, EYEDIS, EYEPNT ,XYPART, BARSIZ, TIKSIZ, XY
     *ZBAS, TTHETA ,TPHI, FRELBL, IPATRN, NPATRN, PATRN ,SCLPRM, WINDO
     *W, SCREEN, SYMBOL, NOSYMB ,FACTXY, LBLSIZ, SYMSIZ, XYZLIM, WORLD 
     *,RADRMX, RADRMN, RADAMN, RADANG, RADX0, RADY0, XUNUSD ,USRKBD, U
     *SRSCR, PLTFIL ,ITITDT, LENCRD ,INPFMT, GRDTYP, LINWID, LINCOL, L
     *INTEX, TITCON, ITCNTR ,IUNUSD, NXYZ1, NXYZ2 ,LBLCHR, NDIMNS, IBL
     *KTP, IDIMNS ,NMESH1, NMESH2, MESH1, MESH2, MESH3, NFIELD ,IFIELD
     *, NINCR ,IVARBL, IVRPTR ,LINEAR, NONLIN ,NPOINT, LETSET ,MXECH
     *O, LINES, MAXLNS ,AXANG, MESH2D, REDFAC, GRDTEX, OUTTEX, IAXTEX, 
     *TITEX, DSCAL ,OUTSTR, IPROP, IHTEX, IBLINK, IERASE, LABTEX, TICTE
     *X, NXYLIM, PATSZ ,MARGIN, PSCR, ITXPRI, ITXSEC, OREAL, OCPU, CSCR
     *D, OUTSID ,TITLIN, TITINX, TITZ, TITX1, TITY1, LTDATA, NPLOTS, RE
     *VLEV ,LBLFMT, IYEAR, IMONTH, IDAY, ISIGFG ,DATPTS, ERRPTS, DATXM
     *N, DATXMX, DATYMN, DATYMX, DATZMN, DATZMX ,DATSUM, ERRSUM, DATAVE
     *, ERRAVE, DATCEN, ERRCEN, DATSTD, ERRSTD ,NCSETS, NCCOL, NCROW, F
     *MARKER, H2STAT, TITFAC, TITLOC, TITMAR ,TIKFAC, IWINLEV, WINREL, 
     *WINABS, WINLIM ,ICPOIN, LEVREP, IREPCT, SYDIR, GRDIR, NMESH0, EXY
     *ZLIM, IVPTR ,TITLMX, NXYZDEF1, NXYZDEF2, IFILE_CASE, N_CYCLE, ITX
     *_CYCLE ,SYM_CYCLE, PLOT_EXTENT, FILL_ANGLE, FILL_WIDTH, FILL_TEX 
     *,FILL_INDEX ,N_LINES ,DSLOPE ,MAX_SUBST, BARBRK ,I_VORDER,SHADOW
     *TYP,SHADOWTEX
      COMMON /T2SCRT/ BUFFER, IBUFFR, N_FILE,N_NAME,N_SELECT, ICHSAVE
      COMMON /T2_CHAR/ C_TIT_ESCAPE,C_TIT_SUBSTITUTE
      COMMON /T2_SCRT/ C_FILE, C_NAME, C_SELECT
      INTEGER JOUFIL, ERRFIL, OUTFIL, DBGFIL, INPFIL, NINMAX
      PARAMETER (NINMAX=20)
      INTEGER NINP(NINMAX)
      COMMON /T2TRBK/NINP, JOUFIL, ERRFIL, OUTFIL, DBGFIL, INPFIL
      CHARACTER*512 STRNG, STJOU
      LOGICAL LTOKEN
      REAL FLOTNG
      INTEGER INTERP, KEYORD, NSTRNG, MAXSTR, NSTJOU, LSTJOU, NTOKEN
      INTEGER*4 INTEG
      COMMON /TOKENC/ INTERP, INTEG, FLOTNG, KEYORD, NSTRNG, MAXSTR, ST
     *RNG, NSTJOU, LSTJOU, STJOU, LTOKEN, NTOKEN
      REAL XYZ(3,2),XYZ2(3,2),XY(2)
      IF (.not. FLAGS(56)) THEN
      T2_GET_AXIS_SIDE=1
      RETURN
      ENDIF
      IXYZ1=MIN(MAX(ABS(IXYZ),1),3)
      DO 10211 J=1,2
      DO 10221 I=1,2
      XYZ(I,J)=(XYZLIM(I,1)+XYZLIM(I,2))/2
10221 CONTINUE
10222 CONTINUE
      XYZ(3,J)=XYZLIM(3,1)
      XYZ(IXYZ1,J)=XYZLIM(IXYZ1,J)
10211 CONTINUE
10212 CONTINUE
      CALL T2XFRM(3,2,XYZ,NONLIN,XFRM12,3,XYZ2)
      IF (IXYZ .eq. 3) THEN
      XY(1)=EYEPNT(3)
      XY(2)=XYZ2(3,1)
      ELSE
      DO 10231 J=1,2
      XY(J)=0
      DO 10241 I=1,3
      XY(J)=XY(J)+(EYEPNT(I)-XYZ2(I,J))**2
10241 CONTINUE
10242 CONTINUE
10231 CONTINUE
10232 CONTINUE
      ENDIF
      IF ((XY(1)-XY(2))*IXYZ .gt. 0) THEN
      T2_GET_AXIS_SIDE=2
      ELSE
      T2_GET_AXIS_SIDE=1
      ENDIF
      END
      SUBROUTINE T2GRID(IGRIDS,BUFFR,JTYPE)
      IMPLICIT NONE
      REAL BUFFR(*)
      INTEGER IGRIDS(3,2),JTYPE
      INTEGER IHIDE,IXYZ,IXYZ1,IXYZ2,IXYZ3,I,J,IMIN,IMAX,ITXSAV,IDUM, MI
     *NX,MAXX,MINY,MAXY,MINZ,MAXZ,IX,IY,IZ
      INTEGER MXYZ,IGRDTYP
      INTEGER T2_GET_AXIS_SIDE
      COMMON /T2FLGC/ FLAGS(200), LTRAP,LHANDL,LSYERR,LSCREV
      LOGICAL FLAGS, LTRAP,LHANDL,LSYERR,LSCREV(3)
      INTEGER RELFLAG 
      PARAMETER (RELFLAG=151)
      INTEGER IWINLEV 
      INTEGER NWINLEV , MAX_FILL 
      PARAMETER (NWINLEV =4)
      PARAMETER (MAX_FILL=4)
      REAL GRDSYM, GRDSIZ, DATDAT(2,8), H2STAT(12), TITLIN(4), TITFA
     *C(4), TITLOC(4), TITMAR(4), TITLMX(4), TIKFAC, TITINX, TITX1, TIT
     *Y1, TITX, TITY, TITZ, TITSIZ, TITCON(5), REVLEV, REDUCE(5), XFR
     *M12(12), XFRM13(12), XFRM14(12), XFRM23(12), XFRM24(12), XFRM34(6
     *), XVARSX(20), CIRSIZ(2,3), ASIZE, AFLARE, SMSZDF, ORAXES(3), EY
     *EDIR(3), VUEDIR(3), VUECEN(3), VERTCL(3), EYESEP, SCRD, SCRZ, EYE
     *DIS, EYEPNT(3), XYPART(2, 2), BARSIZ(3), BARBRK(3), TIKSIZ(3), XY
     *ZBAS(3), TTHETA, TPHI, FRELBL(4), PATRN(20,30), SCLPRM(10,3), WI
     *NDOW(4), SCREEN(2), SYMBOL, NOSYMB, FACTXY(19), LBLSIZ, SYMSIZ, X
     *YZLIM(3,2), WORLD(3), RADRMX, RADRMN, RADAMN, RADANG, RADX0, RADY
     *0, XUNUSD(6), AXANG(3), REDFAC, DSCAL, PATSZ, MARGIN(4), PSCR(2
     *), OREAL, OCPU, CSCRD, DATPTS, ERRPTS, DATXMN, DATXMX, DATYMN, DA
     *TYMX, DATZMN, DATZMX, DATSUM, ERRSUM, DATAVE, ERRAVE, DATCEN, ERR
     *CEN, DATSTD, ERRSTD, WINREL(2,2,NWINLEV),WINABS(2,2,NWINLEV),WINL
     *IM(2,2), FMARKER(3,8), SYDIR(3), GRDIR(3), EXYZLIM(3,2), DSLOPE(2
     *,2)
      REAL PLOT_EXTENT(2,2),FILL_ANGLE(MAX_FILL),FILL_WIDTH(MAX_FILL)
      INTEGER FILL_INDEX, FILL_TEX(MAX_FILL), N_LINES(6)
      EQUIVALENCE (DATDAT, DATPTS)
      INTEGER MAXREP
      PARAMETER (MAXREP=5)
      INTEGER IPATRN, NPATRN(30), NXYLIM(3,2), NPLOTS, NCSETS, NCCOL, N
     *CROW, IYEAR, IMONTH, IDAY, ISIGFG, ITXPRI, ITXSEC, ITITDT(3), L
     *ENCRD, IPROP, IHTEX, IBLINK, IERASE, ITCNTR, IUNUSD, NXYZ1(3), 
     *NXYZ2(3), LBLFMT(3), LBLCHR(3), NDIMNS(3), IBLKTP, IDIMNS, NMES
     *H0, NMESH1, NMESH2, MESH1, MESH2, MESH3, MESH2D, MESHN(3), NMESHN(
     *2), NFIELD, IFIELD(19), NINCR, NPOINT, IVARBL(19), IVPTR(19), I_
     *VORDER(19,2), LINEAR(4), NONLIN(4), MXECHO, LINES, MAXLNS, USRK
     *BD, USRSCR, PLTFIL, LINWID, LINCOL, LINTEX, ICPOIN(3), IREPCT(MA
     *XREP), LEVREP, GRDTYP, GRDTEX, OUTTEX, IAXTEX, TITEX, LETSET, LAB
     *TEX, TICTEX, SHADOWTYP,SHADOWTEX, NXYZDEF1(10), NXYZDEF2(10), IF
     *ILE_CASE ,MAX_SUBST
      INTEGER MAX_CYCLE
      PARAMETER (MAX_CYCLE=20)
      INTEGER N_CYCLE, ITX_CYCLE(MAX_CYCLE)
      REAL SYM_CYCLE(MAX_CYCLE)
      EQUIVALENCE (NMESH1,NMESHN)
      EQUIVALENCE (MESH1,MESHN)
      INTEGER IBUFFR(400)
      REAL BUFFER(400)
      INTEGER NCHSAVE 
      PARAMETER (NCHSAVE=2*512) 
      INTEGER*4 ICHSAVE(NCHSAVE)
      INTEGER*4 IVRPTR(15)
      CHARACTER*512 OUTSTR,C_FILE, C_NAME, C_SELECT
      CHARACTER C_TIT_ESCAPE*1,C_TIT_SUBSTITUTE*2
      INTEGER N_FILE, N_NAME, N_SELECT
      CHARACTER*8 PXNAME
      CHARACTER*64 INPFMT
      LOGICAL LTDATA, OUTSID(4)
      COMMON /T2COM/ PXNAME, REDUCE, TITX, TITY ,XFRM12, XFRM13, XFRM1
     *4, XFRM23 ,XFRM24, XFRM34 ,XVARSX ,TITSIZ, GRDSYM, GRDSIZ, CIRS
     *IZ, ASIZE, AFLARE ,SMSZDF, ORAXES, EYEDIR, VUEDIR, VUECEN ,VERTC
     *L, EYESEP, SCRD, SCRZ, EYEDIS, EYEPNT ,XYPART, BARSIZ, TIKSIZ, XY
     *ZBAS, TTHETA ,TPHI, FRELBL, IPATRN, NPATRN, PATRN ,SCLPRM, WINDO
     *W, SCREEN, SYMBOL, NOSYMB ,FACTXY, LBLSIZ, SYMSIZ, XYZLIM, WORLD 
     *,RADRMX, RADRMN, RADAMN, RADANG, RADX0, RADY0, XUNUSD ,USRKBD, U
     *SRSCR, PLTFIL ,ITITDT, LENCRD ,INPFMT, GRDTYP, LINWID, LINCOL, L
     *INTEX, TITCON, ITCNTR ,IUNUSD, NXYZ1, NXYZ2 ,LBLCHR, NDIMNS, IBL
     *KTP, IDIMNS ,NMESH1, NMESH2, MESH1, MESH2, MESH3, NFIELD ,IFIELD
     *, NINCR ,IVARBL, IVRPTR ,LINEAR, NONLIN ,NPOINT, LETSET ,MXECH
     *O, LINES, MAXLNS ,AXANG, MESH2D, REDFAC, GRDTEX, OUTTEX, IAXTEX, 
     *TITEX, DSCAL ,OUTSTR, IPROP, IHTEX, IBLINK, IERASE, LABTEX, TICTE
     *X, NXYLIM, PATSZ ,MARGIN, PSCR, ITXPRI, ITXSEC, OREAL, OCPU, CSCR
     *D, OUTSID ,TITLIN, TITINX, TITZ, TITX1, TITY1, LTDATA, NPLOTS, RE
     *VLEV ,LBLFMT, IYEAR, IMONTH, IDAY, ISIGFG ,DATPTS, ERRPTS, DATXM
     *N, DATXMX, DATYMN, DATYMX, DATZMN, DATZMX ,DATSUM, ERRSUM, DATAVE
     *, ERRAVE, DATCEN, ERRCEN, DATSTD, ERRSTD ,NCSETS, NCCOL, NCROW, F
     *MARKER, H2STAT, TITFAC, TITLOC, TITMAR ,TIKFAC, IWINLEV, WINREL, 
     *WINABS, WINLIM ,ICPOIN, LEVREP, IREPCT, SYDIR, GRDIR, NMESH0, EXY
     *ZLIM, IVPTR ,TITLMX, NXYZDEF1, NXYZDEF2, IFILE_CASE, N_CYCLE, ITX
     *_CYCLE ,SYM_CYCLE, PLOT_EXTENT, FILL_ANGLE, FILL_WIDTH, FILL_TEX 
     *,FILL_INDEX ,N_LINES ,DSLOPE ,MAX_SUBST, BARBRK ,I_VORDER,SHADOW
     *TYP,SHADOWTEX
      COMMON /T2SCRT/ BUFFER, IBUFFR, N_FILE,N_NAME,N_SELECT, ICHSAVE
      COMMON /T2_CHAR/ C_TIT_ESCAPE,C_TIT_SUBSTITUTE
      COMMON /T2_SCRT/ C_FILE, C_NAME, C_SELECT
      INTEGER JOUFIL, ERRFIL, OUTFIL, DBGFIL, INPFIL, NINMAX
      PARAMETER (NINMAX=20)
      INTEGER NINP(NINMAX)
      COMMON /T2TRBK/NINP, JOUFIL, ERRFIL, OUTFIL, DBGFIL, INPFIL
      CHARACTER*512 STRNG, STJOU
      LOGICAL LTOKEN
      REAL FLOTNG
      INTEGER INTERP, KEYORD, NSTRNG, MAXSTR, NSTJOU, LSTJOU, NTOKEN
      INTEGER*4 INTEG
      COMMON /TOKENC/ INTERP, INTEG, FLOTNG, KEYORD, NSTRNG, MAXSTR, ST
     *RNG, NSTJOU, LSTJOU, STJOU, LTOKEN, NTOKEN
      REAL XYZ(3,4),XYZ2(3,4),XY(2,2),XUP(3,2)
      INTEGER NXYZ(3,2)
      CHARACTER*2 TEXT
      LOGICAL LCYCLE
      INTEGER IAND
      IF (FLAGS(128)) CALL TXXMT
      IHIDE=IAND(JTYPE,4)
      CALL T2CWTS(GRDTEX,ITXSAV)
      CALL TXSDEF
      DO 10251 J=1,2
      DO 10261 I=1,3
      NXYZ(I,J)=IGRIDS(I,J)
10261 CONTINUE
10262 CONTINUE
10251 CONTINUE
10252 CONTINUE
      MINX=IGRIDS(1,1)
      MAXX=IGRIDS(1,2)
      MINY=IGRIDS(2,1)
      MAXY=IGRIDS(2,2)
      MINZ=IGRIDS(3,1)
      MAXZ=IGRIDS(3,2)
      IF (.NOT.FLAGS(56)) THEN
      NXYZ(3,2)=NXYZ(3,1)
      MAXZ=MINZ
      MXYZ=3
      ELSE
      MXYZ=1
      ENDIF
      CALL TXSCIS(2)
      IGRDTYP=IAND(GRDTYP/16,7)
      IF (IGRDTYP .eq. 0 .or. .not. FLAGS(56)) IGRDTYP=7
      DO 10271 IXYZ1=MXYZ,3
      IF (IAND(IGRDTYP,2**(IXYZ1-1)) .ne. 0) THEN
      IF (FLAGS(82)) THEN
      XYZ(IXYZ1,1)=ORAXES(IXYZ1)
      ELSE
      XYZ(IXYZ1,1)=XYZLIM(IXYZ1,T2_GET_AXIS_SIDE(-IXYZ1))
      ENDIF
      XYZ(IXYZ1,2)=XYZ(IXYZ1,1)
      DO 10281 IXYZ=IXYZ1+1,IXYZ1+2
      IXYZ2=MOD(IXYZ-1,3)+1
      IXYZ3=6-IXYZ1-IXYZ2
      DO 10291 I=1,2
      XYZ(IXYZ3,I)=XYZLIM(IXYZ3,I)
10291 CONTINUE
10292 CONTINUE
      IMIN=IGRIDS(IXYZ2,1)
      IMAX=IGRIDS(IXYZ2,2)
      IF (IAND(GRDTYP,2**(IXYZ2-1)).ne.0 .and. IMAX .ge. IMIN) THEN
      LCYCLE=IXYZ2 .eq. 3 .and. IAND(GRDTYP,256) .ne. 0
      DO 10301 IY=IMIN,IMAX
      IF (LCYCLE) THEN
      CALL T2_MESH_FLUSH
      CALL T2CWTS(ITX_CYCLE(MOD(IY-IMIN,N_CYCLE)+1),IDUM)
      CALL TXSDEF
      ENDIF
      XYZ(IXYZ2,1)=BUFFR(IY)
      XYZ(IXYZ2,2)=BUFFR(IY)
      CALL T2XFRM(3,2,XYZ,NONLIN,XFRM14,2,XY)
      CALL T2_MESH_DRAW(XY,2,2+IHIDE)
10301 CONTINUE
10302 CONTINUE
      IF (LCYCLE) THEN
      CALL T2_MESH_FLUSH
      CALL T2CWTS(GRDTEX,IDUM)
      CALL TXSDEF
      ENDIF
      ENDIF
      IF (FLAGS(56) .and. IAND(GRDTYP,128) .ne. 0) THEN
      CALL T2_MESH_FLUSH
      CALL T2CWTS(OUTTEX,IDUM)
      CALL TXSDEF
      DO 10311 I=1,2
      DO 10321 J=1,2
      XYZ(IXYZ2,J)=XYZLIM(IXYZ2,I)
10321 CONTINUE
10322 CONTINUE
      CALL T2XFRM(3,2,XYZ,NONLIN,XFRM14,2,XY)
      CALL T2_MESH_DRAW(XY,2,2+IHIDE)
10311 CONTINUE
10312 CONTINUE
      CALL T2_MESH_FLUSH
      CALL T2CWTS(GRDTEX,IDUM)
      CALL TXSDEF
      ENDIF
10281 CONTINUE
10282 CONTINUE
      ENDIF
10271 CONTINUE
10272 CONTINUE
      IF (IAND(GRDTYP,8).ne.0) THEN
      IF (FLAGS(56)) THEN
      CALL T2GTDR(GRDSIZ,GRDIR,XUP)
      DO 10331 IZ=MINZ,MAXZ
      XYZ(3,1)=BUFFR(IZ)
      DO 10341 IY=MINY,MAXY
      XYZ(2,1)=BUFFR(IY)
      DO 10351 IX=MINX,MAXX
      XYZ(1,1)=BUFFR(IX)
      CALL T2XFRM(3,1,XYZ,NONLIN,XFRM12,3,XY)
      CALL SYMTXT(GRDSYM,TEXT)
      CALL TX3TXT(XY,XUP,XUP(1,2),TEXT(1:1),TEXT(2:2),IHIDE)
10351 CONTINUE
10352 CONTINUE
10341 CONTINUE
10342 CONTINUE
10331 CONTINUE
10332 CONTINUE
      ELSE
      XYZ(3,1)=XYZLIM(3,1)
      DO 10361 IY=MINY,MAXY
      XYZ(2,1)=BUFFR(IY)
      DO 10371 IX=MINX,MAXX
      XYZ(1,1)=BUFFR(IX)
      CALL T2XFRM(3,1,XYZ,NONLIN,XFRM14,2,XY)
      CALL TXTSYM(XY(1,1),XY(2,1),GRDSYM,GRDSIZ)
10371 CONTINUE
10372 CONTINUE
10361 CONTINUE
10362 CONTINUE
      ENDIF
      ENDIF
      CALL T2_MESH_FLUSH
      IF (FLAGS(128)) CALL TXXMT
      CALL TXSCIS(1)
      CALL T2CWTS(ITXSAV,IDUM)
      END
      SUBROUTINE T2STCK(MSCAL,VMIN,VMAX,IN1,IN2,PARMS,MAXN,NUMBER,VALS,T
     *YPE)
      INTEGER MAXN,MSCAL,IN1,IN2,NUMBER,TYPE(MAXN)
      REAL VMIN,VMAX,PARMS(10),VALS(MAXN)
      LOGICAL LTEST
      INTEGER I,J
      REAL BUFFR(10),V,VP,VM,SN,FAC,VMMX
      COMMON /T2FLGC/ FLAGS(200), LTRAP,LHANDL,LSYERR,LSCREV
      LOGICAL FLAGS, LTRAP,LHANDL,LSYERR,LSCREV(3)
      INTEGER RELFLAG 
      PARAMETER (RELFLAG=151)
      INTEGER IWINLEV 
      INTEGER NWINLEV , MAX_FILL 
      PARAMETER (NWINLEV =4)
      PARAMETER (MAX_FILL=4)
      REAL GRDSYM, GRDSIZ, DATDAT(2,8), H2STAT(12), TITLIN(4), TITFA
     *C(4), TITLOC(4), TITMAR(4), TITLMX(4), TIKFAC, TITINX, TITX1, TIT
     *Y1, TITX, TITY, TITZ, TITSIZ, TITCON(5), REVLEV, REDUCE(5), XFR
     *M12(12), XFRM13(12), XFRM14(12), XFRM23(12), XFRM24(12), XFRM34(6
     *), XVARSX(20), CIRSIZ(2,3), ASIZE, AFLARE, SMSZDF, ORAXES(3), EY
     *EDIR(3), VUEDIR(3), VUECEN(3), VERTCL(3), EYESEP, SCRD, SCRZ, EYE
     *DIS, EYEPNT(3), XYPART(2, 2), BARSIZ(3), BARBRK(3), TIKSIZ(3), XY
     *ZBAS(3), TTHETA, TPHI, FRELBL(4), PATRN(20,30), SCLPRM(10,3), WI
     *NDOW(4), SCREEN(2), SYMBOL, NOSYMB, FACTXY(19), LBLSIZ, SYMSIZ, X
     *YZLIM(3,2), WORLD(3), RADRMX, RADRMN, RADAMN, RADANG, RADX0, RADY
     *0, XUNUSD(6), AXANG(3), REDFAC, DSCAL, PATSZ, MARGIN(4), PSCR(2
     *), OREAL, OCPU, CSCRD, DATPTS, ERRPTS, DATXMN, DATXMX, DATYMN, DA
     *TYMX, DATZMN, DATZMX, DATSUM, ERRSUM, DATAVE, ERRAVE, DATCEN, ERR
     *CEN, DATSTD, ERRSTD, WINREL(2,2,NWINLEV),WINABS(2,2,NWINLEV),WINL
     *IM(2,2), FMARKER(3,8), SYDIR(3), GRDIR(3), EXYZLIM(3,2), DSLOPE(2
     *,2)
      REAL PLOT_EXTENT(2,2),FILL_ANGLE(MAX_FILL),FILL_WIDTH(MAX_FILL)
      INTEGER FILL_INDEX, FILL_TEX(MAX_FILL), N_LINES(6)
      EQUIVALENCE (DATDAT, DATPTS)
      INTEGER MAXREP
      PARAMETER (MAXREP=5)
      INTEGER IPATRN, NPATRN(30), NXYLIM(3,2), NPLOTS, NCSETS, NCCOL, N
     *CROW, IYEAR, IMONTH, IDAY, ISIGFG, ITXPRI, ITXSEC, ITITDT(3), L
     *ENCRD, IPROP, IHTEX, IBLINK, IERASE, ITCNTR, IUNUSD, NXYZ1(3), 
     *NXYZ2(3), LBLFMT(3), LBLCHR(3), NDIMNS(3), IBLKTP, IDIMNS, NMES
     *H0, NMESH1, NMESH2, MESH1, MESH2, MESH3, MESH2D, MESHN(3), NMESHN(
     *2), NFIELD, IFIELD(19), NINCR, NPOINT, IVARBL(19), IVPTR(19), I_
     *VORDER(19,2), LINEAR(4), NONLIN(4), MXECHO, LINES, MAXLNS, USRK
     *BD, USRSCR, PLTFIL, LINWID, LINCOL, LINTEX, ICPOIN(3), IREPCT(MA
     *XREP), LEVREP, GRDTYP, GRDTEX, OUTTEX, IAXTEX, TITEX, LETSET, LAB
     *TEX, TICTEX, SHADOWTYP,SHADOWTEX, NXYZDEF1(10), NXYZDEF2(10), IF
     *ILE_CASE ,MAX_SUBST
      INTEGER MAX_CYCLE
      PARAMETER (MAX_CYCLE=20)
      INTEGER N_CYCLE, ITX_CYCLE(MAX_CYCLE)
      REAL SYM_CYCLE(MAX_CYCLE)
      EQUIVALENCE (NMESH1,NMESHN)
      EQUIVALENCE (MESH1,MESHN)
      INTEGER IBUFFR(400)
      REAL BUFFER(400)
      INTEGER NCHSAVE 
      PARAMETER (NCHSAVE=2*512) 
      INTEGER*4 ICHSAVE(NCHSAVE)
      INTEGER*4 IVRPTR(15)
      CHARACTER*512 OUTSTR,C_FILE, C_NAME, C_SELECT
      CHARACTER C_TIT_ESCAPE*1,C_TIT_SUBSTITUTE*2
      INTEGER N_FILE, N_NAME, N_SELECT
      CHARACTER*8 PXNAME
      CHARACTER*64 INPFMT
      LOGICAL LTDATA, OUTSID(4)
      COMMON /T2COM/ PXNAME, REDUCE, TITX, TITY ,XFRM12, XFRM13, XFRM1
     *4, XFRM23 ,XFRM24, XFRM34 ,XVARSX ,TITSIZ, GRDSYM, GRDSIZ, CIRS
     *IZ, ASIZE, AFLARE ,SMSZDF, ORAXES, EYEDIR, VUEDIR, VUECEN ,VERTC
     *L, EYESEP, SCRD, SCRZ, EYEDIS, EYEPNT ,XYPART, BARSIZ, TIKSIZ, XY
     *ZBAS, TTHETA ,TPHI, FRELBL, IPATRN, NPATRN, PATRN ,SCLPRM, WINDO
     *W, SCREEN, SYMBOL, NOSYMB ,FACTXY, LBLSIZ, SYMSIZ, XYZLIM, WORLD 
     *,RADRMX, RADRMN, RADAMN, RADANG, RADX0, RADY0, XUNUSD ,USRKBD, U
     *SRSCR, PLTFIL ,ITITDT, LENCRD ,INPFMT, GRDTYP, LINWID, LINCOL, L
     *INTEX, TITCON, ITCNTR ,IUNUSD, NXYZ1, NXYZ2 ,LBLCHR, NDIMNS, IBL
     *KTP, IDIMNS ,NMESH1, NMESH2, MESH1, MESH2, MESH3, NFIELD ,IFIELD
     *, NINCR ,IVARBL, IVRPTR ,LINEAR, NONLIN ,NPOINT, LETSET ,MXECH
     *O, LINES, MAXLNS ,AXANG, MESH2D, REDFAC, GRDTEX, OUTTEX, IAXTEX, 
     *TITEX, DSCAL ,OUTSTR, IPROP, IHTEX, IBLINK, IERASE, LABTEX, TICTE
     *X, NXYLIM, PATSZ ,MARGIN, PSCR, ITXPRI, ITXSEC, OREAL, OCPU, CSCR
     *D, OUTSID ,TITLIN, TITINX, TITZ, TITX1, TITY1, LTDATA, NPLOTS, RE
     *VLEV ,LBLFMT, IYEAR, IMONTH, IDAY, ISIGFG ,DATPTS, ERRPTS, DATXM
     *N, DATXMX, DATYMN, DATYMX, DATZMN, DATZMX ,DATSUM, ERRSUM, DATAVE
     *, ERRAVE, DATCEN, ERRCEN, DATSTD, ERRSTD ,NCSETS, NCCOL, NCROW, F
     *MARKER, H2STAT, TITFAC, TITLOC, TITMAR ,TIKFAC, IWINLEV, WINREL, 
     *WINABS, WINLIM ,ICPOIN, LEVREP, IREPCT, SYDIR, GRDIR, NMESH0, EXY
     *ZLIM, IVPTR ,TITLMX, NXYZDEF1, NXYZDEF2, IFILE_CASE, N_CYCLE, ITX
     *_CYCLE ,SYM_CYCLE, PLOT_EXTENT, FILL_ANGLE, FILL_WIDTH, FILL_TEX 
     *,FILL_INDEX ,N_LINES ,DSLOPE ,MAX_SUBST, BARBRK ,I_VORDER,SHADOW
     *TYP,SHADOWTEX
      COMMON /T2SCRT/ BUFFER, IBUFFR, N_FILE,N_NAME,N_SELECT, ICHSAVE
      COMMON /T2_CHAR/ C_TIT_ESCAPE,C_TIT_SUBSTITUTE
      COMMON /T2_SCRT/ C_FILE, C_NAME, C_SELECT
      INTEGER JOUFIL, ERRFIL, OUTFIL, DBGFIL, INPFIL, NINMAX
      PARAMETER (NINMAX=20)
      INTEGER NINP(NINMAX)
      COMMON /T2TRBK/NINP, JOUFIL, ERRFIL, OUTFIL, DBGFIL, INPFIL
      CHARACTER*512 STRNG, STJOU
      LOGICAL LTOKEN
      REAL FLOTNG
      INTEGER INTERP, KEYORD, NSTRNG, MAXSTR, NSTJOU, LSTJOU, NTOKEN
      INTEGER*4 INTEG
      COMMON /TOKENC/ INTERP, INTEG, FLOTNG, KEYORD, NSTRNG, MAXSTR, ST
     *RNG, NSTJOU, LSTJOU, STJOU, LTOKEN, NTOKEN
      INTEGER IAND
      NUMBER=-1
      IF (MSCAL.LT.0) THEN
10380 GOTO (10390,10400,10410,10420,10430,10440,10450,10460),-MSCAL
10390 CONTINUE
10460 CONTINUE
      CALL TDSLIN(VMIN,VMAX,IN1,IN2,PARMS,MAXN,NUMBER,VALS,TYPE)
      GOTO 10382
10400 CONTINUE
      CALL TDSLOG(VMIN,VMAX,IN1,IN2,PARMS,MAXN,NUMBER,VALS,TYPE)
      GOTO 10382
10410 CONTINUE
      CALL TDSLOG(-VMAX,-VMIN,IN1,IN2,PARMS,MAXN, NUMBER,VALS,TYPE)
      DO 10471 I=1,MIN(NUMBER,MAXN)
      VALS(I)=-VALS(I)
10471 CONTINUE
10472 CONTINUE
      GOTO 10382
10430 CONTINUE
      CALL TDSYR(VMIN,VMAX,IN1,IN2,PARMS,MAXN,NUMBER,VALS,TYPE)
      GOTO 10382
10420 CONTINUE
      CALL TDSMON(VMIN,VMAX,IN1,IN2,PARMS,MAXN,NUMBER,VALS,TYPE)
      GOTO 10382
10440 CONTINUE
      CALL TDSNRM(VMIN,VMAX,IN1,IN2,PARMS,MAXN,NUMBER,VALS,TYPE)
      GOTO 10382
10450 CONTINUE
      CALL TDSNDS(VMIN,VMAX,IN1,IN2,PARMS,MAXN,NUMBER,VALS,TYPE)
      GOTO 10382
10382 CONTINUE
      IF (NUMBER.LT.0) CALL TDSLIN(VMIN,VMAX,0,0,PARMS,MAXN,NUMBER,VALS,
     *TYPE)
      ELSE
      CALL TDSLIN(VMIN,VMAX,IN1,IN2,PARMS,MAXN,NUMBER,VALS,TYPE)
      IA1=MSCAL
      A2=VMIN
      A3=VMAX
      IA4=IN1
      IA5=IN2
      DO 10481 I=1,10
      BUFFR(I)=PARMS(I)
10481 CONTINUE
10482 CONTINUE
      CALL TDTICK(IA1,A2,A3,IA4,IA5,BUFFR,NUMBER,VALS,TYPE)
      ENDIF
      IF (NUMBER.le.0) THEN
      CALL T2ERR(0,' ',('*** ERROR *** Can not generate ticks'),3)
      NUMBER=0
      ELSEIF (NUMBER.gt.MAXN+1) THEN
      CALL T2STOP('*** FATAL *** Tick overflow')
      ELSEIF (NUMBER.gt.MAXN) THEN
      NUMBER=MAXN
      CALL T2ERR(0,' ',('*** ERROR *** Too many ticks, truncated'),3)
      ENDIF
      END
      SUBROUTINE T2STLM
      IMPLICIT NONE
      COMMON /T2FLGC/ FLAGS(200), LTRAP,LHANDL,LSYERR,LSCREV
      LOGICAL FLAGS, LTRAP,LHANDL,LSYERR,LSCREV(3)
      INTEGER RELFLAG 
      PARAMETER (RELFLAG=151)
      INTEGER IWINLEV 
      INTEGER NWINLEV , MAX_FILL 
      PARAMETER (NWINLEV =4)
      PARAMETER (MAX_FILL=4)
      REAL GRDSYM, GRDSIZ, DATDAT(2,8), H2STAT(12), TITLIN(4), TITFA
     *C(4), TITLOC(4), TITMAR(4), TITLMX(4), TIKFAC, TITINX, TITX1, TIT
     *Y1, TITX, TITY, TITZ, TITSIZ, TITCON(5), REVLEV, REDUCE(5), XFR
     *M12(12), XFRM13(12), XFRM14(12), XFRM23(12), XFRM24(12), XFRM34(6
     *), XVARSX(20), CIRSIZ(2,3), ASIZE, AFLARE, SMSZDF, ORAXES(3), EY
     *EDIR(3), VUEDIR(3), VUECEN(3), VERTCL(3), EYESEP, SCRD, SCRZ, EYE
     *DIS, EYEPNT(3), XYPART(2, 2), BARSIZ(3), BARBRK(3), TIKSIZ(3), XY
     *ZBAS(3), TTHETA, TPHI, FRELBL(4), PATRN(20,30), SCLPRM(10,3), WI
     *NDOW(4), SCREEN(2), SYMBOL, NOSYMB, FACTXY(19), LBLSIZ, SYMSIZ, X
     *YZLIM(3,2), WORLD(3), RADRMX, RADRMN, RADAMN, RADANG, RADX0, RADY
     *0, XUNUSD(6), AXANG(3), REDFAC, DSCAL, PATSZ, MARGIN(4), PSCR(2
     *), OREAL, OCPU, CSCRD, DATPTS, ERRPTS, DATXMN, DATXMX, DATYMN, DA
     *TYMX, DATZMN, DATZMX, DATSUM, ERRSUM, DATAVE, ERRAVE, DATCEN, ERR
     *CEN, DATSTD, ERRSTD, WINREL(2,2,NWINLEV),WINABS(2,2,NWINLEV),WINL
     *IM(2,2), FMARKER(3,8), SYDIR(3), GRDIR(3), EXYZLIM(3,2), DSLOPE(2
     *,2)
      REAL PLOT_EXTENT(2,2),FILL_ANGLE(MAX_FILL),FILL_WIDTH(MAX_FILL)
      INTEGER FILL_INDEX, FILL_TEX(MAX_FILL), N_LINES(6)
      EQUIVALENCE (DATDAT, DATPTS)
      INTEGER MAXREP
      PARAMETER (MAXREP=5)
      INTEGER IPATRN, NPATRN(30), NXYLIM(3,2), NPLOTS, NCSETS, NCCOL, N
     *CROW, IYEAR, IMONTH, IDAY, ISIGFG, ITXPRI, ITXSEC, ITITDT(3), L
     *ENCRD, IPROP, IHTEX, IBLINK, IERASE, ITCNTR, IUNUSD, NXYZ1(3), 
     *NXYZ2(3), LBLFMT(3), LBLCHR(3), NDIMNS(3), IBLKTP, IDIMNS, NMES
     *H0, NMESH1, NMESH2, MESH1, MESH2, MESH3, MESH2D, MESHN(3), NMESHN(
     *2), NFIELD, IFIELD(19), NINCR, NPOINT, IVARBL(19), IVPTR(19), I_
     *VORDER(19,2), LINEAR(4), NONLIN(4), MXECHO, LINES, MAXLNS, USRK
     *BD, USRSCR, PLTFIL, LINWID, LINCOL, LINTEX, ICPOIN(3), IREPCT(MA
     *XREP), LEVREP, GRDTYP, GRDTEX, OUTTEX, IAXTEX, TITEX, LETSET, LAB
     *TEX, TICTEX, SHADOWTYP,SHADOWTEX, NXYZDEF1(10), NXYZDEF2(10), IF
     *ILE_CASE ,MAX_SUBST
      INTEGER MAX_CYCLE
      PARAMETER (MAX_CYCLE=20)
      INTEGER N_CYCLE, ITX_CYCLE(MAX_CYCLE)
      REAL SYM_CYCLE(MAX_CYCLE)
      EQUIVALENCE (NMESH1,NMESHN)
      EQUIVALENCE (MESH1,MESHN)
      INTEGER IBUFFR(400)
      REAL BUFFER(400)
      INTEGER NCHSAVE 
      PARAMETER (NCHSAVE=2*512) 
      INTEGER*4 ICHSAVE(NCHSAVE)
      INTEGER*4 IVRPTR(15)
      CHARACTER*512 OUTSTR,C_FILE, C_NAME, C_SELECT
      CHARACTER C_TIT_ESCAPE*1,C_TIT_SUBSTITUTE*2
      INTEGER N_FILE, N_NAME, N_SELECT
      CHARACTER*8 PXNAME
      CHARACTER*64 INPFMT
      LOGICAL LTDATA, OUTSID(4)
      COMMON /T2COM/ PXNAME, REDUCE, TITX, TITY ,XFRM12, XFRM13, XFRM1
     *4, XFRM23 ,XFRM24, XFRM34 ,XVARSX ,TITSIZ, GRDSYM, GRDSIZ, CIRS
     *IZ, ASIZE, AFLARE ,SMSZDF, ORAXES, EYEDIR, VUEDIR, VUECEN ,VERTC
     *L, EYESEP, SCRD, SCRZ, EYEDIS, EYEPNT ,XYPART, BARSIZ, TIKSIZ, XY
     *ZBAS, TTHETA ,TPHI, FRELBL, IPATRN, NPATRN, PATRN ,SCLPRM, WINDO
     *W, SCREEN, SYMBOL, NOSYMB ,FACTXY, LBLSIZ, SYMSIZ, XYZLIM, WORLD 
     *,RADRMX, RADRMN, RADAMN, RADANG, RADX0, RADY0, XUNUSD ,USRKBD, U
     *SRSCR, PLTFIL ,ITITDT, LENCRD ,INPFMT, GRDTYP, LINWID, LINCOL, L
     *INTEX, TITCON, ITCNTR ,IUNUSD, NXYZ1, NXYZ2 ,LBLCHR, NDIMNS, IBL
     *KTP, IDIMNS ,NMESH1, NMESH2, MESH1, MESH2, MESH3, NFIELD ,IFIELD
     *, NINCR ,IVARBL, IVRPTR ,LINEAR, NONLIN ,NPOINT, LETSET ,MXECH
     *O, LINES, MAXLNS ,AXANG, MESH2D, REDFAC, GRDTEX, OUTTEX, IAXTEX, 
     *TITEX, DSCAL ,OUTSTR, IPROP, IHTEX, IBLINK, IERASE, LABTEX, TICTE
     *X, NXYLIM, PATSZ ,MARGIN, PSCR, ITXPRI, ITXSEC, OREAL, OCPU, CSCR
     *D, OUTSID ,TITLIN, TITINX, TITZ, TITX1, TITY1, LTDATA, NPLOTS, RE
     *VLEV ,LBLFMT, IYEAR, IMONTH, IDAY, ISIGFG ,DATPTS, ERRPTS, DATXM
     *N, DATXMX, DATYMN, DATYMX, DATZMN, DATZMX ,DATSUM, ERRSUM, DATAVE
     *, ERRAVE, DATCEN, ERRCEN, DATSTD, ERRSTD ,NCSETS, NCCOL, NCROW, F
     *MARKER, H2STAT, TITFAC, TITLOC, TITMAR ,TIKFAC, IWINLEV, WINREL, 
     *WINABS, WINLIM ,ICPOIN, LEVREP, IREPCT, SYDIR, GRDIR, NMESH0, EXY
     *ZLIM, IVPTR ,TITLMX, NXYZDEF1, NXYZDEF2, IFILE_CASE, N_CYCLE, ITX
     *_CYCLE ,SYM_CYCLE, PLOT_EXTENT, FILL_ANGLE, FILL_WIDTH, FILL_TEX 
     *,FILL_INDEX ,N_LINES ,DSLOPE ,MAX_SUBST, BARBRK ,I_VORDER,SHADOW
     *TYP,SHADOWTEX
      COMMON /T2SCRT/ BUFFER, IBUFFR, N_FILE,N_NAME,N_SELECT, ICHSAVE
      COMMON /T2_CHAR/ C_TIT_ESCAPE,C_TIT_SUBSTITUTE
      COMMON /T2_SCRT/ C_FILE, C_NAME, C_SELECT
      INTEGER JOUFIL, ERRFIL, OUTFIL, DBGFIL, INPFIL, NINMAX
      PARAMETER (NINMAX=20)
      INTEGER NINP(NINMAX)
      COMMON /T2TRBK/NINP, JOUFIL, ERRFIL, OUTFIL, DBGFIL, INPFIL
      CHARACTER*512 STRNG, STJOU
      LOGICAL LTOKEN
      REAL FLOTNG
      INTEGER INTERP, KEYORD, NSTRNG, MAXSTR, NSTJOU, LSTJOU, NTOKEN
      INTEGER*4 INTEG
      COMMON /TOKENC/ INTERP, INTEG, FLOTNG, KEYORD, NSTRNG, MAXSTR, ST
     *RNG, NSTJOU, LSTJOU, STJOU, LTOKEN, NTOKEN
      LOGICAL DFLAGS(200),DSCREV(3)
      COMMON /T2FLGD/DFLAGS,DSCREV
      REAL DTITLIN(4), DTITFAC(4), DTITMAR(4)
      INTEGER DGRDTYP, DGRDTEX, DOUTTEX, IDAXTEX, DTITEX, DSHADOWTYP,DS
     *HADOWTEX, IFLDDF(19), NDDIMNS, IDTXPRI, IDTXSEC, LINCLF, LINTXF,
     * LINWDF, DNONLN(3), DNXYZ1(3), DNXYZ2(3), DLABTEX, DTICTEX, DNPAT
     *RN(30), DLBLCHR(3), ND_CYCLE, IDTX_CYCLE(MAX_CYCLE)
      REAL DSYM_CYCLE(MAX_CYCLE)
      REAL DTITSIZ, DGRDSYM, DGRDSIZ, DCIRSIZ(2,3), DASIZE, DAFLARE, D
     *SMSZDF, DORAXES(3), DEYEDIR(3), DVUEDIR(3), DVUECEN(3), DVERTCL(3
     *), DEYESEP, DSCRD, DSCRZ, DEYEDIS, DEYEPNT(3), DBARSIZ(3), DBARBR
     *K(3), DTIKSIZ(3), DXYZBS(3), DTTHETA, DTPHI, DFRELBL(4), DPATRN(2
     *0,30), DSCLPRM(10,3), DWINDOW(4), DSCREEN(2), DSYMBOL, DNOSYMB, 
     *DAXANG(3), DLBLSIZ, DSYMSIZ, DXYZLIM(3,2), DFACTXY(19), DRADANG,
     * DDSCAL, DPATSZ, DTITINX, DTIKFAC, DSYDIR(3), DGRDIR(3)
      COMMON /T2COMD/ DTITSIZ, DGRDSYM, DGRDSIZ, DCIRSIZ, DASIZE, DAFLA
     *RE, DSMSZDF, DORAXES, DEYEDIR, DVUEDIR, DVUECEN, DVERTCL, DEYESE
     *P, DSCRD, DSCRZ, DEYEDIS, DEYEPNT, DBARSIZ, DTIKSIZ, DXYZBS, DTTH
     *ETA, DTPHI, DFRELBL, DNPATRN, DPATRN, DSCLPRM, DWINDOW, DSCREEN,
     * DSYMBOL, DNOSYMB, DAXANG, DLBLSIZ, DSYMSIZ, DXYZLIM, DGRDTYP, D
     *FACTXY, IFLDDF, NDDIMNS, DGRDTEX, DOUTTEX, IDAXTEX, DTITEX, DRADA
     *NG, DDSCAL, DNONLN, DNXYZ1, DNXYZ2, LINCLF, LINTXF, LINWDF, DLABT
     *EX, DTICTEX, DPATSZ, IDTXPRI, IDTXSEC, DTITLIN, DTITINX, DLBLCHR,
     * DTITFAC, DTITMAR, DTIKFAC, DSYDIR, DGRDIR, ND_CYCLE, IDTX_CYCLE,
     * DSYM_CYCLE, DBARBRK,  DSHADOWTYP,DSHADOWTEX
      INTEGER LISTPT,NPTMAX,NDSETS
      REAL DATBUF(10248)
      COMMON /T2XPNT/ LISTPT,NPTMAX,NDSETS,DATBUF
      REAL HNONE
      INTEGER NSETD 
      PARAMETER (NSETD=19+9)
      INTEGER ISETD(NSETD),NINCR0,NINCR1,NINCR2,IBTYPE
      INTEGER I1,I2,I3,I4,I5,I6,I7,IM,NP,NL,IENDAT,IBGDAT
      INTEGER I_NDX,I_NDY,I_NDZ
      INTEGER N_SYMBOL 
      INTEGER N_XDATA 
      INTEGER N_DXDATA 
      INTEGER N_NDXDATA 
      INTEGER N_YDATA 
      INTEGER N_DYDATA 
      INTEGER N_NDYDATA 
      INTEGER N_ZDATA 
      INTEGER N_DZDATA 
      INTEGER N_NDZDATA 
      INTEGER N_UDATA 
      INTEGER N_DUDATA 
      INTEGER N_NDUDATA 
      INTEGER N_VDATA 
      INTEGER N_DVDATA 
      INTEGER N_NDVDATA 
      INTEGER N_WDATA 
      INTEGER N_DWDATA 
      INTEGER N_NDWDATA 
      INTEGER NCMAX 
      INTEGER NCSIZE 
      INTEGER NBTYPE 
      INTEGER NINDAT 
      INTEGER NSDATA 
      INTEGER NXDATA 
      INTEGER NDXDATA 
      INTEGER NNDXDATA 
      INTEGER NYDATA 
      INTEGER NDYDATA 
      INTEGER NNDYDATA 
      INTEGER NZDATA 
      INTEGER NDZDATA 
      INTEGER NNDZDATA 
      INTEGER NPDATA 
      INTEGER NLDATA 
      INTEGER NMDATA 
      INTEGER NBGDAT 
      INTEGER NENDAT 
      PARAMETER (N_SYMBOL=1) 
      PARAMETER (N_XDATA=2) 
      PARAMETER (N_DXDATA=3) 
      PARAMETER (N_NDXDATA=4) 
      PARAMETER (N_YDATA=5) 
      PARAMETER (N_DYDATA=6) 
      PARAMETER (N_NDYDATA=7) 
      PARAMETER (N_ZDATA=8) 
      PARAMETER (N_DZDATA=9) 
      PARAMETER (N_NDZDATA=10) 
      PARAMETER (N_UDATA=11) 
      PARAMETER (N_DUDATA=12) 
      PARAMETER (N_NDUDATA=13) 
      PARAMETER (N_VDATA=14) 
      PARAMETER (N_DVDATA=15) 
      PARAMETER (N_NDVDATA=16) 
      PARAMETER (N_WDATA=17) 
      PARAMETER (N_DWDATA=18) 
      PARAMETER (N_NDWDATA=19) 
      PARAMETER (NCMAX=6) 
      PARAMETER (NCSIZE=3) 
      PARAMETER (NBTYPE=1) 
      PARAMETER (NINDAT=2) 
      PARAMETER (NSDATA=5) 
      PARAMETER (NXDATA=NSDATA+1) 
      PARAMETER (NDXDATA=NXDATA+1) 
      PARAMETER (NNDXDATA=NXDATA+2) 
      PARAMETER (NYDATA=NXDATA+NCSIZE) 
      PARAMETER (NDYDATA=NYDATA+1) 
      PARAMETER (NNDYDATA=NYDATA+2) 
      PARAMETER (NZDATA=NYDATA+NCSIZE) 
      PARAMETER (NDZDATA=NZDATA+1) 
      PARAMETER (NNDZDATA=NZDATA+2) 
      PARAMETER (NPDATA=NSDATA+19) 
      PARAMETER (NLDATA=NPDATA+1) 
      PARAMETER (NMDATA=NLDATA+1) 
      PARAMETER (NBGDAT=NMDATA+1) 
      PARAMETER (NENDAT=NBGDAT+1) 
      EQUIVALENCE (IBTYPE,ISETD(NBTYPE))
      EQUIVALENCE (NINCR0,ISETD(NINDAT))
      EQUIVALENCE (NINCR1,ISETD(NINDAT+1))
      EQUIVALENCE (NINCR2,ISETD(NINDAT+2))
      EQUIVALENCE (I7,ISETD(NSDATA))
      EQUIVALENCE (I1,ISETD(NXDATA))
      EQUIVALENCE (I4,ISETD(NDXDATA))
      EQUIVALENCE (I2,ISETD(NYDATA))
      EQUIVALENCE (I5,ISETD(NDYDATA))
      EQUIVALENCE (I3,ISETD(NZDATA))
      EQUIVALENCE (I6,ISETD(NDZDATA))
      EQUIVALENCE (I_NDX,ISETD(NNDXDATA))
      EQUIVALENCE (I_NDY,ISETD(NNDYDATA))
      EQUIVALENCE (I_NDZ,ISETD(NNDZDATA))
      EQUIVALENCE (NP,ISETD(NPDATA))
      EQUIVALENCE (NL,ISETD(NLDATA))
      EQUIVALENCE (IM,ISETD(NMDATA))
      EQUIVALENCE (IBGDAT,ISETD(NBGDAT))
      EQUIVALENCE (IENDAT,ISETD(NENDAT))
      LOGICAL LFLAG(2),LTEST
      INTEGER I,J,K,L,M,IFLAG(2),JXYLIM(3,2)
      INTEGER IXYZ,IXYZ1,ISET,IV,IE,INE,IS
      INTEGER IVRSAV(15)
      REAL EXTREM(2),RAD
      INTEGER IXYZO(3)
      DATA IXYZO/2,1,3/
      DATA HNONE /-666.666/
      LTEST=.true.
      DO 10491 I=5,10
      FLAGS(I)=FLAGS(I).OR.FLAGS(I+60).or.DFLAGS(I+60)
      LTEST=LTEST.and.FLAGS(I)
      FLAGS(I+60)=.false.
10491 CONTINUE
10492 CONTINUE
      IF (LTEST) GOTO 10500
      DO 10511 I=1,15
      IVRSAV(I)=IVRPTR(I)
10511 CONTINUE
10512 CONTINUE
      DO 10521 I=1,3
      JXYLIM(I,1)=1
      JXYLIM(I,2)= 2 147 483 647
      DO 10531 J=1,2
      IF (NXYLIM(I,J) .gt.0) JXYLIM(I,J)=NXYLIM(I,J)
10531 CONTINUE
10532 CONTINUE
10521 CONTINUE
10522 CONTINUE
      JXYLIM(3,2)=MIN(JXYLIM(3,2),NDSETS)
      DO 10541 IXYZ1=1,3
      IXYZ=IXYZO(IXYZ1)
      LTEST=.true.
      DO 10551 M=1,2
      I=2*IXYZ+M+2
      IF (FLAGS(I)) THEN
      LFLAG(M)=.false.
      IFLAG(M)=1
      ELSE
      LFLAG(M)=.true.
      IFLAG(M)=-1
      ENDIF
      EXTREM(M)=XYZLIM(IXYZ,M)
      LTEST=LTEST.and.FLAGS(I)
      FLAGS(I)=.TRUE.
10551 CONTINUE
10552 CONTINUE
      IF(LTEST)GOTO 10541
      DO 10561 ISET=JXYLIM(3,1),JXYLIM(3,2)
      CALL T2GDSET(ISET,JXYLIM(1,1),JXYLIM(1,2)  ,JXYLIM(2,1),JXYLIM(2,2
     *),ISETD,EXYZLIM,'*')
      IF(NP .lt. JXYLIM(1,1))GOTO 10561
      IF (IBTYPE.eq.2) THEN
      IF (MESH1.eq.IXYZ) THEN
      NL=JXYLIM(2,1)
      ELSEIF (MESH2.eq.IXYZ) THEN
      NINCR0=NINCR1*NINCR0
      NP=NL-JXYLIM(2,1)+1
      NL=JXYLIM(2,1)
      ELSEIF (MESH3.eq.IXYZ) THEN
      ENDIF
      ENDIF
      IV=ISETD(NCSIZE*(IXYZ-1)+NXDATA)
      IE=ISETD(NCSIZE*(IXYZ-1)+NDXDATA)
      INE=ISETD(NCSIZE*(IXYZ-1)+NNDXDATA)
      IS=I7
      NP=NP-JXYLIM(1,1)+1
      IF (DATBUF(IV).EQ.HNONE) THEN
      CALL T2STL1(0.0,HNONE,HNONE,HNONE,1,NONLIN(IXYZ), IFLAG,EXTREM,NIN
     *CR0,1,1,1)
      ELSE
      DO 10571 I=JXYLIM(2,1),NL
      CALL T2STL1(DATBUF(IV),DATBUF(IE),DATBUF(INE),DATBUF(IS), NP,NONLI
     *N(IXYZ), IFLAG,EXTREM,NINCR0,1,1,1)
      IF (DATBUF(IS).ne.HNONE) IS=IS+NINCR0*NINCR1
      IF (DATBUF(IV).ne.HNONE) IV=IV+NINCR0*NINCR1
      IF (DATBUF(IE).ne.HNONE) IE=IE+NINCR0*NINCR1
10571 CONTINUE
10572 CONTINUE
      ENDIF
      DO 10581 I=1,2
      IF (LFLAG(I)) IFLAG(I)=0
10581 CONTINUE
10582 CONTINUE
10561 CONTINUE
10562 CONTINUE
      IF (FLAGS(27)) THEN
      IF (IXYZ1.eq.1) RAD=MAX(ABS(EXTREM(1)),ABS(EXTREM(2)))
      IF (IXYZ.lt.3 .or. FLAGS(91)) THEN
      IF (LFLAG(1)) EXTREM(1)=-RAD
      IF (LFLAG(2)) EXTREM(2)=RAD
      ENDIF
      ENDIF
      DO 10591 M=1,2
      IF (LFLAG(M)) XYZLIM(IXYZ,M)=EXTREM(M)
10591 CONTINUE
10592 CONTINUE
10541 CONTINUE
10542 CONTINUE
      DO 10601 I=1,15
      IVRPTR(I)=IVRSAV(I)
10601 CONTINUE
10602 CONTINUE
10500 CONTINUE
      DO 10501 I=1,2
      DO 10611 J=1,3
      NXYLIM(J,I)=0
      EXYZLIM(J,I)=HNONE
10611 CONTINUE
10612 CONTINUE
10501 CONTINUE
10502 CONTINUE
      END
      SUBROUTINE T2STL1(VALS,ERRS,NERRS,SEPS,NP,ISCAL,IFLAG,EXTREM,INCRM
     *T, MINPNT,MAXPNT,INCPNT)
      IMPLICIT NONE
      INTEGER ISCAL,NP,IFLAG(2)
      INTEGER INCRMT,MINPNT,MAXPNT,INCPNT
      REAL VALS(INCPNT,INCRMT,*), ERRS(INCPNT,INCRMT,*), NERRS(INCPNT,IN
     *CRMT,*), SEPS(INCPNT,INCRMT,*), EXTREM(2)
      REAL VMIN, VMAX, ERR(2), SEP, VPMN, VMMX, V, VP, VM, SN, FAC
      LOGICAL LE, LNE, LS, LF1, LF2, LTEST
      INTEGER IE, I, J
      COMMON /T2FLGC/ FLAGS(200), LTRAP,LHANDL,LSYERR,LSCREV
      LOGICAL FLAGS, LTRAP,LHANDL,LSYERR,LSCREV(3)
      INTEGER RELFLAG 
      PARAMETER (RELFLAG=151)
      INTEGER IWINLEV 
      INTEGER NWINLEV , MAX_FILL 
      PARAMETER (NWINLEV =4)
      PARAMETER (MAX_FILL=4)
      REAL GRDSYM, GRDSIZ, DATDAT(2,8), H2STAT(12), TITLIN(4), TITFA
     *C(4), TITLOC(4), TITMAR(4), TITLMX(4), TIKFAC, TITINX, TITX1, TIT
     *Y1, TITX, TITY, TITZ, TITSIZ, TITCON(5), REVLEV, REDUCE(5), XFR
     *M12(12), XFRM13(12), XFRM14(12), XFRM23(12), XFRM24(12), XFRM34(6
     *), XVARSX(20), CIRSIZ(2,3), ASIZE, AFLARE, SMSZDF, ORAXES(3), EY
     *EDIR(3), VUEDIR(3), VUECEN(3), VERTCL(3), EYESEP, SCRD, SCRZ, EYE
     *DIS, EYEPNT(3), XYPART(2, 2), BARSIZ(3), BARBRK(3), TIKSIZ(3), XY
     *ZBAS(3), TTHETA, TPHI, FRELBL(4), PATRN(20,30), SCLPRM(10,3), WI
     *NDOW(4), SCREEN(2), SYMBOL, NOSYMB, FACTXY(19), LBLSIZ, SYMSIZ, X
     *YZLIM(3,2), WORLD(3), RADRMX, RADRMN, RADAMN, RADANG, RADX0, RADY
     *0, XUNUSD(6), AXANG(3), REDFAC, DSCAL, PATSZ, MARGIN(4), PSCR(2
     *), OREAL, OCPU, CSCRD, DATPTS, ERRPTS, DATXMN, DATXMX, DATYMN, DA
     *TYMX, DATZMN, DATZMX, DATSUM, ERRSUM, DATAVE, ERRAVE, DATCEN, ERR
     *CEN, DATSTD, ERRSTD, WINREL(2,2,NWINLEV),WINABS(2,2,NWINLEV),WINL
     *IM(2,2), FMARKER(3,8), SYDIR(3), GRDIR(3), EXYZLIM(3,2), DSLOPE(2
     *,2)
      REAL PLOT_EXTENT(2,2),FILL_ANGLE(MAX_FILL),FILL_WIDTH(MAX_FILL)
      INTEGER FILL_INDEX, FILL_TEX(MAX_FILL), N_LINES(6)
      EQUIVALENCE (DATDAT, DATPTS)
      INTEGER MAXREP
      PARAMETER (MAXREP=5)
      INTEGER IPATRN, NPATRN(30), NXYLIM(3,2), NPLOTS, NCSETS, NCCOL, N
     *CROW, IYEAR, IMONTH, IDAY, ISIGFG, ITXPRI, ITXSEC, ITITDT(3), L
     *ENCRD, IPROP, IHTEX, IBLINK, IERASE, ITCNTR, IUNUSD, NXYZ1(3), 
     *NXYZ2(3), LBLFMT(3), LBLCHR(3), NDIMNS(3), IBLKTP, IDIMNS, NMES
     *H0, NMESH1, NMESH2, MESH1, MESH2, MESH3, MESH2D, MESHN(3), NMESHN(
     *2), NFIELD, IFIELD(19), NINCR, NPOINT, IVARBL(19), IVPTR(19), I_
     *VORDER(19,2), LINEAR(4), NONLIN(4), MXECHO, LINES, MAXLNS, USRK
     *BD, USRSCR, PLTFIL, LINWID, LINCOL, LINTEX, ICPOIN(3), IREPCT(MA
     *XREP), LEVREP, GRDTYP, GRDTEX, OUTTEX, IAXTEX, TITEX, LETSET, LAB
     *TEX, TICTEX, SHADOWTYP,SHADOWTEX, NXYZDEF1(10), NXYZDEF2(10), IF
     *ILE_CASE ,MAX_SUBST
      INTEGER MAX_CYCLE
      PARAMETER (MAX_CYCLE=20)
      INTEGER N_CYCLE, ITX_CYCLE(MAX_CYCLE)
      REAL SYM_CYCLE(MAX_CYCLE)
      EQUIVALENCE (NMESH1,NMESHN)
      EQUIVALENCE (MESH1,MESHN)
      INTEGER IBUFFR(400)
      REAL BUFFER(400)
      INTEGER NCHSAVE 
      PARAMETER (NCHSAVE=2*512) 
      INTEGER*4 ICHSAVE(NCHSAVE)
      INTEGER*4 IVRPTR(15)
      CHARACTER*512 OUTSTR,C_FILE, C_NAME, C_SELECT
      CHARACTER C_TIT_ESCAPE*1,C_TIT_SUBSTITUTE*2
      INTEGER N_FILE, N_NAME, N_SELECT
      CHARACTER*8 PXNAME
      CHARACTER*64 INPFMT
      LOGICAL LTDATA, OUTSID(4)
      COMMON /T2COM/ PXNAME, REDUCE, TITX, TITY ,XFRM12, XFRM13, XFRM1
     *4, XFRM23 ,XFRM24, XFRM34 ,XVARSX ,TITSIZ, GRDSYM, GRDSIZ, CIRS
     *IZ, ASIZE, AFLARE ,SMSZDF, ORAXES, EYEDIR, VUEDIR, VUECEN ,VERTC
     *L, EYESEP, SCRD, SCRZ, EYEDIS, EYEPNT ,XYPART, BARSIZ, TIKSIZ, XY
     *ZBAS, TTHETA ,TPHI, FRELBL, IPATRN, NPATRN, PATRN ,SCLPRM, WINDO
     *W, SCREEN, SYMBOL, NOSYMB ,FACTXY, LBLSIZ, SYMSIZ, XYZLIM, WORLD 
     *,RADRMX, RADRMN, RADAMN, RADANG, RADX0, RADY0, XUNUSD ,USRKBD, U
     *SRSCR, PLTFIL ,ITITDT, LENCRD ,INPFMT, GRDTYP, LINWID, LINCOL, L
     *INTEX, TITCON, ITCNTR ,IUNUSD, NXYZ1, NXYZ2 ,LBLCHR, NDIMNS, IBL
     *KTP, IDIMNS ,NMESH1, NMESH2, MESH1, MESH2, MESH3, NFIELD ,IFIELD
     *, NINCR ,IVARBL, IVRPTR ,LINEAR, NONLIN ,NPOINT, LETSET ,MXECH
     *O, LINES, MAXLNS ,AXANG, MESH2D, REDFAC, GRDTEX, OUTTEX, IAXTEX, 
     *TITEX, DSCAL ,OUTSTR, IPROP, IHTEX, IBLINK, IERASE, LABTEX, TICTE
     *X, NXYLIM, PATSZ ,MARGIN, PSCR, ITXPRI, ITXSEC, OREAL, OCPU, CSCR
     *D, OUTSID ,TITLIN, TITINX, TITZ, TITX1, TITY1, LTDATA, NPLOTS, RE
     *VLEV ,LBLFMT, IYEAR, IMONTH, IDAY, ISIGFG ,DATPTS, ERRPTS, DATXM
     *N, DATXMX, DATYMN, DATYMX, DATZMN, DATZMX ,DATSUM, ERRSUM, DATAVE
     *, ERRAVE, DATCEN, ERRCEN, DATSTD, ERRSTD ,NCSETS, NCCOL, NCROW, F
     *MARKER, H2STAT, TITFAC, TITLOC, TITMAR ,TIKFAC, IWINLEV, WINREL, 
     *WINABS, WINLIM ,ICPOIN, LEVREP, IREPCT, SYDIR, GRDIR, NMESH0, EXY
     *ZLIM, IVPTR ,TITLMX, NXYZDEF1, NXYZDEF2, IFILE_CASE, N_CYCLE, ITX
     *_CYCLE ,SYM_CYCLE, PLOT_EXTENT, FILL_ANGLE, FILL_WIDTH, FILL_TEX 
     *,FILL_INDEX ,N_LINES ,DSLOPE ,MAX_SUBST, BARBRK ,I_VORDER,SHADOW
     *TYP,SHADOWTEX
      COMMON /T2SCRT/ BUFFER, IBUFFR, N_FILE,N_NAME,N_SELECT, ICHSAVE
      COMMON /T2_CHAR/ C_TIT_ESCAPE,C_TIT_SUBSTITUTE
      COMMON /T2_SCRT/ C_FILE, C_NAME, C_SELECT
      INTEGER JOUFIL, ERRFIL, OUTFIL, DBGFIL, INPFIL, NINMAX
      PARAMETER (NINMAX=20)
      INTEGER NINP(NINMAX)
      COMMON /T2TRBK/NINP, JOUFIL, ERRFIL, OUTFIL, DBGFIL, INPFIL
      CHARACTER*512 STRNG, STJOU
      LOGICAL LTOKEN
      REAL FLOTNG
      INTEGER INTERP, KEYORD, NSTRNG, MAXSTR, NSTJOU, LSTJOU, NTOKEN
      INTEGER*4 INTEG
      COMMON /TOKENC/ INTERP, INTEG, FLOTNG, KEYORD, NSTRNG, MAXSTR, ST
     *RNG, NSTJOU, LSTJOU, STJOU, LTOKEN, NTOKEN
      REAL HNONE
      DATA HNONE /-666.666/
      LF1=MOD(IFLAG(1),2).ne.0
      LF2=MOD(IFLAG(2),2).ne.0
      IF ((IFLAG(1).NE.1 .OR. IFLAG(2).NE.1) .and. VALS(1,1,1).NE.HNONE)
     * THEN
      ERR(1)=0.
      ERR(2)=0.
      LE=ERRS(1,1,1).NE.HNONE
      SEP=0.
      LS=SEPS(1,1,1).NE.HNONE
      LNE=NERRS(1,1,1).NE.HNONE
      IF (LNE) THEN
      IE=2
      ELSE
      IE=1
      ENDIF
      IF (ISCAL.EQ.(-2) .OR. ISCAL.EQ.(-3)) THEN
      VPMN=1.0E35
      VMMX=-1.0E35
      VMIN= 0.
      VMAX= 0.
      LTEST= .FALSE.
      DO 10621 I=1,NP
      IF (LS) V=SEPS(1,1,I)
      IF (V .lt. 1.0E35) THEN
      DO 10631 J=MINPNT,MAXPNT
      V= VALS(1,J,I)
      LTEST=.TRUE.
      IF (LNE) ERR(2)= ABS(NERRS(1,J,I))
      IF (LE) ERR(1)= ABS(ERRS(1,J,I))
      VP= V+ERR(1)
      VM= V-ERR(IE)
      IF (VMAX.LT.VP) VMAX= VP
      IF (VMIN.GT.VM) VMIN= VM
      IF (V) 10640,10650,10660
10640 CONTINUE
      IF (VP.GE.0.) VP= V*0.25
      IF (VMMX.LT.VP) VMMX=VP
      GOTO 10631
10660 CONTINUE
      IF (VM.LE.0.) VM= V*0.25
      IF (VPMN.GT.VM) VPMN=VM
10650 CONTINUE
10631 CONTINUE
10632 CONTINUE
      ENDIF
10621 CONTINUE
10622 CONTINUE
      SN= 0.
      IF (IFLAG(1).GT.0) THEN
      VMIN= EXTREM(1)
      SN= SIGN(1.,VMIN)
      ENDIF
      IF (IFLAG(2).GT.0) THEN
      IF (SN*EXTREM(2).LT.0.) THEN
      CALL T2ERR(0,' ',('SN*EXTREM(2)<0'),3)
      CALL TRACE
      RETURN
      ENDIF
      VMAX= EXTREM(2)
      SN= SIGN(1.,VMAX)
      ENDIF
      IF (SN.EQ.0) THEN
      IF (IFLAG(1).EQ.0 .and. EXTREM(1).GT.0. .or.IFLAG(2).EQ.0 .and. EX
     *TREM(2).GT.0. .or.VMAX.GE.VPMN) SN= 1.
      ENDIF
      IF (SN.EQ.0.) THEN
      IF (IFLAG(1).EQ.0 .and. EXTREM(1).LT.0. .or.IFLAG(2).EQ.0 .and. EX
     *TREM(2).LT.0. .or.VMIN.LE.VMMX) SN= -1.
      ENDIF
      IF (SN.EQ.0.) THEN
      ISCAL= -2
      VMIN= 1.0
      VMAX= 10.0
      ELSE
      IF (.not.LTEST) THEN
      VPMN=EXTREM(1)
      VMMX=EXTREM(2)
      ENDIF
      IF (SN.GT.0.) THEN
      VMIN= VPMN
      ISCAL= -2
      ELSE
      VMAX= VMMX
      ISCAL= -3
      ENDIF
      IF (VMIN.eq.0) VMIN=1.0
      VMAX=MAX(VMAX,VMIN)
      FAC= (VMAX/VMIN)**0.1
      IF (FAC.eq.0) FAC=1.
      IF (FAC.EQ.1.) FAC= 2.
      VMAX=VMAX*FAC
      VMIN=VMIN/FAC
      IF (IFLAG(1).GT.0) VMIN= EXTREM(1)
      IF ((IFLAG(1).EQ.0 .or. IFLAG(1).eq.-3) .and. SN*EXTREM(1).GT.0.) 
     *VMIN= AMIN1(VMIN,EXTREM(1))
      IF (IFLAG(2).GT.0) VMAX= EXTREM(2)
      IF ((IFLAG(2).EQ.0 .or.IFLAG(2).eq.-3).and. SN*EXTREM(2).GT.0.) VM
     *AX= AMAX1(VMAX,EXTREM(2))
      ENDIF
      ELSE
      VMIN=1.0E35
      VMAX=-1.0E35
      DO 10671 I=1,NP
      IF (LS) V=SEPS(1,1,I)
      IF (V .lt. 1.0E35) THEN
      DO 10681 J=MINPNT,MAXPNT
      V=VALS(1,J,I)
      IF (LNE) ERR(2)= ABS(NERRS(1,J,I))
      IF (LE) ERR(1)= ABS(ERRS(1,J,I))
      VP= V+ERR(1)
      VM= V-ERR(IE)
      IF (VP.GT.VMAX) VMAX= VP
      IF (VM.LT.VMIN) VMIN= VM
10681 CONTINUE
10682 CONTINUE
      endif
10671 CONTINUE
10672 CONTINUE
      VMAX=MIN(MAX(VMAX,-1.0E35),1.0E35)
      VMIN=MIN(MAX(VMIN,-1.0E35),1.0E35)
      IF (VMIN .gt. VMAX) THEN
      VMIN=0
      VMAX=0
      ENDIF
      IF (ISCAL.EQ.(-1).or.ISCAL.le.-7) THEN
      FAC= (VMAX-VMIN)*0.1
      IF (FAC .le. 10.**(1-6)*ABS(VMAX+VMIN)) FAC=10.**(1-6)*ABS(VMAX+VM
     *IN)
      IF (LF1) VMIN=VMIN-FAC
      IF (LF2) VMAX=VMAX+FAC
      IF (LF1 .AND. ABS(VMIN) .LE. FAC) VMIN= 0.
      IF (LF2 .AND. ABS(VMAX) .LE. FAC) VMAX= 0.
      IF (VMAX.eq.0 .and. VMIN.eq.0) THEN
      VMAX=1
      IF (LF1) VMIN=-1
      ELSEIF (VMAX.eq.VMIN) THEN
      VMAX=VMAX+0.5
      VMIN=VMIN-0.5
      ELSEIF (VMAX.lt.VMIN) THEN
      VMAX=1
      VMIN=-1
      ENDIF
      ENDIF
      IF (IFLAG(1).GT.0) VMIN= EXTREM(1)
      IF (IFLAG(1).EQ.0.or.IFLAG(1).eq.-3) VMIN= AMIN1(VMIN,EXTREM(1))
      IF (IFLAG(2).GT.0) VMAX= EXTREM(2)
      IF (IFLAG(2).EQ.0.or.IFLAG(2).eq.-3) VMAX= AMAX1(VMAX,EXTREM(2))
      ENDIF
      EXTREM(1)= MIN(MAX(VMIN,-1.0E35),1.0E35)
      IFLAG(1)=1
      EXTREM(2)= MIN(MAX(VMAX,-1.0E35),1.0E35)
      IFLAG(2)=1
      ENDIF
      IF (ISCAL.LE.-4 .AND. ISCAL.GE.-5) THEN
      EXTREM(1)=AINT(EXTREM(1))
      IF (EXTREM(2).GT.AINT(EXTREM(2))+0.006) EXTREM(2)=AINT(EXTREM(2))+
     *1.005
      IF (EXTREM(2).eq.EXTREM(1)) EXTREM(2)=EXTREM(1)+1.005
      IF (EXTREM(1).LT.0.0 .OR. EXTREM(2).LT.0) THEN
      CALL T2ERR(0,' ',('*** WARNING *** Negative values meaningless for
     * calendar/normal scale'),3)
      ENDIF
      ELSEIF (ISCAL.EQ.(-2) .OR. ISCAL.EQ.(-3)) THEN
      IF (EXTREM(1).EQ.0.0 .OR. EXTREM(2).EQ.0.0 .OR. SIGN(1.,EXTREM(1))
     *.NE.SIGN(1.,EXTREM(2)) ) THEN
      CALL T2ERR(0,' ',('*** WARNING *** log scale may not include zero.
     * Linear used.'),3)
      ISCAL=-1
      ENDIF
      ENDIF
      END
      SUBROUTINE T2TCKS(INFLAGS)
      IMPLICIT NONE
      COMMON /T2FLGC/ FLAGS(200), LTRAP,LHANDL,LSYERR,LSCREV
      LOGICAL FLAGS, LTRAP,LHANDL,LSYERR,LSCREV(3)
      INTEGER RELFLAG 
      PARAMETER (RELFLAG=151)
      INTEGER IWINLEV 
      INTEGER NWINLEV , MAX_FILL 
      PARAMETER (NWINLEV =4)
      PARAMETER (MAX_FILL=4)
      REAL GRDSYM, GRDSIZ, DATDAT(2,8), H2STAT(12), TITLIN(4), TITFA
     *C(4), TITLOC(4), TITMAR(4), TITLMX(4), TIKFAC, TITINX, TITX1, TIT
     *Y1, TITX, TITY, TITZ, TITSIZ, TITCON(5), REVLEV, REDUCE(5), XFR
     *M12(12), XFRM13(12), XFRM14(12), XFRM23(12), XFRM24(12), XFRM34(6
     *), XVARSX(20), CIRSIZ(2,3), ASIZE, AFLARE, SMSZDF, ORAXES(3), EY
     *EDIR(3), VUEDIR(3), VUECEN(3), VERTCL(3), EYESEP, SCRD, SCRZ, EYE
     *DIS, EYEPNT(3), XYPART(2, 2), BARSIZ(3), BARBRK(3), TIKSIZ(3), XY
     *ZBAS(3), TTHETA, TPHI, FRELBL(4), PATRN(20,30), SCLPRM(10,3), WI
     *NDOW(4), SCREEN(2), SYMBOL, NOSYMB, FACTXY(19), LBLSIZ, SYMSIZ, X
     *YZLIM(3,2), WORLD(3), RADRMX, RADRMN, RADAMN, RADANG, RADX0, RADY
     *0, XUNUSD(6), AXANG(3), REDFAC, DSCAL, PATSZ, MARGIN(4), PSCR(2
     *), OREAL, OCPU, CSCRD, DATPTS, ERRPTS, DATXMN, DATXMX, DATYMN, DA
     *TYMX, DATZMN, DATZMX, DATSUM, ERRSUM, DATAVE, ERRAVE, DATCEN, ERR
     *CEN, DATSTD, ERRSTD, WINREL(2,2,NWINLEV),WINABS(2,2,NWINLEV),WINL
     *IM(2,2), FMARKER(3,8), SYDIR(3), GRDIR(3), EXYZLIM(3,2), DSLOPE(2
     *,2)
      REAL PLOT_EXTENT(2,2),FILL_ANGLE(MAX_FILL),FILL_WIDTH(MAX_FILL)
      INTEGER FILL_INDEX, FILL_TEX(MAX_FILL), N_LINES(6)
      EQUIVALENCE (DATDAT, DATPTS)
      INTEGER MAXREP
      PARAMETER (MAXREP=5)
      INTEGER IPATRN, NPATRN(30), NXYLIM(3,2), NPLOTS, NCSETS, NCCOL, N
     *CROW, IYEAR, IMONTH, IDAY, ISIGFG, ITXPRI, ITXSEC, ITITDT(3), L
     *ENCRD, IPROP, IHTEX, IBLINK, IERASE, ITCNTR, IUNUSD, NXYZ1(3), 
     *NXYZ2(3), LBLFMT(3), LBLCHR(3), NDIMNS(3), IBLKTP, IDIMNS, NMES
     *H0, NMESH1, NMESH2, MESH1, MESH2, MESH3, MESH2D, MESHN(3), NMESHN(
     *2), NFIELD, IFIELD(19), NINCR, NPOINT, IVARBL(19), IVPTR(19), I_
     *VORDER(19,2), LINEAR(4), NONLIN(4), MXECHO, LINES, MAXLNS, USRK
     *BD, USRSCR, PLTFIL, LINWID, LINCOL, LINTEX, ICPOIN(3), IREPCT(MA
     *XREP), LEVREP, GRDTYP, GRDTEX, OUTTEX, IAXTEX, TITEX, LETSET, LAB
     *TEX, TICTEX, SHADOWTYP,SHADOWTEX, NXYZDEF1(10), NXYZDEF2(10), IF
     *ILE_CASE ,MAX_SUBST
      INTEGER MAX_CYCLE
      PARAMETER (MAX_CYCLE=20)
      INTEGER N_CYCLE, ITX_CYCLE(MAX_CYCLE)
      REAL SYM_CYCLE(MAX_CYCLE)
      EQUIVALENCE (NMESH1,NMESHN)
      EQUIVALENCE (MESH1,MESHN)
      INTEGER IBUFFR(400)
      REAL BUFFER(400)
      INTEGER NCHSAVE 
      PARAMETER (NCHSAVE=2*512) 
      INTEGER*4 ICHSAVE(NCHSAVE)
      INTEGER*4 IVRPTR(15)
      CHARACTER*512 OUTSTR,C_FILE, C_NAME, C_SELECT
      CHARACTER C_TIT_ESCAPE*1,C_TIT_SUBSTITUTE*2
      INTEGER N_FILE, N_NAME, N_SELECT
      CHARACTER*8 PXNAME
      CHARACTER*64 INPFMT
      LOGICAL LTDATA, OUTSID(4)
      COMMON /T2COM/ PXNAME, REDUCE, TITX, TITY ,XFRM12, XFRM13, XFRM1
     *4, XFRM23 ,XFRM24, XFRM34 ,XVARSX ,TITSIZ, GRDSYM, GRDSIZ, CIRS
     *IZ, ASIZE, AFLARE ,SMSZDF, ORAXES, EYEDIR, VUEDIR, VUECEN ,VERTC
     *L, EYESEP, SCRD, SCRZ, EYEDIS, EYEPNT ,XYPART, BARSIZ, TIKSIZ, XY
     *ZBAS, TTHETA ,TPHI, FRELBL, IPATRN, NPATRN, PATRN ,SCLPRM, WINDO
     *W, SCREEN, SYMBOL, NOSYMB ,FACTXY, LBLSIZ, SYMSIZ, XYZLIM, WORLD 
     *,RADRMX, RADRMN, RADAMN, RADANG, RADX0, RADY0, XUNUSD ,USRKBD, U
     *SRSCR, PLTFIL ,ITITDT, LENCRD ,INPFMT, GRDTYP, LINWID, LINCOL, L
     *INTEX, TITCON, ITCNTR ,IUNUSD, NXYZ1, NXYZ2 ,LBLCHR, NDIMNS, IBL
     *KTP, IDIMNS ,NMESH1, NMESH2, MESH1, MESH2, MESH3, NFIELD ,IFIELD
     *, NINCR ,IVARBL, IVRPTR ,LINEAR, NONLIN ,NPOINT, LETSET ,MXECH
     *O, LINES, MAXLNS ,AXANG, MESH2D, REDFAC, GRDTEX, OUTTEX, IAXTEX, 
     *TITEX, DSCAL ,OUTSTR, IPROP, IHTEX, IBLINK, IERASE, LABTEX, TICTE
     *X, NXYLIM, PATSZ ,MARGIN, PSCR, ITXPRI, ITXSEC, OREAL, OCPU, CSCR
     *D, OUTSID ,TITLIN, TITINX, TITZ, TITX1, TITY1, LTDATA, NPLOTS, RE
     *VLEV ,LBLFMT, IYEAR, IMONTH, IDAY, ISIGFG ,DATPTS, ERRPTS, DATXM
     *N, DATXMX, DATYMN, DATYMX, DATZMN, DATZMX ,DATSUM, ERRSUM, DATAVE
     *, ERRAVE, DATCEN, ERRCEN, DATSTD, ERRSTD ,NCSETS, NCCOL, NCROW, F
     *MARKER, H2STAT, TITFAC, TITLOC, TITMAR ,TIKFAC, IWINLEV, WINREL, 
     *WINABS, WINLIM ,ICPOIN, LEVREP, IREPCT, SYDIR, GRDIR, NMESH0, EXY
     *ZLIM, IVPTR ,TITLMX, NXYZDEF1, NXYZDEF2, IFILE_CASE, N_CYCLE, ITX
     *_CYCLE ,SYM_CYCLE, PLOT_EXTENT, FILL_ANGLE, FILL_WIDTH, FILL_TEX 
     *,FILL_INDEX ,N_LINES ,DSLOPE ,MAX_SUBST, BARBRK ,I_VORDER,SHADOW
     *TYP,SHADOWTEX
      COMMON /T2SCRT/ BUFFER, IBUFFR, N_FILE,N_NAME,N_SELECT, ICHSAVE
      COMMON /T2_CHAR/ C_TIT_ESCAPE,C_TIT_SUBSTITUTE
      COMMON /T2_SCRT/ C_FILE, C_NAME, C_SELECT
      INTEGER JOUFIL, ERRFIL, OUTFIL, DBGFIL, INPFIL, NINMAX
      PARAMETER (NINMAX=20)
      INTEGER NINP(NINMAX)
      COMMON /T2TRBK/NINP, JOUFIL, ERRFIL, OUTFIL, DBGFIL, INPFIL
      CHARACTER*512 STRNG, STJOU
      LOGICAL LTOKEN
      REAL FLOTNG
      INTEGER INTERP, KEYORD, NSTRNG, MAXSTR, NSTJOU, LSTJOU, NTOKEN
      INTEGER*4 INTEG
      COMMON /TOKENC/ INTERP, INTEG, FLOTNG, KEYORD, NSTRNG, MAXSTR, ST
     *RNG, NSTJOU, LSTJOU, STJOU, LTOKEN, NTOKEN
      INTEGER INFLAGS,INFLAG,IAX
      REAL XYZ(3,2)
      INTEGER IGRIDS(3,2)
      INTEGER IXYZ,IXYZMX,IXYZS(3,2,3)
      INTEGER IB,IBCON,IB1,IB2,NB,NUMBER
      INTEGER I,J,K,IAXSAV,IMAX,IAXIS,ITICK,ILABEL,IPNT,IDUM
      INTEGER T2_GET_AXIS_SIDE
      INTEGER IAND,IOR
      REAL RAD
      PARAMETER (RAD=3.14159265/180.)
      IF (FLAGS(3)) RETURN
      FLAGS(3)=.TRUE.
      INFLAG=IAND(INFLAGS,4)
      IAX=IAND(INFLAGS,1)
      IF (IAND(INFLAGS,8) .ne. 0 .and. FLAGS(56)) THEN
      IAX=1
      INFLAG=IOR(INFLAG,4)
      ENDIF
      IF (.NOT.FLAGS(75)) CALL TXDEF2
      NONLIN(4)=0
      IF (.NOT.FLAGS(75)) THEN
      CALL T2ERR(0,' ',('*** ERROR *** Data coordinate system not define
     *d'),3)
      CALL TRACE
      ELSE
      CALL T2CWTS(IAXTEX,IAXSAV)
      NB=400/3
      IF (GRDTYP.eq.0) NB=400/2
      IB1=400-NB+1
      IB2=IB1-NB
      IBCON=1
      NB= NB-1
      IF (.NOT.FLAGS(2)) CALL T2AXES
      IXYZMX=2
      IF (FLAGS(56)) IXYZMX=3
      DO 10691 K=1,3
      DO 10701 J=1,2
      DO 10711 I=1,3
      IXYZS(I,J,K)=1
10711 CONTINUE
10712 CONTINUE
10701 CONTINUE
10702 CONTINUE
10691 CONTINUE
10692 CONTINUE
      IF (FLAGS(56) .and. FLAGS(132)) THEN
      IXYZ=2*T2_GET_AXIS_SIDE(3)-3
      DO 10721 I=1,2
      J=T2_GET_AXIS_SIDE(I*IXYZ)
      DO 10731 K=1,2
      IXYZS(I,1,K)=J
10731 CONTINUE
10732 CONTINUE
10721 CONTINUE
10722 CONTINUE
      IF ((SIN(45.*RAD)-ABS(SIN(TTHETA*RAD)))*IXYZ .gt.0) THEN
      IXYZS(1,1,3)=3-IXYZS(1,1,1)
      IXYZS(2,1,3)=IXYZS(2,1,1)
      ELSE
      IXYZS(1,1,3)=IXYZS(1,1,1)
      IXYZS(2,1,3)=3-IXYZS(2,1,1)
      ENDIF
      ENDIF
      DO 10741 K=1,3
      DO 10751 I=1,3
      J=IXYZS(I,1,K)
      IF (LSCREV(K)) IXYZS(I,1,K)=3-J
      IXYZS(I,2,K)=3-IXYZS(I,1,K)
10751 CONTINUE
10752 CONTINUE
10741 CONTINUE
10742 CONTINUE
      DO 10761 IXYZ=1,IXYZMX
      IGRIDS(IXYZ,1)=IBCON
      IF (XYZLIM(IXYZ,1).NE.XYZLIM(IXYZ,2)) THEN
      CALL T2STCK(NONLIN(IXYZ), XYZLIM(IXYZ,1),XYZLIM(IXYZ,2), NXYZ1(IXY
     *Z),NXYZ2(IXYZ), SCLPRM(1,IXYZ), NB, NUMBER,BUFFER(IB1),IBUFFR(IB1)
     *)
      IF (NUMBER.le.0) THEN
      IMAX=0
      ELSEIF ((FLAGS(56).and. .not.FLAGS(133)).OR.(FLAGS(82))) THEN
      IMAX=1
      ELSE
      IMAX=2
      ENDIF
      DO 10771 I=1,IMAX
      DO 10781 J=1,3
      IF (.NOT.FLAGS(82)) THEN
      XYZ(J,1)=XYZLIM(J,IXYZS(J,I,IXYZ))
      ELSE
      XYZ(J,1)=ORAXES(J)
      ENDIF
      XYZ(J,2)=XYZ(J,1)
10781 CONTINUE
10782 CONTINUE
      XYZ(IXYZ,1)=XYZLIM(IXYZ,1)
      XYZ(IXYZ,2)=XYZLIM(IXYZ,2)
      IAXIS=0
      ITICK=0
      ILABEL=0
      IF (FLAGS(56)) THEN
      IF (FLAGS(IXYZ+49)) THEN
      IAXIS=1
      IF (FLAGS(IXYZ+43)) ITICK=1
      IF (FLAGS(IXYZ+46)) ILABEL=1
      ENDIF
      ELSE
      IPNT=2*I-IXYZ+1
      IF (FLAGS(IPNT+18) .AND. FLAGS(IXYZ+49)) THEN
      IF (FLAGS(82)) IAXIS=1
      IF (FLAGS(IXYZ+43).AND. FLAGS(IPNT+31)) ITICK=1
      ILABEL=-IPNT
      IF (FLAGS(IXYZ+46) .AND. FLAGS(IPNT+35) .and. (FLAGS(94).or.OUTSID
     *(IPNT))) ILABEL=IPNT
      IF (.not. FLAGS(94) .and. ILABEL.gt.0 .and. .not.OUTSID(IXYZ+2)) T
     *HEN
      IBUFFR(IB1+NUMBER-1)=  MIN(MAX(IBUFFR(IB1+NUMBER-1),-1),1)
      ENDIF
      ENDIF
      ENDIF
      IF ((IAXIS.ne.0 .or. ITICK.ne.0 .or. ILABEL.GT.0) .and. NUMBER.gt.
     *0) CALL T2AXIS(XYZ, IOR(INFLAG,IXYZ), BUFFER(IB1), BUFFER(IB2), NB
     *, NUMBER, IBUFFR(IB1), IAX, ITICK, ILABEL)
10771 CONTINUE
10772 CONTINUE
      IF (GRDTYP.GT.0) THEN
      IB=IB1
      IF (IXYZ.eq.IXYZMX) IB2=400-2
      DO 10791 I=1,NUMBER
      IF (IBUFFR(IB).GT.0) THEN
      IF(IBCON.GE.IB2-3)GOTO 10792
      BUFFER(IBCON)=BUFFER(IB)
      IBCON=IBCON+1
      ENDIF
      IB=IB+1
10791 CONTINUE
10792 CONTINUE
      ENDIF
      ENDIF
      IF (GRDTYP.gt.0 .and. IBCON.EQ.IGRIDS(IXYZ,1)) THEN
      IF (IBCON.LT.IB2) THEN
      IF (FLAGS(82)) THEN
      BUFFER(IBCON)=ORAXES(IXYZ)
      ELSE
      BUFFER(IBCON)=XYZLIM(IXYZ,1)
      ENDIF
      IBCON=IBCON+1
      ENDIF
      ENDIF
      IGRIDS(IXYZ,2)=IBCON-1
10761 CONTINUE
10762 CONTINUE
      IF (.not.FLAGS(56)) THEN
      IGRIDS(3,1)=IBCON
      IGRIDS(3,2)=IBCON
      BUFFER(IBCON)=0
      ENDIF
      IF (GRDTYP.NE.0) CALL T2GRID(IGRIDS,BUFFER,IOR(INFLAGS,INFLAG))
      CALL T2CWTS(IAXSAV,IDUM)
      ENDIF
      NONLIN(4)=1
      END
      SUBROUTINE T2TLAB(ITICK,VAL,PARM,IWID,LFTADJ,TEXT,NTEXT,CASE,NCASE
     *,NFIRST)
      INTEGER ITICK,IWID,LFTADJ,NTEXT,NCASE
      REAL VAL,PARM(10),HOUR(3)
      CHARACTER*(*) TEXT,CASE
      COMMON /T2FLGC/ FLAGS(200), LTRAP,LHANDL,LSYERR,LSCREV
      LOGICAL FLAGS, LTRAP,LHANDL,LSYERR,LSCREV(3)
      INTEGER RELFLAG 
      PARAMETER (RELFLAG=151)
      INTEGER IWINLEV 
      INTEGER NWINLEV , MAX_FILL 
      PARAMETER (NWINLEV =4)
      PARAMETER (MAX_FILL=4)
      REAL GRDSYM, GRDSIZ, DATDAT(2,8), H2STAT(12), TITLIN(4), TITFA
     *C(4), TITLOC(4), TITMAR(4), TITLMX(4), TIKFAC, TITINX, TITX1, TIT
     *Y1, TITX, TITY, TITZ, TITSIZ, TITCON(5), REVLEV, REDUCE(5), XFR
     *M12(12), XFRM13(12), XFRM14(12), XFRM23(12), XFRM24(12), XFRM34(6
     *), XVARSX(20), CIRSIZ(2,3), ASIZE, AFLARE, SMSZDF, ORAXES(3), EY
     *EDIR(3), VUEDIR(3), VUECEN(3), VERTCL(3), EYESEP, SCRD, SCRZ, EYE
     *DIS, EYEPNT(3), XYPART(2, 2), BARSIZ(3), BARBRK(3), TIKSIZ(3), XY
     *ZBAS(3), TTHETA, TPHI, FRELBL(4), PATRN(20,30), SCLPRM(10,3), WI
     *NDOW(4), SCREEN(2), SYMBOL, NOSYMB, FACTXY(19), LBLSIZ, SYMSIZ, X
     *YZLIM(3,2), WORLD(3), RADRMX, RADRMN, RADAMN, RADANG, RADX0, RADY
     *0, XUNUSD(6), AXANG(3), REDFAC, DSCAL, PATSZ, MARGIN(4), PSCR(2
     *), OREAL, OCPU, CSCRD, DATPTS, ERRPTS, DATXMN, DATXMX, DATYMN, DA
     *TYMX, DATZMN, DATZMX, DATSUM, ERRSUM, DATAVE, ERRAVE, DATCEN, ERR
     *CEN, DATSTD, ERRSTD, WINREL(2,2,NWINLEV),WINABS(2,2,NWINLEV),WINL
     *IM(2,2), FMARKER(3,8), SYDIR(3), GRDIR(3), EXYZLIM(3,2), DSLOPE(2
     *,2)
      REAL PLOT_EXTENT(2,2),FILL_ANGLE(MAX_FILL),FILL_WIDTH(MAX_FILL)
      INTEGER FILL_INDEX, FILL_TEX(MAX_FILL), N_LINES(6)
      EQUIVALENCE (DATDAT, DATPTS)
      INTEGER MAXREP
      PARAMETER (MAXREP=5)
      INTEGER IPATRN, NPATRN(30), NXYLIM(3,2), NPLOTS, NCSETS, NCCOL, N
     *CROW, IYEAR, IMONTH, IDAY, ISIGFG, ITXPRI, ITXSEC, ITITDT(3), L
     *ENCRD, IPROP, IHTEX, IBLINK, IERASE, ITCNTR, IUNUSD, NXYZ1(3), 
     *NXYZ2(3), LBLFMT(3), LBLCHR(3), NDIMNS(3), IBLKTP, IDIMNS, NMES
     *H0, NMESH1, NMESH2, MESH1, MESH2, MESH3, MESH2D, MESHN(3), NMESHN(
     *2), NFIELD, IFIELD(19), NINCR, NPOINT, IVARBL(19), IVPTR(19), I_
     *VORDER(19,2), LINEAR(4), NONLIN(4), MXECHO, LINES, MAXLNS, USRK
     *BD, USRSCR, PLTFIL, LINWID, LINCOL, LINTEX, ICPOIN(3), IREPCT(MA
     *XREP), LEVREP, GRDTYP, GRDTEX, OUTTEX, IAXTEX, TITEX, LETSET, LAB
     *TEX, TICTEX, SHADOWTYP,SHADOWTEX, NXYZDEF1(10), NXYZDEF2(10), IF
     *ILE_CASE ,MAX_SUBST
      INTEGER MAX_CYCLE
      PARAMETER (MAX_CYCLE=20)
      INTEGER N_CYCLE, ITX_CYCLE(MAX_CYCLE)
      REAL SYM_CYCLE(MAX_CYCLE)
      EQUIVALENCE (NMESH1,NMESHN)
      EQUIVALENCE (MESH1,MESHN)
      INTEGER IBUFFR(400)
      REAL BUFFER(400)
      INTEGER NCHSAVE 
      PARAMETER (NCHSAVE=2*512) 
      INTEGER*4 ICHSAVE(NCHSAVE)
      INTEGER*4 IVRPTR(15)
      CHARACTER*512 OUTSTR,C_FILE, C_NAME, C_SELECT
      CHARACTER C_TIT_ESCAPE*1,C_TIT_SUBSTITUTE*2
      INTEGER N_FILE, N_NAME, N_SELECT
      CHARACTER*8 PXNAME
      CHARACTER*64 INPFMT
      LOGICAL LTDATA, OUTSID(4)
      COMMON /T2COM/ PXNAME, REDUCE, TITX, TITY ,XFRM12, XFRM13, XFRM1
     *4, XFRM23 ,XFRM24, XFRM34 ,XVARSX ,TITSIZ, GRDSYM, GRDSIZ, CIRS
     *IZ, ASIZE, AFLARE ,SMSZDF, ORAXES, EYEDIR, VUEDIR, VUECEN ,VERTC
     *L, EYESEP, SCRD, SCRZ, EYEDIS, EYEPNT ,XYPART, BARSIZ, TIKSIZ, XY
     *ZBAS, TTHETA ,TPHI, FRELBL, IPATRN, NPATRN, PATRN ,SCLPRM, WINDO
     *W, SCREEN, SYMBOL, NOSYMB ,FACTXY, LBLSIZ, SYMSIZ, XYZLIM, WORLD 
     *,RADRMX, RADRMN, RADAMN, RADANG, RADX0, RADY0, XUNUSD ,USRKBD, U
     *SRSCR, PLTFIL ,ITITDT, LENCRD ,INPFMT, GRDTYP, LINWID, LINCOL, L
     *INTEX, TITCON, ITCNTR ,IUNUSD, NXYZ1, NXYZ2 ,LBLCHR, NDIMNS, IBL
     *KTP, IDIMNS ,NMESH1, NMESH2, MESH1, MESH2, MESH3, NFIELD ,IFIELD
     *, NINCR ,IVARBL, IVRPTR ,LINEAR, NONLIN ,NPOINT, LETSET ,MXECH
     *O, LINES, MAXLNS ,AXANG, MESH2D, REDFAC, GRDTEX, OUTTEX, IAXTEX, 
     *TITEX, DSCAL ,OUTSTR, IPROP, IHTEX, IBLINK, IERASE, LABTEX, TICTE
     *X, NXYLIM, PATSZ ,MARGIN, PSCR, ITXPRI, ITXSEC, OREAL, OCPU, CSCR
     *D, OUTSID ,TITLIN, TITINX, TITZ, TITX1, TITY1, LTDATA, NPLOTS, RE
     *VLEV ,LBLFMT, IYEAR, IMONTH, IDAY, ISIGFG ,DATPTS, ERRPTS, DATXM
     *N, DATXMX, DATYMN, DATYMX, DATZMN, DATZMX ,DATSUM, ERRSUM, DATAVE
     *, ERRAVE, DATCEN, ERRCEN, DATSTD, ERRSTD ,NCSETS, NCCOL, NCROW, F
     *MARKER, H2STAT, TITFAC, TITLOC, TITMAR ,TIKFAC, IWINLEV, WINREL, 
     *WINABS, WINLIM ,ICPOIN, LEVREP, IREPCT, SYDIR, GRDIR, NMESH0, EXY
     *ZLIM, IVPTR ,TITLMX, NXYZDEF1, NXYZDEF2, IFILE_CASE, N_CYCLE, ITX
     *_CYCLE ,SYM_CYCLE, PLOT_EXTENT, FILL_ANGLE, FILL_WIDTH, FILL_TEX 
     *,FILL_INDEX ,N_LINES ,DSLOPE ,MAX_SUBST, BARBRK ,I_VORDER,SHADOW
     *TYP,SHADOWTEX
      COMMON /T2SCRT/ BUFFER, IBUFFR, N_FILE,N_NAME,N_SELECT, ICHSAVE
      COMMON /T2_CHAR/ C_TIT_ESCAPE,C_TIT_SUBSTITUTE
      COMMON /T2_SCRT/ C_FILE, C_NAME, C_SELECT
      INTEGER JOUFIL, ERRFIL, OUTFIL, DBGFIL, INPFIL, NINMAX
      PARAMETER (NINMAX=20)
      INTEGER NINP(NINMAX)
      COMMON /T2TRBK/NINP, JOUFIL, ERRFIL, OUTFIL, DBGFIL, INPFIL
      CHARACTER*512 STRNG, STJOU
      LOGICAL LTOKEN
      REAL FLOTNG
      INTEGER INTERP, KEYORD, NSTRNG, MAXSTR, NSTJOU, LSTJOU, NTOKEN
      INTEGER*4 INTEG
      COMMON /TOKENC/ INTERP, INTEG, FLOTNG, KEYORD, NSTRNG, MAXSTR, ST
     *RNG, NSTJOU, LSTJOU, STJOU, LTOKEN, NTOKEN
      CHARACTER*10 MONTHS(13)
      CHARACTER*12 DIGITS
      CHARACTER*12 SCHAR,BASCHR
      INTEGER IHATH(13)
      DOUBLE PRECISION DT
      DATA IHATH/000,031,059,090,120,151,181,212,243,273,304,334,365/
      DATA BASEXX/10./,BASFAC/1./
      DATA MONTHS /'December','January','February','March','April','May'
     *, 'June','July','August','September','October','November', 'Decemb
     *er'/
      DATA BASCHR/'101'/
      DATA LASBAS/3/
      DATA DIGITS/'0123456789**'/
      BASE=PARM(1)
      OFFSET=PARM(2)
      IF (PARM(4).ne.0) THEN
      T=PARM(4)*VAL
      ELSE
      T=VAL
      ENDIF
      CASE=' '
      LEFT=LFTADJ
      NTEXT=LEN(TEXT)
      NFIRST=1
      IF (ITICK.GT.1) THEN
      JWID=IWID
10800 GOTO (10810,10820,10830,10840,10850,10860,10870,10880,10890,10900,
     *10910,10920,10930),ITICK-1
10880 CONTINUE
10870 CONTINUE
      LEFT=1
      IF (VAL.eq.0) GOTO 10940
      T=ALOG10(ABS(VAL))+1
      IEXP=T
      JWID=MIN(MAX(0,IWID-IEXP),6)
      IF (ITICK.gt.8.and.IEXP.le.IWID.and.T.ge.0) GOTO 10940
      JWID=MIN(MAX(IWID,2),6)
      IF (NTEXT.lt.JWID+10) GOTO 10950
      T=VAL/10.**IEXP
      DO 10961 I=1,2
      IF (ABS(T).lt. 1) THEN
      T=T*10.
      IEXP=IEXP-1
      ENDIF
10961 CONTINUE
10962 CONTINUE
      IF (ABS(T).ge.10) THEN
      T=T/10
      IEXP=IEXP+1
      ENDIF
      CALL T2CRMF(T,10,JWID-1,SCHAR,IFIRST,ILAST)
      TEXT=SCHAR(IFIRST:10)
      ILAST=ILAST-IFIRST+1
      I=INDEX(TEXT(1:5),'0.')
      IF (I.gt.0) THEN
      IF (T.gt.5) THEN
      IEXP=IEXP+1
      TEXT(I:I+1)='.0'
      IF (I.eq.ILAST) ILAST=ILAST+1
      ELSE
      IEXT=IEXP-1
      TEXT(I:9)=TEXT(I+2:I+2)//'.'//TEXT(I+3:10)
      TEXT(10:10)='0'
      IF (ILAST.GT.I) ILAST=ILAST-1
      ENDIF
      ENDIF
      NTEXT=ILAST+1
      IF (TEXT(NTEXT:NTEXT).eq.'.') NTEXT=NTEXT+2
      TEXT(NTEXT:NTEXT+3)='.101'
      CASE(NTEXT:NTEXT+3)='M  V'
      NTEXT=NTEXT+4
      T=IEXP
      CALL T2CRMF(T,4,0,SCHAR,IFIRST,ILAST)
      TEXT(NTEXT:LEN(TEXT))=SCHAR(IFIRST:ILAST)
      NTEXT=NTEXT+ILAST-IFIRST+2
      TEXT(NTEXT:NTEXT)='2'
      CASE(NTEXT:NTEXT)='V'
      GOTO 10802
10810 CONTINUE
10940 CONTINUE
      IF (LEFT.gt.0) NTEXT=-IABS(NTEXT)
      CALL T2CRMF(VAL,NTEXT,JWID,TEXT,IFIRST,ILAST)
      NTEXT=ILAST
      NFIRST=IFIRST
      GOTO 10802
10820 CONTINUE
      IF (NTEXT.lt.8) GOTO 10950
      IF (VAL.EQ.0.) THEN
      ITICK=ISIGN(2,ITICK)
      TEXT='0'
      NTEXT=1
      ELSE
      IF (BASEXX.NE.BASE) THEN
      IF (ABS(BASE-2.71828).lt.0.001) THEN
      BASCHR='e1'
      LASBAS=2
      ELSE
      BASEXX=BASE
      BASFAC=1./ALOG10(BASE)
      CALL T2CRMF(BASEXX,11,4,SCHAR,IFIRST,ILAST)
      BASCHR=SCHAR(IFIRST:ILAST)
      LASBAS=ILAST-IFIRST+2
      BASCHR(LASBAS:LASBAS)='1'
      ENDIF
      ENDIF
      TEXT=BASCHR
      CASE(LASBAS:LASBAS)='V'
      LEFT=LASBAS+1
      X=BASFAC*ALOG10(ABS(VAL))
      CALL T2CRMF(X,12,3,SCHAR,IFIRST,ILAST)
      TEXT(LEFT:NTEXT)=SCHAR(IFIRST:ILAST)
      NTEXT=LEFT+ILAST-IFIRST+2
      TEXT(NTEXT:NTEXT)='2'
      CASE(NTEXT:NTEXT)='V'
      ENDIF
      GOTO 10802
10830 CONTINUE
      V=ABS(VAL)
      POWER=ALOG10(V)
      IPOWER=INT(300.+POWER)-300
      I=V*10.**(-IPOWER)+0.5
      IF (I.LE.0 .OR. I.GT.9) I=11
      TEXT=DIGITS(I+1:I+1)
      NTEXT=1
      GOTO 10802
10840 CONTINUE
      IF (NTEXT.lt.3) GOTO 10950
      J= MOD(INT(VAL),12) + 1
      TEXT= MONTHS(J)
      NTEXT=3
      GOTO 10802
10860 CONTINUE
      J= MOD(INT(VAL),12) + 1
      TEXT= MONTHS(J)(1:1)
      NTEXT=1
      GOTO 10802
10850 CONTINUE
      YEAR=VAL
      IF (YEAR.lt.0 .or. NTEXT.lt.4) GOTO 10950
      IF (YEAR.LT.100.) YEAR= YEAR+1900.
      CALL T2CRMF(YEAR,-5,0,SCHAR,IFIRST,ILAST)
      TEXT=SCHAR(1:ILAST)
      NTEXT=ILAST
      GOTO 10802
10890 CONTINUE
      DT=T+864*3600.
      CALL T2NTIM(DT,YEAR,FMON,DAY,HOUR,FMIN,SEC)
      CALL T2CRMF(YEAR,-5,0,TEXT,IFIRST,ILAST)
      NTEXT=ILAST
      GOTO 10802
10900 CONTINUE
      DT=T+36*3600.
      CALL T2NTIM(DT,YEAR,FMON,DAY,HOUR(1),HOUR(2),HOUR(3))
      J=NINT(FMON)+1
      TEXT= MONTHS(J)
      NTEXT=MIN(NTEXT,3)
      GOTO 10802
10910 CONTINUE
      DT=T+2*3600.
      CALL T2NTIM(DT,YEAR,FMON,DAY,HOUR(1),HOUR(2),HOUR(3))
      CALL T2CRMF(DAY,-4,0,TEXT,IFIRST,ILAST)
      NTEXT=ILAST
      GOTO 10802
10920 CONTINUE
      DT=T
      CALL T2NTIM(DT,YEAR,FMON,DAY,HOUR(1),HOUR(2),HOUR(3))
      IMAX=1
      DO 10971 I=1,3
      IF (HOUR(I).gt.0.005) IMAX=I
10971 CONTINUE
10972 CONTINUE
      NTEXT=0
      K=-5
      TEXT=' '
      DO 10981 I=1,IMAX
      T=HOUR(I)
      IF (NTEXT+5.gt.LEN(TEXT)) GOTO 10950
      CALL T2CRMF(T,K,2,TEXT(NTEXT+1:NTEXT+5),IFIRST,ILAST)
      K=5
      IF (TEXT(NTEXT+1:NTEXT+1).eq.' ') TEXT(NTEXT+1:NTEXT+1)='0'
      NTEXT=NTEXT+ILAST
      IF (I.lt.MAX(2,IMAX)) THEN
      NTEXT=NTEXT+1
      TEXT(NTEXT:NTEXT)=':'
      ENDIF
10981 CONTINUE
10982 CONTINUE
      GOTO 10802
10930 CONTINUE
      IF (NTEXT.lt.11) GOTO 10950
      DT=T+2*3600.
      CALL T2NTIM(DT,YEAR,FMON,DAY,HOUR,FMIN,SEC)
      CALL T2CRMF(DAY,-4,0,TEXT,IFIRST,ILAST)
      NTEXT=ILAST
      NTEXT=NTEXT+1
      TEXT(NTEXT:NTEXT)='-'
      J=NINT(FMON)+1
      TEXT(NTEXT+1:NTEXT+3)= MONTHS(J)
      NTEXT=NTEXT+4
      TEXT(NTEXT:NTEXT)='-'
      CALL T2CRMF(YEAR,-5,0,SCHAR,IFIRST,ILAST)
      TEXT(NTEXT+1:NTEXT+4)=SCHAR(1:ILAST)
      NTEXT=NTEXT+ILAST
      GOTO 10802
10802 CONTINUE
      ELSE
      TEXT='****'
      NTEXT=1
      ENDIF
      IF (NTEXT.LE.0) THEN
      NTEXT=1
      ENDIF
      NCASE=NTEXT
      RETURN
10950 CONTINUE
      TEXT='********'
      NTEXT=MIN(LEN(TEXT),8)
      END
      SUBROUTINE TDSLIN(VMIN,VMAX,IN1,IN2,PARMS,MAXN,NUMBER,VALS,TYPE)
      INTEGER NUMBER,N1,N2,TYPE(MAXN)
      REAL VMIN,VMAX,PARMS(10),VALS(MAXN)
      COMMON /T2FLGC/ FLAGS(200), LTRAP,LHANDL,LSYERR,LSCREV
      LOGICAL FLAGS, LTRAP,LHANDL,LSYERR,LSCREV(3)
      INTEGER RELFLAG 
      PARAMETER (RELFLAG=151)
      INTEGER IWINLEV 
      INTEGER NWINLEV , MAX_FILL 
      PARAMETER (NWINLEV =4)
      PARAMETER (MAX_FILL=4)
      REAL GRDSYM, GRDSIZ, DATDAT(2,8), H2STAT(12), TITLIN(4), TITFA
     *C(4), TITLOC(4), TITMAR(4), TITLMX(4), TIKFAC, TITINX, TITX1, TIT
     *Y1, TITX, TITY, TITZ, TITSIZ, TITCON(5), REVLEV, REDUCE(5), XFR
     *M12(12), XFRM13(12), XFRM14(12), XFRM23(12), XFRM24(12), XFRM34(6
     *), XVARSX(20), CIRSIZ(2,3), ASIZE, AFLARE, SMSZDF, ORAXES(3), EY
     *EDIR(3), VUEDIR(3), VUECEN(3), VERTCL(3), EYESEP, SCRD, SCRZ, EYE
     *DIS, EYEPNT(3), XYPART(2, 2), BARSIZ(3), BARBRK(3), TIKSIZ(3), XY
     *ZBAS(3), TTHETA, TPHI, FRELBL(4), PATRN(20,30), SCLPRM(10,3), WI
     *NDOW(4), SCREEN(2), SYMBOL, NOSYMB, FACTXY(19), LBLSIZ, SYMSIZ, X
     *YZLIM(3,2), WORLD(3), RADRMX, RADRMN, RADAMN, RADANG, RADX0, RADY
     *0, XUNUSD(6), AXANG(3), REDFAC, DSCAL, PATSZ, MARGIN(4), PSCR(2
     *), OREAL, OCPU, CSCRD, DATPTS, ERRPTS, DATXMN, DATXMX, DATYMN, DA
     *TYMX, DATZMN, DATZMX, DATSUM, ERRSUM, DATAVE, ERRAVE, DATCEN, ERR
     *CEN, DATSTD, ERRSTD, WINREL(2,2,NWINLEV),WINABS(2,2,NWINLEV),WINL
     *IM(2,2), FMARKER(3,8), SYDIR(3), GRDIR(3), EXYZLIM(3,2), DSLOPE(2
     *,2)
      REAL PLOT_EXTENT(2,2),FILL_ANGLE(MAX_FILL),FILL_WIDTH(MAX_FILL)
      INTEGER FILL_INDEX, FILL_TEX(MAX_FILL), N_LINES(6)
      EQUIVALENCE (DATDAT, DATPTS)
      INTEGER MAXREP
      PARAMETER (MAXREP=5)
      INTEGER IPATRN, NPATRN(30), NXYLIM(3,2), NPLOTS, NCSETS, NCCOL, N
     *CROW, IYEAR, IMONTH, IDAY, ISIGFG, ITXPRI, ITXSEC, ITITDT(3), L
     *ENCRD, IPROP, IHTEX, IBLINK, IERASE, ITCNTR, IUNUSD, NXYZ1(3), 
     *NXYZ2(3), LBLFMT(3), LBLCHR(3), NDIMNS(3), IBLKTP, IDIMNS, NMES
     *H0, NMESH1, NMESH2, MESH1, MESH2, MESH3, MESH2D, MESHN(3), NMESHN(
     *2), NFIELD, IFIELD(19), NINCR, NPOINT, IVARBL(19), IVPTR(19), I_
     *VORDER(19,2), LINEAR(4), NONLIN(4), MXECHO, LINES, MAXLNS, USRK
     *BD, USRSCR, PLTFIL, LINWID, LINCOL, LINTEX, ICPOIN(3), IREPCT(MA
     *XREP), LEVREP, GRDTYP, GRDTEX, OUTTEX, IAXTEX, TITEX, LETSET, LAB
     *TEX, TICTEX, SHADOWTYP,SHADOWTEX, NXYZDEF1(10), NXYZDEF2(10), IF
     *ILE_CASE ,MAX_SUBST
      INTEGER MAX_CYCLE
      PARAMETER (MAX_CYCLE=20)
      INTEGER N_CYCLE, ITX_CYCLE(MAX_CYCLE)
      REAL SYM_CYCLE(MAX_CYCLE)
      EQUIVALENCE (NMESH1,NMESHN)
      EQUIVALENCE (MESH1,MESHN)
      INTEGER IBUFFR(400)
      REAL BUFFER(400)
      INTEGER NCHSAVE 
      PARAMETER (NCHSAVE=2*512) 
      INTEGER*4 ICHSAVE(NCHSAVE)
      INTEGER*4 IVRPTR(15)
      CHARACTER*512 OUTSTR,C_FILE, C_NAME, C_SELECT
      CHARACTER C_TIT_ESCAPE*1,C_TIT_SUBSTITUTE*2
      INTEGER N_FILE, N_NAME, N_SELECT
      CHARACTER*8 PXNAME
      CHARACTER*64 INPFMT
      LOGICAL LTDATA, OUTSID(4)
      COMMON /T2COM/ PXNAME, REDUCE, TITX, TITY ,XFRM12, XFRM13, XFRM1
     *4, XFRM23 ,XFRM24, XFRM34 ,XVARSX ,TITSIZ, GRDSYM, GRDSIZ, CIRS
     *IZ, ASIZE, AFLARE ,SMSZDF, ORAXES, EYEDIR, VUEDIR, VUECEN ,VERTC
     *L, EYESEP, SCRD, SCRZ, EYEDIS, EYEPNT ,XYPART, BARSIZ, TIKSIZ, XY
     *ZBAS, TTHETA ,TPHI, FRELBL, IPATRN, NPATRN, PATRN ,SCLPRM, WINDO
     *W, SCREEN, SYMBOL, NOSYMB ,FACTXY, LBLSIZ, SYMSIZ, XYZLIM, WORLD 
     *,RADRMX, RADRMN, RADAMN, RADANG, RADX0, RADY0, XUNUSD ,USRKBD, U
     *SRSCR, PLTFIL ,ITITDT, LENCRD ,INPFMT, GRDTYP, LINWID, LINCOL, L
     *INTEX, TITCON, ITCNTR ,IUNUSD, NXYZ1, NXYZ2 ,LBLCHR, NDIMNS, IBL
     *KTP, IDIMNS ,NMESH1, NMESH2, MESH1, MESH2, MESH3, NFIELD ,IFIELD
     *, NINCR ,IVARBL, IVRPTR ,LINEAR, NONLIN ,NPOINT, LETSET ,MXECH
     *O, LINES, MAXLNS ,AXANG, MESH2D, REDFAC, GRDTEX, OUTTEX, IAXTEX, 
     *TITEX, DSCAL ,OUTSTR, IPROP, IHTEX, IBLINK, IERASE, LABTEX, TICTE
     *X, NXYLIM, PATSZ ,MARGIN, PSCR, ITXPRI, ITXSEC, OREAL, OCPU, CSCR
     *D, OUTSID ,TITLIN, TITINX, TITZ, TITX1, TITY1, LTDATA, NPLOTS, RE
     *VLEV ,LBLFMT, IYEAR, IMONTH, IDAY, ISIGFG ,DATPTS, ERRPTS, DATXM
     *N, DATXMX, DATYMN, DATYMX, DATZMN, DATZMX ,DATSUM, ERRSUM, DATAVE
     *, ERRAVE, DATCEN, ERRCEN, DATSTD, ERRSTD ,NCSETS, NCCOL, NCROW, F
     *MARKER, H2STAT, TITFAC, TITLOC, TITMAR ,TIKFAC, IWINLEV, WINREL, 
     *WINABS, WINLIM ,ICPOIN, LEVREP, IREPCT, SYDIR, GRDIR, NMESH0, EXY
     *ZLIM, IVPTR ,TITLMX, NXYZDEF1, NXYZDEF2, IFILE_CASE, N_CYCLE, ITX
     *_CYCLE ,SYM_CYCLE, PLOT_EXTENT, FILL_ANGLE, FILL_WIDTH, FILL_TEX 
     *,FILL_INDEX ,N_LINES ,DSLOPE ,MAX_SUBST, BARBRK ,I_VORDER,SHADOW
     *TYP,SHADOWTEX
      COMMON /T2SCRT/ BUFFER, IBUFFR, N_FILE,N_NAME,N_SELECT, ICHSAVE
      COMMON /T2_CHAR/ C_TIT_ESCAPE,C_TIT_SUBSTITUTE
      COMMON /T2_SCRT/ C_FILE, C_NAME, C_SELECT
      INTEGER JOUFIL, ERRFIL, OUTFIL, DBGFIL, INPFIL, NINMAX
      PARAMETER (NINMAX=20)
      INTEGER NINP(NINMAX)
      COMMON /T2TRBK/NINP, JOUFIL, ERRFIL, OUTFIL, DBGFIL, INPFIL
      CHARACTER*512 STRNG, STJOU
      LOGICAL LTOKEN
      REAL FLOTNG
      INTEGER INTERP, KEYORD, NSTRNG, MAXSTR, NSTJOU, LSTJOU, NTOKEN
      INTEGER*4 INTEG
      COMMON /TOKENC/ INTERP, INTEG, FLOTNG, KEYORD, NSTRNG, MAXSTR, ST
     *RNG, NSTJOU, LSTJOU, STJOU, LTOKEN, NTOKEN
      DOUBLE PRECISION DONE,DTEN,DBASE,DROUND,DX2,DSTEP2
      REAL ROUND(7)
      INTEGER*4 I2
      DATA NROUND/7/
      DATA ROUND/1.,2.,2.5,5.,10.,20.,1000000./
      JERR=0
      DONE= 1.
      DTEN= 10.
      BASE= PARMS(1)
      IF (BASE.LE.0.) BASE=10.
      OFFSET=PARMS(2)
      VDIF= VMAX-VMIN
      NUMBER=0
      IF (VDIF.eq.0) RETURN
      SMALL= 5.0E-4 * VDIF
      XVMIN= VMIN-SMALL
      XVMAX= VMAX+SMALL
      S= SIGN(1.,VDIF)
10990 CONTINUE
      N1=IAND(2**16-1,IABS(IN1))
      N2=IAND(2**16-1,IABS(IN2))
      IF (N1.EQ.0) N1= 6
      IF (N2.EQ.0) N2= 5
      ITYPE1=ISIGN(2,IN1)
      ITYPE2=ISIGN(1,IN2-1)
      PSTEP= ABS(VDIF)/(FLOAT(N1)*BASE)
      JORDER= ALOG10(PSTEP)
      IF (PSTEP.LT.1.0) JORDER=JORDER-1
      PSTEP= PSTEP/10.**JORDER
      I=0
11001 CONTINUE
      I=I+1
      IF(.NOT.(ROUND(I).GE.PSTEP))GOTO 11001
11002 CONTINUE
      IF (I.EQ.NROUND) RETURN
      DBASE= BASE
      DROUND= ROUND(I)
      DX2= N2
      DSTEP2= DBASE*DROUND*(DTEN**JORDER)/DX2
      IF (VDIF.LT.0.) DSTEP2= -DSTEP2
      I2= XVMIN/DSTEP2
11011 CONTINUE
      DX2=I2
      VAL=DX2*DSTEP2
      IF(SIGN(1.,VAL-XVMIN).EQ.S)GOTO 11012
      I2=I2+1
      GOTO 11011
11012 CONTINUE
      VAL=MAX(ABS(VMAX),ABS(VMIN))
      IF (IABS(I2).GE.10**6 ) THEN
      CALL T2ERR(0,' ',('*** WARNING *** Data range may be too small for
     * available precision'),3)
      ENDIF
      I2= N2-MOD(I2,N2)
      IF (I2.GE.N2) I2= I2-N2
      IF (VAL.lt.10.**(2-6) .or. VAL.gt.1.E8) ITYPE1=ISIGN(8,N1)
      NUMBER= 0
11021 CONTINUE
      VAL= DX2*DSTEP2
      IF(SIGN(1.,VAL-XVMAX).EQ.S)GOTO 11022
      NUMBER=NUMBER+1
      IF (NUMBER.GT.MAXN) THEN
      IF (JERR.gt.0.or.MAXN.le.2) RETURN
      JERR=JERR+1
      CALL T2ERR(0,' ',('*** ERROR *** Too many ticks. default labels=6,
     *ticks=5 used.'),3)
      N1=0
      N2=0
      GOTO 10990
      ENDIF
      VALS(NUMBER)= VAL
      IF (I2.EQ.0) THEN
      I2= N2
      TYPE(NUMBER)= ITYPE1
      ELSE
      TYPE(NUMBER)= ITYPE2
      ENDIF
      DX2= DX2+DONE
      I2= I2-1
      GOTO 11021
11022 CONTINUE
      END
      SUBROUTINE TDSNDS(VMIN,VMAX,IN1,IN2,PARMS,MAXN,NUMBER,VALS,TYPE)
      INTEGER NUMBER,N1,N2,TYPE(MAXN)
      REAL VMIN,VMAX,PARMS(10),VALS(MAXN)
      COMMON /T2FLGC/ FLAGS(200), LTRAP,LHANDL,LSYERR,LSCREV
      LOGICAL FLAGS, LTRAP,LHANDL,LSYERR,LSCREV(3)
      INTEGER RELFLAG 
      PARAMETER (RELFLAG=151)
      INTEGER IWINLEV 
      INTEGER NWINLEV , MAX_FILL 
      PARAMETER (NWINLEV =4)
      PARAMETER (MAX_FILL=4)
      REAL GRDSYM, GRDSIZ, DATDAT(2,8), H2STAT(12), TITLIN(4), TITFA
     *C(4), TITLOC(4), TITMAR(4), TITLMX(4), TIKFAC, TITINX, TITX1, TIT
     *Y1, TITX, TITY, TITZ, TITSIZ, TITCON(5), REVLEV, REDUCE(5), XFR
     *M12(12), XFRM13(12), XFRM14(12), XFRM23(12), XFRM24(12), XFRM34(6
     *), XVARSX(20), CIRSIZ(2,3), ASIZE, AFLARE, SMSZDF, ORAXES(3), EY
     *EDIR(3), VUEDIR(3), VUECEN(3), VERTCL(3), EYESEP, SCRD, SCRZ, EYE
     *DIS, EYEPNT(3), XYPART(2, 2), BARSIZ(3), BARBRK(3), TIKSIZ(3), XY
     *ZBAS(3), TTHETA, TPHI, FRELBL(4), PATRN(20,30), SCLPRM(10,3), WI
     *NDOW(4), SCREEN(2), SYMBOL, NOSYMB, FACTXY(19), LBLSIZ, SYMSIZ, X
     *YZLIM(3,2), WORLD(3), RADRMX, RADRMN, RADAMN, RADANG, RADX0, RADY
     *0, XUNUSD(6), AXANG(3), REDFAC, DSCAL, PATSZ, MARGIN(4), PSCR(2
     *), OREAL, OCPU, CSCRD, DATPTS, ERRPTS, DATXMN, DATXMX, DATYMN, DA
     *TYMX, DATZMN, DATZMX, DATSUM, ERRSUM, DATAVE, ERRAVE, DATCEN, ERR
     *CEN, DATSTD, ERRSTD, WINREL(2,2,NWINLEV),WINABS(2,2,NWINLEV),WINL
     *IM(2,2), FMARKER(3,8), SYDIR(3), GRDIR(3), EXYZLIM(3,2), DSLOPE(2
     *,2)
      REAL PLOT_EXTENT(2,2),FILL_ANGLE(MAX_FILL),FILL_WIDTH(MAX_FILL)
      INTEGER FILL_INDEX, FILL_TEX(MAX_FILL), N_LINES(6)
      EQUIVALENCE (DATDAT, DATPTS)
      INTEGER MAXREP
      PARAMETER (MAXREP=5)
      INTEGER IPATRN, NPATRN(30), NXYLIM(3,2), NPLOTS, NCSETS, NCCOL, N
     *CROW, IYEAR, IMONTH, IDAY, ISIGFG, ITXPRI, ITXSEC, ITITDT(3), L
     *ENCRD, IPROP, IHTEX, IBLINK, IERASE, ITCNTR, IUNUSD, NXYZ1(3), 
     *NXYZ2(3), LBLFMT(3), LBLCHR(3), NDIMNS(3), IBLKTP, IDIMNS, NMES
     *H0, NMESH1, NMESH2, MESH1, MESH2, MESH3, MESH2D, MESHN(3), NMESHN(
     *2), NFIELD, IFIELD(19), NINCR, NPOINT, IVARBL(19), IVPTR(19), I_
     *VORDER(19,2), LINEAR(4), NONLIN(4), MXECHO, LINES, MAXLNS, USRK
     *BD, USRSCR, PLTFIL, LINWID, LINCOL, LINTEX, ICPOIN(3), IREPCT(MA
     *XREP), LEVREP, GRDTYP, GRDTEX, OUTTEX, IAXTEX, TITEX, LETSET, LAB
     *TEX, TICTEX, SHADOWTYP,SHADOWTEX, NXYZDEF1(10), NXYZDEF2(10), IF
     *ILE_CASE ,MAX_SUBST
      INTEGER MAX_CYCLE
      PARAMETER (MAX_CYCLE=20)
      INTEGER N_CYCLE, ITX_CYCLE(MAX_CYCLE)
      REAL SYM_CYCLE(MAX_CYCLE)
      EQUIVALENCE (NMESH1,NMESHN)
      EQUIVALENCE (MESH1,MESHN)
      INTEGER IBUFFR(400)
      REAL BUFFER(400)
      INTEGER NCHSAVE 
      PARAMETER (NCHSAVE=2*512) 
      INTEGER*4 ICHSAVE(NCHSAVE)
      INTEGER*4 IVRPTR(15)
      CHARACTER*512 OUTSTR,C_FILE, C_NAME, C_SELECT
      CHARACTER C_TIT_ESCAPE*1,C_TIT_SUBSTITUTE*2
      INTEGER N_FILE, N_NAME, N_SELECT
      CHARACTER*8 PXNAME
      CHARACTER*64 INPFMT
      LOGICAL LTDATA, OUTSID(4)
      COMMON /T2COM/ PXNAME, REDUCE, TITX, TITY ,XFRM12, XFRM13, XFRM1
     *4, XFRM23 ,XFRM24, XFRM34 ,XVARSX ,TITSIZ, GRDSYM, GRDSIZ, CIRS
     *IZ, ASIZE, AFLARE ,SMSZDF, ORAXES, EYEDIR, VUEDIR, VUECEN ,VERTC
     *L, EYESEP, SCRD, SCRZ, EYEDIS, EYEPNT ,XYPART, BARSIZ, TIKSIZ, XY
     *ZBAS, TTHETA ,TPHI, FRELBL, IPATRN, NPATRN, PATRN ,SCLPRM, WINDO
     *W, SCREEN, SYMBOL, NOSYMB ,FACTXY, LBLSIZ, SYMSIZ, XYZLIM, WORLD 
     *,RADRMX, RADRMN, RADAMN, RADANG, RADX0, RADY0, XUNUSD ,USRKBD, U
     *SRSCR, PLTFIL ,ITITDT, LENCRD ,INPFMT, GRDTYP, LINWID, LINCOL, L
     *INTEX, TITCON, ITCNTR ,IUNUSD, NXYZ1, NXYZ2 ,LBLCHR, NDIMNS, IBL
     *KTP, IDIMNS ,NMESH1, NMESH2, MESH1, MESH2, MESH3, NFIELD ,IFIELD
     *, NINCR ,IVARBL, IVRPTR ,LINEAR, NONLIN ,NPOINT, LETSET ,MXECH
     *O, LINES, MAXLNS ,AXANG, MESH2D, REDFAC, GRDTEX, OUTTEX, IAXTEX, 
     *TITEX, DSCAL ,OUTSTR, IPROP, IHTEX, IBLINK, IERASE, LABTEX, TICTE
     *X, NXYLIM, PATSZ ,MARGIN, PSCR, ITXPRI, ITXSEC, OREAL, OCPU, CSCR
     *D, OUTSID ,TITLIN, TITINX, TITZ, TITX1, TITY1, LTDATA, NPLOTS, RE
     *VLEV ,LBLFMT, IYEAR, IMONTH, IDAY, ISIGFG ,DATPTS, ERRPTS, DATXM
     *N, DATXMX, DATYMN, DATYMX, DATZMN, DATZMX ,DATSUM, ERRSUM, DATAVE
     *, ERRAVE, DATCEN, ERRCEN, DATSTD, ERRSTD ,NCSETS, NCCOL, NCROW, F
     *MARKER, H2STAT, TITFAC, TITLOC, TITMAR ,TIKFAC, IWINLEV, WINREL, 
     *WINABS, WINLIM ,ICPOIN, LEVREP, IREPCT, SYDIR, GRDIR, NMESH0, EXY
     *ZLIM, IVPTR ,TITLMX, NXYZDEF1, NXYZDEF2, IFILE_CASE, N_CYCLE, ITX
     *_CYCLE ,SYM_CYCLE, PLOT_EXTENT, FILL_ANGLE, FILL_WIDTH, FILL_TEX 
     *,FILL_INDEX ,N_LINES ,DSLOPE ,MAX_SUBST, BARBRK ,I_VORDER,SHADOW
     *TYP,SHADOWTEX
      COMMON /T2SCRT/ BUFFER, IBUFFR, N_FILE,N_NAME,N_SELECT, ICHSAVE
      COMMON /T2_CHAR/ C_TIT_ESCAPE,C_TIT_SUBSTITUTE
      COMMON /T2_SCRT/ C_FILE, C_NAME, C_SELECT
      INTEGER JOUFIL, ERRFIL, OUTFIL, DBGFIL, INPFIL, NINMAX
      PARAMETER (NINMAX=20)
      INTEGER NINP(NINMAX)
      COMMON /T2TRBK/NINP, JOUFIL, ERRFIL, OUTFIL, DBGFIL, INPFIL
      CHARACTER*512 STRNG, STJOU
      LOGICAL LTOKEN
      REAL FLOTNG
      INTEGER INTERP, KEYORD, NSTRNG, MAXSTR, NSTJOU, LSTJOU, NTOKEN
      INTEGER*4 INTEG
      COMMON /TOKENC/ INTERP, INTEG, FLOTNG, KEYORD, NSTRNG, MAXSTR, ST
     *RNG, NSTJOU, LSTJOU, STJOU, LTOKEN, NTOKEN
      REAL VM(6,2)
      DOUBLE PRECISION DT(5),T2TIMF
      PARAMETER (NROUN=7)
      REAL ROUND(NROUN,6),FLIM(6,2),FSCAL(6)
      INTEGER ILAB(6)
      DATA ILAB/10,11,12,13,13,13/
      DATA FSCAL/3.1536E7,2.628E6,86400.,3600.,60.,1./
      DATA FLIM/ 0., 1., 1., 0., 0., 0., 1.,12.,31.,24.,60.,60./
      DATA ROUND/1.,2.,5.,10.,20.,25.,50., 1.,2.,4., 4., 6.,12.,13., 1.,
     *2.,5.,10.,31.,31.,32., 1.,2.,5.,10.,20.,30.,61., 1.,2.,5.,10.,20.,
     *30.,61., 1.,2.,5.,10.,20.,30.,61./
      FAC=PARMS(4)
      IF (FAC.eq.0) FAC=1
      VMN=MIN(VMIN,VMAX)
      VMX=MAX(VMIN,VMAX)
      DT(1)=FAC*VMN
      DT(2)=FAC*VMX
      VDF=FAC*(VMX-VMN)
      DO 11031 I=1,2
      CALL T2NTIM(DT(I),VM(1,I),VM(2,I),VM(3,I),VM(4,I),VM(5,I),VM(6,I))
     *
11031 CONTINUE
11032 CONTINUE
      N1=IAND(2**16-1,IABS(IN1))
      N2=IAND(2**16-1,IABS(IN2))
      IF (N1.eq.0) N1=6
      IF (N2.eq.0) N2=5
      ITYPE1=ISIGN(2,IN1)
      ITYPE2=ISIGN(1,IN2-1)
      IF (VM(1,2)-VM(1,1) .GT. 99 .or. VDF.lt.59) THEN
      J=1
      IF (VDF.lt.60)J=6
      VM(6,2)=VM(6,1)+VDF
      CALL TDSLIN(VM(J,1),VM(J,2),N1,IN2,PARMS,MAXN,NUMBER,VALS,TYPE)
      NUM=MIN(NUMBER,MAXN)
      NUMBER=0
      DO 11041 I=J,6
      VM(I,1)=FLIM(I,1)
11041 CONTINUE
11042 CONTINUE
      DO 11051 I=1,NUM
      VM(J,1)=VALS(I)
      T=T2TIMF(VM(1,1),VM(2,1),VM(3,1),VM(4,1),VM(5,1),VM(6,1))/FAC
      IF (T.ge.VMN.and.T.le.VMX) THEN
      NUMBER=NUMBER+1
      TYPE(NUMBER)=TYPE(I)
      IF (TYPE(NUMBER).eq.2) TYPE(NUMBER)=ILAB(J)
      VALS(NUMBER)=T
      ENDIF
11051 CONTINUE
11052 CONTINUE
      RETURN
      ENDIF
      DO 11061 I=1,6
      VDIF=VDF/FSCAL(I)
      IF (VDIF.gt.N1.or.I.eq.6.or.VDIF.gt.4) THEN
      I1=I
      IF (NUMBER.le.0) NUMBER=0
      V1DIF=AMAX1(1.0,VDIF/(N1+1))
      DO 11071 J=1,NROUN-1
      IF (V1DIF.gt.ROUND(J,I1).and.V1DIF.le.ROUND(J+1,I1)) V1DIF=ROUND(J
     *+1,I1)
11071 CONTINUE
11072 CONTINUE
      IF (V1DIF.gt.1.0.or.I.eq.6) THEN
      I2=I1
      V2DIF=AMAX1(1.0,V1DIF/(N2+1))
      ELSE
      I2=I+1
      V2DIF=AMAX1(1.0,(FLIM(I2,2)-FLIM(I2,1))/(N2+1))
      ENDIF
      DO 11081 J=1,NROUN-1
      IF (V2DIF.gt.ROUND(J,I2).and.V2DIF.le.ROUND(J+1,I2)) THEN
      V2DIF=ROUND(J+1,I2)
      IF (I1.eq.I2) THEN
      IF (AMOD(V1DIF,V2DIF).gt.0.1) V2DIF=ROUND(J+1,I2)+0.5
      ENDIF
      ENDIF
11081 CONTINUE
11082 CONTINUE
      DO 11091 J=MAX(2,I2),6
      VM(J,1)=FLIM(J,1)
11091 CONTINUE
11092 CONTINUE
      DT(3)=DT(1)
11101 IF(.NOT.(.NOT.(DT(3).gt.DT(2)))) GOTO 11102
      DT(3)=T2TIMF(VM(1,1),VM(2,1),VM(3,1),VM(4,1),VM(5,1),VM(6,1))
      CALL T2NTIM(DT(3),VM(1,2),VM(2,2),VM(3,2),VM(4,2),VM(5,2),VM(6,2))
     *
      IF (DT(3).ge.DT(1) .and. DT(3).le.DT(2)) THEN
      IF (VM(I1,2) .eq. FLIM(I1,1) .and. VM(I2,2) .eq. FLIM(I2,1) ) THEN
     *
      DO 11111 J=I1,1,-1
      IF (VM(J,2).ne.FLIM(J,1).or.J.eq.1) THEN
      NUMBER=NUMBER+1
      IF (NUMBER.gt.MAXN) RETURN
      VALS(NUMBER)=DT(3)/FAC
      TYPE(NUMBER)=ILAB(J)
      GOTO 11112
      ENDIF
11111 CONTINUE
11112 CONTINUE
      ELSEIF (AMOD(VM(I1,2),V1DIF) .eq. 0.0 .and. (VM(I2,2).eq.FLIM(I2,1
     *) .or. I1.eq.I2)) THEN
      NUMBER=NUMBER+1
      IF (NUMBER.gt.MAXN) RETURN
      VALS(NUMBER)=DT(3)/FAC
      TYPE(NUMBER)=ILAB(I)
      ELSEIF (AMOD(VM(I2,2),V2DIF) .lt. 0.1) THEN
      NUMBER=NUMBER+1
      IF (NUMBER.gt.MAXN) RETURN
      TYPE(NUMBER)=-1
      VALS(NUMBER)=DT(3)/FAC
      ENDIF
      ENDIF
      VM(I2,1)=VM(I2,1)+1
      GOTO 11101
11102 CONTINUE
      RETURN
      ENDIF
11061 CONTINUE
11062 CONTINUE
      END
      SUBROUTINE TDSLOG(VMIN,VMAX,IN1,IN2,PARM,MAXN,NUMBER,VALS,TYPE)
      IMPLICIT NONE
      COMMON /T2FLGC/ FLAGS(200), LTRAP,LHANDL,LSYERR,LSCREV
      LOGICAL FLAGS, LTRAP,LHANDL,LSYERR,LSCREV(3)
      INTEGER RELFLAG 
      PARAMETER (RELFLAG=151)
      INTEGER IWINLEV 
      INTEGER NWINLEV , MAX_FILL 
      PARAMETER (NWINLEV =4)
      PARAMETER (MAX_FILL=4)
      REAL GRDSYM, GRDSIZ, DATDAT(2,8), H2STAT(12), TITLIN(4), TITFA
     *C(4), TITLOC(4), TITMAR(4), TITLMX(4), TIKFAC, TITINX, TITX1, TIT
     *Y1, TITX, TITY, TITZ, TITSIZ, TITCON(5), REVLEV, REDUCE(5), XFR
     *M12(12), XFRM13(12), XFRM14(12), XFRM23(12), XFRM24(12), XFRM34(6
     *), XVARSX(20), CIRSIZ(2,3), ASIZE, AFLARE, SMSZDF, ORAXES(3), EY
     *EDIR(3), VUEDIR(3), VUECEN(3), VERTCL(3), EYESEP, SCRD, SCRZ, EYE
     *DIS, EYEPNT(3), XYPART(2, 2), BARSIZ(3), BARBRK(3), TIKSIZ(3), XY
     *ZBAS(3), TTHETA, TPHI, FRELBL(4), PATRN(20,30), SCLPRM(10,3), WI
     *NDOW(4), SCREEN(2), SYMBOL, NOSYMB, FACTXY(19), LBLSIZ, SYMSIZ, X
     *YZLIM(3,2), WORLD(3), RADRMX, RADRMN, RADAMN, RADANG, RADX0, RADY
     *0, XUNUSD(6), AXANG(3), REDFAC, DSCAL, PATSZ, MARGIN(4), PSCR(2
     *), OREAL, OCPU, CSCRD, DATPTS, ERRPTS, DATXMN, DATXMX, DATYMN, DA
     *TYMX, DATZMN, DATZMX, DATSUM, ERRSUM, DATAVE, ERRAVE, DATCEN, ERR
     *CEN, DATSTD, ERRSTD, WINREL(2,2,NWINLEV),WINABS(2,2,NWINLEV),WINL
     *IM(2,2), FMARKER(3,8), SYDIR(3), GRDIR(3), EXYZLIM(3,2), DSLOPE(2
     *,2)
      REAL PLOT_EXTENT(2,2),FILL_ANGLE(MAX_FILL),FILL_WIDTH(MAX_FILL)
      INTEGER FILL_INDEX, FILL_TEX(MAX_FILL), N_LINES(6)
      EQUIVALENCE (DATDAT, DATPTS)
      INTEGER MAXREP
      PARAMETER (MAXREP=5)
      INTEGER IPATRN, NPATRN(30), NXYLIM(3,2), NPLOTS, NCSETS, NCCOL, N
     *CROW, IYEAR, IMONTH, IDAY, ISIGFG, ITXPRI, ITXSEC, ITITDT(3), L
     *ENCRD, IPROP, IHTEX, IBLINK, IERASE, ITCNTR, IUNUSD, NXYZ1(3), 
     *NXYZ2(3), LBLFMT(3), LBLCHR(3), NDIMNS(3), IBLKTP, IDIMNS, NMES
     *H0, NMESH1, NMESH2, MESH1, MESH2, MESH3, MESH2D, MESHN(3), NMESHN(
     *2), NFIELD, IFIELD(19), NINCR, NPOINT, IVARBL(19), IVPTR(19), I_
     *VORDER(19,2), LINEAR(4), NONLIN(4), MXECHO, LINES, MAXLNS, USRK
     *BD, USRSCR, PLTFIL, LINWID, LINCOL, LINTEX, ICPOIN(3), IREPCT(MA
     *XREP), LEVREP, GRDTYP, GRDTEX, OUTTEX, IAXTEX, TITEX, LETSET, LAB
     *TEX, TICTEX, SHADOWTYP,SHADOWTEX, NXYZDEF1(10), NXYZDEF2(10), IF
     *ILE_CASE ,MAX_SUBST
      INTEGER MAX_CYCLE
      PARAMETER (MAX_CYCLE=20)
      INTEGER N_CYCLE, ITX_CYCLE(MAX_CYCLE)
      REAL SYM_CYCLE(MAX_CYCLE)
      EQUIVALENCE (NMESH1,NMESHN)
      EQUIVALENCE (MESH1,MESHN)
      INTEGER IBUFFR(400)
      REAL BUFFER(400)
      INTEGER NCHSAVE 
      PARAMETER (NCHSAVE=2*512) 
      INTEGER*4 ICHSAVE(NCHSAVE)
      INTEGER*4 IVRPTR(15)
      CHARACTER*512 OUTSTR,C_FILE, C_NAME, C_SELECT
      CHARACTER C_TIT_ESCAPE*1,C_TIT_SUBSTITUTE*2
      INTEGER N_FILE, N_NAME, N_SELECT
      CHARACTER*8 PXNAME
      CHARACTER*64 INPFMT
      LOGICAL LTDATA, OUTSID(4)
      COMMON /T2COM/ PXNAME, REDUCE, TITX, TITY ,XFRM12, XFRM13, XFRM1
     *4, XFRM23 ,XFRM24, XFRM34 ,XVARSX ,TITSIZ, GRDSYM, GRDSIZ, CIRS
     *IZ, ASIZE, AFLARE ,SMSZDF, ORAXES, EYEDIR, VUEDIR, VUECEN ,VERTC
     *L, EYESEP, SCRD, SCRZ, EYEDIS, EYEPNT ,XYPART, BARSIZ, TIKSIZ, XY
     *ZBAS, TTHETA ,TPHI, FRELBL, IPATRN, NPATRN, PATRN ,SCLPRM, WINDO
     *W, SCREEN, SYMBOL, NOSYMB ,FACTXY, LBLSIZ, SYMSIZ, XYZLIM, WORLD 
     *,RADRMX, RADRMN, RADAMN, RADANG, RADX0, RADY0, XUNUSD ,USRKBD, U
     *SRSCR, PLTFIL ,ITITDT, LENCRD ,INPFMT, GRDTYP, LINWID, LINCOL, L
     *INTEX, TITCON, ITCNTR ,IUNUSD, NXYZ1, NXYZ2 ,LBLCHR, NDIMNS, IBL
     *KTP, IDIMNS ,NMESH1, NMESH2, MESH1, MESH2, MESH3, NFIELD ,IFIELD
     *, NINCR ,IVARBL, IVRPTR ,LINEAR, NONLIN ,NPOINT, LETSET ,MXECH
     *O, LINES, MAXLNS ,AXANG, MESH2D, REDFAC, GRDTEX, OUTTEX, IAXTEX, 
     *TITEX, DSCAL ,OUTSTR, IPROP, IHTEX, IBLINK, IERASE, LABTEX, TICTE
     *X, NXYLIM, PATSZ ,MARGIN, PSCR, ITXPRI, ITXSEC, OREAL, OCPU, CSCR
     *D, OUTSID ,TITLIN, TITINX, TITZ, TITX1, TITY1, LTDATA, NPLOTS, RE
     *VLEV ,LBLFMT, IYEAR, IMONTH, IDAY, ISIGFG ,DATPTS, ERRPTS, DATXM
     *N, DATXMX, DATYMN, DATYMX, DATZMN, DATZMX ,DATSUM, ERRSUM, DATAVE
     *, ERRAVE, DATCEN, ERRCEN, DATSTD, ERRSTD ,NCSETS, NCCOL, NCROW, F
     *MARKER, H2STAT, TITFAC, TITLOC, TITMAR ,TIKFAC, IWINLEV, WINREL, 
     *WINABS, WINLIM ,ICPOIN, LEVREP, IREPCT, SYDIR, GRDIR, NMESH0, EXY
     *ZLIM, IVPTR ,TITLMX, NXYZDEF1, NXYZDEF2, IFILE_CASE, N_CYCLE, ITX
     *_CYCLE ,SYM_CYCLE, PLOT_EXTENT, FILL_ANGLE, FILL_WIDTH, FILL_TEX 
     *,FILL_INDEX ,N_LINES ,DSLOPE ,MAX_SUBST, BARBRK ,I_VORDER,SHADOW
     *TYP,SHADOWTEX
      COMMON /T2SCRT/ BUFFER, IBUFFR, N_FILE,N_NAME,N_SELECT, ICHSAVE
      COMMON /T2_CHAR/ C_TIT_ESCAPE,C_TIT_SUBSTITUTE
      COMMON /T2_SCRT/ C_FILE, C_NAME, C_SELECT
      INTEGER JOUFIL, ERRFIL, OUTFIL, DBGFIL, INPFIL, NINMAX
      PARAMETER (NINMAX=20)
      INTEGER NINP(NINMAX)
      COMMON /T2TRBK/NINP, JOUFIL, ERRFIL, OUTFIL, DBGFIL, INPFIL
      CHARACTER*512 STRNG, STJOU
      LOGICAL LTOKEN
      REAL FLOTNG
      INTEGER INTERP, KEYORD, NSTRNG, MAXSTR, NSTJOU, LSTJOU, NTOKEN
      INTEGER*4 INTEG
      COMMON /TOKENC/ INTERP, INTEG, FLOTNG, KEYORD, NSTRNG, MAXSTR, ST
     *RNG, NSTJOU, LSTJOU, STJOU, LTOKEN, NTOKEN
      INTEGER MAXN
      REAL VMIN,VMAX,VALS(MAXN),PARM(10)
      INTEGER IN1,IN2,TYPE(MAXN),IDEC,ILABEL,NUMBER
      INTEGER I,J,IJ,JORDER,IT
      INTEGER N1,N2,N3,ITYPE1,ITYPE2,ITYPE3,ITDEC,MINORD,MAXORD,MOVORD,I
     *MAX
      INTEGER LIST1(9),LIST2(9)
      REAL WMIN,WMAX,FAC,BASE,BFAC,POWER,ORDER,VAL,VALUE
      LOGICAL LEXP,LZERO1
      INTEGER IHALF, ITWO, IFOUR, NIHALF
      PARAMETER ( IHALF = 2**5 )
      PARAMETER ( NIHALF = -IHALF ) 
      PARAMETER ( ITWO = 2**2+2**5 ) 
      PARAMETER ( IFOUR = 2**2+2**3+2**5+2**7) 
      INTEGER IAND
      INTEGER N1LIST(8),N2LIST(8),N3LIST(8)
      DATA N1LIST/2,IFOUR,ITWO,NIHALF,-1,-1,-1,-1/
      DATA N2LIST/-2,-2,-2,-2,-2,-2,NIHALF,NIHALF/
      DATA N3LIST/4,7*0/
      IF (SIGN(1.,VMIN).NE.SIGN(1.,VMAX)) GOTO 11120
      IF (IAND(2**16,ABS(IN1)).ne.0) GOTO 11120
      N1=IAND(2**16-1,ABS(IN1))
      LZERO1=N1.EQ.0
      N2=IAND(2**16-1,ABS(IN2))
      N3=IABS(N2)/2**10
      BASE=PARM(1)
      IF (BASE.eq.0) BASE=10
      BFAC=1./ALOG10(BASE)
      WMAX=ABS(VMAX)
      WMIN=ABS(VMIN)
      IF (WMIN.GT.WMAX) THEN
      WMIN=WMAX
      WMAX=ABS(VMIN)
      ENDIF
      IF (WMIN.EQ.0.) GOTO 11120
      FAC= (WMAX/WMIN)**0.001
      WMAX=WMAX*FAC
      WMIN=WMIN/FAC
      IF (LZERO1 .OR. N2.EQ.0) THEN
      IDEC= INT(0.5 + ALOG10(WMAX/WMIN)*BFAC)
      IF (IDEC.LE.0 .and. N2.eq.0 .and. LZERO1) GOTO 11120
      IDEC=MAX(IDEC,1)
      IF (IDEC.GT.8) THEN
      IF (LZERO1) N1=-2**10*((6+IDEC-2)/6)
      ELSE
      IF (LZERO1) N1=N1LIST(IDEC)
      IF (N2.EQ.0) THEN
      N2=N2LIST(IDEC)
      N3=N3LIST(IDEC)
      ENDIF
      ENDIF
      ENDIF
11130 CONTINUE
      LEXP=IN1.lt.0
      IF ( IAND(ABS(IN1),2**17).eq.0 .and. (N1.lt.0 .or. (WMAX.GE.1.E6 .
     *OR. WMIN.LT.1.E-5))) LEXP=.true.
      N1=ABS(N1)
      ILABEL=0
      ORDER=ALOG10(WMIN)*BFAC
      MINORD=INT(ORDER)
      IF (FLOAT(MINORD).GT.ORDER) MINORD=MINORD-1
      ORDER=ALOG10(WMAX)*BFAC
      MAXORD=INT(ORDER)
      IF (FLOAT(MAXORD).LT.ORDER) MAXORD=MAXORD+1
      ITYPE1=2
      ITYPE2=-1
      ITYPE3=-1
      IF (LEXP) THEN
      ITDEC=3
      ITYPE1=4
      ELSE
      ITDEC=2
      ENDIF
      ITYPE1=ISIGN(ITYPE1,IN2)
      ITYPE2=ISIGN(ITYPE2,IN2-1)
      IF (N3.gt.0) THEN
      ITYPE2=ISIGN(ITYPE2,IN2)
      ENDIF
      IMAX=MIN(MAX(INT(BASE)-1,1),9)
      MOVORD=N1/2**10
      IF (MOVORD.gt.1) THEN
      IF (MINORD.LT.0) MINORD= MINORD - (MOVORD-1)
      MINORD= MOVORD*(MINORD/MOVORD)
      IF (MAXORD.GT.0) MAXORD= MAXORD + (MOVORD-1)
      MAXORD= MOVORD*(MAXORD/MOVORD)
      IF (IN2.eq.0)N2=0
      ELSE
      MOVORD=1
      ENDIF
      CALL TDSLG1(N1,LIST1)
      CALL TDSLG1(N2,LIST2)
      LIST1(1)=ITYPE2
      DO 11141 I=2,IMAX
      IF (LIST1(I).ne.0) THEN
      LIST1(I)=LIST1(I)*ITYPE1
      ELSE
      LIST1(I)=LIST2(I)*ITYPE2
      ENDIF
      IF (LIST1(I).ne.0) LIST1(1)=1
11141 CONTINUE
11142 CONTINUE
      NUMBER=0
      DO 11151 JORDER=MINORD,MAXORD,MOVORD
      DO 11161 IJ=1,MOVORD
      POWER=BASE**(JORDER+IJ-1)
      IF(POWER.gt.WMAX)GOTO 11162
      DO 11171 I=1,IMAX
      VALUE= POWER*FLOAT(I)
      IF(VALUE.gt.WMAX)GOTO 11172
      IF (WMIN.le.VALUE) THEN
      IF (I+IJ.eq.2) THEN
      IT=ITDEC
      ELSE
      IT= LIST1(I)
      ENDIF
      IF (IT.NE.0) THEN
      IF (ABS(IT).gt.1) ILABEL=ILABEL+1
      NUMBER=NUMBER+1
      IF (NUMBER.GT.MAXN) GOTO 11180
      VALS(NUMBER)=VALUE
      TYPE(NUMBER)=IT
      ENDIF
      ENDIF
      DO 11191 J=1,N3
      VAL=VALUE+J*POWER/(N3+1)
      IF(VAL.gt.WMAX)GOTO 11192
      IF ((SIGN(1.,WMIN-VAL).EQ.SIGN(1.,VAL-WMAX) .OR.WMIN.eq.VAL.OR.WMA
     *X.eq.VAL)) THEN
      NUMBER=NUMBER+1
      IF (NUMBER.GT.MAXN) GOTO 11180
      VALS(NUMBER)=VAL
      TYPE(NUMBER)=ITYPE3
      ENDIF
11191 CONTINUE
11192 CONTINUE
11171 CONTINUE
11172 CONTINUE
11161 CONTINUE
11162 CONTINUE
11151 CONTINUE
11152 CONTINUE
      IF (ILABEL.gt.6 .and. LZERO1) THEN
      LZERO1=.false.
      IF (N1.eq.2) THEN
      N1=IFOUR
      GOTO 11130
      ENDIF
      IF (N1.eq.IFOUR) THEN
      N1=ITWO
      GOTO 11130
      ENDIF
      IF (N1.eq.ITWO) THEN
      N1=IHALF
      GOTO 11130
      ENDIF
      IF (N1.eq.IHALF) THEN
      N1=-1
      GOTO 11130
      ENDIF
      IF (N1.eq.1) THEN
      N1=-2**10*(1+(ILABEL-1)/6)
      GOTO 11130
      ENDIF
      ENDIF
11180 CONTINUE
      IF (WMAX.LT.0.) THEN
      DO 11201 I=1,MIN(NUMBER,MAXN)
      VALS(I)=-VALS(I)
11201 CONTINUE
11202 CONTINUE
      ENDIF
11120 CONTINUE
      END
      SUBROUTINE TDSLG1(N,LIST)
      INTEGER LIST(9),N,NA,I,J
      NA=IABS(N)
      IF (NA.EQ.2) NA=1023
      J=NA/4
      DO 11211 I=2,9
      LIST(I)=IAND(J,1)
      J=J/2
11211 CONTINUE
11212 CONTINUE
      LIST(1)=1
      END
      SUBROUTINE TDSMON(VMIN,VMAX,IN1,IN2,BASE,MAXN,NUMBER,VALS,TYPE)
      REAL VMIN,VMAX,VALS(MAXN)
      INTEGER IN1,IN2,TYPE(MAXN)
      NUMBER= 0
      VMX= AMAX1(VMAX,VMIN)
      IVMX=VMX
      IVMN= MIN1(VMAX,VMIN)
      N1=IAND(2**16-1,IABS(IN1))
      N2=IAND(2**16-1,IABS(IN2))
      IF (N1.eq.0) N1=6
      IF (N2.eq.0) N2=6
      ITYPE1=6-ISIGN(1,IN1)
      ITYPE2=ISIGN(1,IN2-1)
      J1=MIN(MAX((IVMX-IVMN+1)/N1,1),12)
      IF (J1.eq.5) J1=4
      IF (J1.gt.6.and.J1.lt.12) J1=6
      J2= MIN(MAX(J1/N2,1),12)
      IF (J2.eq.5) J2=4
      IF (J2.gt.6.and.J2.lt.12) J2=6
      IVST= 1
      DO 11221 IV=IVMN,IVMX,IVST
      IM=MOD(IV-1,12)+1
      IF (IM.le.0) IM=IM+1
      I1=MOD(IV-1,J1)
      I2= MOD(IV-1,J2)
      IF (I1*I2.EQ.0) THEN
      V= FLOAT(IV)+0.005
      IF(V.gt.VMX)GOTO 11221
      NUMBER=NUMBER+1
      IF (NUMBER.GT.MAXN) RETURN
      VALS(NUMBER)= V
      TYPE(NUMBER)= ITYPE2
      IF (I1.EQ.0) THEN
      IF (J1.eq.1) THEN
      IF(V+0.155.gt.VMX)GOTO 11221
      NUMBER=NUMBER+1
      IF (NUMBER.GT.MAXN) RETURN
      VALS(NUMBER)= V+0.155
      TYPE(NUMBER)= -ITYPE1
      ELSE
      TYPE(NUMBER)= ITYPE1
      ENDIF
      ENDIF
      ENDIF
11221 CONTINUE
11222 CONTINUE
      END
      SUBROUTINE TDSNRM(VMIN,VMAX,IN1,IN2,PARMS,MAXN,NUMBER,VALS,TYPE)
      REAL VMIN,VMAX,PARMS(10),VALS(*)
      INTEGER MAXN,NUMBER,TYPE(*)
      INTEGER I,IN1,IN2,ITYPE1,ITYPE2
      PARAMETER (NTABLE=10)
      REAL TABLE(NTABLE)
      REAL VMN,VMX,MEAN,SIGMA,T
      DOUBLE PRECISION DTEMP,DPOWER,DTEN,DTENTH,DVAL
      DATA DTEN/10.D0/,DTENTH/0.1D0/
      DATA TABLE /0.,.125,.25,.38,.52,.67,.84,1.04,1.28,1.64/
      N1=IAND(2**16-1,IABS(IN1))
      IF (N1.EQ.0) N1=6
      ITYPE1=ISIGN(2,IN1)
      ITYPE2=ISIGN(1,IN2-1)
      MEAN=PARMS(2)
      SIGMA=ABS(PARMS(3))
      IF (SIGMA.EQ.0.) SIGMA=1.
      VMN=(VMIN-MEAN)/SIGMA
      VMX=(VMAX-MEAN)/SIGMA
      IF (VMX.LT.VMN) THEN
      T=VMX
      VMX=VMN
      VMN=T
      ENDIF
      DO 11231 I=1,NTABLE
      IF (ABS(VMN).GE.TABLE(I)) NINTMN=I-1
      IF (ABS(VMX).GE.TABLE(I)) NINTMX=I-1
11231 CONTINUE
11232 CONTINUE
      IF (VMN.LT.0.0) NINTMN=-NINTMN
      IF (VMX.LT.0.0) NINTMX=-NINTMX
      NSTEP= (NINTMX-NINTMN)/N1 + 1
      NINT=NINTMN
      IF (NINT*NINTMX.LT.0) NINT=NSTEP*(NINT/NSTEP)-NSTEP/2
      IF (NINT.LE.-NTABLE) NINT=NINT+NSTEP
      NUM=MAXN
      VALS(NUM)=VMN
      VX=VMN
11241 CONTINUE
      VN=VX
      IF (NINT.LE.NINTMX) THEN
      I=IABS(NINT)
      VX=TABLE(I+1)
      IF (NINT.LT.0) VX=-VX
      VX=VX*SIGMA+MEAN
      ELSE
      IF(NINT.GE.9999)GOTO 11242
      NINT=9999
      VX=VMX
      ENDIF
      VAL=0.
      DVAL=0.
      HALF=0.5*(VN+VX)
      IF (VN.NE.0.0) THEN
      L=ALOG10(ABS(VN))
      DPOWER=DTEN**L
      DO 11251 I=1,6
      VAL=DVAL
      POWER=DPOWER
      J=(HALF-VAL)/POWER
      DTEMP=J
      DVAL=DVAL+DPOWER*DTEMP
      VAL=DVAL
      IF (VAL.LT.VN) VAL=VAL+POWER
      IF(VAL.LT.VX)GOTO 11252
      DPOWER=DPOWER*DTENTH
11251 CONTINUE
11252 CONTINUE
      ENDIF
      NINT=NINT+NSTEP
      NUM=NUM-1
      VALS(NUM)=VAL
      TYPE(NUM)=ITYPE1
      GOTO 11241
11242 CONTINUE
      NUMBER=0
11260 CONTINUE
      DO 11261 NNN=NUM,MAXN
      DIFF=VMX-VALS(NNN)
      IF (DIFF.LE.0.0) THEN
      N=0
      ELSE
      L=ALOG10(DIFF)
11271 CONTINUE
      STEP=10.**L
      N=DIFF/STEP
      IF(N.GE.2)GOTO 11272
      L=L-1
      GOTO 11271
11272 CONTINUE
      ENDIF
      IF ((N+0.1)*STEP.gt.DIFF) N=N-1
      IF (NNN .ne. NUM) THEN
      IF (NUMBER.GE.MAXN) RETURN
      NUMBER=NUMBER+1
      VALS(NUMBER)=VMX
      TYPE(NUMBER)=ITYPE1
      ENDIF
      IF ( VMX .lt. 0 ) THEN
      NM=N+1
      VMX=VALS(NNN)
      ELSE
      NM=0
      ENDIF
      DO 11281 I=1,N
      IF(NUMBER.GE.NNN)GOTO 11262
      IF (NUMBER.GE.MAXN) RETURN
      NUMBER=NUMBER+1
      VALS(NUMBER)=VMX+(NM-I)*STEP
      TYPE(NUMBER)=ITYPE2
11281 CONTINUE
11282 CONTINUE
      VMX=VALS(NNN)
11261 CONTINUE
11262 CONTINUE
      END
      SUBROUTINE TDSYR(VMIN,VMAX,IN1,IN2,PARM,MAXN,NUMBER,VALS,TYPE)
      REAL VMIN,VMAX,VALS(MAXN)
      INTEGER IN1,IN2,TYPE(MAXN)
      REAL PARM(10)
      REAL HATH(12)
      REAL BASE(7)
      DATA BASE/1.,2.,5.,10.,20.,50.,100./
      DATA HATH/0.,.031,.059,.090,.120,.151,.181,.212,.243,.273,.304,.33
     *4/
      VMX= AMAX1(VMAX,VMIN)
      VMN= AMIN1(VMAX,VMIN)
      VDIF= VMX-VMN
      N1=IAND(2**16-1,IABS(IN1))
      N2=IAND(2**16-1,IABS(IN2))
      IF (N1.EQ.0) N1=6
      IF (N2.eq.0) N2=5
      ITYPE1=6
      ITYPE2=ISIGN(1,IN2-1)
      VM= AMAX1(1.0, AINT(1.0+(VDIF)/FLOAT(N1)) )
      IF (VM.ge.50.5) RETURN
      DO 11291 I=1,6
      IF (VM.gt.BASE(I).and.VM.le.BASE(I+1)) VM=BASE(I+1)
11291 CONTINUE
11292 CONTINUE
      VN= AINT(VMN/VM)
      V= VN*VM - VM
      IF (VM.le.1.5.or.IN2.ne.0.or.VDIF.le.18) V=V+ 0.183
      NUMBER= 0
11301 IF(.NOT.(.NOT.(V.GT.VMX))) GOTO 11302
      IF (V.ge.VMN) THEN
      NUMBER=NUMBER+1
      IF (NUMBER.GT.MAXN) RETURN
      VALS(NUMBER)= V
      TYPE(NUMBER)=-6
      ENDIF
      V= V + VM
      GOTO 11301
11302 CONTINUE
      JMAX=1
      IF (IN2.ne.0) THEN
      INC=MIN(MAX(12/IABS(N2),1),12)
      IF (INC.eq.5) INC=6
      IF (INC.gt.6.) INC=12
      VM=1
      ELSE
      INC=12
      IF (VDIF.LE.18.) THEN
      INC=6
      VM=1
      ENDIF
      IF (VDIF.LE.9.) INC=3
      IF (VDIF.le.6 ) INC=2
      IF (VDIF.Le.3.) INC=1
      ENDIF
      VN= AINT(VMN/VM)
      VN= VN*VM - VM
      IF (VM.gt.1) THEN
      JMAX=VM
      VM=1.0
      ENDIF
11311 IF(.NOT.(.NOT.(VN.GT.VMX))) GOTO 11312
      J=1
      DO 11321 JJ=1,JMAX
      DO 11331 I=1,12,INC
      V=VN+HATH(I)
      IF (V.GE.VMN.and.V.le.VMX) THEN
      NUMBER=NUMBER+1
      IF (NUMBER.GT.MAXN) RETURN
      TYPE(NUMBER)=J
      VALS(NUMBER)=V
      ENDIF
      J=ITYPE2
11331 CONTINUE
11332 CONTINUE
      VN=VN+VM
11321 CONTINUE
11322 CONTINUE
      GOTO 11311
11312 CONTINUE
      END
      SUBROUTINE TDTICK(ISCAL,VMIN,VMAX,N1,N2,PARM,NUMBER,VALS,ITYPE)
      END
      FUNCTION TDFNCT(VALUE,NUMBER)
      TDFNCT=VALUE
      END
      SUBROUTINE T2CWTS(LSET,LSAVE)
      COMMON /T2FLGC/ FLAGS(200), LTRAP,LHANDL,LSYERR,LSCREV
      LOGICAL FLAGS, LTRAP,LHANDL,LSYERR,LSCREV(3)
      INTEGER RELFLAG 
      PARAMETER (RELFLAG=151)
      INTEGER IWINLEV 
      INTEGER NWINLEV , MAX_FILL 
      PARAMETER (NWINLEV =4)
      PARAMETER (MAX_FILL=4)
      REAL GRDSYM, GRDSIZ, DATDAT(2,8), H2STAT(12), TITLIN(4), TITFA
     *C(4), TITLOC(4), TITMAR(4), TITLMX(4), TIKFAC, TITINX, TITX1, TIT
     *Y1, TITX, TITY, TITZ, TITSIZ, TITCON(5), REVLEV, REDUCE(5), XFR
     *M12(12), XFRM13(12), XFRM14(12), XFRM23(12), XFRM24(12), XFRM34(6
     *), XVARSX(20), CIRSIZ(2,3), ASIZE, AFLARE, SMSZDF, ORAXES(3), EY
     *EDIR(3), VUEDIR(3), VUECEN(3), VERTCL(3), EYESEP, SCRD, SCRZ, EYE
     *DIS, EYEPNT(3), XYPART(2, 2), BARSIZ(3), BARBRK(3), TIKSIZ(3), XY
     *ZBAS(3), TTHETA, TPHI, FRELBL(4), PATRN(20,30), SCLPRM(10,3), WI
     *NDOW(4), SCREEN(2), SYMBOL, NOSYMB, FACTXY(19), LBLSIZ, SYMSIZ, X
     *YZLIM(3,2), WORLD(3), RADRMX, RADRMN, RADAMN, RADANG, RADX0, RADY
     *0, XUNUSD(6), AXANG(3), REDFAC, DSCAL, PATSZ, MARGIN(4), PSCR(2
     *), OREAL, OCPU, CSCRD, DATPTS, ERRPTS, DATXMN, DATXMX, DATYMN, DA
     *TYMX, DATZMN, DATZMX, DATSUM, ERRSUM, DATAVE, ERRAVE, DATCEN, ERR
     *CEN, DATSTD, ERRSTD, WINREL(2,2,NWINLEV),WINABS(2,2,NWINLEV),WINL
     *IM(2,2), FMARKER(3,8), SYDIR(3), GRDIR(3), EXYZLIM(3,2), DSLOPE(2
     *,2)
      REAL PLOT_EXTENT(2,2),FILL_ANGLE(MAX_FILL),FILL_WIDTH(MAX_FILL)
      INTEGER FILL_INDEX, FILL_TEX(MAX_FILL), N_LINES(6)
      EQUIVALENCE (DATDAT, DATPTS)
      INTEGER MAXREP
      PARAMETER (MAXREP=5)
      INTEGER IPATRN, NPATRN(30), NXYLIM(3,2), NPLOTS, NCSETS, NCCOL, N
     *CROW, IYEAR, IMONTH, IDAY, ISIGFG, ITXPRI, ITXSEC, ITITDT(3), L
     *ENCRD, IPROP, IHTEX, IBLINK, IERASE, ITCNTR, IUNUSD, NXYZ1(3), 
     *NXYZ2(3), LBLFMT(3), LBLCHR(3), NDIMNS(3), IBLKTP, IDIMNS, NMES
     *H0, NMESH1, NMESH2, MESH1, MESH2, MESH3, MESH2D, MESHN(3), NMESHN(
     *2), NFIELD, IFIELD(19), NINCR, NPOINT, IVARBL(19), IVPTR(19), I_
     *VORDER(19,2), LINEAR(4), NONLIN(4), MXECHO, LINES, MAXLNS, USRK
     *BD, USRSCR, PLTFIL, LINWID, LINCOL, LINTEX, ICPOIN(3), IREPCT(MA
     *XREP), LEVREP, GRDTYP, GRDTEX, OUTTEX, IAXTEX, TITEX, LETSET, LAB
     *TEX, TICTEX, SHADOWTYP,SHADOWTEX, NXYZDEF1(10), NXYZDEF2(10), IF
     *ILE_CASE ,MAX_SUBST
      INTEGER MAX_CYCLE
      PARAMETER (MAX_CYCLE=20)
      INTEGER N_CYCLE, ITX_CYCLE(MAX_CYCLE)
      REAL SYM_CYCLE(MAX_CYCLE)
      EQUIVALENCE (NMESH1,NMESHN)
      EQUIVALENCE (MESH1,MESHN)
      INTEGER IBUFFR(400)
      REAL BUFFER(400)
      INTEGER NCHSAVE 
      PARAMETER (NCHSAVE=2*512) 
      INTEGER*4 ICHSAVE(NCHSAVE)
      INTEGER*4 IVRPTR(15)
      CHARACTER*512 OUTSTR,C_FILE, C_NAME, C_SELECT
      CHARACTER C_TIT_ESCAPE*1,C_TIT_SUBSTITUTE*2
      INTEGER N_FILE, N_NAME, N_SELECT
      CHARACTER*8 PXNAME
      CHARACTER*64 INPFMT
      LOGICAL LTDATA, OUTSID(4)
      COMMON /T2COM/ PXNAME, REDUCE, TITX, TITY ,XFRM12, XFRM13, XFRM1
     *4, XFRM23 ,XFRM24, XFRM34 ,XVARSX ,TITSIZ, GRDSYM, GRDSIZ, CIRS
     *IZ, ASIZE, AFLARE ,SMSZDF, ORAXES, EYEDIR, VUEDIR, VUECEN ,VERTC
     *L, EYESEP, SCRD, SCRZ, EYEDIS, EYEPNT ,XYPART, BARSIZ, TIKSIZ, XY
     *ZBAS, TTHETA ,TPHI, FRELBL, IPATRN, NPATRN, PATRN ,SCLPRM, WINDO
     *W, SCREEN, SYMBOL, NOSYMB ,FACTXY, LBLSIZ, SYMSIZ, XYZLIM, WORLD 
     *,RADRMX, RADRMN, RADAMN, RADANG, RADX0, RADY0, XUNUSD ,USRKBD, U
     *SRSCR, PLTFIL ,ITITDT, LENCRD ,INPFMT, GRDTYP, LINWID, LINCOL, L
     *INTEX, TITCON, ITCNTR ,IUNUSD, NXYZ1, NXYZ2 ,LBLCHR, NDIMNS, IBL
     *KTP, IDIMNS ,NMESH1, NMESH2, MESH1, MESH2, MESH3, NFIELD ,IFIELD
     *, NINCR ,IVARBL, IVRPTR ,LINEAR, NONLIN ,NPOINT, LETSET ,MXECH
     *O, LINES, MAXLNS ,AXANG, MESH2D, REDFAC, GRDTEX, OUTTEX, IAXTEX, 
     *TITEX, DSCAL ,OUTSTR, IPROP, IHTEX, IBLINK, IERASE, LABTEX, TICTE
     *X, NXYLIM, PATSZ ,MARGIN, PSCR, ITXPRI, ITXSEC, OREAL, OCPU, CSCR
     *D, OUTSID ,TITLIN, TITINX, TITZ, TITX1, TITY1, LTDATA, NPLOTS, RE
     *VLEV ,LBLFMT, IYEAR, IMONTH, IDAY, ISIGFG ,DATPTS, ERRPTS, DATXM
     *N, DATXMX, DATYMN, DATYMX, DATZMN, DATZMX ,DATSUM, ERRSUM, DATAVE
     *, ERRAVE, DATCEN, ERRCEN, DATSTD, ERRSTD ,NCSETS, NCCOL, NCROW, F
     *MARKER, H2STAT, TITFAC, TITLOC, TITMAR ,TIKFAC, IWINLEV, WINREL, 
     *WINABS, WINLIM ,ICPOIN, LEVREP, IREPCT, SYDIR, GRDIR, NMESH0, EXY
     *ZLIM, IVPTR ,TITLMX, NXYZDEF1, NXYZDEF2, IFILE_CASE, N_CYCLE, ITX
     *_CYCLE ,SYM_CYCLE, PLOT_EXTENT, FILL_ANGLE, FILL_WIDTH, FILL_TEX 
     *,FILL_INDEX ,N_LINES ,DSLOPE ,MAX_SUBST, BARBRK ,I_VORDER,SHADOW
     *TYP,SHADOWTEX
      COMMON /T2SCRT/ BUFFER, IBUFFR, N_FILE,N_NAME,N_SELECT, ICHSAVE
      COMMON /T2_CHAR/ C_TIT_ESCAPE,C_TIT_SUBSTITUTE
      COMMON /T2_SCRT/ C_FILE, C_NAME, C_SELECT
      INTEGER JOUFIL, ERRFIL, OUTFIL, DBGFIL, INPFIL, NINMAX
      PARAMETER (NINMAX=20)
      INTEGER NINP(NINMAX)
      COMMON /T2TRBK/NINP, JOUFIL, ERRFIL, OUTFIL, DBGFIL, INPFIL
      CHARACTER*512 STRNG, STJOU
      LOGICAL LTOKEN
      REAL FLOTNG
      INTEGER INTERP, KEYORD, NSTRNG, MAXSTR, NSTJOU, LSTJOU, NTOKEN
      INTEGER*4 INTEG
      COMMON /TOKENC/ INTERP, INTEG, FLOTNG, KEYORD, NSTRNG, MAXSTR, ST
     *RNG, NSTJOU, LSTJOU, STJOU, LTOKEN, NTOKEN
      LSAVE=LINWID*8+LINTEX*64+LINCOL*512+IPATRN*4096
      I=IAND(LSET/8,7)
      IF (I.gt.0) LINWID=I
      I=IAND(LSET/64,7)
      IF (I.gt.0) LINTEX=I
      I=IAND(LSET/512,7)
      IF (I.gt.0) LINCOL=I
      IPATRN=MIN(MAX(IAND(LSET/4096,7),1),30)
      END
