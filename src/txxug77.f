C        MORTRAN 2.79 (BRACKETED KEYWORD MACROS OF 09/28/81)          
      BLOCK DATA TXDATA
      INTEGER IXX 
      INTEGER PXELWORDS, MAX_QOPN, QOPNSIZ 
      PARAMETER (PXELWORDS=2000)
      PARAMETER (MAX_QOPN=8)
      PARAMETER (QOPNSIZ=200)
      INTEGER IOPEN(10)
      LOGICAL L_IDOPEN(10)
      INTEGER VIRGIN ,ISEGMN ,JSEGMN, DFTSEG, JPROP, IACT
      LOGICAL LCLEAR ,LERAS ,LINTF, LPROP
      REAL DFTANG ,DFTSIZ ,URSIZE, WDOW(4)
      INTEGER DFTWID ,DFTTEX ,DFTCOL ,DFTVEC ,DFTFNT ,DFTBLK ,DFTPRP ,DF
     *TSTR ,DFTQUI ,PXEL(PXELWORDS)
      COMMON /TXCOMD/PXEL ,LCLEAR ,VIRGIN ,ISEGMN ,JSEGMN ,URSIZE ,DFTCO
     *L ,DFTTEX ,DFTWID ,DFTQUI ,DFTFNT ,DFTANG ,DFTSIZ ,DFTVEC ,LERAS ,
     *DFTPRP ,DFTBLK ,DFTSEG ,LINTF ,IOPEN, L_IDOPEN ,JPROP, LPROP, WDOW
     *, IACT
      INTEGER NQOPNF ,NQTXT
      CHARACTER*(QOPNSIZ) QOPNF
      CHARACTER*(QOPNSIZ) QOPN(MAX_QOPN)
      INTEGER NQOPN(MAX_QOPN)
      CHARACTER*80 QTXT
      COMMON/TXCOMV/NQOPN ,QOPN ,NQTXT ,QTXT ,NQOPNF ,QOPNF
      REAL UR 
      PARAMETER (UR = .1 / 2.54 ) 
      DATA URSIZE/ UR /
      DATA QOPNF/'Default'/
      DATA LINTF/.FALSE./
      DATA QOPN(1)/' '/
      DATA NQOPN/MAX_QOPN*0 /
      DATA QTXT/' '/
      DATA VIRGIN/0/,PXEL(1)/0/
      DATA DFTCOL/1/,DFTWID/2/,DFTTEX/4/
      DATA DFTSIZ/0/,DFTFNT/1/
      DATA DFTPRP/0/,DFTVEC/0/,DFTQUI/0/
      END
      SUBROUTINE TXCURS(X,Y,JCHAR)
      IMPLICIT NONE
      REAL X,Y,XA,TEMP,X1,Y1
      INTEGER I
      INTEGER IXX 
      INTEGER PXELWORDS, MAX_QOPN, QOPNSIZ 
      PARAMETER (PXELWORDS=2000)
      PARAMETER (MAX_QOPN=8)
      PARAMETER (QOPNSIZ=200)
      INTEGER IOPEN(10)
      LOGICAL L_IDOPEN(10)
      INTEGER VIRGIN ,ISEGMN ,JSEGMN, DFTSEG, JPROP, IACT
      LOGICAL LCLEAR ,LERAS ,LINTF, LPROP
      REAL DFTANG ,DFTSIZ ,URSIZE, WDOW(4)
      INTEGER DFTWID ,DFTTEX ,DFTCOL ,DFTVEC ,DFTFNT ,DFTBLK ,DFTPRP ,DF
     *TSTR ,DFTQUI ,PXEL(PXELWORDS)
      COMMON /TXCOMD/PXEL ,LCLEAR ,VIRGIN ,ISEGMN ,JSEGMN ,URSIZE ,DFTCO
     *L ,DFTTEX ,DFTWID ,DFTQUI ,DFTFNT ,DFTANG ,DFTSIZ ,DFTVEC ,LERAS ,
     *DFTPRP ,DFTBLK ,DFTSEG ,LINTF ,IOPEN, L_IDOPEN ,JPROP, LPROP, WDOW
     *, IACT
      INTEGER NQOPNF ,NQTXT
      CHARACTER*(QOPNSIZ) QOPNF
      CHARACTER*(QOPNSIZ) QOPN(MAX_QOPN)
      INTEGER NQOPN(MAX_QOPN)
      CHARACTER*80 QTXT
      COMMON/TXCOMV/NQOPN ,QOPN ,NQTXT ,QTXT ,NQOPNF ,QOPNF
      REAL PLIM(4,4),ZSCRN(2),XLLINE,YLLINE,XTLINE,YTLINE,XFRMFC, PAT(2
     *0),PATCUM,PATTOT,PATMOD,CCSCIS(4),DISPL, RESOL(2)
      INTEGER NPTS,IDDEVC,IPAT,NPAT,LMOVE,IROTAX,IROTAF
      COMMON/TXCOM/PLIM,ZSCRN, XLLINE,YLLINE,XTLINE,YTLINE,XFRMFC, IPA
     *T,NPAT,PAT,PATTOT, NPTS,IDDEVC,CCSCIS,LMOVE,IROTAX,DISPL,IROTAF,P
     *ATCUM,PATMOD, RESOL
      BYTE JCHAR
      INTEGER IA(8)
      CHARACTER*8 STRING
      X=0
      Y=0
      JCHAR=0
      CALL UGSLCT(' ',IOPEN(2))
      CALL UGINFO('CONTROLS',STRING,IA,XA)
      IF(IA(5) .eq. 0) return
      CALL UGENAB('LOCATOR')
      CALL UGECTL('LOCATOR',STRING,I,X1,Y1)
10010 GOTO (10020,10030,10040,10050),IROTAX+1
10020 CONTINUE
      Y=Y1
      X=X1
      GOTO 10012
10030 CONTINUE
      Y=X1
      X=PLIM(3,4)-Y1
      GOTO 10012
10040 CONTINUE
      Y=PLIM(4,4)-Y1
      X=PLIM(3,4)-X1
      GOTO 10012
10050 CONTINUE
      Y=PLIM(4,4)-X1
      X=Y1
      GOTO 10012
10012 CONTINUE
C     JCHAR=I
      JCHAR=ICHAR(STRING(1:1))
      IF (JCHAR.GE.ICHAR('a')) JCHAR=JCHAR-32
      END
      SUBROUTINE TXDEVC(INFOIN,CARDIN)
      IMPLICIT NONE
      INTEGER INFOIN(10)
      CHARACTER*(*) CARDIN
      EXTERNAL UGXERR
      LOGICAL INTRAC
      INTEGER IXX 
      INTEGER PXELWORDS, MAX_QOPN, QOPNSIZ 
      PARAMETER (PXELWORDS=2000)
      PARAMETER (MAX_QOPN=8)
      PARAMETER (QOPNSIZ=200)
      INTEGER IOPEN(10)
      LOGICAL L_IDOPEN(10)
      INTEGER VIRGIN ,ISEGMN ,JSEGMN, DFTSEG, JPROP, IACT
      LOGICAL LCLEAR ,LERAS ,LINTF, LPROP
      REAL DFTANG ,DFTSIZ ,URSIZE, WDOW(4)
      INTEGER DFTWID ,DFTTEX ,DFTCOL ,DFTVEC ,DFTFNT ,DFTBLK ,DFTPRP ,DF
     *TSTR ,DFTQUI ,PXEL(PXELWORDS)
      COMMON /TXCOMD/PXEL ,LCLEAR ,VIRGIN ,ISEGMN ,JSEGMN ,URSIZE ,DFTCO
     *L ,DFTTEX ,DFTWID ,DFTQUI ,DFTFNT ,DFTANG ,DFTSIZ ,DFTVEC ,LERAS ,
     *DFTPRP ,DFTBLK ,DFTSEG ,LINTF ,IOPEN, L_IDOPEN ,JPROP, LPROP, WDOW
     *, IACT
      INTEGER NQOPNF ,NQTXT
      CHARACTER*(QOPNSIZ) QOPNF
      CHARACTER*(QOPNSIZ) QOPN(MAX_QOPN)
      INTEGER NQOPN(MAX_QOPN)
      CHARACTER*80 QTXT
      COMMON/TXCOMV/NQOPN ,QOPN ,NQTXT ,QTXT ,NQOPNF ,QOPNF
      REAL PLIM(4,4),ZSCRN(2),XLLINE,YLLINE,XTLINE,YTLINE,XFRMFC, PAT(2
     *0),PATCUM,PATTOT,PATMOD,CCSCIS(4),DISPL, RESOL(2)
      INTEGER NPTS,IDDEVC,IPAT,NPAT,LMOVE,IROTAX,IROTAF
      COMMON/TXCOM/PLIM,ZSCRN, XLLINE,YLLINE,XTLINE,YTLINE,XFRMFC, IPA
     *T,NPAT,PAT,PATTOT, NPTS,IDDEVC,CCSCIS,LMOVE,IROTAX,DISPL,IROTAF,P
     *ATCUM,PATMOD, RESOL
      COMMON /T2FLGC/ FLAGS(200), LTRAP,LHANDL,LSYERR,LSCREV
      LOGICAL FLAGS, LTRAP,LHANDL,LSYERR,LSCREV(3)
      INTEGER RELFLAG 
      PARAMETER (RELFLAG=151)
      INTEGER IWINLEV 
      INTEGER NWINLEV , MAX_FILL 
      PARAMETER (NWINLEV =4)
      PARAMETER (MAX_FILL=4)
      REAL GRDSYM, GRDSIZ, DATDAT(2,8), H2STAT(12), TITLIN(4), TITFA
     *C(4), TITLOC(4), TITMAR(4), TITLMX(4), TIKFAC, TITINX, TITX1, TIT
     *Y1, TITX, TITY, TITZ, TITSIZ, TITCON(5), REVLEV, REDUCE(5), XFR
     *M12(12), XFRM13(12), XFRM14(12), XFRM23(12), XFRM24(12), XFRM34(6
     *), XVARSX(20), CIRSIZ(2,3), ASIZE, AFLARE, SMSZDF, ORAXES(3), EY
     *EDIR(3), VUEDIR(3), VUECEN(3), VERTCL(3), EYESEP, SCRD, SCRZ, EYE
     *DIS, EYEPNT(3), XYPART(2, 2), BARSIZ(3), BARBRK(3), TIKSIZ(3), XY
     *ZBAS(3), TTHETA, TPHI, FRELBL(4), PATRN(20,30), SCLPRM(10,3), WI
     *NDOW(4), SCREEN(2), SYMBOL, NOSYMB, FACTXY(19), LBLSIZ, SYMSIZ, X
     *YZLIM(3,2), WORLD(3), RADRMX, RADRMN, RADAMN, RADANG, RADX0, RADY
     *0, XUNUSD(6), AXANG(3), REDFAC, DSCAL, PATSZ, MARGIN(4), PSCR(2
     *), OREAL, OCPU, CSCRD, DATPTS, ERRPTS, DATXMN, DATXMX, DATYMN, DA
     *TYMX, DATZMN, DATZMX, DATSUM, ERRSUM, DATAVE, ERRAVE, DATCEN, ERR
     *CEN, DATSTD, ERRSTD, WINREL(2,2,NWINLEV),WINABS(2,2,NWINLEV),WINL
     *IM(2,2), FMARKER(3,8), SYDIR(3), GRDIR(3), EXYZLIM(3,2), DSLOPE(2
     *,2)
      REAL PLOT_EXTENT(2,2),FILL_ANGLE(MAX_FILL),FILL_WIDTH(MAX_FILL)
      INTEGER FILL_INDEX, FILL_TEX(MAX_FILL), N_LINES(6)
      EQUIVALENCE (DATDAT, DATPTS)
      INTEGER MAXREP
      PARAMETER (MAXREP=5)
      INTEGER IPATRN, NPATRN(30), NXYLIM(3,2), NPLOTS, NCSETS, NCCOL, N
     *CROW, IYEAR, IMONTH, IDAY, ISIGFG, ITXPRI, ITXSEC, ITITDT(3), L
     *ENCRD, IPROP, IHTEX, IBLINK, IERASE, ITCNTR, IUNUSD, NXYZ1(3), 
     *NXYZ2(3), LBLFMT(3), LBLCHR(3), NDIMNS(3), IBLKTP, IDIMNS, NMES
     *H0, NMESH1, NMESH2, MESH1, MESH2, MESH3, MESH2D, MESHN(3), NMESHN(
     *2), NFIELD, IFIELD(19), NINCR, NPOINT, IVARBL(19), IVPTR(19), I_
     *VORDER(19,2), LINEAR(4), NONLIN(4), MXECHO, LINES, MAXLNS, USRK
     *BD, USRSCR, PLTFIL, LINWID, LINCOL, LINTEX, ICPOIN(3), IREPCT(MA
     *XREP), LEVREP, GRDTYP, GRDTEX, OUTTEX, IAXTEX, TITEX, LETSET, LAB
     *TEX, TICTEX, SHADOWTYP,SHADOWTEX, NXYZDEF1(10), NXYZDEF2(10), IF
     *ILE_CASE ,MAX_SUBST
      INTEGER MAX_CYCLE
      PARAMETER (MAX_CYCLE=20)
      INTEGER N_CYCLE, ITX_CYCLE(MAX_CYCLE)
      REAL SYM_CYCLE(MAX_CYCLE)
      EQUIVALENCE (NMESH1,NMESHN)
      EQUIVALENCE (MESH1,MESHN)
      INTEGER IBUFFR(400)
      REAL BUFFER(400)
      INTEGER NCHSAVE 
      PARAMETER (NCHSAVE=2*512) 
      INTEGER*4 ICHSAVE(NCHSAVE)
      INTEGER*4 IVRPTR(15)
      CHARACTER*512 OUTSTR,C_FILE, C_NAME, C_SELECT
      CHARACTER C_TIT_ESCAPE*1,C_TIT_SUBSTITUTE*2
      INTEGER N_FILE, N_NAME, N_SELECT
      CHARACTER*8 PXNAME
      CHARACTER*64 INPFMT
      LOGICAL LTDATA, OUTSID(4)
      COMMON /T2COM/ PXNAME, REDUCE, TITX, TITY ,XFRM12, XFRM13, XFRM1
     *4, XFRM23 ,XFRM24, XFRM34 ,XVARSX ,TITSIZ, GRDSYM, GRDSIZ, CIRS
     *IZ, ASIZE, AFLARE ,SMSZDF, ORAXES, EYEDIR, VUEDIR, VUECEN ,VERTC
     *L, EYESEP, SCRD, SCRZ, EYEDIS, EYEPNT ,XYPART, BARSIZ, TIKSIZ, XY
     *ZBAS, TTHETA ,TPHI, FRELBL, IPATRN, NPATRN, PATRN ,SCLPRM, WINDO
     *W, SCREEN, SYMBOL, NOSYMB ,FACTXY, LBLSIZ, SYMSIZ, XYZLIM, WORLD 
     *,RADRMX, RADRMN, RADAMN, RADANG, RADX0, RADY0, XUNUSD ,USRKBD, U
     *SRSCR, PLTFIL ,ITITDT, LENCRD ,INPFMT, GRDTYP, LINWID, LINCOL, L
     *INTEX, TITCON, ITCNTR ,IUNUSD, NXYZ1, NXYZ2 ,LBLCHR, NDIMNS, IBL
     *KTP, IDIMNS ,NMESH1, NMESH2, MESH1, MESH2, MESH3, NFIELD ,IFIELD
     *, NINCR ,IVARBL, IVRPTR ,LINEAR, NONLIN ,NPOINT, LETSET ,MXECH
     *O, LINES, MAXLNS ,AXANG, MESH2D, REDFAC, GRDTEX, OUTTEX, IAXTEX, 
     *TITEX, DSCAL ,OUTSTR, IPROP, IHTEX, IBLINK, IERASE, LABTEX, TICTE
     *X, NXYLIM, PATSZ ,MARGIN, PSCR, ITXPRI, ITXSEC, OREAL, OCPU, CSCR
     *D, OUTSID ,TITLIN, TITINX, TITZ, TITX1, TITY1, LTDATA, NPLOTS, RE
     *VLEV ,LBLFMT, IYEAR, IMONTH, IDAY, ISIGFG ,DATPTS, ERRPTS, DATXM
     *N, DATXMX, DATYMN, DATYMX, DATZMN, DATZMX ,DATSUM, ERRSUM, DATAVE
     *, ERRAVE, DATCEN, ERRCEN, DATSTD, ERRSTD ,NCSETS, NCCOL, NCROW, F
     *MARKER, H2STAT, TITFAC, TITLOC, TITMAR ,TIKFAC, IWINLEV, WINREL, 
     *WINABS, WINLIM ,ICPOIN, LEVREP, IREPCT, SYDIR, GRDIR, NMESH0, EXY
     *ZLIM, IVPTR ,TITLMX, NXYZDEF1, NXYZDEF2, IFILE_CASE, N_CYCLE, ITX
     *_CYCLE ,SYM_CYCLE, PLOT_EXTENT, FILL_ANGLE, FILL_WIDTH, FILL_TEX 
     *,FILL_INDEX ,N_LINES ,DSLOPE ,MAX_SUBST, BARBRK ,I_VORDER,SHADOW
     *TYP,SHADOWTEX
      COMMON /T2SCRT/ BUFFER, IBUFFR, N_FILE,N_NAME,N_SELECT, ICHSAVE
      COMMON /T2_CHAR/ C_TIT_ESCAPE,C_TIT_SUBSTITUTE
      COMMON /T2_SCRT/ C_FILE, C_NAME, C_SELECT
      INTEGER JOUFIL, ERRFIL, OUTFIL, DBGFIL, INPFIL, NINMAX
      PARAMETER (NINMAX=20)
      INTEGER NINP(NINMAX)
      COMMON /T2TRBK/NINP, JOUFIL, ERRFIL, OUTFIL, DBGFIL, INPFIL
      CHARACTER*512 STRNG, STJOU
      LOGICAL LTOKEN
      REAL FLOTNG
      INTEGER INTERP, KEYORD, NSTRNG, MAXSTR, NSTJOU, LSTJOU, NTOKEN
      INTEGER*4 INTEG
      COMMON /TOKENC/ INTERP, INTEG, FLOTNG, KEYORD, NSTRNG, MAXSTR, ST
     *RNG, NSTJOU, LSTJOU, STJOU, LTOKEN, NTOKEN
      INTEGER NDEVICE
      PARAMETER (NDEVICE=31)
      INTEGER CM 
      PARAMETER (CM=2.54)
      CHARACTER*256 INFILE 
      CHARACTER*256 INNAME 
      INTEGER JNNAME 
      CHARACTER*128 DECWD 
      INTEGER NDECWD 
      INTEGER ISTAT 
      INTEGER IOP, IORIENT, ITYPE
      LOGICAL LCOLOR
      CHARACTER*(QOPNSIZ) BUFFR
      INTEGER EXTFLG
      REAL width,height
      LOGICAL LOPEN
      LOGICAL NEWOPN,LTEST,LQUOTE, LDDNAM, L_DEVICE_SET
      INTEGER IFORMT,IFANF,NBUFFR,LARGE,IXXXXX,JCODE,I_WSTYPE
      INTEGER I,J,JBEG,JEND,K,KBEG,KEND
      CHARACTER*1 QUOTE
      INTEGER MAX_GKS_TYPES 
      PARAMETER (MAX_GKS_TYPES=11)
      EXTERNAL TXDATA 
      CHARACTER TKSTR*1075
      CHARACTER*4 GKS_TYPE(MAX_GKS_TYPES)
      CHARACTER*8 DDLIST(NDEVICE)
      CHARACTER*4 EXLIST(NDEVICE)
      LOGICAL LFLUSH, FLUSH(NDEVICE)
      INTEGER T2BTRIM
      LOGICAL T2_GET_LOGICAL,DMMY
      DATA BUFFR/' '/ 
      DATA GKS_TYPE/  'DAT'  ,'AGM'  ,'CGM'  ,'SIX'  ,
     *'HP'  ,'PS'  ,'TEK'  ,'DDIF'  ,'LJ'  ,'EPS'  ,'REG'  /
      DATA DDLIST   /  'SEQGIGI,'  ,'SDDGIGI,'  ,'DECGIGI,'
     *  ,'SDDGRIN,'  ,'IBM2250,'  ,'SEQ4010,'  ,'SDD4010,'  ,'TEK4010,' 
     * ,'VEP12FF,'  ,'VEP12CR,'  ,'VEP12FX,'  ,'VEP12CX,'  ,'CALFICH,'  
     *,'SDDXCOW,'  ,'SDDSXSS,'  ,'SDD4027,'  ,'SEQ4027,'  ,'UGSIXEL,'  ,
     *'PRNTRNX,'  ,'QMS1200,'  ,'SEQEXCL,'  ,'SEQIMAG,'  ,'UGUISDC,'  ,'
     *POST150,'  ,'UGUISWM,'  ,'UGHPGLD,'  ,'UGGKSWM,'  ,'XWINDOW,'  ,'T
     *EKEMUL,'  ,'POSTSCR,'  ,'EPSF,   '  /
      DATA EXLIST /  'reg ', 'reg ', 'reg ', '    ', '    ', 
     *'tek ', 'tek ', 'tek ', 'vep ', 'vep ', 'vep ', 'vep ', 'cal '
     *, '    ', '    ', 'tek ', 'tek ', 'six ', 'ptx ', 'q   ', 'xcl ', 
     *'img ', '    ', 'ps  ', '    ', 'hpgl', '    ', '    ', 'tek ', 'p
     *s ', 'eps '  /
      DATA FLUSH/  .FALSE. , .FALSE. , .TRUE. , .TR
     *UE. , .TRUE. , .FALSE. , .FALSE. , .TRUE. , .FALSE. , .FALSE. , .F
     *ALSE. , .FALSE. , .FALSE. , .TRUE. , .TRUE. , .TRUE. , .FALSE. , .
     *FALSE. , .FALSE. , .FALSE. , .FALSE. , .FALSE. , .TRUE. , .FALSE. 
     *, .TRUE. , .FALSE. , .TRUE. , .TRUE. , .TRUE. , .FALSE. , .FALSE. 
     */
      ITYPE=0
      LCOLOR=.FALSE.
      IORIENT=0
      IOP=1
      width=0
      height=0
      REDUCE(1)=0.
      I_WSTYPE=0
      IDDEVC = 0
      LDDNAM = .FALSE.
      L_DEVICE_SET = .FALSE.
      LOPEN = .false.
      IF (INTRAC(I)) THEN
      IFORMT = 1
      ELSE
      IFORMT = 2
      ENDIF
      IFANF = 0
      IROTAX=0
      EXTFLG=0
      BUFFR='GENIL,'
      NBUFFR=INDEX(BUFFR,' ')
      LTEST=.FALSE.
      LARGE=0
      NEWOPN=.false.
      GOTO 10061
10070 CONTINUE
10080 CONTINUE
      LQUOTE=.false.
      DO 10091 I=1,NSTRNG
      IF(LQUOTE) THEN
      IF (NBUFFR .lt. LEN(BUFFR))BUFFR(NBUFFR:NBUFFR)=STRNG(I:I)
      NBUFFR=NBUFFR+1
      IF (STRNG(I:I).eq.QUOTE)LQUOTE=.not.LQUOTE
      ELSE
      IF (INDEX('''"',STRNG(I:I)) .gt. 0) THEN
      LQUOTE=.not.LQUOTE
      QUOTE=STRNG(I:I)
      ENDIF
      IF(STRNG(I:I).ne.' ') THEN
C***  CALL T2UPCS(STRNG(I:I))
      IF(NBUFFR .lt. LEN(BUFFR))BUFFR(NBUFFR:NBUFFR)=STRNG(I:I)
      NBUFFR=NBUFFR+1
      ENDIF
      ENDIF
10091 CONTINUE
10092 CONTINUE
      IF (NBUFFR .lt. LEN(BUFFR))BUFFR(NBUFFR:NBUFFR)=','
      NBUFFR=NBUFFR+1
      DO 10101 I=1,NDEVICE
      IF(INDEX(BUFFR(1:NBUFFR),DDLIST(I)).gt.0) THEN
      L_DEVICE_SET=.TRUE.
      LFLUSH=FLUSH(I)
      FLAGS(54)=LFLUSH
      ENDIF
10101 CONTINUE
10102 CONTINUE
      GOTO 10061
10130 CONTINUE
      IDDEVC=INTEG
      L_DEVICE_SET=.TRUE.
      GOTO 10061
10140 CONTINUE
      IDDEVC=27
      i_wstype=integ
      L_DEVICE_SET=.true.
      GOTO 10061
10150 CONTINUE
      I_WSTYPE=INTEG
      GOTO 10061
10160 CONTINUE
      LARGE=INTEG
      GOTO 10061
10170 CONTINUE
      IFORMT=INTEG
      GOTO 10061
10180 CONTINUE
      IFANF=INTEG
      GOTO 10061
10190 CONTINUE
      EXTFLG=INTEG
      GOTO 10061
10200 CONTINUE
      INTEG=MOD(INTEG+4,4)
      NEWOPN=IROTAX.ne.INTEG
      IROTAX=INTEG
      GOTO 10061
10210 CONTINUE
      IF (NSTRNG.LE.0) THEN
      CALL T2ERR(INFOIN,CARDIN,('*** ERROR *** Missing string'),4)
      ELSE
      LDDNAM=.TRUE.
      IF (NBUFFR .lt. LEN(BUFFR))BUFFR(NBUFFR:NBUFFR+6)='DDNAME='
      NBUFFR=NBUFFR+7
      GOTO 10080
      ENDIF
      GOTO 10061
10220 CONTINUE
      IORIENT = INTEG
      GOTO 10061
10230 CONTINUE
      LCOLOR=LTOKEN
      GOTO 10061
10240 CONTINUE
      LOPEN=LTOKEN
      GOTO 10061
10250 CONTINUE
      IF (NSTRNG.LE.0) THEN
      CALL T2ERR(INFOIN,CARDIN,('*** ERROR *** Missing string'),4)
      ELSE
      LDDNAM=.TRUE.
      IF (NBUFFR .lt. LEN(BUFFR))BUFFR(NBUFFR:NBUFFR+7)='CHANNEL='
      NBUFFR=NBUFFR+8
      GOTO 10080
      ENDIF
      GOTO 10061
10260 CONTINUE
      IF (NBUFFR .lt. LEN(BUFFR))BUFFR(NBUFFR:NBUFFR+7)='REVERSE,'
      NBUFFR=NBUFFR+8
      GOTO 10061
10270 CONTINUE
      WIDTH=FLOTNG
      GOTO 10061
10280 CONTINUE
      HEIGHT=FLOTNG
      GOTO 10061
10290 CONTINUE
      IF (NSTRNG.LE.0.or.NSTRNG+NBUFFR+10.gt.LEN(BUFFR)) THEN
      CALL T2ERR(INFOIN,CARDIN,('*** ERROR *** IDENT too long or missing
     *'),4)
      ELSE
      IF (NBUFFR .lt. LEN(BUFFR)) BUFFR(NBUFFR:NBUFFR+7)='PICTID='''
      NBUFFR=NBUFFR+8
      IF (NBUFFR .lt. LEN(BUFFR)) BUFFR(NBUFFR:NBUFFR+NSTRNG-1)=STRNG(:N
     *STRNG)
      NBUFFR=NBUFFR+NSTRNG
      IF (NBUFFR .lt. LEN(BUFFR))BUFFR(NBUFFR:NBUFFR)=''','
      NBUFFR=NBUFFR+2
      ENDIF
      GOTO 10061
10300 CONTINUE
      IF (INTEG.gt.0) THEN
      IF (NBUFFR .lt. LEN(BUFFR))BUFFR(NBUFFR:NBUFFR+6)='PICTSQ='
      NBUFFR=NBUFFR+7
      DO 10311 I=1,NSTRNG
      IF (NBUFFR .lt. LEN(BUFFR))BUFFR(NBUFFR:NBUFFR)=STRNG(I:I)
      NBUFFR=NBUFFR+1
10311 CONTINUE
10312 CONTINUE
      IF (NBUFFR .lt. LEN(BUFFR))BUFFR(NBUFFR:NBUFFR)=','
      NBUFFR=NBUFFR+1
      ENDIF
      GOTO 10061
10320 CONTINUE
      NQOPNF=0
      GOTO 10061
10330 CONTINUE
      DO 10341 IOP=1,MAX_QOPN
      IF(NQOPN(IOP) .EQ. 0)GOTO 10342
10341 CONTINUE
10342 CONTINUE
      IF( IOP .gt. MAX_QOPN) CALL T2ERR(INFOIN,CARDIN,('*** ERROR *** Al
     *l units are used'),4)
      GOTO 10061
10350 CONTINUE
      IOP=INTEG
      GOTO 10061
10110 GOTO ( 10130,10130,10130,10130,10130,10130,10130,10130,10130,10130
     *,10130,10130,10130,10130,10130,10130,10130,10130,10130,10130,10130
     *,10130,10130,10130,10130,10130,10140,10140,10140,10140,10140,10140
     *,10140,10140,10140,10140,10140,10140,10140,10140,10140,10140,10140
     *,10140,10140,10140,10140,10140,10140,10140,10140,10140,10140,10140
     *,10140,10140,10140,10140,10140,10140,10140,10140,10140,10150,10160
     *,10160,10160,10170,10170,10170,10180,10180,10190,10190,10200,10200
     *,10200,10200,10200,10210,10210,10210,10220,10220,10230,10240,10250
     *,10260,10270,10280,10290,10300,10320,10330,10350,10130,10065)
     *,KEYORD
C0061 CALL TOKEN(INFOIN,CARDIN,'TEST:0,REGIS:3,GIGI:3,GRINNELL:4,TEK:8,T
C    *EKTRONIX:8,TEK4010:8,TEK4013:8,VERSATEC:9,FICHE:13,COW:14,VAXSTATI
C    *ON:23,SEX:15,TEK4027:16,SIXELS:18,PRINTRONIX:19,QMS1200:20,EXCL:21
C    *,IMAGEN:22,OLDPOST:24,UIS:25,HPGL:26,XWINDOW:28,TEKEMUL:29,POSTSCR
C    *IPT:30,GKS:27,METAFILE:-2002,VT125:11010011,VT125BW:11010012,VT240
C    *:11010013,VT240BW:11010014,VT330:11010016,VT340:11010017,LCP01:-15
C    *,VT330:16,VT340:17,LA100:-4031,LA50:-4032,LA210:-4034,LA75:-4035,L
C    *N03P:-4038,VSXXX:41,LVP16A:-5051,LVP16B:-5052,MPS2000:-55,HP7550:-
C    *5053,HP7580:-5054,HP7585:-5056,GPOSTSCRIPT:-6061,EPS:-10065,DDIF:-
C    *8065,CGM:-3007,TEK4014:7070072,TEK4107:7080082,TEK4207:7083084,TEK
C    *4128:7085086,TEK4129:7087088,VS500:88,TEK4129:88,LJ250:-9091,LJ250
C    *_120DPI:-9092,XGKS:210211,XMOTIF:230231,WSTYPE:0:999:0,LARGE:2,BIG
C    *:2,SMALL:1,INTERACTIVE:1,SEQUENTIAL:2,SLAVE:3,CONTINUOUS:2,FANFOLD
C    *:1,INTERNAL:1,EXTERNAL:2,SIDEWAYS:1,ROTATED:1,NORMAL:0,ORIENTATION
C    *:-3:3:0,,FILE:F,DDNAME:F,OUTPUT:F,LANDSCAPE:0,PORTRAIT:1,COLOR:Y,O
C    *PEN:Y,CHANNEL:F,REVERSE,WIDTH:::0,HEIGHT:::0,IDENT:T,NUMBER:0:9999
C    *:-1,PERMANENT,ADDITIONAL,UNIT:1:8:1,;')
10061 TKSTR(:330)=             'TEST:0,REGIS:3,GIGI:3,GRINNELL:4,TEK:8,T
     *EKTRONIX:8,TEK4010:8,TEK4013:8,VERSATEC:9,FICHE:13,COW:14,VAXSTATI
     *ON:23,SEX:15,TEK4027:16,SIXELS:18,PRINTRONIX:19,QMS1200:20,EXCL:21
     *,IMAGEN:22,OLDPOST:24,UIS:25,HPGL:26,XWINDOW:28,TEKEMUL:29,POSTSCR
     *IPT:30,GKS:27,METAFILE:-2002,VT125:11010011,VT125BW:11010012,VT240
     *:11010013,VT240BW:11010014'
      TKSTR(331:660)=          ',VT330:11010016,VT340:11010017,LCP01:-15
     *,VT330:16,VT340:17,LA100:-4031,LA50:-4032,LA210:-4034,LA75:-4035,L
     *N03P:-4038,VSXXX:41,LVP16A:-5051,LVP16B:-5052,MPS2000:-55,HP7550:-
c    *5053,HP7580:-5054,HP7585:-5056,GPOSTSCRIPT:-6061,EPS:-10065,DDIF:-
     *5053,HP7580:-5054,HP7585:-5056,GPOSTSCRIPT:-6061,GEP:-10065,DDIF:-
     *8065,CGM:-3007,TEK4014:7070072,TEK4107:7080082,TEK4207:7083084,TEK
     *4128:7085086,TEK4129:70870'
      TKSTR(661:)=             '88,VS500:88,TEK4129:88,LJ250:-9091,LJ250
     *_120DPI:-9092,XGKS:210211,XMOTIF:230231,WSTYPE:0:999:0,LARGE:2,BIG
     *:2,SMALL:1,INTERACTIVE:1,SEQUENTIAL:2,SLAVE:3,CONTINUOUS:2,FANFOLD
c    *:1,INTERNAL:1,EXTERNAL:2,SIDEWAYS:1,ROTATED:1,NORMAL:0,ORIENTATION
     *:1,INTERNAL:1,EXTERNAL:2,SIDEWAYS:3,ROTATED:3,NORMAL:0,ORIENTATION
c    *:-3:3:0,,FILE:F,DDNAME:F,OUTPUT:F,LANDSCAPE:0,PORTRAIT:1,COLOR:Y,O
     *:-3:3:0,,FILE:F,DDNAME:F,OUTPUT:F,LANDSCAPE:0,PORTRAIT:3,COLOR:Y,O
     *PEN:Y,CHANNEL:F,REVERSE,WIDTH:::0,HEIGHT:::0,IDENT:T,NUMBER:0:9999
     *:-1,PERMANENT,ADDITIONAL,UNIT:1:8:1,EPSF:31,;'
      CALL TOKEN(INFOIN,CARDIN,TKSTR)
      GOTO (10062,10110,10065,10065,10070,10065,10065,10110,10065),INTER
     *P
10065 CALL T2ERR(INFOIN,CARDIN,' ',5)
      GOTO 10061
10062 CONTINUE
      IF (FLAGS(23)) RETURN
      IROTAF=IROTAX
      IF(.NOT.L_DEVICE_SET.and.NQOPNF.le.0) THEN
      IDDEVC=28
      L_DEVICE_SET=.TRUE.
      ENDIF
      IF (IFORMT.EQ.0) IFORMT = 3
10360 GOTO (10370,10380,10390),IFORMT
10370 CONTINUE
      GOTO 10362
10380 CONTINUE
      IF (IDDEVC.EQ.8) IDDEVC = 6
      IF (IDDEVC.EQ.16)IDDEVC = 17
      IF (IDDEVC.EQ.3) IDDEVC = 1
      GOTO 10362
10390 CONTINUE
      IF (IDDEVC.EQ.3) IDDEVC = 2
      IF (IDDEVC.EQ.8) IDDEVC = 7
      GOTO 10362
10362 CONTINUE
      IF (IFANF.EQ.0) IFANF=1
      IF (IFANF.EQ.2) THEN
      IF (IDDEVC.EQ.9) IDDEVC = 10
      ENDIF
      IF (EXTFLG.EQ.0) EXTFLG=1
      IF (EXTFLG.EQ.2) THEN
      IF (IDDEVC.EQ.9) IDDEVC = 11
      IF (IDDEVC.EQ.10) IDDEVC = 12
      ENDIF
      JBEG=NBUFFR
      IF (IDDEVC.GT.0) THEN
      IDDEVC=MOD(IDDEVC,100)
      LFLUSH=FLUSH(IDDEVC)
      IF (NBUFFR .lt. LEN(BUFFR))BUFFR(NBUFFR:NBUFFR+7)=DDLIST(IDDEVC)
      NBUFFR=NBUFFR+8
      ENDIF
      IF (IDDEVC .eq. 27 .and. i_wstype .ne. 0) THEN
      ELSE IF(IORIENT .eq. 1) THEN
      IF (NBUFFR .lt. LEN(BUFFR)) BUFFR(NBUFFR:)='ROTAXIS,'
      NBUFFR=NBUFFR+8
      ENDIF
      IF ( .NOT.LFLUSH .AND. .NOT.LDDNAM ) THEN
      LDDNAM = .TRUE. 
C     CALL T2_GET_LOGICAL('TOPDRAWER_OUTPUT',INNAME,JNNAME)
      DMMY=T2_GET_LOGICAL('$TOPDRAWER_OUTPUT',INNAME,JNNAME) ! for unix-fortran
      IF ( JNNAME .GE. 1 ) THEN 
      OUTSTR = 'DDNAME='//INNAME(1:JNNAME)//',' 
      ELSE 
      INQUIRE ( UNIT = 9 , NAME = INFILE )
      CALL FILENAME ( INFILE(:T2BTRIM(INFILE)) , INNAME , JNNAME )
C     IF ( INNAME .EQ. ' ' ) THEN
      IF ( T2BTRIM(INNAME) .EQ. 0 ) THEN
      INNAME = 'ugdevice'
      JNNAME = 8
      ENDIF 
      OUTSTR = 'DDNAME='//INNAME(:JNNAME)//'.'//EXLIST(IDDEVC)//','
      ENDIF
      IF (NBUFFR .lt. LEN(BUFFR)) BUFFR(NBUFFR:)=OUTSTR
      NBUFFR=NBUFFR+INDEX(OUTSTR,',')+1
      ENDIF
      IF (IOP .eq. 1) FLAGS(54)=LFLUSH
      IF (WIDTH .gt. 0 .and. NBUFFR+11 .lt. LEN(BUFFR)) THEN
      NBUFFR=NBUFFR+1
      WIDTH=MIN(MAX(WIDTH*CM/REDUCE(2),1.0),99.0)
      WRITE(OUTSTR,'(A,F4.1,A)')'WIDTH=',WIDTH,','
      IF (NBUFFR .lt. LEN(BUFFR))BUFFR(NBUFFR:)=OUTSTR
      NBUFFR=NBUFFR+INDEX(OUTSTR,',')+1
      ENDIF
      IF (HEIGHT .gt. 0 .and. NBUFFR+12 .lt. LEN(BUFFR)) THEN
      NBUFFR=NBUFFR
      HEIGHT=MIN(MAX(HEIGHT*CM/REDUCE(2),1.0),99.0)
      WRITE(OUTSTR,'(A,F4.1,A)')'HEIGHT=',HEIGHT,','
      IF (NBUFFR .lt. LEN(BUFFR))BUFFR(NBUFFR:)=OUTSTR
      NBUFFR=NBUFFR+INDEX(OUTSTR,',')+1
      ENDIF
      DO I=JBEG,NBUFFR
      IF (BUFFR(I:I) .ne. ' ') THEN
      BUFFR(JBEG:JBEG)=BUFFR(I:I)
      JBEG=JBEG+1
      ENDIF
      ENDDO
      NBUFFR=JBEG
      NBUFFR=NBUFFR-1
      CALL T2REST
      FLAGS(53)=FLAGS(54)
      IF(.NOT.L_DEVICE_SET) THEN
      IF(BUFFR.eq.',') NBUFFR=0
      IF(NBUFFR.gt.1) THEN
      QOPNF(NQOPNF+1:)=BUFFR
      ENDIF
      BUFFR=QOPNF
      QOPNF(NQOPNF+1:)=' '
      NBUFFR=MIN(NQOPNF+NBUFFR,LEN(QOPNF))
      FLAGS(53)=LINTF
      FLAGS(54)=LINTF
      ENDIF
      JBEG=1
10401 CONTINUE
      LQUOTE=.false.
      JCODE=0
      JEND=0
      DO 10411 J=JBEG+1,LEN(BUFFR)
      IF (LQUOTE) THEN
      IF (STRNG(I:I).eq.QUOTE)LQUOTE=.not.LQUOTE
      ELSE
      IF (INDEX('''"',STRNG(I:I)) .gt. 0) THEN
      LQUOTE=.not.LQUOTE
      QUOTE=STRNG(I:I)
      ENDIF
      IF(BUFFR(J:J).eq.'=') THEN
      JCODE=J
      ELSEIF(BUFFR(J:J).eq.',') THEN
      JEND=J
      IF(JCODE.eq.0) JCODE=JEND
      GOTO 10412
      ENDIF
      ENDIF
10411 CONTINUE
10412 CONTINUE
      IF(JEND.le.0)GOTO 10402
      IF(JEND.eq.JBEG+1.or.BUFFR(JBEG+1:JEND-1).eq.' ') THEN
      BUFFR(JBEG:)=BUFFR(J:)
      NBUFFR=NBUFFR-J+JBEG
      ELSE
      KBEG=INDEX(BUFFR(JEND:),BUFFR(JBEG:JCODE))
      IF(KBEG.eq.0) THEN
      JBEG=JEND
      ELSE
      LQUOTE=.false.
      KEND=0
      DO 10421 K=KBEG+1,LEN(BUFFR)
      IF (LQUOTE) THEN
      IF (STRNG(I:I).eq.QUOTE)LQUOTE=.not.LQUOTE
      ELSE
      IF (INDEX(STRNG(I:I),'''"' ) .gt. 0) THEN
      LQUOTE=.not.LQUOTE
      QUOTE=STRNG(I:I)
      ENDIF
      IF(BUFFR(K:K).eq.',') THEN
      KEND=K
      GOTO 10422
      ENDIF
      ENDIF
10421 CONTINUE
10422 CONTINUE
      BUFFR(JBEG:)=BUFFR(JEND:)
      NBUFFR=NBUFFR-(JEND-JBEG)
      ENDIF
      ENDIF
      GOTO 10401
10402 CONTINUE
      NEWOPN = BUFFR.NE.QOPN(IOP).or.NEWOPN
      QOPN(IOP) = BUFFR
      NQOPN(IOP) = NBUFFR
      IF(NQOPNF.le.0) THEN
      LINTF = FLAGS(53)
      QOPNF = BUFFR
      NQOPNF = NBUFFR
      ENDIF
      IF (NEWOPN) CALL TXEND
      IF (LOPEN) THEN
      CALL TXEND
      CALL TXXOPN(ZSCRN)
      ENDIF
      END
      SUBROUTINE FILENAME ( FILE , NAME , NNAME ) 
      CHARACTER*(*) FILE 
      CHARACTER*(*) NAME 
      INTEGER NNAME 
      ITOP = INDEX ( FILE , '.top' ) 
      ITDR = INDEX ( FILE , '.tdr' ) 
      IF ( FILE ( ITOP: ) .EQ. '.top' ) THEN 
      NAME = FILE (:ITOP-1) 
      NNAME = ITOP-1 
      ELSE 
     *IF ( FILE ( ITDR: ) .EQ. '.tdr' ) THEN 
      NAME = FILE (:ITDR-1) 
      NNAME = ITDR-1 
      ELSE 
      NAME = FILE 
      NNAME = LEN ( FILE ) 
      ENDIF 
      RETURN 
      END 
      SUBROUTINE TXDEVS
      IMPLICIT NONE
      COMMON /T2FLGC/ FLAGS(200), LTRAP,LHANDL,LSYERR,LSCREV
      LOGICAL FLAGS, LTRAP,LHANDL,LSYERR,LSCREV(3)
      INTEGER RELFLAG 
      PARAMETER (RELFLAG=151)
      INTEGER IWINLEV 
      INTEGER NWINLEV , MAX_FILL 
      PARAMETER (NWINLEV =4)
      PARAMETER (MAX_FILL=4)
      REAL GRDSYM, GRDSIZ, DATDAT(2,8), H2STAT(12), TITLIN(4), TITFA
     *C(4), TITLOC(4), TITMAR(4), TITLMX(4), TIKFAC, TITINX, TITX1, TIT
     *Y1, TITX, TITY, TITZ, TITSIZ, TITCON(5), REVLEV, REDUCE(5), XFR
     *M12(12), XFRM13(12), XFRM14(12), XFRM23(12), XFRM24(12), XFRM34(6
     *), XVARSX(20), CIRSIZ(2,3), ASIZE, AFLARE, SMSZDF, ORAXES(3), EY
     *EDIR(3), VUEDIR(3), VUECEN(3), VERTCL(3), EYESEP, SCRD, SCRZ, EYE
     *DIS, EYEPNT(3), XYPART(2, 2), BARSIZ(3), BARBRK(3), TIKSIZ(3), XY
     *ZBAS(3), TTHETA, TPHI, FRELBL(4), PATRN(20,30), SCLPRM(10,3), WI
     *NDOW(4), SCREEN(2), SYMBOL, NOSYMB, FACTXY(19), LBLSIZ, SYMSIZ, X
     *YZLIM(3,2), WORLD(3), RADRMX, RADRMN, RADAMN, RADANG, RADX0, RADY
     *0, XUNUSD(6), AXANG(3), REDFAC, DSCAL, PATSZ, MARGIN(4), PSCR(2
     *), OREAL, OCPU, CSCRD, DATPTS, ERRPTS, DATXMN, DATXMX, DATYMN, DA
     *TYMX, DATZMN, DATZMX, DATSUM, ERRSUM, DATAVE, ERRAVE, DATCEN, ERR
     *CEN, DATSTD, ERRSTD, WINREL(2,2,NWINLEV),WINABS(2,2,NWINLEV),WINL
     *IM(2,2), FMARKER(3,8), SYDIR(3), GRDIR(3), EXYZLIM(3,2), DSLOPE(2
     *,2)
      REAL PLOT_EXTENT(2,2),FILL_ANGLE(MAX_FILL),FILL_WIDTH(MAX_FILL)
      INTEGER FILL_INDEX, FILL_TEX(MAX_FILL), N_LINES(6)
      EQUIVALENCE (DATDAT, DATPTS)
      INTEGER MAXREP
      PARAMETER (MAXREP=5)
      INTEGER IPATRN, NPATRN(30), NXYLIM(3,2), NPLOTS, NCSETS, NCCOL, N
     *CROW, IYEAR, IMONTH, IDAY, ISIGFG, ITXPRI, ITXSEC, ITITDT(3), L
     *ENCRD, IPROP, IHTEX, IBLINK, IERASE, ITCNTR, IUNUSD, NXYZ1(3), 
     *NXYZ2(3), LBLFMT(3), LBLCHR(3), NDIMNS(3), IBLKTP, IDIMNS, NMES
     *H0, NMESH1, NMESH2, MESH1, MESH2, MESH3, MESH2D, MESHN(3), NMESHN(
     *2), NFIELD, IFIELD(19), NINCR, NPOINT, IVARBL(19), IVPTR(19), I_
     *VORDER(19,2), LINEAR(4), NONLIN(4), MXECHO, LINES, MAXLNS, USRK
     *BD, USRSCR, PLTFIL, LINWID, LINCOL, LINTEX, ICPOIN(3), IREPCT(MA
     *XREP), LEVREP, GRDTYP, GRDTEX, OUTTEX, IAXTEX, TITEX, LETSET, LAB
     *TEX, TICTEX, SHADOWTYP,SHADOWTEX, NXYZDEF1(10), NXYZDEF2(10), IF
     *ILE_CASE ,MAX_SUBST
      INTEGER MAX_CYCLE
      PARAMETER (MAX_CYCLE=20)
      INTEGER N_CYCLE, ITX_CYCLE(MAX_CYCLE)
      REAL SYM_CYCLE(MAX_CYCLE)
      EQUIVALENCE (NMESH1,NMESHN)
      EQUIVALENCE (MESH1,MESHN)
      INTEGER IBUFFR(400)
      REAL BUFFER(400)
      INTEGER NCHSAVE 
      PARAMETER (NCHSAVE=2*512) 
      INTEGER*4 ICHSAVE(NCHSAVE)
      INTEGER*4 IVRPTR(15)
      CHARACTER*512 OUTSTR,C_FILE, C_NAME, C_SELECT
      CHARACTER C_TIT_ESCAPE*1,C_TIT_SUBSTITUTE*2
      INTEGER N_FILE, N_NAME, N_SELECT
      CHARACTER*8 PXNAME
      CHARACTER*64 INPFMT
      LOGICAL LTDATA, OUTSID(4)
      COMMON /T2COM/ PXNAME, REDUCE, TITX, TITY ,XFRM12, XFRM13, XFRM1
     *4, XFRM23 ,XFRM24, XFRM34 ,XVARSX ,TITSIZ, GRDSYM, GRDSIZ, CIRS
     *IZ, ASIZE, AFLARE ,SMSZDF, ORAXES, EYEDIR, VUEDIR, VUECEN ,VERTC
     *L, EYESEP, SCRD, SCRZ, EYEDIS, EYEPNT ,XYPART, BARSIZ, TIKSIZ, XY
     *ZBAS, TTHETA ,TPHI, FRELBL, IPATRN, NPATRN, PATRN ,SCLPRM, WINDO
     *W, SCREEN, SYMBOL, NOSYMB ,FACTXY, LBLSIZ, SYMSIZ, XYZLIM, WORLD 
     *,RADRMX, RADRMN, RADAMN, RADANG, RADX0, RADY0, XUNUSD ,USRKBD, U
     *SRSCR, PLTFIL ,ITITDT, LENCRD ,INPFMT, GRDTYP, LINWID, LINCOL, L
     *INTEX, TITCON, ITCNTR ,IUNUSD, NXYZ1, NXYZ2 ,LBLCHR, NDIMNS, IBL
     *KTP, IDIMNS ,NMESH1, NMESH2, MESH1, MESH2, MESH3, NFIELD ,IFIELD
     *, NINCR ,IVARBL, IVRPTR ,LINEAR, NONLIN ,NPOINT, LETSET ,MXECH
     *O, LINES, MAXLNS ,AXANG, MESH2D, REDFAC, GRDTEX, OUTTEX, IAXTEX, 
     *TITEX, DSCAL ,OUTSTR, IPROP, IHTEX, IBLINK, IERASE, LABTEX, TICTE
     *X, NXYLIM, PATSZ ,MARGIN, PSCR, ITXPRI, ITXSEC, OREAL, OCPU, CSCR
     *D, OUTSID ,TITLIN, TITINX, TITZ, TITX1, TITY1, LTDATA, NPLOTS, RE
     *VLEV ,LBLFMT, IYEAR, IMONTH, IDAY, ISIGFG ,DATPTS, ERRPTS, DATXM
     *N, DATXMX, DATYMN, DATYMX, DATZMN, DATZMX ,DATSUM, ERRSUM, DATAVE
     *, ERRAVE, DATCEN, ERRCEN, DATSTD, ERRSTD ,NCSETS, NCCOL, NCROW, F
     *MARKER, H2STAT, TITFAC, TITLOC, TITMAR ,TIKFAC, IWINLEV, WINREL, 
     *WINABS, WINLIM ,ICPOIN, LEVREP, IREPCT, SYDIR, GRDIR, NMESH0, EXY
     *ZLIM, IVPTR ,TITLMX, NXYZDEF1, NXYZDEF2, IFILE_CASE, N_CYCLE, ITX
     *_CYCLE ,SYM_CYCLE, PLOT_EXTENT, FILL_ANGLE, FILL_WIDTH, FILL_TEX 
     *,FILL_INDEX ,N_LINES ,DSLOPE ,MAX_SUBST, BARBRK ,I_VORDER,SHADOW
     *TYP,SHADOWTEX
      COMMON /T2SCRT/ BUFFER, IBUFFR, N_FILE,N_NAME,N_SELECT, ICHSAVE
      COMMON /T2_CHAR/ C_TIT_ESCAPE,C_TIT_SUBSTITUTE
      COMMON /T2_SCRT/ C_FILE, C_NAME, C_SELECT
      INTEGER JOUFIL, ERRFIL, OUTFIL, DBGFIL, INPFIL, NINMAX
      PARAMETER (NINMAX=20)
      INTEGER NINP(NINMAX)
      COMMON /T2TRBK/NINP, JOUFIL, ERRFIL, OUTFIL, DBGFIL, INPFIL
      CHARACTER*512 STRNG, STJOU
      LOGICAL LTOKEN
      REAL FLOTNG
      INTEGER INTERP, KEYORD, NSTRNG, MAXSTR, NSTJOU, LSTJOU, NTOKEN
      INTEGER*4 INTEG
      COMMON /TOKENC/ INTERP, INTEG, FLOTNG, KEYORD, NSTRNG, MAXSTR, ST
     *RNG, NSTJOU, LSTJOU, STJOU, LTOKEN, NTOKEN
      EXTERNAL UGXERR
      INTEGER IXX 
      INTEGER PXELWORDS, MAX_QOPN, QOPNSIZ 
      PARAMETER (PXELWORDS=2000)
      PARAMETER (MAX_QOPN=8)
      PARAMETER (QOPNSIZ=200)
      INTEGER IOPEN(10)
      LOGICAL L_IDOPEN(10)
      INTEGER VIRGIN ,ISEGMN ,JSEGMN, DFTSEG, JPROP, IACT
      LOGICAL LCLEAR ,LERAS ,LINTF, LPROP
      REAL DFTANG ,DFTSIZ ,URSIZE, WDOW(4)
      INTEGER DFTWID ,DFTTEX ,DFTCOL ,DFTVEC ,DFTFNT ,DFTBLK ,DFTPRP ,DF
     *TSTR ,DFTQUI ,PXEL(PXELWORDS)
      COMMON /TXCOMD/PXEL ,LCLEAR ,VIRGIN ,ISEGMN ,JSEGMN ,URSIZE ,DFTCO
     *L ,DFTTEX ,DFTWID ,DFTQUI ,DFTFNT ,DFTANG ,DFTSIZ ,DFTVEC ,LERAS ,
     *DFTPRP ,DFTBLK ,DFTSEG ,LINTF ,IOPEN, L_IDOPEN ,JPROP, LPROP, WDOW
     *, IACT
      INTEGER NQOPNF ,NQTXT
      CHARACTER*(QOPNSIZ) QOPNF
      CHARACTER*(QOPNSIZ) QOPN(MAX_QOPN)
      INTEGER NQOPN(MAX_QOPN)
      CHARACTER*80 QTXT
      COMMON/TXCOMV/NQOPN ,QOPN ,NQTXT ,QTXT ,NQOPNF ,QOPNF
      character*20 T2_GET_UNIT_NAME,CUNIT
      character*11 CLEVEL(3)
      character*11 Controls(6)
      character*10 cmedium(3)
      character*8 CENABL(2)
      character*4 CEXT(4)
      character*6 CINTER(6)
      character*8 string
      character*6 CURDEV(2)
      integer IA(10),IE(10),I,J,ILEVEL,IOP
      integer T2BTRIM
      REAL DSPC(2),X(2),AFF
      data CUNIT/' '/
      data clevel/'Hardcopy','Slave','Interactive'/
      data controls/'Keyboard','Pick','Button'  ,'Stroke','Locator','Val
     *uator'/
      data cmedium/'Nonerase','Raster','Refresh'/
      DATA CENABL /'Disabled','Enabled'/
      DATA CEXT/'Xmin','Ymin','Xmax','Ymax'/
      DATA CURDEV/' ',' <===='/
      IF(NQOPNF.gt.0) WRITE(6,*)'   Default:',QOPNF(1:NQOPNF)
      DO 10431 IOP=1,MAX_QOPN
      IF (NQOPN(IOP) .gt. 0) WRITE(6,*)'   Device:',IOP,' ' ,QOPN(IOP)(:
     *MAX(1,NQOPN(IOP)))
10431 CONTINUE
10432 CONTINUE
      CALL UGINFO('OPENDEV',STRING,IOPEN,WDOW)
      IF(IOPEN(1) .eq. 0) return
      CUNIT(2:)=T2_GET_UNIT_NAME(1.)
      CALL UGINFO('ACTDEV',STRING,IACT,WDOW)
      DO 10441 IOP=2,IOPEN(1)+1
      J=1
      IF (IOPEN(IOP).eq.IACT) J=2
      WRITE(6,*)'   Unit=',IOPEN(IOP),CURDEV(J)
      CALL UGSLCT(' ',IOPEN(IOP))
      CALL UGDSPC('GET',X,X(2),AFF)
      WRITE(6,*)'     Size=',X(1),' by '  ,X(2),CUNIT(:T2BTRIM(CUNIT))
      DO 10451 I=1,4
      IA(I)=0
10451 CONTINUE
10452 CONTINUE
      CALL UGINFO('DPHYSIZE',STRING,IA,WDOW)
      IF (IA(3) .gt. 0) THEN
      DO 10461 I=1,2
      IA(I+2)=IA(I+2)-IA(I)+1
      WDOW(I)=WDOW(I)/2.54
10461 CONTINUE
10462 CONTINUE
      WRITE(6,*)'     Res.=',WDOW(1),' by ',WDOW(2)  ,CUNIT(:T2BTRIM(CUN
     *IT))
      WRITE(6,*)'     Pxel=',IA(3),'    by ',IA(4)
      ENDIF
      CALL UGINFO('ILEVEL',STRING,Ilevel,WDOW)
      CALL UGINFO('DMEDIUM',STRING,IA,WDOW)
      CALL UGINFO('DEVTYPE',STRING,IA,WDOW)
      WRITE(6,*)'     ',STRING,' - ',CLEVEL(ILEVEL),' - '  ,CMEDIUM(IA(2
     *))
      IF(ILEVEL.EQ.3) THEN
      CALL UGINFO('CONTROLS',STRING,ia,WDOW)
      CALL UGINFO('ECONTROLS',STRING,IE,WDOW)
      DO 10471 I=1,6
      J=MIN(MAX(IE(I)+1,1),2)
      If(IA(I) .ne. 0) WRITE(6,*)  '     Controls= ',controls(I),' - ',C
     *ENABL(J)
10471 CONTINUE
10472 CONTINUE
      ENDIF
10441 CONTINUE
10442 CONTINUE
      CALL UGSLCT(' ',IACT)
      END
      REAL FUNCTION TXSYM(TEXT)
      IMPLICIT NONE
      CHARACTER*(*) TEXT
      CHARACTER*5 STR
      INTEGER I,J
      STR=TEXT
      CALL T2UPCS(STR)
      IF(STR.eq.'NONE') THEN
      TXSYM=0
      ELSEIF(STR.eq.'DOT') THEN
      TXSYM=ICHAR(' ')*257
      ELSE
      I=ICHAR(TEXT(1:1))
      IF(LEN(TEXT).gt.1) THEN
      IF(STR(2:2).eq.'0') STR(2:2)='O'
      IF(STR(2:2).ne.' ') I=ICHAR(STR(1:1))
      J=ICHAR(STR(2:2))
      ELSE
      J=ICHAR(' ')
      ENDIF
      TXSYM=256*I+J
      IF (LEN(TEXT).gt.2) THEN
      STR = TEXT 
      CALL T2ERR(0,' ','*** WARNING *** Illegal symbol "'//STR//'"',3)
      ENDIF
      ENDIF
      END
      SUBROUTINE SYMTXT(SYM,TXT)
      IMPLICIT NONE
      REAL SYM,SYMBOL
      CHARACTER*2 TXT
      INTEGER I,J
      J=0
      IF(ABS(SYM) .lt. 65536.)J=NINT(SYM)
      I=J/256
      J=MOD(J,256)
      IF(I.lt.32.or.I.gt.127) I=32
      IF(J.lt.32.or.J.gt.127) J=32
      TXT=CHAR(I)//CHAR(J)
      END
      SUBROUTINE TXTEXT(X1,Y1,SIZEIN,ORIENT,TEXT,CASE)
      IMPLICIT NONE
      INTEGER NTEXT,NCASE
      REAL X1,Y1,SIZEIN,ORIENT,X,Y
      CHARACTER *(*) TEXT,CASE
      REAL SIZE,ANGLE,TEMP
      INTEGER I
      EXTERNAL UGXERR
      INTEGER IXX 
      INTEGER PXELWORDS, MAX_QOPN, QOPNSIZ 
      PARAMETER (PXELWORDS=2000)
      PARAMETER (MAX_QOPN=8)
      PARAMETER (QOPNSIZ=200)
      INTEGER IOPEN(10)
      LOGICAL L_IDOPEN(10)
      INTEGER VIRGIN ,ISEGMN ,JSEGMN, DFTSEG, JPROP, IACT
      LOGICAL LCLEAR ,LERAS ,LINTF, LPROP
      REAL DFTANG ,DFTSIZ ,URSIZE, WDOW(4)
      INTEGER DFTWID ,DFTTEX ,DFTCOL ,DFTVEC ,DFTFNT ,DFTBLK ,DFTPRP ,DF
     *TSTR ,DFTQUI ,PXEL(PXELWORDS)
      COMMON /TXCOMD/PXEL ,LCLEAR ,VIRGIN ,ISEGMN ,JSEGMN ,URSIZE ,DFTCO
     *L ,DFTTEX ,DFTWID ,DFTQUI ,DFTFNT ,DFTANG ,DFTSIZ ,DFTVEC ,LERAS ,
     *DFTPRP ,DFTBLK ,DFTSEG ,LINTF ,IOPEN, L_IDOPEN ,JPROP, LPROP, WDOW
     *, IACT
      INTEGER NQOPNF ,NQTXT
      CHARACTER*(QOPNSIZ) QOPNF
      CHARACTER*(QOPNSIZ) QOPN(MAX_QOPN)
      INTEGER NQOPN(MAX_QOPN)
      CHARACTER*80 QTXT
      COMMON/TXCOMV/NQOPN ,QOPN ,NQTXT ,QTXT ,NQOPNF ,QOPNF
      REAL PLIM(4,4),ZSCRN(2),XLLINE,YLLINE,XTLINE,YTLINE,XFRMFC, PAT(2
     *0),PATCUM,PATTOT,PATMOD,CCSCIS(4),DISPL, RESOL(2)
      INTEGER NPTS,IDDEVC,IPAT,NPAT,LMOVE,IROTAX,IROTAF
      COMMON/TXCOM/PLIM,ZSCRN, XLLINE,YLLINE,XTLINE,YTLINE,XFRMFC, IPA
     *T,NPAT,PAT,PATTOT, NPTS,IDDEVC,CCSCIS,LMOVE,IROTAX,DISPL,IROTAF,P
     *ATCUM,PATMOD, RESOL
      COMMON /T2FLGC/ FLAGS(200), LTRAP,LHANDL,LSYERR,LSCREV
      LOGICAL FLAGS, LTRAP,LHANDL,LSYERR,LSCREV(3)
      INTEGER RELFLAG 
      PARAMETER (RELFLAG=151)
      INTEGER IWINLEV 
      INTEGER NWINLEV , MAX_FILL 
      PARAMETER (NWINLEV =4)
      PARAMETER (MAX_FILL=4)
      REAL GRDSYM, GRDSIZ, DATDAT(2,8), H2STAT(12), TITLIN(4), TITFA
     *C(4), TITLOC(4), TITMAR(4), TITLMX(4), TIKFAC, TITINX, TITX1, TIT
     *Y1, TITX, TITY, TITZ, TITSIZ, TITCON(5), REVLEV, REDUCE(5), XFR
     *M12(12), XFRM13(12), XFRM14(12), XFRM23(12), XFRM24(12), XFRM34(6
     *), XVARSX(20), CIRSIZ(2,3), ASIZE, AFLARE, SMSZDF, ORAXES(3), EY
     *EDIR(3), VUEDIR(3), VUECEN(3), VERTCL(3), EYESEP, SCRD, SCRZ, EYE
     *DIS, EYEPNT(3), XYPART(2, 2), BARSIZ(3), BARBRK(3), TIKSIZ(3), XY
     *ZBAS(3), TTHETA, TPHI, FRELBL(4), PATRN(20,30), SCLPRM(10,3), WI
     *NDOW(4), SCREEN(2), SYMBOL, NOSYMB, FACTXY(19), LBLSIZ, SYMSIZ, X
     *YZLIM(3,2), WORLD(3), RADRMX, RADRMN, RADAMN, RADANG, RADX0, RADY
     *0, XUNUSD(6), AXANG(3), REDFAC, DSCAL, PATSZ, MARGIN(4), PSCR(2
     *), OREAL, OCPU, CSCRD, DATPTS, ERRPTS, DATXMN, DATXMX, DATYMN, DA
     *TYMX, DATZMN, DATZMX, DATSUM, ERRSUM, DATAVE, ERRAVE, DATCEN, ERR
     *CEN, DATSTD, ERRSTD, WINREL(2,2,NWINLEV),WINABS(2,2,NWINLEV),WINL
     *IM(2,2), FMARKER(3,8), SYDIR(3), GRDIR(3), EXYZLIM(3,2), DSLOPE(2
     *,2)
      REAL PLOT_EXTENT(2,2),FILL_ANGLE(MAX_FILL),FILL_WIDTH(MAX_FILL)
      INTEGER FILL_INDEX, FILL_TEX(MAX_FILL), N_LINES(6)
      EQUIVALENCE (DATDAT, DATPTS)
      INTEGER MAXREP
      PARAMETER (MAXREP=5)
      INTEGER IPATRN, NPATRN(30), NXYLIM(3,2), NPLOTS, NCSETS, NCCOL, N
     *CROW, IYEAR, IMONTH, IDAY, ISIGFG, ITXPRI, ITXSEC, ITITDT(3), L
     *ENCRD, IPROP, IHTEX, IBLINK, IERASE, ITCNTR, IUNUSD, NXYZ1(3), 
     *NXYZ2(3), LBLFMT(3), LBLCHR(3), NDIMNS(3), IBLKTP, IDIMNS, NMES
     *H0, NMESH1, NMESH2, MESH1, MESH2, MESH3, MESH2D, MESHN(3), NMESHN(
     *2), NFIELD, IFIELD(19), NINCR, NPOINT, IVARBL(19), IVPTR(19), I_
     *VORDER(19,2), LINEAR(4), NONLIN(4), MXECHO, LINES, MAXLNS, USRK
     *BD, USRSCR, PLTFIL, LINWID, LINCOL, LINTEX, ICPOIN(3), IREPCT(MA
     *XREP), LEVREP, GRDTYP, GRDTEX, OUTTEX, IAXTEX, TITEX, LETSET, LAB
     *TEX, TICTEX, SHADOWTYP,SHADOWTEX, NXYZDEF1(10), NXYZDEF2(10), IF
     *ILE_CASE ,MAX_SUBST
      INTEGER MAX_CYCLE
      PARAMETER (MAX_CYCLE=20)
      INTEGER N_CYCLE, ITX_CYCLE(MAX_CYCLE)
      REAL SYM_CYCLE(MAX_CYCLE)
      EQUIVALENCE (NMESH1,NMESHN)
      EQUIVALENCE (MESH1,MESHN)
      INTEGER IBUFFR(400)
      REAL BUFFER(400)
      INTEGER NCHSAVE 
      PARAMETER (NCHSAVE=2*512) 
      INTEGER*4 ICHSAVE(NCHSAVE)
      INTEGER*4 IVRPTR(15)
      CHARACTER*512 OUTSTR,C_FILE, C_NAME, C_SELECT
      CHARACTER C_TIT_ESCAPE*1,C_TIT_SUBSTITUTE*2
      INTEGER N_FILE, N_NAME, N_SELECT
      CHARACTER*8 PXNAME
      CHARACTER*64 INPFMT
      LOGICAL LTDATA, OUTSID(4)
      COMMON /T2COM/ PXNAME, REDUCE, TITX, TITY ,XFRM12, XFRM13, XFRM1
     *4, XFRM23 ,XFRM24, XFRM34 ,XVARSX ,TITSIZ, GRDSYM, GRDSIZ, CIRS
     *IZ, ASIZE, AFLARE ,SMSZDF, ORAXES, EYEDIR, VUEDIR, VUECEN ,VERTC
     *L, EYESEP, SCRD, SCRZ, EYEDIS, EYEPNT ,XYPART, BARSIZ, TIKSIZ, XY
     *ZBAS, TTHETA ,TPHI, FRELBL, IPATRN, NPATRN, PATRN ,SCLPRM, WINDO
     *W, SCREEN, SYMBOL, NOSYMB ,FACTXY, LBLSIZ, SYMSIZ, XYZLIM, WORLD 
     *,RADRMX, RADRMN, RADAMN, RADANG, RADX0, RADY0, XUNUSD ,USRKBD, U
     *SRSCR, PLTFIL ,ITITDT, LENCRD ,INPFMT, GRDTYP, LINWID, LINCOL, L
     *INTEX, TITCON, ITCNTR ,IUNUSD, NXYZ1, NXYZ2 ,LBLCHR, NDIMNS, IBL
     *KTP, IDIMNS ,NMESH1, NMESH2, MESH1, MESH2, MESH3, NFIELD ,IFIELD
     *, NINCR ,IVARBL, IVRPTR ,LINEAR, NONLIN ,NPOINT, LETSET ,MXECH
     *O, LINES, MAXLNS ,AXANG, MESH2D, REDFAC, GRDTEX, OUTTEX, IAXTEX, 
     *TITEX, DSCAL ,OUTSTR, IPROP, IHTEX, IBLINK, IERASE, LABTEX, TICTE
     *X, NXYLIM, PATSZ ,MARGIN, PSCR, ITXPRI, ITXSEC, OREAL, OCPU, CSCR
     *D, OUTSID ,TITLIN, TITINX, TITZ, TITX1, TITY1, LTDATA, NPLOTS, RE
     *VLEV ,LBLFMT, IYEAR, IMONTH, IDAY, ISIGFG ,DATPTS, ERRPTS, DATXM
     *N, DATXMX, DATYMN, DATYMX, DATZMN, DATZMX ,DATSUM, ERRSUM, DATAVE
     *, ERRAVE, DATCEN, ERRCEN, DATSTD, ERRSTD ,NCSETS, NCCOL, NCROW, F
     *MARKER, H2STAT, TITFAC, TITLOC, TITMAR ,TIKFAC, IWINLEV, WINREL, 
     *WINABS, WINLIM ,ICPOIN, LEVREP, IREPCT, SYDIR, GRDIR, NMESH0, EXY
     *ZLIM, IVPTR ,TITLMX, NXYZDEF1, NXYZDEF2, IFILE_CASE, N_CYCLE, ITX
     *_CYCLE ,SYM_CYCLE, PLOT_EXTENT, FILL_ANGLE, FILL_WIDTH, FILL_TEX 
     *,FILL_INDEX ,N_LINES ,DSLOPE ,MAX_SUBST, BARBRK ,I_VORDER,SHADOW
     *TYP,SHADOWTEX
      COMMON /T2SCRT/ BUFFER, IBUFFR, N_FILE,N_NAME,N_SELECT, ICHSAVE
      COMMON /T2_CHAR/ C_TIT_ESCAPE,C_TIT_SUBSTITUTE
      COMMON /T2_SCRT/ C_FILE, C_NAME, C_SELECT
      INTEGER JOUFIL, ERRFIL, OUTFIL, DBGFIL, INPFIL, NINMAX
      PARAMETER (NINMAX=20)
      INTEGER NINP(NINMAX)
      COMMON /T2TRBK/NINP, JOUFIL, ERRFIL, OUTFIL, DBGFIL, INPFIL
      CHARACTER*512 STRNG, STJOU
      LOGICAL LTOKEN
      REAL FLOTNG
      INTEGER INTERP, KEYORD, NSTRNG, MAXSTR, NSTJOU, LSTJOU, NTOKEN
      INTEGER*4 INTEG
      COMMON /TOKENC/ INTERP, INTEG, FLOTNG, KEYORD, NSTRNG, MAXSTR, ST
     *RNG, NSTJOU, LSTJOU, STJOU, LTOKEN, NTOKEN
      CHARACTER*12 STEMP
      CHARACTER*7 S_PROP(2)
      DATA STEMP/' '/
      DATA S_PROP/' ','FIXSIZE'/
10480 GOTO (10490,10500,10510,10520),IROTAX+1
10490 CONTINUE
      X=X1
      Y=Y1
      GOTO 10482
10500 CONTINUE
      X=Y1
      Y=PLIM(3,4)-X1
      GOTO 10482
10510 CONTINUE
      X=PLIM(3,4)-X1
      Y=PLIM(4,4)-Y1
      GOTO 10482
10520 CONTINUE
      X=PLIM(4,4)-Y1
      Y=X1
      GOTO 10482
10482 CONTINUE
      IF (TEXT.ne.' ') THEN
      NTEXT=LEN(TEXT)
      NCASE=LEN(CASE)
      SIZE = ABS(SIZEIN*XFRMFC*REDUCE(2))
      ANGLE=AMOD(ORIENT+IROTAX*(-90.),360.)
      IF (ABS(SIZE-DFTSIZ).GT.0.02*SIZE .OR. ABS(ANGLE-DFTANG).GE.0.1 )T
     *HEN
      QTXT=' '
      NQTXT=1
      IF (ABS(ANGLE-DFTANG).GE.0.1) THEN
      QTXT(NQTXT:NQTXT+5)='ANGLE='
      NQTXT=NQTXT+6
      WRITE(STEMP,'(F11.1,A)') ANGLE,','
      DO 10531 I=1,12
      IF(STEMP(I:I).ne.' ') THEN
      QTXT(NQTXT:NQTXT)=STEMP(I:I)
      NQTXT=NQTXT+1
      ENDIF
10531 CONTINUE
10532 CONTINUE
      DFTANG = ANGLE
      ENDIF
      IF (ABS(SIZE-DFTSIZ).GT.0.02*DFTSIZ) THEN
      TEMP = ABS(0.1*SIZE/URSIZE)
      TEMP = AMIN1(AMAX1(TEMP,.0001),99999.)
      QTXT(NQTXT:NQTXT+5)='DSIZE='
      NQTXT=NQTXT+6
      WRITE(STEMP,'(F11.4,A)') TEMP,','
      DO 10541 I=1,12
      IF(STEMP(I:I).ne.' ') THEN
      NQTXT=NQTXT+1
      QTXT(NQTXT:NQTXT)=STEMP(I:I)
      ENDIF
10541 CONTINUE
10542 CONTINUE
      DFTSIZ = SIZE
      ENDIF
      CALL UGDEFL(QTXT(1:NQTXT),IXX,IXX)
      ENDIF
      FLAGS(1)=.FALSE.
      I=MIN(MAX(JPROP,0),1)
      JPROP=0
      if (CASE .ne. ' '.or.(DFTVEC.eq.0.and.SIZEIN.gt.0)) then
      call td2ugs(text,case)
      CALL UGXTXT(S_PROP(JPROP+1),X,Y,TEXT,CASE,PXEL)
      else
      CALL UGTEXT(S_PROP(JPROP+1),X,Y,TEXT,PXEL)
      endif
      FLAGS(1) = .FALSE.
      ENDIF
      END
      SUBROUTINE TXTSYM(X,Y,SYM,SIZEIN)
      IMPLICIT NONE
      EXTERNAL UGXERR
      INTEGER IXX 
      INTEGER PXELWORDS, MAX_QOPN, QOPNSIZ 
      PARAMETER (PXELWORDS=2000)
      PARAMETER (MAX_QOPN=8)
      PARAMETER (QOPNSIZ=200)
      INTEGER IOPEN(10)
      LOGICAL L_IDOPEN(10)
      INTEGER VIRGIN ,ISEGMN ,JSEGMN, DFTSEG, JPROP, IACT
      LOGICAL LCLEAR ,LERAS ,LINTF, LPROP
      REAL DFTANG ,DFTSIZ ,URSIZE, WDOW(4)
      INTEGER DFTWID ,DFTTEX ,DFTCOL ,DFTVEC ,DFTFNT ,DFTBLK ,DFTPRP ,DF
     *TSTR ,DFTQUI ,PXEL(PXELWORDS)
      COMMON /TXCOMD/PXEL ,LCLEAR ,VIRGIN ,ISEGMN ,JSEGMN ,URSIZE ,DFTCO
     *L ,DFTTEX ,DFTWID ,DFTQUI ,DFTFNT ,DFTANG ,DFTSIZ ,DFTVEC ,LERAS ,
     *DFTPRP ,DFTBLK ,DFTSEG ,LINTF ,IOPEN, L_IDOPEN ,JPROP, LPROP, WDOW
     *, IACT
      INTEGER NQOPNF ,NQTXT
      CHARACTER*(QOPNSIZ) QOPNF
      CHARACTER*(QOPNSIZ) QOPN(MAX_QOPN)
      INTEGER NQOPN(MAX_QOPN)
      CHARACTER*80 QTXT
      COMMON/TXCOMV/NQOPN ,QOPN ,NQTXT ,QTXT ,NQOPNF ,QOPNF
      REAL PLIM(4,4),ZSCRN(2),XLLINE,YLLINE,XTLINE,YTLINE,XFRMFC, PAT(2
     *0),PATCUM,PATTOT,PATMOD,CCSCIS(4),DISPL, RESOL(2)
      INTEGER NPTS,IDDEVC,IPAT,NPAT,LMOVE,IROTAX,IROTAF
      COMMON/TXCOM/PLIM,ZSCRN, XLLINE,YLLINE,XTLINE,YTLINE,XFRMFC, IPA
     *T,NPAT,PAT,PATTOT, NPTS,IDDEVC,CCSCIS,LMOVE,IROTAX,DISPL,IROTAF,P
     *ATCUM,PATMOD, RESOL
      REAL X,Y,SYM,SIZEIN
      INTEGER I,I1,I2
      COMMON /T2FLGC/ FLAGS(200), LTRAP,LHANDL,LSYERR,LSCREV
      LOGICAL FLAGS, LTRAP,LHANDL,LSYERR,LSCREV(3)
      INTEGER RELFLAG 
      PARAMETER (RELFLAG=151)
      INTEGER IWINLEV 
      INTEGER NWINLEV , MAX_FILL 
      PARAMETER (NWINLEV =4)
      PARAMETER (MAX_FILL=4)
      REAL GRDSYM, GRDSIZ, DATDAT(2,8), H2STAT(12), TITLIN(4), TITFA
     *C(4), TITLOC(4), TITMAR(4), TITLMX(4), TIKFAC, TITINX, TITX1, TIT
     *Y1, TITX, TITY, TITZ, TITSIZ, TITCON(5), REVLEV, REDUCE(5), XFR
     *M12(12), XFRM13(12), XFRM14(12), XFRM23(12), XFRM24(12), XFRM34(6
     *), XVARSX(20), CIRSIZ(2,3), ASIZE, AFLARE, SMSZDF, ORAXES(3), EY
     *EDIR(3), VUEDIR(3), VUECEN(3), VERTCL(3), EYESEP, SCRD, SCRZ, EYE
     *DIS, EYEPNT(3), XYPART(2, 2), BARSIZ(3), BARBRK(3), TIKSIZ(3), XY
     *ZBAS(3), TTHETA, TPHI, FRELBL(4), PATRN(20,30), SCLPRM(10,3), WI
     *NDOW(4), SCREEN(2), SYMBOL, NOSYMB, FACTXY(19), LBLSIZ, SYMSIZ, X
     *YZLIM(3,2), WORLD(3), RADRMX, RADRMN, RADAMN, RADANG, RADX0, RADY
     *0, XUNUSD(6), AXANG(3), REDFAC, DSCAL, PATSZ, MARGIN(4), PSCR(2
     *), OREAL, OCPU, CSCRD, DATPTS, ERRPTS, DATXMN, DATXMX, DATYMN, DA
     *TYMX, DATZMN, DATZMX, DATSUM, ERRSUM, DATAVE, ERRAVE, DATCEN, ERR
     *CEN, DATSTD, ERRSTD, WINREL(2,2,NWINLEV),WINABS(2,2,NWINLEV),WINL
     *IM(2,2), FMARKER(3,8), SYDIR(3), GRDIR(3), EXYZLIM(3,2), DSLOPE(2
     *,2)
      REAL PLOT_EXTENT(2,2),FILL_ANGLE(MAX_FILL),FILL_WIDTH(MAX_FILL)
      INTEGER FILL_INDEX, FILL_TEX(MAX_FILL), N_LINES(6)
      EQUIVALENCE (DATDAT, DATPTS)
      INTEGER MAXREP
      PARAMETER (MAXREP=5)
      INTEGER IPATRN, NPATRN(30), NXYLIM(3,2), NPLOTS, NCSETS, NCCOL, N
     *CROW, IYEAR, IMONTH, IDAY, ISIGFG, ITXPRI, ITXSEC, ITITDT(3), L
     *ENCRD, IPROP, IHTEX, IBLINK, IERASE, ITCNTR, IUNUSD, NXYZ1(3), 
     *NXYZ2(3), LBLFMT(3), LBLCHR(3), NDIMNS(3), IBLKTP, IDIMNS, NMES
     *H0, NMESH1, NMESH2, MESH1, MESH2, MESH3, MESH2D, MESHN(3), NMESHN(
     *2), NFIELD, IFIELD(19), NINCR, NPOINT, IVARBL(19), IVPTR(19), I_
     *VORDER(19,2), LINEAR(4), NONLIN(4), MXECHO, LINES, MAXLNS, USRK
     *BD, USRSCR, PLTFIL, LINWID, LINCOL, LINTEX, ICPOIN(3), IREPCT(MA
     *XREP), LEVREP, GRDTYP, GRDTEX, OUTTEX, IAXTEX, TITEX, LETSET, LAB
     *TEX, TICTEX, SHADOWTYP,SHADOWTEX, NXYZDEF1(10), NXYZDEF2(10), IF
     *ILE_CASE ,MAX_SUBST
      INTEGER MAX_CYCLE
      PARAMETER (MAX_CYCLE=20)
      INTEGER N_CYCLE, ITX_CYCLE(MAX_CYCLE)
      REAL SYM_CYCLE(MAX_CYCLE)
      EQUIVALENCE (NMESH1,NMESHN)
      EQUIVALENCE (MESH1,MESHN)
      INTEGER IBUFFR(400)
      REAL BUFFER(400)
      INTEGER NCHSAVE 
      PARAMETER (NCHSAVE=2*512) 
      INTEGER*4 ICHSAVE(NCHSAVE)
      INTEGER*4 IVRPTR(15)
      CHARACTER*512 OUTSTR,C_FILE, C_NAME, C_SELECT
      CHARACTER C_TIT_ESCAPE*1,C_TIT_SUBSTITUTE*2
      INTEGER N_FILE, N_NAME, N_SELECT
      CHARACTER*8 PXNAME
      CHARACTER*64 INPFMT
      LOGICAL LTDATA, OUTSID(4)
      COMMON /T2COM/ PXNAME, REDUCE, TITX, TITY ,XFRM12, XFRM13, XFRM1
     *4, XFRM23 ,XFRM24, XFRM34 ,XVARSX ,TITSIZ, GRDSYM, GRDSIZ, CIRS
     *IZ, ASIZE, AFLARE ,SMSZDF, ORAXES, EYEDIR, VUEDIR, VUECEN ,VERTC
     *L, EYESEP, SCRD, SCRZ, EYEDIS, EYEPNT ,XYPART, BARSIZ, TIKSIZ, XY
     *ZBAS, TTHETA ,TPHI, FRELBL, IPATRN, NPATRN, PATRN ,SCLPRM, WINDO
     *W, SCREEN, SYMBOL, NOSYMB ,FACTXY, LBLSIZ, SYMSIZ, XYZLIM, WORLD 
     *,RADRMX, RADRMN, RADAMN, RADANG, RADX0, RADY0, XUNUSD ,USRKBD, U
     *SRSCR, PLTFIL ,ITITDT, LENCRD ,INPFMT, GRDTYP, LINWID, LINCOL, L
     *INTEX, TITCON, ITCNTR ,IUNUSD, NXYZ1, NXYZ2 ,LBLCHR, NDIMNS, IBL
     *KTP, IDIMNS ,NMESH1, NMESH2, MESH1, MESH2, MESH3, NFIELD ,IFIELD
     *, NINCR ,IVARBL, IVRPTR ,LINEAR, NONLIN ,NPOINT, LETSET ,MXECH
     *O, LINES, MAXLNS ,AXANG, MESH2D, REDFAC, GRDTEX, OUTTEX, IAXTEX, 
     *TITEX, DSCAL ,OUTSTR, IPROP, IHTEX, IBLINK, IERASE, LABTEX, TICTE
     *X, NXYLIM, PATSZ ,MARGIN, PSCR, ITXPRI, ITXSEC, OREAL, OCPU, CSCR
     *D, OUTSID ,TITLIN, TITINX, TITZ, TITX1, TITY1, LTDATA, NPLOTS, RE
     *VLEV ,LBLFMT, IYEAR, IMONTH, IDAY, ISIGFG ,DATPTS, ERRPTS, DATXM
     *N, DATXMX, DATYMN, DATYMX, DATZMN, DATZMX ,DATSUM, ERRSUM, DATAVE
     *, ERRAVE, DATCEN, ERRCEN, DATSTD, ERRSTD ,NCSETS, NCCOL, NCROW, F
     *MARKER, H2STAT, TITFAC, TITLOC, TITMAR ,TIKFAC, IWINLEV, WINREL, 
     *WINABS, WINLIM ,ICPOIN, LEVREP, IREPCT, SYDIR, GRDIR, NMESH0, EXY
     *ZLIM, IVPTR ,TITLMX, NXYZDEF1, NXYZDEF2, IFILE_CASE, N_CYCLE, ITX
     *_CYCLE ,SYM_CYCLE, PLOT_EXTENT, FILL_ANGLE, FILL_WIDTH, FILL_TEX 
     *,FILL_INDEX ,N_LINES ,DSLOPE ,MAX_SUBST, BARBRK ,I_VORDER,SHADOW
     *TYP,SHADOWTEX
      COMMON /T2SCRT/ BUFFER, IBUFFR, N_FILE,N_NAME,N_SELECT, ICHSAVE
      COMMON /T2_CHAR/ C_TIT_ESCAPE,C_TIT_SUBSTITUTE
      COMMON /T2_SCRT/ C_FILE, C_NAME, C_SELECT
      INTEGER JOUFIL, ERRFIL, OUTFIL, DBGFIL, INPFIL, NINMAX
      PARAMETER (NINMAX=20)
      INTEGER NINP(NINMAX)
      COMMON /T2TRBK/NINP, JOUFIL, ERRFIL, OUTFIL, DBGFIL, INPFIL
      CHARACTER*512 STRNG, STJOU
      LOGICAL LTOKEN
      REAL FLOTNG
      INTEGER INTERP, KEYORD, NSTRNG, MAXSTR, NSTJOU, LSTJOU, NTOKEN
      INTEGER*4 INTEG
      COMMON /TOKENC/ INTERP, INTEG, FLOTNG, KEYORD, NSTRNG, MAXSTR, ST
     *RNG, NSTJOU, LSTJOU, STJOU, LTOKEN, NTOKEN
      REAL XY(2)
      CHARACTER*(1) CHARI1 , CHARI2 
      IF (X .lt. CCSCIS(1) .or. X .gt. CCSCIS(2)) RETURN
      IF (Y .lt. CCSCIS(3) .or. Y .gt. CCSCIS(4)) RETURN
      I=0
      IF(ABS(SYM).lt.65536) I=NINT(ABS(SYM))
      I1=I/256
      I2=I-256*I1
      IF(I1.eq.32.and.I2.eq.32)I1=0
      FLAGS(1)=.FALSE.
      IF(I1.lt.32.or.I2.lt.32) THEN
      CALL TXDOT(X,Y)
      ELSE
      JPROP=1
      CHARI1 = CHAR(I1) 
      CHARI2 = CHAR(I2) 
      CALL TXTEXT(X,Y,SIZEIN,0.0,CHARI1,CHARI2)
      ENDIF
      FLAGS(1)=.FALSE.
      END
      SUBROUTINE TXDOT(X,Y)
      IMPLICIT NONE
      REAL X,Y
      INTEGER IHIT
      REAL XY1,XY2
      EXTERNAL UGXERR
      COMMON /T2FLGC/ FLAGS(200), LTRAP,LHANDL,LSYERR,LSCREV
      LOGICAL FLAGS, LTRAP,LHANDL,LSYERR,LSCREV(3)
      INTEGER RELFLAG 
      PARAMETER (RELFLAG=151)
      INTEGER IWINLEV 
      INTEGER NWINLEV , MAX_FILL 
      PARAMETER (NWINLEV =4)
      PARAMETER (MAX_FILL=4)
      REAL GRDSYM, GRDSIZ, DATDAT(2,8), H2STAT(12), TITLIN(4), TITFA
     *C(4), TITLOC(4), TITMAR(4), TITLMX(4), TIKFAC, TITINX, TITX1, TIT
     *Y1, TITX, TITY, TITZ, TITSIZ, TITCON(5), REVLEV, REDUCE(5), XFR
     *M12(12), XFRM13(12), XFRM14(12), XFRM23(12), XFRM24(12), XFRM34(6
     *), XVARSX(20), CIRSIZ(2,3), ASIZE, AFLARE, SMSZDF, ORAXES(3), EY
     *EDIR(3), VUEDIR(3), VUECEN(3), VERTCL(3), EYESEP, SCRD, SCRZ, EYE
     *DIS, EYEPNT(3), XYPART(2, 2), BARSIZ(3), BARBRK(3), TIKSIZ(3), XY
     *ZBAS(3), TTHETA, TPHI, FRELBL(4), PATRN(20,30), SCLPRM(10,3), WI
     *NDOW(4), SCREEN(2), SYMBOL, NOSYMB, FACTXY(19), LBLSIZ, SYMSIZ, X
     *YZLIM(3,2), WORLD(3), RADRMX, RADRMN, RADAMN, RADANG, RADX0, RADY
     *0, XUNUSD(6), AXANG(3), REDFAC, DSCAL, PATSZ, MARGIN(4), PSCR(2
     *), OREAL, OCPU, CSCRD, DATPTS, ERRPTS, DATXMN, DATXMX, DATYMN, DA
     *TYMX, DATZMN, DATZMX, DATSUM, ERRSUM, DATAVE, ERRAVE, DATCEN, ERR
     *CEN, DATSTD, ERRSTD, WINREL(2,2,NWINLEV),WINABS(2,2,NWINLEV),WINL
     *IM(2,2), FMARKER(3,8), SYDIR(3), GRDIR(3), EXYZLIM(3,2), DSLOPE(2
     *,2)
      REAL PLOT_EXTENT(2,2),FILL_ANGLE(MAX_FILL),FILL_WIDTH(MAX_FILL)
      INTEGER FILL_INDEX, FILL_TEX(MAX_FILL), N_LINES(6)
      EQUIVALENCE (DATDAT, DATPTS)
      INTEGER MAXREP
      PARAMETER (MAXREP=5)
      INTEGER IPATRN, NPATRN(30), NXYLIM(3,2), NPLOTS, NCSETS, NCCOL, N
     *CROW, IYEAR, IMONTH, IDAY, ISIGFG, ITXPRI, ITXSEC, ITITDT(3), L
     *ENCRD, IPROP, IHTEX, IBLINK, IERASE, ITCNTR, IUNUSD, NXYZ1(3), 
     *NXYZ2(3), LBLFMT(3), LBLCHR(3), NDIMNS(3), IBLKTP, IDIMNS, NMES
     *H0, NMESH1, NMESH2, MESH1, MESH2, MESH3, MESH2D, MESHN(3), NMESHN(
     *2), NFIELD, IFIELD(19), NINCR, NPOINT, IVARBL(19), IVPTR(19), I_
     *VORDER(19,2), LINEAR(4), NONLIN(4), MXECHO, LINES, MAXLNS, USRK
     *BD, USRSCR, PLTFIL, LINWID, LINCOL, LINTEX, ICPOIN(3), IREPCT(MA
     *XREP), LEVREP, GRDTYP, GRDTEX, OUTTEX, IAXTEX, TITEX, LETSET, LAB
     *TEX, TICTEX, SHADOWTYP,SHADOWTEX, NXYZDEF1(10), NXYZDEF2(10), IF
     *ILE_CASE ,MAX_SUBST
      INTEGER MAX_CYCLE
      PARAMETER (MAX_CYCLE=20)
      INTEGER N_CYCLE, ITX_CYCLE(MAX_CYCLE)
      REAL SYM_CYCLE(MAX_CYCLE)
      EQUIVALENCE (NMESH1,NMESHN)
      EQUIVALENCE (MESH1,MESHN)
      INTEGER IBUFFR(400)
      REAL BUFFER(400)
      INTEGER NCHSAVE 
      PARAMETER (NCHSAVE=2*512) 
      INTEGER*4 ICHSAVE(NCHSAVE)
      INTEGER*4 IVRPTR(15)
      CHARACTER*512 OUTSTR,C_FILE, C_NAME, C_SELECT
      CHARACTER C_TIT_ESCAPE*1,C_TIT_SUBSTITUTE*2
      INTEGER N_FILE, N_NAME, N_SELECT
      CHARACTER*8 PXNAME
      CHARACTER*64 INPFMT
      LOGICAL LTDATA, OUTSID(4)
      COMMON /T2COM/ PXNAME, REDUCE, TITX, TITY ,XFRM12, XFRM13, XFRM1
     *4, XFRM23 ,XFRM24, XFRM34 ,XVARSX ,TITSIZ, GRDSYM, GRDSIZ, CIRS
     *IZ, ASIZE, AFLARE ,SMSZDF, ORAXES, EYEDIR, VUEDIR, VUECEN ,VERTC
     *L, EYESEP, SCRD, SCRZ, EYEDIS, EYEPNT ,XYPART, BARSIZ, TIKSIZ, XY
     *ZBAS, TTHETA ,TPHI, FRELBL, IPATRN, NPATRN, PATRN ,SCLPRM, WINDO
     *W, SCREEN, SYMBOL, NOSYMB ,FACTXY, LBLSIZ, SYMSIZ, XYZLIM, WORLD 
     *,RADRMX, RADRMN, RADAMN, RADANG, RADX0, RADY0, XUNUSD ,USRKBD, U
     *SRSCR, PLTFIL ,ITITDT, LENCRD ,INPFMT, GRDTYP, LINWID, LINCOL, L
     *INTEX, TITCON, ITCNTR ,IUNUSD, NXYZ1, NXYZ2 ,LBLCHR, NDIMNS, IBL
     *KTP, IDIMNS ,NMESH1, NMESH2, MESH1, MESH2, MESH3, NFIELD ,IFIELD
     *, NINCR ,IVARBL, IVRPTR ,LINEAR, NONLIN ,NPOINT, LETSET ,MXECH
     *O, LINES, MAXLNS ,AXANG, MESH2D, REDFAC, GRDTEX, OUTTEX, IAXTEX, 
     *TITEX, DSCAL ,OUTSTR, IPROP, IHTEX, IBLINK, IERASE, LABTEX, TICTE
     *X, NXYLIM, PATSZ ,MARGIN, PSCR, ITXPRI, ITXSEC, OREAL, OCPU, CSCR
     *D, OUTSID ,TITLIN, TITINX, TITZ, TITX1, TITY1, LTDATA, NPLOTS, RE
     *VLEV ,LBLFMT, IYEAR, IMONTH, IDAY, ISIGFG ,DATPTS, ERRPTS, DATXM
     *N, DATXMX, DATYMN, DATYMX, DATZMN, DATZMX ,DATSUM, ERRSUM, DATAVE
     *, ERRAVE, DATCEN, ERRCEN, DATSTD, ERRSTD ,NCSETS, NCCOL, NCROW, F
     *MARKER, H2STAT, TITFAC, TITLOC, TITMAR ,TIKFAC, IWINLEV, WINREL, 
     *WINABS, WINLIM ,ICPOIN, LEVREP, IREPCT, SYDIR, GRDIR, NMESH0, EXY
     *ZLIM, IVPTR ,TITLMX, NXYZDEF1, NXYZDEF2, IFILE_CASE, N_CYCLE, ITX
     *_CYCLE ,SYM_CYCLE, PLOT_EXTENT, FILL_ANGLE, FILL_WIDTH, FILL_TEX 
     *,FILL_INDEX ,N_LINES ,DSLOPE ,MAX_SUBST, BARBRK ,I_VORDER,SHADOW
     *TYP,SHADOWTEX
      COMMON /T2SCRT/ BUFFER, IBUFFR, N_FILE,N_NAME,N_SELECT, ICHSAVE
      COMMON /T2_CHAR/ C_TIT_ESCAPE,C_TIT_SUBSTITUTE
      COMMON /T2_SCRT/ C_FILE, C_NAME, C_SELECT
      INTEGER JOUFIL, ERRFIL, OUTFIL, DBGFIL, INPFIL, NINMAX
      PARAMETER (NINMAX=20)
      INTEGER NINP(NINMAX)
      COMMON /T2TRBK/NINP, JOUFIL, ERRFIL, OUTFIL, DBGFIL, INPFIL
      CHARACTER*512 STRNG, STJOU
      LOGICAL LTOKEN
      REAL FLOTNG
      INTEGER INTERP, KEYORD, NSTRNG, MAXSTR, NSTJOU, LSTJOU, NTOKEN
      INTEGER*4 INTEG
      COMMON /TOKENC/ INTERP, INTEG, FLOTNG, KEYORD, NSTRNG, MAXSTR, ST
     *RNG, NSTJOU, LSTJOU, STJOU, LTOKEN, NTOKEN
      INTEGER IXX 
      INTEGER PXELWORDS, MAX_QOPN, QOPNSIZ 
      PARAMETER (PXELWORDS=2000)
      PARAMETER (MAX_QOPN=8)
      PARAMETER (QOPNSIZ=200)
      INTEGER IOPEN(10)
      LOGICAL L_IDOPEN(10)
      INTEGER VIRGIN ,ISEGMN ,JSEGMN, DFTSEG, JPROP, IACT
      LOGICAL LCLEAR ,LERAS ,LINTF, LPROP
      REAL DFTANG ,DFTSIZ ,URSIZE, WDOW(4)
      INTEGER DFTWID ,DFTTEX ,DFTCOL ,DFTVEC ,DFTFNT ,DFTBLK ,DFTPRP ,DF
     *TSTR ,DFTQUI ,PXEL(PXELWORDS)
      COMMON /TXCOMD/PXEL ,LCLEAR ,VIRGIN ,ISEGMN ,JSEGMN ,URSIZE ,DFTCO
     *L ,DFTTEX ,DFTWID ,DFTQUI ,DFTFNT ,DFTANG ,DFTSIZ ,DFTVEC ,LERAS ,
     *DFTPRP ,DFTBLK ,DFTSEG ,LINTF ,IOPEN, L_IDOPEN ,JPROP, LPROP, WDOW
     *, IACT
      INTEGER NQOPNF ,NQTXT
      CHARACTER*(QOPNSIZ) QOPNF
      CHARACTER*(QOPNSIZ) QOPN(MAX_QOPN)
      INTEGER NQOPN(MAX_QOPN)
      CHARACTER*80 QTXT
      COMMON/TXCOMV/NQOPN ,QOPN ,NQTXT ,QTXT ,NQOPNF ,QOPNF
      REAL PLIM(4,4),ZSCRN(2),XLLINE,YLLINE,XTLINE,YTLINE,XFRMFC, PAT(2
     *0),PATCUM,PATTOT,PATMOD,CCSCIS(4),DISPL, RESOL(2)
      INTEGER NPTS,IDDEVC,IPAT,NPAT,LMOVE,IROTAX,IROTAF
      COMMON/TXCOM/PLIM,ZSCRN, XLLINE,YLLINE,XTLINE,YTLINE,XFRMFC, IPA
     *T,NPAT,PAT,PATTOT, NPTS,IDDEVC,CCSCIS,LMOVE,IROTAX,DISPL,IROTAF,P
     *ATCUM,PATMOD, RESOL
      IF (X .lt. CCSCIS(1) .or. X .gt. CCSCIS(2)) RETURN
      IF (Y .lt. CCSCIS(3) .or. Y .gt. CCSCIS(4)) RETURN
      IF (IHIT.LT.4) THEN
10550 GOTO (10560,10570,10580,10590),IROTAX+1
10560 CONTINUE
      XY1=X
      XY2=Y
      GOTO 10552
10570 CONTINUE
      XY1=Y
      XY2=PLIM(3,4)-X
      GOTO 10552
10580 CONTINUE
      XY1=PLIM(3,4)-X
      XY2=PLIM(4,4)-Y
      GOTO 10552
10590 CONTINUE
      XY1=PLIM(4,4)-Y
      XY2=X
      GOTO 10552
10552 CONTINUE
      CALL UGMARK(' ',XY1,XY2,PXEL)
      FLAGS(1)=.FALSE.
      ENDIF
      END
      SUBROUTINE TXRDOT(X1,Y1,X2,Y2,N)
      IMPLICIT NONE
      EXTERNAL UGXERR
      COMMON /T2FLGC/ FLAGS(200), LTRAP,LHANDL,LSYERR,LSCREV
      LOGICAL FLAGS, LTRAP,LHANDL,LSYERR,LSCREV(3)
      INTEGER RELFLAG 
      PARAMETER (RELFLAG=151)
      INTEGER IWINLEV 
      INTEGER NWINLEV , MAX_FILL 
      PARAMETER (NWINLEV =4)
      PARAMETER (MAX_FILL=4)
      REAL GRDSYM, GRDSIZ, DATDAT(2,8), H2STAT(12), TITLIN(4), TITFA
     *C(4), TITLOC(4), TITMAR(4), TITLMX(4), TIKFAC, TITINX, TITX1, TIT
     *Y1, TITX, TITY, TITZ, TITSIZ, TITCON(5), REVLEV, REDUCE(5), XFR
     *M12(12), XFRM13(12), XFRM14(12), XFRM23(12), XFRM24(12), XFRM34(6
     *), XVARSX(20), CIRSIZ(2,3), ASIZE, AFLARE, SMSZDF, ORAXES(3), EY
     *EDIR(3), VUEDIR(3), VUECEN(3), VERTCL(3), EYESEP, SCRD, SCRZ, EYE
     *DIS, EYEPNT(3), XYPART(2, 2), BARSIZ(3), BARBRK(3), TIKSIZ(3), XY
     *ZBAS(3), TTHETA, TPHI, FRELBL(4), PATRN(20,30), SCLPRM(10,3), WI
     *NDOW(4), SCREEN(2), SYMBOL, NOSYMB, FACTXY(19), LBLSIZ, SYMSIZ, X
     *YZLIM(3,2), WORLD(3), RADRMX, RADRMN, RADAMN, RADANG, RADX0, RADY
     *0, XUNUSD(6), AXANG(3), REDFAC, DSCAL, PATSZ, MARGIN(4), PSCR(2
     *), OREAL, OCPU, CSCRD, DATPTS, ERRPTS, DATXMN, DATXMX, DATYMN, DA
     *TYMX, DATZMN, DATZMX, DATSUM, ERRSUM, DATAVE, ERRAVE, DATCEN, ERR
     *CEN, DATSTD, ERRSTD, WINREL(2,2,NWINLEV),WINABS(2,2,NWINLEV),WINL
     *IM(2,2), FMARKER(3,8), SYDIR(3), GRDIR(3), EXYZLIM(3,2), DSLOPE(2
     *,2)
      REAL PLOT_EXTENT(2,2),FILL_ANGLE(MAX_FILL),FILL_WIDTH(MAX_FILL)
      INTEGER FILL_INDEX, FILL_TEX(MAX_FILL), N_LINES(6)
      EQUIVALENCE (DATDAT, DATPTS)
      INTEGER MAXREP
      PARAMETER (MAXREP=5)
      INTEGER IPATRN, NPATRN(30), NXYLIM(3,2), NPLOTS, NCSETS, NCCOL, N
     *CROW, IYEAR, IMONTH, IDAY, ISIGFG, ITXPRI, ITXSEC, ITITDT(3), L
     *ENCRD, IPROP, IHTEX, IBLINK, IERASE, ITCNTR, IUNUSD, NXYZ1(3), 
     *NXYZ2(3), LBLFMT(3), LBLCHR(3), NDIMNS(3), IBLKTP, IDIMNS, NMES
     *H0, NMESH1, NMESH2, MESH1, MESH2, MESH3, MESH2D, MESHN(3), NMESHN(
     *2), NFIELD, IFIELD(19), NINCR, NPOINT, IVARBL(19), IVPTR(19), I_
     *VORDER(19,2), LINEAR(4), NONLIN(4), MXECHO, LINES, MAXLNS, USRK
     *BD, USRSCR, PLTFIL, LINWID, LINCOL, LINTEX, ICPOIN(3), IREPCT(MA
     *XREP), LEVREP, GRDTYP, GRDTEX, OUTTEX, IAXTEX, TITEX, LETSET, LAB
     *TEX, TICTEX, SHADOWTYP,SHADOWTEX, NXYZDEF1(10), NXYZDEF2(10), IF
     *ILE_CASE ,MAX_SUBST
      INTEGER MAX_CYCLE
      PARAMETER (MAX_CYCLE=20)
      INTEGER N_CYCLE, ITX_CYCLE(MAX_CYCLE)
      REAL SYM_CYCLE(MAX_CYCLE)
      EQUIVALENCE (NMESH1,NMESHN)
      EQUIVALENCE (MESH1,MESHN)
      INTEGER IBUFFR(400)
      REAL BUFFER(400)
      INTEGER NCHSAVE 
      PARAMETER (NCHSAVE=2*512) 
      INTEGER*4 ICHSAVE(NCHSAVE)
      INTEGER*4 IVRPTR(15)
      CHARACTER*512 OUTSTR,C_FILE, C_NAME, C_SELECT
      CHARACTER C_TIT_ESCAPE*1,C_TIT_SUBSTITUTE*2
      INTEGER N_FILE, N_NAME, N_SELECT
      CHARACTER*8 PXNAME
      CHARACTER*64 INPFMT
      LOGICAL LTDATA, OUTSID(4)
      COMMON /T2COM/ PXNAME, REDUCE, TITX, TITY ,XFRM12, XFRM13, XFRM1
     *4, XFRM23 ,XFRM24, XFRM34 ,XVARSX ,TITSIZ, GRDSYM, GRDSIZ, CIRS
     *IZ, ASIZE, AFLARE ,SMSZDF, ORAXES, EYEDIR, VUEDIR, VUECEN ,VERTC
     *L, EYESEP, SCRD, SCRZ, EYEDIS, EYEPNT ,XYPART, BARSIZ, TIKSIZ, XY
     *ZBAS, TTHETA ,TPHI, FRELBL, IPATRN, NPATRN, PATRN ,SCLPRM, WINDO
     *W, SCREEN, SYMBOL, NOSYMB ,FACTXY, LBLSIZ, SYMSIZ, XYZLIM, WORLD 
     *,RADRMX, RADRMN, RADAMN, RADANG, RADX0, RADY0, XUNUSD ,USRKBD, U
     *SRSCR, PLTFIL ,ITITDT, LENCRD ,INPFMT, GRDTYP, LINWID, LINCOL, L
     *INTEX, TITCON, ITCNTR ,IUNUSD, NXYZ1, NXYZ2 ,LBLCHR, NDIMNS, IBL
     *KTP, IDIMNS ,NMESH1, NMESH2, MESH1, MESH2, MESH3, NFIELD ,IFIELD
     *, NINCR ,IVARBL, IVRPTR ,LINEAR, NONLIN ,NPOINT, LETSET ,MXECH
     *O, LINES, MAXLNS ,AXANG, MESH2D, REDFAC, GRDTEX, OUTTEX, IAXTEX, 
     *TITEX, DSCAL ,OUTSTR, IPROP, IHTEX, IBLINK, IERASE, LABTEX, TICTE
     *X, NXYLIM, PATSZ ,MARGIN, PSCR, ITXPRI, ITXSEC, OREAL, OCPU, CSCR
     *D, OUTSID ,TITLIN, TITINX, TITZ, TITX1, TITY1, LTDATA, NPLOTS, RE
     *VLEV ,LBLFMT, IYEAR, IMONTH, IDAY, ISIGFG ,DATPTS, ERRPTS, DATXM
     *N, DATXMX, DATYMN, DATYMX, DATZMN, DATZMX ,DATSUM, ERRSUM, DATAVE
     *, ERRAVE, DATCEN, ERRCEN, DATSTD, ERRSTD ,NCSETS, NCCOL, NCROW, F
     *MARKER, H2STAT, TITFAC, TITLOC, TITMAR ,TIKFAC, IWINLEV, WINREL, 
     *WINABS, WINLIM ,ICPOIN, LEVREP, IREPCT, SYDIR, GRDIR, NMESH0, EXY
     *ZLIM, IVPTR ,TITLMX, NXYZDEF1, NXYZDEF2, IFILE_CASE, N_CYCLE, ITX
     *_CYCLE ,SYM_CYCLE, PLOT_EXTENT, FILL_ANGLE, FILL_WIDTH, FILL_TEX 
     *,FILL_INDEX ,N_LINES ,DSLOPE ,MAX_SUBST, BARBRK ,I_VORDER,SHADOW
     *TYP,SHADOWTEX
      COMMON /T2SCRT/ BUFFER, IBUFFR, N_FILE,N_NAME,N_SELECT, ICHSAVE
      COMMON /T2_CHAR/ C_TIT_ESCAPE,C_TIT_SUBSTITUTE
      COMMON /T2_SCRT/ C_FILE, C_NAME, C_SELECT
      INTEGER JOUFIL, ERRFIL, OUTFIL, DBGFIL, INPFIL, NINMAX
      PARAMETER (NINMAX=20)
      INTEGER NINP(NINMAX)
      COMMON /T2TRBK/NINP, JOUFIL, ERRFIL, OUTFIL, DBGFIL, INPFIL
      CHARACTER*512 STRNG, STJOU
      LOGICAL LTOKEN
      REAL FLOTNG
      INTEGER INTERP, KEYORD, NSTRNG, MAXSTR, NSTJOU, LSTJOU, NTOKEN
      INTEGER*4 INTEG
      COMMON /TOKENC/ INTERP, INTEG, FLOTNG, KEYORD, NSTRNG, MAXSTR, ST
     *RNG, NSTJOU, LSTJOU, STJOU, LTOKEN, NTOKEN
      INTEGER IXX 
      INTEGER PXELWORDS, MAX_QOPN, QOPNSIZ 
      PARAMETER (PXELWORDS=2000)
      PARAMETER (MAX_QOPN=8)
      PARAMETER (QOPNSIZ=200)
      INTEGER IOPEN(10)
      LOGICAL L_IDOPEN(10)
      INTEGER VIRGIN ,ISEGMN ,JSEGMN, DFTSEG, JPROP, IACT
      LOGICAL LCLEAR ,LERAS ,LINTF, LPROP
      REAL DFTANG ,DFTSIZ ,URSIZE, WDOW(4)
      INTEGER DFTWID ,DFTTEX ,DFTCOL ,DFTVEC ,DFTFNT ,DFTBLK ,DFTPRP ,DF
     *TSTR ,DFTQUI ,PXEL(PXELWORDS)
      COMMON /TXCOMD/PXEL ,LCLEAR ,VIRGIN ,ISEGMN ,JSEGMN ,URSIZE ,DFTCO
     *L ,DFTTEX ,DFTWID ,DFTQUI ,DFTFNT ,DFTANG ,DFTSIZ ,DFTVEC ,LERAS ,
     *DFTPRP ,DFTBLK ,DFTSEG ,LINTF ,IOPEN, L_IDOPEN ,JPROP, LPROP, WDOW
     *, IACT
      INTEGER NQOPNF ,NQTXT
      CHARACTER*(QOPNSIZ) QOPNF
      CHARACTER*(QOPNSIZ) QOPN(MAX_QOPN)
      INTEGER NQOPN(MAX_QOPN)
      CHARACTER*80 QTXT
      COMMON/TXCOMV/NQOPN ,QOPN ,NQTXT ,QTXT ,NQOPNF ,QOPNF
      REAL PLIM(4,4),ZSCRN(2),XLLINE,YLLINE,XTLINE,YTLINE,XFRMFC, PAT(2
     *0),PATCUM,PATTOT,PATMOD,CCSCIS(4),DISPL, RESOL(2)
      INTEGER NPTS,IDDEVC,IPAT,NPAT,LMOVE,IROTAX,IROTAF
      COMMON/TXCOM/PLIM,ZSCRN, XLLINE,YLLINE,XTLINE,YTLINE,XFRMFC, IPA
     *T,NPAT,PAT,PATTOT, NPTS,IDDEVC,CCSCIS,LMOVE,IROTAX,DISPL,IROTAF,P
     *ATCUM,PATMOD, RESOL
      REAL X1,X2,Y1,Y2
      REAL XP(4),YP(2),A(2),AP,XY1,XY2
      INTEGER I,N,NP,IRAN
      REAL RAN
      XP(1)=MAX(MIN(X1,X2),CCSCIS(1))
      XP(2)=MIN(MAX(X1,X2),CCSCIS(2))
      XP(3)=MAX(MIN(Y1,Y2),CCSCIS(3))
      XP(4)=MIN(MAX(Y1,Y2),CCSCIS(4))
      DO 10601 I=1,4,2
      IF (XP(I) .gt. XP(I+1)) RETURN
10601 CONTINUE
10602 CONTINUE
      A(1)=ABS(X1-X2)
      A(2)=ABS(Y1-Y2)
      NP=N
      DO 10611 I=1,2
      IF (A(I) .gt. 0) THEN
      AP=XP(2*I)-XP(2*I-1)
      IF (AP .eq. 0) RETURN
      NP=NINT(NP*AP/A(I))
      ENDIF
10611 CONTINUE
10612 CONTINUE
      IF( IROTAX.ne.0 ) THEN
      DO 10621 I=1,2
10630 GOTO (10640,10650,10660),IROTAX
10640 CONTINUE
      AP=XP(I)
      XP(I)=Xp(I+2)
      Xp(I+2)=PLIM(3,4)-AP
      GOTO 10632
10650 CONTINUE
      Xp(I+2)=PLIM(3,4)-Xp(I+2)
      XP(I)=PLIM(4,4)-XP(I)
      GOTO 10632
10660 CONTINUE
      AP=XP(I)
      XP(I)=PLIM(4,4)-Xp(I+2)
      Xp(I+2)=AP
      GOTO 10632
10632 CONTINUE
10621 CONTINUE
10622 CONTINUE
      ENDIF
      DO 10671 I=1,4,2
      XP(I+1)=XP(I+1)-XP(I)
10671 CONTINUE
10672 CONTINUE
      DO 10681 I=1,NP
      XY1=XP(1)+RAN(IRAN)*XP(2)
      XY2=XP(3)+RAN(IRAN)*XP(4)
      CALL UGMARK(' ',XY1,XY2,PXEL)
      FLAGS(1)=.FALSE.
      IF (LTRAP) RETURN
10681 CONTINUE
10682 CONTINUE
      END
      SUBROUTINE TXXCLO
      IMPLICIT NONE
      COMMON /T2FLGC/ FLAGS(200), LTRAP,LHANDL,LSYERR,LSCREV
      LOGICAL FLAGS, LTRAP,LHANDL,LSYERR,LSCREV(3)
      INTEGER RELFLAG 
      PARAMETER (RELFLAG=151)
      INTEGER IWINLEV 
      INTEGER NWINLEV , MAX_FILL 
      PARAMETER (NWINLEV =4)
      PARAMETER (MAX_FILL=4)
      REAL GRDSYM, GRDSIZ, DATDAT(2,8), H2STAT(12), TITLIN(4), TITFA
     *C(4), TITLOC(4), TITMAR(4), TITLMX(4), TIKFAC, TITINX, TITX1, TIT
     *Y1, TITX, TITY, TITZ, TITSIZ, TITCON(5), REVLEV, REDUCE(5), XFR
     *M12(12), XFRM13(12), XFRM14(12), XFRM23(12), XFRM24(12), XFRM34(6
     *), XVARSX(20), CIRSIZ(2,3), ASIZE, AFLARE, SMSZDF, ORAXES(3), EY
     *EDIR(3), VUEDIR(3), VUECEN(3), VERTCL(3), EYESEP, SCRD, SCRZ, EYE
     *DIS, EYEPNT(3), XYPART(2, 2), BARSIZ(3), BARBRK(3), TIKSIZ(3), XY
     *ZBAS(3), TTHETA, TPHI, FRELBL(4), PATRN(20,30), SCLPRM(10,3), WI
     *NDOW(4), SCREEN(2), SYMBOL, NOSYMB, FACTXY(19), LBLSIZ, SYMSIZ, X
     *YZLIM(3,2), WORLD(3), RADRMX, RADRMN, RADAMN, RADANG, RADX0, RADY
     *0, XUNUSD(6), AXANG(3), REDFAC, DSCAL, PATSZ, MARGIN(4), PSCR(2
     *), OREAL, OCPU, CSCRD, DATPTS, ERRPTS, DATXMN, DATXMX, DATYMN, DA
     *TYMX, DATZMN, DATZMX, DATSUM, ERRSUM, DATAVE, ERRAVE, DATCEN, ERR
     *CEN, DATSTD, ERRSTD, WINREL(2,2,NWINLEV),WINABS(2,2,NWINLEV),WINL
     *IM(2,2), FMARKER(3,8), SYDIR(3), GRDIR(3), EXYZLIM(3,2), DSLOPE(2
     *,2)
      REAL PLOT_EXTENT(2,2),FILL_ANGLE(MAX_FILL),FILL_WIDTH(MAX_FILL)
      INTEGER FILL_INDEX, FILL_TEX(MAX_FILL), N_LINES(6)
      EQUIVALENCE (DATDAT, DATPTS)
      INTEGER MAXREP
      PARAMETER (MAXREP=5)
      INTEGER IPATRN, NPATRN(30), NXYLIM(3,2), NPLOTS, NCSETS, NCCOL, N
     *CROW, IYEAR, IMONTH, IDAY, ISIGFG, ITXPRI, ITXSEC, ITITDT(3), L
     *ENCRD, IPROP, IHTEX, IBLINK, IERASE, ITCNTR, IUNUSD, NXYZ1(3), 
     *NXYZ2(3), LBLFMT(3), LBLCHR(3), NDIMNS(3), IBLKTP, IDIMNS, NMES
     *H0, NMESH1, NMESH2, MESH1, MESH2, MESH3, MESH2D, MESHN(3), NMESHN(
     *2), NFIELD, IFIELD(19), NINCR, NPOINT, IVARBL(19), IVPTR(19), I_
     *VORDER(19,2), LINEAR(4), NONLIN(4), MXECHO, LINES, MAXLNS, USRK
     *BD, USRSCR, PLTFIL, LINWID, LINCOL, LINTEX, ICPOIN(3), IREPCT(MA
     *XREP), LEVREP, GRDTYP, GRDTEX, OUTTEX, IAXTEX, TITEX, LETSET, LAB
     *TEX, TICTEX, SHADOWTYP,SHADOWTEX, NXYZDEF1(10), NXYZDEF2(10), IF
     *ILE_CASE ,MAX_SUBST
      INTEGER MAX_CYCLE
      PARAMETER (MAX_CYCLE=20)
      INTEGER N_CYCLE, ITX_CYCLE(MAX_CYCLE)
      REAL SYM_CYCLE(MAX_CYCLE)
      EQUIVALENCE (NMESH1,NMESHN)
      EQUIVALENCE (MESH1,MESHN)
      INTEGER IBUFFR(400)
      REAL BUFFER(400)
      INTEGER NCHSAVE 
      PARAMETER (NCHSAVE=2*512) 
      INTEGER*4 ICHSAVE(NCHSAVE)
      INTEGER*4 IVRPTR(15)
      CHARACTER*512 OUTSTR,C_FILE, C_NAME, C_SELECT
      CHARACTER C_TIT_ESCAPE*1,C_TIT_SUBSTITUTE*2
      INTEGER N_FILE, N_NAME, N_SELECT
      CHARACTER*8 PXNAME
      CHARACTER*64 INPFMT
      LOGICAL LTDATA, OUTSID(4)
      COMMON /T2COM/ PXNAME, REDUCE, TITX, TITY ,XFRM12, XFRM13, XFRM1
     *4, XFRM23 ,XFRM24, XFRM34 ,XVARSX ,TITSIZ, GRDSYM, GRDSIZ, CIRS
     *IZ, ASIZE, AFLARE ,SMSZDF, ORAXES, EYEDIR, VUEDIR, VUECEN ,VERTC
     *L, EYESEP, SCRD, SCRZ, EYEDIS, EYEPNT ,XYPART, BARSIZ, TIKSIZ, XY
     *ZBAS, TTHETA ,TPHI, FRELBL, IPATRN, NPATRN, PATRN ,SCLPRM, WINDO
     *W, SCREEN, SYMBOL, NOSYMB ,FACTXY, LBLSIZ, SYMSIZ, XYZLIM, WORLD 
     *,RADRMX, RADRMN, RADAMN, RADANG, RADX0, RADY0, XUNUSD ,USRKBD, U
     *SRSCR, PLTFIL ,ITITDT, LENCRD ,INPFMT, GRDTYP, LINWID, LINCOL, L
     *INTEX, TITCON, ITCNTR ,IUNUSD, NXYZ1, NXYZ2 ,LBLCHR, NDIMNS, IBL
     *KTP, IDIMNS ,NMESH1, NMESH2, MESH1, MESH2, MESH3, NFIELD ,IFIELD
     *, NINCR ,IVARBL, IVRPTR ,LINEAR, NONLIN ,NPOINT, LETSET ,MXECH
     *O, LINES, MAXLNS ,AXANG, MESH2D, REDFAC, GRDTEX, OUTTEX, IAXTEX, 
     *TITEX, DSCAL ,OUTSTR, IPROP, IHTEX, IBLINK, IERASE, LABTEX, TICTE
     *X, NXYLIM, PATSZ ,MARGIN, PSCR, ITXPRI, ITXSEC, OREAL, OCPU, CSCR
     *D, OUTSID ,TITLIN, TITINX, TITZ, TITX1, TITY1, LTDATA, NPLOTS, RE
     *VLEV ,LBLFMT, IYEAR, IMONTH, IDAY, ISIGFG ,DATPTS, ERRPTS, DATXM
     *N, DATXMX, DATYMN, DATYMX, DATZMN, DATZMX ,DATSUM, ERRSUM, DATAVE
     *, ERRAVE, DATCEN, ERRCEN, DATSTD, ERRSTD ,NCSETS, NCCOL, NCROW, F
     *MARKER, H2STAT, TITFAC, TITLOC, TITMAR ,TIKFAC, IWINLEV, WINREL, 
     *WINABS, WINLIM ,ICPOIN, LEVREP, IREPCT, SYDIR, GRDIR, NMESH0, EXY
     *ZLIM, IVPTR ,TITLMX, NXYZDEF1, NXYZDEF2, IFILE_CASE, N_CYCLE, ITX
     *_CYCLE ,SYM_CYCLE, PLOT_EXTENT, FILL_ANGLE, FILL_WIDTH, FILL_TEX 
     *,FILL_INDEX ,N_LINES ,DSLOPE ,MAX_SUBST, BARBRK ,I_VORDER,SHADOW
     *TYP,SHADOWTEX
      COMMON /T2SCRT/ BUFFER, IBUFFR, N_FILE,N_NAME,N_SELECT, ICHSAVE
      COMMON /T2_CHAR/ C_TIT_ESCAPE,C_TIT_SUBSTITUTE
      COMMON /T2_SCRT/ C_FILE, C_NAME, C_SELECT
      INTEGER JOUFIL, ERRFIL, OUTFIL, DBGFIL, INPFIL, NINMAX
      PARAMETER (NINMAX=20)
      INTEGER NINP(NINMAX)
      COMMON /T2TRBK/NINP, JOUFIL, ERRFIL, OUTFIL, DBGFIL, INPFIL
      CHARACTER*512 STRNG, STJOU
      LOGICAL LTOKEN
      REAL FLOTNG
      INTEGER INTERP, KEYORD, NSTRNG, MAXSTR, NSTJOU, LSTJOU, NTOKEN
      INTEGER*4 INTEG
      COMMON /TOKENC/ INTERP, INTEG, FLOTNG, KEYORD, NSTRNG, MAXSTR, ST
     *RNG, NSTJOU, LSTJOU, STJOU, LTOKEN, NTOKEN
      INTEGER IXX 
      INTEGER PXELWORDS, MAX_QOPN, QOPNSIZ 
      PARAMETER (PXELWORDS=2000)
      PARAMETER (MAX_QOPN=8)
      PARAMETER (QOPNSIZ=200)
      INTEGER IOPEN(10)
      LOGICAL L_IDOPEN(10)
      INTEGER VIRGIN ,ISEGMN ,JSEGMN, DFTSEG, JPROP, IACT
      LOGICAL LCLEAR ,LERAS ,LINTF, LPROP
      REAL DFTANG ,DFTSIZ ,URSIZE, WDOW(4)
      INTEGER DFTWID ,DFTTEX ,DFTCOL ,DFTVEC ,DFTFNT ,DFTBLK ,DFTPRP ,DF
     *TSTR ,DFTQUI ,PXEL(PXELWORDS)
      COMMON /TXCOMD/PXEL ,LCLEAR ,VIRGIN ,ISEGMN ,JSEGMN ,URSIZE ,DFTCO
     *L ,DFTTEX ,DFTWID ,DFTQUI ,DFTFNT ,DFTANG ,DFTSIZ ,DFTVEC ,LERAS ,
     *DFTPRP ,DFTBLK ,DFTSEG ,LINTF ,IOPEN, L_IDOPEN ,JPROP, LPROP, WDOW
     *, IACT
      INTEGER NQOPNF ,NQTXT
      CHARACTER*(QOPNSIZ) QOPNF
      CHARACTER*(QOPNSIZ) QOPN(MAX_QOPN)
      INTEGER NQOPN(MAX_QOPN)
      CHARACTER*80 QTXT
      COMMON/TXCOMV/NQOPN ,QOPN ,NQTXT ,QTXT ,NQOPNF ,QOPNF
      CHARACTER*8 STRING
      INTEGER IOP
      REAL X
      CALL UGINFO('OPENDEV',' ',IOPEN,X)
      IF(IOPEN(1).gt.0) THEN
      CALL TXXMT
      DO 10691 IOP=2,IOPEN(1)+1
      CALL UGSLCT(' ',IOPEN(IOP))
      IF (LCLEAR) THEN
      JSEGMN=DFTSEG
      ISEGMN=DFTSEG
      IF(PXNAME.ne.' ') THEN
      CALL UGPICT('CLEAR,ALIAS='//PXNAME,0)
      ELSE
      CALL UGPICT('CLEAR',0)
      ENDIF
      ENDIF
      CALL UGCLOS('NOCLEAR')
10691 CONTINUE
10692 CONTINUE
      LCLEAR = .false.
      CALL UGINFO('OPENDEV',STRING,IOPEN,WDOW)
      FLAGS(24)= IOPEN(1) .ne. 0
      ENDIF
      END
      SUBROUTINE TXXCLR
      IMPLICIT NONE
      COMMON /T2FLGC/ FLAGS(200), LTRAP,LHANDL,LSYERR,LSCREV
      LOGICAL FLAGS, LTRAP,LHANDL,LSYERR,LSCREV(3)
      INTEGER RELFLAG 
      PARAMETER (RELFLAG=151)
      INTEGER IWINLEV 
      INTEGER NWINLEV , MAX_FILL 
      PARAMETER (NWINLEV =4)
      PARAMETER (MAX_FILL=4)
      REAL GRDSYM, GRDSIZ, DATDAT(2,8), H2STAT(12), TITLIN(4), TITFA
     *C(4), TITLOC(4), TITMAR(4), TITLMX(4), TIKFAC, TITINX, TITX1, TIT
     *Y1, TITX, TITY, TITZ, TITSIZ, TITCON(5), REVLEV, REDUCE(5), XFR
     *M12(12), XFRM13(12), XFRM14(12), XFRM23(12), XFRM24(12), XFRM34(6
     *), XVARSX(20), CIRSIZ(2,3), ASIZE, AFLARE, SMSZDF, ORAXES(3), EY
     *EDIR(3), VUEDIR(3), VUECEN(3), VERTCL(3), EYESEP, SCRD, SCRZ, EYE
     *DIS, EYEPNT(3), XYPART(2, 2), BARSIZ(3), BARBRK(3), TIKSIZ(3), XY
     *ZBAS(3), TTHETA, TPHI, FRELBL(4), PATRN(20,30), SCLPRM(10,3), WI
     *NDOW(4), SCREEN(2), SYMBOL, NOSYMB, FACTXY(19), LBLSIZ, SYMSIZ, X
     *YZLIM(3,2), WORLD(3), RADRMX, RADRMN, RADAMN, RADANG, RADX0, RADY
     *0, XUNUSD(6), AXANG(3), REDFAC, DSCAL, PATSZ, MARGIN(4), PSCR(2
     *), OREAL, OCPU, CSCRD, DATPTS, ERRPTS, DATXMN, DATXMX, DATYMN, DA
     *TYMX, DATZMN, DATZMX, DATSUM, ERRSUM, DATAVE, ERRAVE, DATCEN, ERR
     *CEN, DATSTD, ERRSTD, WINREL(2,2,NWINLEV),WINABS(2,2,NWINLEV),WINL
     *IM(2,2), FMARKER(3,8), SYDIR(3), GRDIR(3), EXYZLIM(3,2), DSLOPE(2
     *,2)
      REAL PLOT_EXTENT(2,2),FILL_ANGLE(MAX_FILL),FILL_WIDTH(MAX_FILL)
      INTEGER FILL_INDEX, FILL_TEX(MAX_FILL), N_LINES(6)
      EQUIVALENCE (DATDAT, DATPTS)
      INTEGER MAXREP
      PARAMETER (MAXREP=5)
      INTEGER IPATRN, NPATRN(30), NXYLIM(3,2), NPLOTS, NCSETS, NCCOL, N
     *CROW, IYEAR, IMONTH, IDAY, ISIGFG, ITXPRI, ITXSEC, ITITDT(3), L
     *ENCRD, IPROP, IHTEX, IBLINK, IERASE, ITCNTR, IUNUSD, NXYZ1(3), 
     *NXYZ2(3), LBLFMT(3), LBLCHR(3), NDIMNS(3), IBLKTP, IDIMNS, NMES
     *H0, NMESH1, NMESH2, MESH1, MESH2, MESH3, MESH2D, MESHN(3), NMESHN(
     *2), NFIELD, IFIELD(19), NINCR, NPOINT, IVARBL(19), IVPTR(19), I_
     *VORDER(19,2), LINEAR(4), NONLIN(4), MXECHO, LINES, MAXLNS, USRK
     *BD, USRSCR, PLTFIL, LINWID, LINCOL, LINTEX, ICPOIN(3), IREPCT(MA
     *XREP), LEVREP, GRDTYP, GRDTEX, OUTTEX, IAXTEX, TITEX, LETSET, LAB
     *TEX, TICTEX, SHADOWTYP,SHADOWTEX, NXYZDEF1(10), NXYZDEF2(10), IF
     *ILE_CASE ,MAX_SUBST
      INTEGER MAX_CYCLE
      PARAMETER (MAX_CYCLE=20)
      INTEGER N_CYCLE, ITX_CYCLE(MAX_CYCLE)
      REAL SYM_CYCLE(MAX_CYCLE)
      EQUIVALENCE (NMESH1,NMESHN)
      EQUIVALENCE (MESH1,MESHN)
      INTEGER IBUFFR(400)
      REAL BUFFER(400)
      INTEGER NCHSAVE 
      PARAMETER (NCHSAVE=2*512) 
      INTEGER*4 ICHSAVE(NCHSAVE)
      INTEGER*4 IVRPTR(15)
      CHARACTER*512 OUTSTR,C_FILE, C_NAME, C_SELECT
      CHARACTER C_TIT_ESCAPE*1,C_TIT_SUBSTITUTE*2
      INTEGER N_FILE, N_NAME, N_SELECT
      CHARACTER*8 PXNAME
      CHARACTER*64 INPFMT
      LOGICAL LTDATA, OUTSID(4)
      COMMON /T2COM/ PXNAME, REDUCE, TITX, TITY ,XFRM12, XFRM13, XFRM1
     *4, XFRM23 ,XFRM24, XFRM34 ,XVARSX ,TITSIZ, GRDSYM, GRDSIZ, CIRS
     *IZ, ASIZE, AFLARE ,SMSZDF, ORAXES, EYEDIR, VUEDIR, VUECEN ,VERTC
     *L, EYESEP, SCRD, SCRZ, EYEDIS, EYEPNT ,XYPART, BARSIZ, TIKSIZ, XY
     *ZBAS, TTHETA ,TPHI, FRELBL, IPATRN, NPATRN, PATRN ,SCLPRM, WINDO
     *W, SCREEN, SYMBOL, NOSYMB ,FACTXY, LBLSIZ, SYMSIZ, XYZLIM, WORLD 
     *,RADRMX, RADRMN, RADAMN, RADANG, RADX0, RADY0, XUNUSD ,USRKBD, U
     *SRSCR, PLTFIL ,ITITDT, LENCRD ,INPFMT, GRDTYP, LINWID, LINCOL, L
     *INTEX, TITCON, ITCNTR ,IUNUSD, NXYZ1, NXYZ2 ,LBLCHR, NDIMNS, IBL
     *KTP, IDIMNS ,NMESH1, NMESH2, MESH1, MESH2, MESH3, NFIELD ,IFIELD
     *, NINCR ,IVARBL, IVRPTR ,LINEAR, NONLIN ,NPOINT, LETSET ,MXECH
     *O, LINES, MAXLNS ,AXANG, MESH2D, REDFAC, GRDTEX, OUTTEX, IAXTEX, 
     *TITEX, DSCAL ,OUTSTR, IPROP, IHTEX, IBLINK, IERASE, LABTEX, TICTE
     *X, NXYLIM, PATSZ ,MARGIN, PSCR, ITXPRI, ITXSEC, OREAL, OCPU, CSCR
     *D, OUTSID ,TITLIN, TITINX, TITZ, TITX1, TITY1, LTDATA, NPLOTS, RE
     *VLEV ,LBLFMT, IYEAR, IMONTH, IDAY, ISIGFG ,DATPTS, ERRPTS, DATXM
     *N, DATXMX, DATYMN, DATYMX, DATZMN, DATZMX ,DATSUM, ERRSUM, DATAVE
     *, ERRAVE, DATCEN, ERRCEN, DATSTD, ERRSTD ,NCSETS, NCCOL, NCROW, F
     *MARKER, H2STAT, TITFAC, TITLOC, TITMAR ,TIKFAC, IWINLEV, WINREL, 
     *WINABS, WINLIM ,ICPOIN, LEVREP, IREPCT, SYDIR, GRDIR, NMESH0, EXY
     *ZLIM, IVPTR ,TITLMX, NXYZDEF1, NXYZDEF2, IFILE_CASE, N_CYCLE, ITX
     *_CYCLE ,SYM_CYCLE, PLOT_EXTENT, FILL_ANGLE, FILL_WIDTH, FILL_TEX 
     *,FILL_INDEX ,N_LINES ,DSLOPE ,MAX_SUBST, BARBRK ,I_VORDER,SHADOW
     *TYP,SHADOWTEX
      COMMON /T2SCRT/ BUFFER, IBUFFR, N_FILE,N_NAME,N_SELECT, ICHSAVE
      COMMON /T2_CHAR/ C_TIT_ESCAPE,C_TIT_SUBSTITUTE
      COMMON /T2_SCRT/ C_FILE, C_NAME, C_SELECT
      INTEGER JOUFIL, ERRFIL, OUTFIL, DBGFIL, INPFIL, NINMAX
      PARAMETER (NINMAX=20)
      INTEGER NINP(NINMAX)
      COMMON /T2TRBK/NINP, JOUFIL, ERRFIL, OUTFIL, DBGFIL, INPFIL
      CHARACTER*512 STRNG, STJOU
      LOGICAL LTOKEN
      REAL FLOTNG
      INTEGER INTERP, KEYORD, NSTRNG, MAXSTR, NSTJOU, LSTJOU, NTOKEN
      INTEGER*4 INTEG
      COMMON /TOKENC/ INTERP, INTEG, FLOTNG, KEYORD, NSTRNG, MAXSTR, ST
     *RNG, NSTJOU, LSTJOU, STJOU, LTOKEN, NTOKEN
      EXTERNAL UGXERR
      INTEGER IXX 
      INTEGER PXELWORDS, MAX_QOPN, QOPNSIZ 
      PARAMETER (PXELWORDS=2000)
      PARAMETER (MAX_QOPN=8)
      PARAMETER (QOPNSIZ=200)
      INTEGER IOPEN(10)
      LOGICAL L_IDOPEN(10)
      INTEGER VIRGIN ,ISEGMN ,JSEGMN, DFTSEG, JPROP, IACT
      LOGICAL LCLEAR ,LERAS ,LINTF, LPROP
      REAL DFTANG ,DFTSIZ ,URSIZE, WDOW(4)
      INTEGER DFTWID ,DFTTEX ,DFTCOL ,DFTVEC ,DFTFNT ,DFTBLK ,DFTPRP ,DF
     *TSTR ,DFTQUI ,PXEL(PXELWORDS)
      COMMON /TXCOMD/PXEL ,LCLEAR ,VIRGIN ,ISEGMN ,JSEGMN ,URSIZE ,DFTCO
     *L ,DFTTEX ,DFTWID ,DFTQUI ,DFTFNT ,DFTANG ,DFTSIZ ,DFTVEC ,LERAS ,
     *DFTPRP ,DFTBLK ,DFTSEG ,LINTF ,IOPEN, L_IDOPEN ,JPROP, LPROP, WDOW
     *, IACT
      INTEGER NQOPNF ,NQTXT
      CHARACTER*(QOPNSIZ) QOPNF
      CHARACTER*(QOPNSIZ) QOPN(MAX_QOPN)
      INTEGER NQOPN(MAX_QOPN)
      CHARACTER*80 QTXT
      COMMON/TXCOMV/NQOPN ,QOPN ,NQTXT ,QTXT ,NQOPNF ,QOPNF
      INTEGER IOP
      CHARACTER*8 STRING
      REAL X
      CALL UGINFO('OPENDEV',STRING,IOPEN,X)
      IF(IOPEN(1).gt.0) THEN
      CALL TXXMT
      If (FLAGS(60)) THEN
      LCLEAR = .true.
      ELSE
      JSEGMN=DFTSEG
      ISEGMN=DFTSEG
      DO 10701 IOP=2,IOPEN(1)+1
      CALL UGSLCT(' ',IOPEN(IOP))
      IF(PXNAME.ne.' ') THEN
      CALL UGPICT('CLEAR,ALIAS='//PXNAME,0)
      ELSE
      CALL UGPICT('CLEAR',0)
      ENDIF
10701 CONTINUE
10702 CONTINUE
      ENDIF
      ENDIF
      END
      SUBROUTINE TXXERA(EWDOW)
      IMPLICIT NONE
      REAL EWDOW(2,2),VIEW(2,2,2)
      INTEGER I
      REAL HNONE
      EXTERNAL UGXERR
      INTEGER IXX 
      INTEGER PXELWORDS, MAX_QOPN, QOPNSIZ 
      PARAMETER (PXELWORDS=2000)
      PARAMETER (MAX_QOPN=8)
      PARAMETER (QOPNSIZ=200)
      INTEGER IOPEN(10)
      LOGICAL L_IDOPEN(10)
      INTEGER VIRGIN ,ISEGMN ,JSEGMN, DFTSEG, JPROP, IACT
      LOGICAL LCLEAR ,LERAS ,LINTF, LPROP
      REAL DFTANG ,DFTSIZ ,URSIZE, WDOW(4)
      INTEGER DFTWID ,DFTTEX ,DFTCOL ,DFTVEC ,DFTFNT ,DFTBLK ,DFTPRP ,DF
     *TSTR ,DFTQUI ,PXEL(PXELWORDS)
      COMMON /TXCOMD/PXEL ,LCLEAR ,VIRGIN ,ISEGMN ,JSEGMN ,URSIZE ,DFTCO
     *L ,DFTTEX ,DFTWID ,DFTQUI ,DFTFNT ,DFTANG ,DFTSIZ ,DFTVEC ,LERAS ,
     *DFTPRP ,DFTBLK ,DFTSEG ,LINTF ,IOPEN, L_IDOPEN ,JPROP, LPROP, WDOW
     *, IACT
      INTEGER NQOPNF ,NQTXT
      CHARACTER*(QOPNSIZ) QOPNF
      CHARACTER*(QOPNSIZ) QOPN(MAX_QOPN)
      INTEGER NQOPN(MAX_QOPN)
      CHARACTER*80 QTXT
      COMMON/TXCOMV/NQOPN ,QOPN ,NQTXT ,QTXT ,NQOPNF ,QOPNF
      CHARACTER*8 STRING
      REAL X
      DATA HNONE /-666.666/
      IF (EWDOW(1,1).eq.HNONE) THEN
      CALL TXXCLR
      RETURN
      ENDIF
      CALL UGINFO('OPENDEV',STRING,IOPEN,X)
      IF(IOPEN(1).gt.0) THEN
      CALL UGSLCT(' ',IOPEN(2))
      CALL TXXMT
      CALL UGWDOW('GET',VIEW(1,1,1),WDOW)
      DO 10711 I=1,2
      VIEW(I,1,2)=MAX(MIN(EWDOW(I,1),EWDOW(I,2)),VIEW(I,1,1))
      VIEW(I,2,2)=MIN(MAX(EWDOW(I,1),EWDOW(I,2)),VIEW(I,2,1))
10711 CONTINUE
10712 CONTINUE
      CALL UGWDOW('PUT',VIEW(1,1,2),WDOW)
      CALL UGPICT('CLEAR,WINDOW',0)
      CALL UGWDOW('PUT',VIEW(1,1,1),WDOW)
      ENDIF
      END
      SUBROUTINE TXXMT
      IMPLICIT NONE
      EXTERNAL UGXERR
      INTEGER IXX 
      INTEGER PXELWORDS, MAX_QOPN, QOPNSIZ 
      PARAMETER (PXELWORDS=2000)
      PARAMETER (MAX_QOPN=8)
      PARAMETER (QOPNSIZ=200)
      INTEGER IOPEN(10)
      LOGICAL L_IDOPEN(10)
      INTEGER VIRGIN ,ISEGMN ,JSEGMN, DFTSEG, JPROP, IACT
      LOGICAL LCLEAR ,LERAS ,LINTF, LPROP
      REAL DFTANG ,DFTSIZ ,URSIZE, WDOW(4)
      INTEGER DFTWID ,DFTTEX ,DFTCOL ,DFTVEC ,DFTFNT ,DFTBLK ,DFTPRP ,DF
     *TSTR ,DFTQUI ,PXEL(PXELWORDS)
      COMMON /TXCOMD/PXEL ,LCLEAR ,VIRGIN ,ISEGMN ,JSEGMN ,URSIZE ,DFTCO
     *L ,DFTTEX ,DFTWID ,DFTQUI ,DFTFNT ,DFTANG ,DFTSIZ ,DFTVEC ,LERAS ,
     *DFTPRP ,DFTBLK ,DFTSEG ,LINTF ,IOPEN, L_IDOPEN ,JPROP, LPROP, WDOW
     *, IACT
      INTEGER NQOPNF ,NQTXT
      CHARACTER*(QOPNSIZ) QOPNF
      CHARACTER*(QOPNSIZ) QOPN(MAX_QOPN)
      INTEGER NQOPN(MAX_QOPN)
      CHARACTER*80 QTXT
      COMMON/TXCOMV/NQOPN ,QOPN ,NQTXT ,QTXT ,NQOPNF ,QOPNF
      COMMON /T2FLGC/ FLAGS(200), LTRAP,LHANDL,LSYERR,LSCREV
      LOGICAL FLAGS, LTRAP,LHANDL,LSYERR,LSCREV(3)
      INTEGER RELFLAG 
      PARAMETER (RELFLAG=151)
      INTEGER IWINLEV 
      INTEGER NWINLEV , MAX_FILL 
      PARAMETER (NWINLEV =4)
      PARAMETER (MAX_FILL=4)
      REAL GRDSYM, GRDSIZ, DATDAT(2,8), H2STAT(12), TITLIN(4), TITFA
     *C(4), TITLOC(4), TITMAR(4), TITLMX(4), TIKFAC, TITINX, TITX1, TIT
     *Y1, TITX, TITY, TITZ, TITSIZ, TITCON(5), REVLEV, REDUCE(5), XFR
     *M12(12), XFRM13(12), XFRM14(12), XFRM23(12), XFRM24(12), XFRM34(6
     *), XVARSX(20), CIRSIZ(2,3), ASIZE, AFLARE, SMSZDF, ORAXES(3), EY
     *EDIR(3), VUEDIR(3), VUECEN(3), VERTCL(3), EYESEP, SCRD, SCRZ, EYE
     *DIS, EYEPNT(3), XYPART(2, 2), BARSIZ(3), BARBRK(3), TIKSIZ(3), XY
     *ZBAS(3), TTHETA, TPHI, FRELBL(4), PATRN(20,30), SCLPRM(10,3), WI
     *NDOW(4), SCREEN(2), SYMBOL, NOSYMB, FACTXY(19), LBLSIZ, SYMSIZ, X
     *YZLIM(3,2), WORLD(3), RADRMX, RADRMN, RADAMN, RADANG, RADX0, RADY
     *0, XUNUSD(6), AXANG(3), REDFAC, DSCAL, PATSZ, MARGIN(4), PSCR(2
     *), OREAL, OCPU, CSCRD, DATPTS, ERRPTS, DATXMN, DATXMX, DATYMN, DA
     *TYMX, DATZMN, DATZMX, DATSUM, ERRSUM, DATAVE, ERRAVE, DATCEN, ERR
     *CEN, DATSTD, ERRSTD, WINREL(2,2,NWINLEV),WINABS(2,2,NWINLEV),WINL
     *IM(2,2), FMARKER(3,8), SYDIR(3), GRDIR(3), EXYZLIM(3,2), DSLOPE(2
     *,2)
      REAL PLOT_EXTENT(2,2),FILL_ANGLE(MAX_FILL),FILL_WIDTH(MAX_FILL)
      INTEGER FILL_INDEX, FILL_TEX(MAX_FILL), N_LINES(6)
      EQUIVALENCE (DATDAT, DATPTS)
      INTEGER MAXREP
      PARAMETER (MAXREP=5)
      INTEGER IPATRN, NPATRN(30), NXYLIM(3,2), NPLOTS, NCSETS, NCCOL, N
     *CROW, IYEAR, IMONTH, IDAY, ISIGFG, ITXPRI, ITXSEC, ITITDT(3), L
     *ENCRD, IPROP, IHTEX, IBLINK, IERASE, ITCNTR, IUNUSD, NXYZ1(3), 
     *NXYZ2(3), LBLFMT(3), LBLCHR(3), NDIMNS(3), IBLKTP, IDIMNS, NMES
     *H0, NMESH1, NMESH2, MESH1, MESH2, MESH3, MESH2D, MESHN(3), NMESHN(
     *2), NFIELD, IFIELD(19), NINCR, NPOINT, IVARBL(19), IVPTR(19), I_
     *VORDER(19,2), LINEAR(4), NONLIN(4), MXECHO, LINES, MAXLNS, USRK
     *BD, USRSCR, PLTFIL, LINWID, LINCOL, LINTEX, ICPOIN(3), IREPCT(MA
     *XREP), LEVREP, GRDTYP, GRDTEX, OUTTEX, IAXTEX, TITEX, LETSET, LAB
     *TEX, TICTEX, SHADOWTYP,SHADOWTEX, NXYZDEF1(10), NXYZDEF2(10), IF
     *ILE_CASE ,MAX_SUBST
      INTEGER MAX_CYCLE
      PARAMETER (MAX_CYCLE=20)
      INTEGER N_CYCLE, ITX_CYCLE(MAX_CYCLE)
      REAL SYM_CYCLE(MAX_CYCLE)
      EQUIVALENCE (NMESH1,NMESHN)
      EQUIVALENCE (MESH1,MESHN)
      INTEGER IBUFFR(400)
      REAL BUFFER(400)
      INTEGER NCHSAVE 
      PARAMETER (NCHSAVE=2*512) 
      INTEGER*4 ICHSAVE(NCHSAVE)
      INTEGER*4 IVRPTR(15)
      CHARACTER*512 OUTSTR,C_FILE, C_NAME, C_SELECT
      CHARACTER C_TIT_ESCAPE*1,C_TIT_SUBSTITUTE*2
      INTEGER N_FILE, N_NAME, N_SELECT
      CHARACTER*8 PXNAME
      CHARACTER*64 INPFMT
      LOGICAL LTDATA, OUTSID(4)
      COMMON /T2COM/ PXNAME, REDUCE, TITX, TITY ,XFRM12, XFRM13, XFRM1
     *4, XFRM23 ,XFRM24, XFRM34 ,XVARSX ,TITSIZ, GRDSYM, GRDSIZ, CIRS
     *IZ, ASIZE, AFLARE ,SMSZDF, ORAXES, EYEDIR, VUEDIR, VUECEN ,VERTC
     *L, EYESEP, SCRD, SCRZ, EYEDIS, EYEPNT ,XYPART, BARSIZ, TIKSIZ, XY
     *ZBAS, TTHETA ,TPHI, FRELBL, IPATRN, NPATRN, PATRN ,SCLPRM, WINDO
     *W, SCREEN, SYMBOL, NOSYMB ,FACTXY, LBLSIZ, SYMSIZ, XYZLIM, WORLD 
     *,RADRMX, RADRMN, RADAMN, RADANG, RADX0, RADY0, XUNUSD ,USRKBD, U
     *SRSCR, PLTFIL ,ITITDT, LENCRD ,INPFMT, GRDTYP, LINWID, LINCOL, L
     *INTEX, TITCON, ITCNTR ,IUNUSD, NXYZ1, NXYZ2 ,LBLCHR, NDIMNS, IBL
     *KTP, IDIMNS ,NMESH1, NMESH2, MESH1, MESH2, MESH3, NFIELD ,IFIELD
     *, NINCR ,IVARBL, IVRPTR ,LINEAR, NONLIN ,NPOINT, LETSET ,MXECH
     *O, LINES, MAXLNS ,AXANG, MESH2D, REDFAC, GRDTEX, OUTTEX, IAXTEX, 
     *TITEX, DSCAL ,OUTSTR, IPROP, IHTEX, IBLINK, IERASE, LABTEX, TICTE
     *X, NXYLIM, PATSZ ,MARGIN, PSCR, ITXPRI, ITXSEC, OREAL, OCPU, CSCR
     *D, OUTSID ,TITLIN, TITINX, TITZ, TITX1, TITY1, LTDATA, NPLOTS, RE
     *VLEV ,LBLFMT, IYEAR, IMONTH, IDAY, ISIGFG ,DATPTS, ERRPTS, DATXM
     *N, DATXMX, DATYMN, DATYMX, DATZMN, DATZMX ,DATSUM, ERRSUM, DATAVE
     *, ERRAVE, DATCEN, ERRCEN, DATSTD, ERRSTD ,NCSETS, NCCOL, NCROW, F
     *MARKER, H2STAT, TITFAC, TITLOC, TITMAR ,TIKFAC, IWINLEV, WINREL, 
     *WINABS, WINLIM ,ICPOIN, LEVREP, IREPCT, SYDIR, GRDIR, NMESH0, EXY
     *ZLIM, IVPTR ,TITLMX, NXYZDEF1, NXYZDEF2, IFILE_CASE, N_CYCLE, ITX
     *_CYCLE ,SYM_CYCLE, PLOT_EXTENT, FILL_ANGLE, FILL_WIDTH, FILL_TEX 
     *,FILL_INDEX ,N_LINES ,DSLOPE ,MAX_SUBST, BARBRK ,I_VORDER,SHADOW
     *TYP,SHADOWTEX
      COMMON /T2SCRT/ BUFFER, IBUFFR, N_FILE,N_NAME,N_SELECT, ICHSAVE
      COMMON /T2_CHAR/ C_TIT_ESCAPE,C_TIT_SUBSTITUTE
      COMMON /T2_SCRT/ C_FILE, C_NAME, C_SELECT
      INTEGER JOUFIL, ERRFIL, OUTFIL, DBGFIL, INPFIL, NINMAX
      PARAMETER (NINMAX=20)
      INTEGER NINP(NINMAX)
      COMMON /T2TRBK/NINP, JOUFIL, ERRFIL, OUTFIL, DBGFIL, INPFIL
      CHARACTER*512 STRNG, STJOU
      LOGICAL LTOKEN
      REAL FLOTNG
      INTEGER INTERP, KEYORD, NSTRNG, MAXSTR, NSTJOU, LSTJOU, NTOKEN
      INTEGER*4 INTEG
      COMMON /TOKENC/ INTERP, INTEG, FLOTNG, KEYORD, NSTRNG, MAXSTR, ST
     *RNG, NSTJOU, LSTJOU, STJOU, LTOKEN, NTOKEN
      INTEGER IOP
      IF (PXEL(1).ne.VIRGIN) THEN
      DO 10721 IOP=2,IOPEN(1)+1
      CALL UGSLCT(' ',IOPEN(IOP))
      IF (LCLEAR) THEN
      JSEGMN=DFTSEG
      ISEGMN=DFTSEG
      IF (PXNAME.ne.' ') THEN
      CALL UGPICT('CLEAR,ALIAS='//PXNAME,0)
      ELSE
      CALL UGPICT('CLEAR',0)
      ENDIF
      LCLEAR = .false.
      ENDIF
      IF (.not.LTRAP) THEN
      IF(LERAS) THEN
      CALL UGWRIT('ERASE',ISEGMN,PXEL)
      ELSE
      CALL UGWRIT(' ',ISEGMN,PXEL)
      ENDIF
      IF(ISEGMN.gt.0) ISEGMN=ISEGMN+1
      ENDIF
10721 CONTINUE
10722 CONTINUE
      CALL UGINIT('CLEAR',PXEL,PXELWORDS)
      VIRGIN=PXEL(1)
      ENDIF
      END
      SUBROUTINE TXXOPN(INCHFC)
      IMPLICIT NONE
      EXTERNAL UGXERR
      INTEGER IXX 
      INTEGER PXELWORDS, MAX_QOPN, QOPNSIZ 
      PARAMETER (PXELWORDS=2000)
      PARAMETER (MAX_QOPN=8)
      PARAMETER (QOPNSIZ=200)
      INTEGER IOPEN(10)
      LOGICAL L_IDOPEN(10)
      INTEGER VIRGIN ,ISEGMN ,JSEGMN, DFTSEG, JPROP, IACT
      LOGICAL LCLEAR ,LERAS ,LINTF, LPROP
      REAL DFTANG ,DFTSIZ ,URSIZE, WDOW(4)
      INTEGER DFTWID ,DFTTEX ,DFTCOL ,DFTVEC ,DFTFNT ,DFTBLK ,DFTPRP ,DF
     *TSTR ,DFTQUI ,PXEL(PXELWORDS)
      COMMON /TXCOMD/PXEL ,LCLEAR ,VIRGIN ,ISEGMN ,JSEGMN ,URSIZE ,DFTCO
     *L ,DFTTEX ,DFTWID ,DFTQUI ,DFTFNT ,DFTANG ,DFTSIZ ,DFTVEC ,LERAS ,
     *DFTPRP ,DFTBLK ,DFTSEG ,LINTF ,IOPEN, L_IDOPEN ,JPROP, LPROP, WDOW
     *, IACT
      INTEGER NQOPNF ,NQTXT
      CHARACTER*(QOPNSIZ) QOPNF
      CHARACTER*(QOPNSIZ) QOPN(MAX_QOPN)
      INTEGER NQOPN(MAX_QOPN)
      CHARACTER*80 QTXT
      COMMON/TXCOMV/NQOPN ,QOPN ,NQTXT ,QTXT ,NQOPNF ,QOPNF
      REAL PLIM(4,4),ZSCRN(2),XLLINE,YLLINE,XTLINE,YTLINE,XFRMFC, PAT(2
     *0),PATCUM,PATTOT,PATMOD,CCSCIS(4),DISPL, RESOL(2)
      INTEGER NPTS,IDDEVC,IPAT,NPAT,LMOVE,IROTAX,IROTAF
      COMMON/TXCOM/PLIM,ZSCRN, XLLINE,YLLINE,XTLINE,YTLINE,XFRMFC, IPA
     *T,NPAT,PAT,PATTOT, NPTS,IDDEVC,CCSCIS,LMOVE,IROTAX,DISPL,IROTAF,P
     *ATCUM,PATMOD, RESOL
      REAL INCHFC(2),EXTREM(4),EXTEND(4)
      COMMON /T2FLGC/ FLAGS(200), LTRAP,LHANDL,LSYERR,LSCREV
      LOGICAL FLAGS, LTRAP,LHANDL,LSYERR,LSCREV(3)
      INTEGER RELFLAG 
      PARAMETER (RELFLAG=151)
      INTEGER IWINLEV 
      INTEGER NWINLEV , MAX_FILL 
      PARAMETER (NWINLEV =4)
      PARAMETER (MAX_FILL=4)
      REAL GRDSYM, GRDSIZ, DATDAT(2,8), H2STAT(12), TITLIN(4), TITFA
     *C(4), TITLOC(4), TITMAR(4), TITLMX(4), TIKFAC, TITINX, TITX1, TIT
     *Y1, TITX, TITY, TITZ, TITSIZ, TITCON(5), REVLEV, REDUCE(5), XFR
     *M12(12), XFRM13(12), XFRM14(12), XFRM23(12), XFRM24(12), XFRM34(6
     *), XVARSX(20), CIRSIZ(2,3), ASIZE, AFLARE, SMSZDF, ORAXES(3), EY
     *EDIR(3), VUEDIR(3), VUECEN(3), VERTCL(3), EYESEP, SCRD, SCRZ, EYE
     *DIS, EYEPNT(3), XYPART(2, 2), BARSIZ(3), BARBRK(3), TIKSIZ(3), XY
     *ZBAS(3), TTHETA, TPHI, FRELBL(4), PATRN(20,30), SCLPRM(10,3), WI
     *NDOW(4), SCREEN(2), SYMBOL, NOSYMB, FACTXY(19), LBLSIZ, SYMSIZ, X
     *YZLIM(3,2), WORLD(3), RADRMX, RADRMN, RADAMN, RADANG, RADX0, RADY
     *0, XUNUSD(6), AXANG(3), REDFAC, DSCAL, PATSZ, MARGIN(4), PSCR(2
     *), OREAL, OCPU, CSCRD, DATPTS, ERRPTS, DATXMN, DATXMX, DATYMN, DA
     *TYMX, DATZMN, DATZMX, DATSUM, ERRSUM, DATAVE, ERRAVE, DATCEN, ERR
     *CEN, DATSTD, ERRSTD, WINREL(2,2,NWINLEV),WINABS(2,2,NWINLEV),WINL
     *IM(2,2), FMARKER(3,8), SYDIR(3), GRDIR(3), EXYZLIM(3,2), DSLOPE(2
     *,2)
      REAL PLOT_EXTENT(2,2),FILL_ANGLE(MAX_FILL),FILL_WIDTH(MAX_FILL)
      INTEGER FILL_INDEX, FILL_TEX(MAX_FILL), N_LINES(6)
      EQUIVALENCE (DATDAT, DATPTS)
      INTEGER MAXREP
      PARAMETER (MAXREP=5)
      INTEGER IPATRN, NPATRN(30), NXYLIM(3,2), NPLOTS, NCSETS, NCCOL, N
     *CROW, IYEAR, IMONTH, IDAY, ISIGFG, ITXPRI, ITXSEC, ITITDT(3), L
     *ENCRD, IPROP, IHTEX, IBLINK, IERASE, ITCNTR, IUNUSD, NXYZ1(3), 
     *NXYZ2(3), LBLFMT(3), LBLCHR(3), NDIMNS(3), IBLKTP, IDIMNS, NMES
     *H0, NMESH1, NMESH2, MESH1, MESH2, MESH3, MESH2D, MESHN(3), NMESHN(
     *2), NFIELD, IFIELD(19), NINCR, NPOINT, IVARBL(19), IVPTR(19), I_
     *VORDER(19,2), LINEAR(4), NONLIN(4), MXECHO, LINES, MAXLNS, USRK
     *BD, USRSCR, PLTFIL, LINWID, LINCOL, LINTEX, ICPOIN(3), IREPCT(MA
     *XREP), LEVREP, GRDTYP, GRDTEX, OUTTEX, IAXTEX, TITEX, LETSET, LAB
     *TEX, TICTEX, SHADOWTYP,SHADOWTEX, NXYZDEF1(10), NXYZDEF2(10), IF
     *ILE_CASE ,MAX_SUBST
      INTEGER MAX_CYCLE
      PARAMETER (MAX_CYCLE=20)
      INTEGER N_CYCLE, ITX_CYCLE(MAX_CYCLE)
      REAL SYM_CYCLE(MAX_CYCLE)
      EQUIVALENCE (NMESH1,NMESHN)
      EQUIVALENCE (MESH1,MESHN)
      INTEGER IBUFFR(400)
      REAL BUFFER(400)
      INTEGER NCHSAVE 
      PARAMETER (NCHSAVE=2*512) 
      INTEGER*4 ICHSAVE(NCHSAVE)
      INTEGER*4 IVRPTR(15)
      CHARACTER*512 OUTSTR,C_FILE, C_NAME, C_SELECT
      CHARACTER C_TIT_ESCAPE*1,C_TIT_SUBSTITUTE*2
      INTEGER N_FILE, N_NAME, N_SELECT
      CHARACTER*8 PXNAME
      CHARACTER*64 INPFMT
      LOGICAL LTDATA, OUTSID(4)
      COMMON /T2COM/ PXNAME, REDUCE, TITX, TITY ,XFRM12, XFRM13, XFRM1
     *4, XFRM23 ,XFRM24, XFRM34 ,XVARSX ,TITSIZ, GRDSYM, GRDSIZ, CIRS
     *IZ, ASIZE, AFLARE ,SMSZDF, ORAXES, EYEDIR, VUEDIR, VUECEN ,VERTC
     *L, EYESEP, SCRD, SCRZ, EYEDIS, EYEPNT ,XYPART, BARSIZ, TIKSIZ, XY
     *ZBAS, TTHETA ,TPHI, FRELBL, IPATRN, NPATRN, PATRN ,SCLPRM, WINDO
     *W, SCREEN, SYMBOL, NOSYMB ,FACTXY, LBLSIZ, SYMSIZ, XYZLIM, WORLD 
     *,RADRMX, RADRMN, RADAMN, RADANG, RADX0, RADY0, XUNUSD ,USRKBD, U
     *SRSCR, PLTFIL ,ITITDT, LENCRD ,INPFMT, GRDTYP, LINWID, LINCOL, L
     *INTEX, TITCON, ITCNTR ,IUNUSD, NXYZ1, NXYZ2 ,LBLCHR, NDIMNS, IBL
     *KTP, IDIMNS ,NMESH1, NMESH2, MESH1, MESH2, MESH3, NFIELD ,IFIELD
     *, NINCR ,IVARBL, IVRPTR ,LINEAR, NONLIN ,NPOINT, LETSET ,MXECH
     *O, LINES, MAXLNS ,AXANG, MESH2D, REDFAC, GRDTEX, OUTTEX, IAXTEX, 
     *TITEX, DSCAL ,OUTSTR, IPROP, IHTEX, IBLINK, IERASE, LABTEX, TICTE
     *X, NXYLIM, PATSZ ,MARGIN, PSCR, ITXPRI, ITXSEC, OREAL, OCPU, CSCR
     *D, OUTSID ,TITLIN, TITINX, TITZ, TITX1, TITY1, LTDATA, NPLOTS, RE
     *VLEV ,LBLFMT, IYEAR, IMONTH, IDAY, ISIGFG ,DATPTS, ERRPTS, DATXM
     *N, DATXMX, DATYMN, DATYMX, DATZMN, DATZMX ,DATSUM, ERRSUM, DATAVE
     *, ERRAVE, DATCEN, ERRCEN, DATSTD, ERRSTD ,NCSETS, NCCOL, NCROW, F
     *MARKER, H2STAT, TITFAC, TITLOC, TITMAR ,TIKFAC, IWINLEV, WINREL, 
     *WINABS, WINLIM ,ICPOIN, LEVREP, IREPCT, SYDIR, GRDIR, NMESH0, EXY
     *ZLIM, IVPTR ,TITLMX, NXYZDEF1, NXYZDEF2, IFILE_CASE, N_CYCLE, ITX
     *_CYCLE ,SYM_CYCLE, PLOT_EXTENT, FILL_ANGLE, FILL_WIDTH, FILL_TEX 
     *,FILL_INDEX ,N_LINES ,DSLOPE ,MAX_SUBST, BARBRK ,I_VORDER,SHADOW
     *TYP,SHADOWTEX
      COMMON /T2SCRT/ BUFFER, IBUFFR, N_FILE,N_NAME,N_SELECT, ICHSAVE
      COMMON /T2_CHAR/ C_TIT_ESCAPE,C_TIT_SUBSTITUTE
      COMMON /T2_SCRT/ C_FILE, C_NAME, C_SELECT
      INTEGER JOUFIL, ERRFIL, OUTFIL, DBGFIL, INPFIL, NINMAX
      PARAMETER (NINMAX=20)
      INTEGER NINP(NINMAX)
      COMMON /T2TRBK/NINP, JOUFIL, ERRFIL, OUTFIL, DBGFIL, INPFIL
      CHARACTER*512 STRNG, STJOU
      LOGICAL LTOKEN
      REAL FLOTNG
      INTEGER INTERP, KEYORD, NSTRNG, MAXSTR, NSTJOU, LSTJOU, NTOKEN
      INTEGER*4 INTEG
      COMMON /TOKENC/ INTERP, INTEG, FLOTNG, KEYORD, NSTRNG, MAXSTR, ST
     *RNG, NSTJOU, LSTJOU, STJOU, LTOKEN, NTOKEN
      INTEGER I,UGIVAL(4),IOP
      LOGICAL L_TEST(MAX_QOPN)
      CHARACTER*8 STRING
      REAL UGRVAL(4)
      CHARACTER*1 UGSTR
      REAL X,Y,AFF
      IF (LTRAP) RETURN
      IF (.NOT.(FLAGS(24))) THEN
      CALL UGINFO('OPENDEV',STRING,IOPEN,WDOW)
      INCHFC(1)=1.
      INCHFC(2)=1.
      DO 10731 I=3,4
      PLIM(1+MOD(IROTAX,2),I)=0.0
      PLIM(2-MOD(IROTAX,2),I)=0.0
      PLIM(3+MOD(IROTAX,2),I)=13 
      PLIM(4-MOD(IROTAX,2),I)=10
10731 CONTINUE
10732 CONTINUE
      DO 10741 IOP=1,MAX_QOPN
      l_TEST(IOP)=.false.
10741 CONTINUE
10742 CONTINUE
      DO 10751 IOP=2,IOPEN(1)+1
      IF (IOPEN(IOP) .gt. 0 .and. IOPEN(IOP) .le. MAX_QOPN) l_TEST(IOPEN
     *(IOP))=.true.
10751 CONTINUE
10752 CONTINUE
      DO 10761 IOP=1,MAX_QOPN
      IF(NQOPN(IOP) .le. 0 .or. l_TEST(IOP))GOTO 10761
      CALL UGOPEN(QOPN(IOP),IOP)
      CALL UGINFO('OPENDEV',STRING,IOPEN,WDOW)
      FLAGS(24)=IOPEN(1) .gt. 0
      CALL UGINFO('ACTDEV',STRING,IACT,WDOW)
      If (IACT .NE. IOP) GOTO 10761
      LPROP=INDEX(QOPN(1),'UGGKSWM') .gt. 0
      CALL UGDSPC('GET',X,Y,AFF)
      CALL UGINFO('DSPCSIZE',UGSTR,UGIVAL,UGRVAL)
      CALL UGINFO('DPHYSIZE',UGSTR,UGIVAL,RESOL)
      DO 10771 I=1,2
      RESOL(I)=RESOL(I)/2.54
      IF (RESOL(I).LT. 1.0E-4) RESOL(I)=1.2912093E-02*(2.54/2.54)
      RESOL(I)=MAX(RESOL(I),.001)
10771 CONTINUE
10772 CONTINUE
      IF (IOP .EQ. 1) URSIZE=X*UGRVAL(1)/2.54
10761 CONTINUE
10762 CONTINUE
      CALL UGINIT('CLEAR',PXEL,PXELWORDS)
      VIRGIN=PXEL(1)
      ENDIF
      CALL TXXSIZ
      END
      SUBROUTINE TXXOPT(IOPT,IPARM,PARM,IERR)
      IMPLICIT NONE
      EXTERNAL UGXERR
      INTEGER IERR,DFTBLD
      LOGICAL LTEMP
      INTEGER IXX 
      INTEGER PXELWORDS, MAX_QOPN, QOPNSIZ 
      PARAMETER (PXELWORDS=2000)
      PARAMETER (MAX_QOPN=8)
      PARAMETER (QOPNSIZ=200)
      INTEGER IOPEN(10)
      LOGICAL L_IDOPEN(10)
      INTEGER VIRGIN ,ISEGMN ,JSEGMN, DFTSEG, JPROP, IACT
      LOGICAL LCLEAR ,LERAS ,LINTF, LPROP
      REAL DFTANG ,DFTSIZ ,URSIZE, WDOW(4)
      INTEGER DFTWID ,DFTTEX ,DFTCOL ,DFTVEC ,DFTFNT ,DFTBLK ,DFTPRP ,DF
     *TSTR ,DFTQUI ,PXEL(PXELWORDS)
      COMMON /TXCOMD/PXEL ,LCLEAR ,VIRGIN ,ISEGMN ,JSEGMN ,URSIZE ,DFTCO
     *L ,DFTTEX ,DFTWID ,DFTQUI ,DFTFNT ,DFTANG ,DFTSIZ ,DFTVEC ,LERAS ,
     *DFTPRP ,DFTBLK ,DFTSEG ,LINTF ,IOPEN, L_IDOPEN ,JPROP, LPROP, WDOW
     *, IACT
      INTEGER NQOPNF ,NQTXT
      CHARACTER*(QOPNSIZ) QOPNF
      CHARACTER*(QOPNSIZ) QOPN(MAX_QOPN)
      INTEGER NQOPN(MAX_QOPN)
      CHARACTER*80 QTXT
      COMMON/TXCOMV/NQOPN ,QOPN ,NQTXT ,QTXT ,NQOPNF ,QOPNF
      COMMON /T2FLGC/ FLAGS(200), LTRAP,LHANDL,LSYERR,LSCREV
      LOGICAL FLAGS, LTRAP,LHANDL,LSYERR,LSCREV(3)
      INTEGER RELFLAG 
      PARAMETER (RELFLAG=151)
      INTEGER IWINLEV 
      INTEGER NWINLEV , MAX_FILL 
      PARAMETER (NWINLEV =4)
      PARAMETER (MAX_FILL=4)
      REAL GRDSYM, GRDSIZ, DATDAT(2,8), H2STAT(12), TITLIN(4), TITFA
     *C(4), TITLOC(4), TITMAR(4), TITLMX(4), TIKFAC, TITINX, TITX1, TIT
     *Y1, TITX, TITY, TITZ, TITSIZ, TITCON(5), REVLEV, REDUCE(5), XFR
     *M12(12), XFRM13(12), XFRM14(12), XFRM23(12), XFRM24(12), XFRM34(6
     *), XVARSX(20), CIRSIZ(2,3), ASIZE, AFLARE, SMSZDF, ORAXES(3), EY
     *EDIR(3), VUEDIR(3), VUECEN(3), VERTCL(3), EYESEP, SCRD, SCRZ, EYE
     *DIS, EYEPNT(3), XYPART(2, 2), BARSIZ(3), BARBRK(3), TIKSIZ(3), XY
     *ZBAS(3), TTHETA, TPHI, FRELBL(4), PATRN(20,30), SCLPRM(10,3), WI
     *NDOW(4), SCREEN(2), SYMBOL, NOSYMB, FACTXY(19), LBLSIZ, SYMSIZ, X
     *YZLIM(3,2), WORLD(3), RADRMX, RADRMN, RADAMN, RADANG, RADX0, RADY
     *0, XUNUSD(6), AXANG(3), REDFAC, DSCAL, PATSZ, MARGIN(4), PSCR(2
     *), OREAL, OCPU, CSCRD, DATPTS, ERRPTS, DATXMN, DATXMX, DATYMN, DA
     *TYMX, DATZMN, DATZMX, DATSUM, ERRSUM, DATAVE, ERRAVE, DATCEN, ERR
     *CEN, DATSTD, ERRSTD, WINREL(2,2,NWINLEV),WINABS(2,2,NWINLEV),WINL
     *IM(2,2), FMARKER(3,8), SYDIR(3), GRDIR(3), EXYZLIM(3,2), DSLOPE(2
     *,2)
      REAL PLOT_EXTENT(2,2),FILL_ANGLE(MAX_FILL),FILL_WIDTH(MAX_FILL)
      INTEGER FILL_INDEX, FILL_TEX(MAX_FILL), N_LINES(6)
      EQUIVALENCE (DATDAT, DATPTS)
      INTEGER MAXREP
      PARAMETER (MAXREP=5)
      INTEGER IPATRN, NPATRN(30), NXYLIM(3,2), NPLOTS, NCSETS, NCCOL, N
     *CROW, IYEAR, IMONTH, IDAY, ISIGFG, ITXPRI, ITXSEC, ITITDT(3), L
     *ENCRD, IPROP, IHTEX, IBLINK, IERASE, ITCNTR, IUNUSD, NXYZ1(3), 
     *NXYZ2(3), LBLFMT(3), LBLCHR(3), NDIMNS(3), IBLKTP, IDIMNS, NMES
     *H0, NMESH1, NMESH2, MESH1, MESH2, MESH3, MESH2D, MESHN(3), NMESHN(
     *2), NFIELD, IFIELD(19), NINCR, NPOINT, IVARBL(19), IVPTR(19), I_
     *VORDER(19,2), LINEAR(4), NONLIN(4), MXECHO, LINES, MAXLNS, USRK
     *BD, USRSCR, PLTFIL, LINWID, LINCOL, LINTEX, ICPOIN(3), IREPCT(MA
     *XREP), LEVREP, GRDTYP, GRDTEX, OUTTEX, IAXTEX, TITEX, LETSET, LAB
     *TEX, TICTEX, SHADOWTYP,SHADOWTEX, NXYZDEF1(10), NXYZDEF2(10), IF
     *ILE_CASE ,MAX_SUBST
      INTEGER MAX_CYCLE
      PARAMETER (MAX_CYCLE=20)
      INTEGER N_CYCLE, ITX_CYCLE(MAX_CYCLE)
      REAL SYM_CYCLE(MAX_CYCLE)
      EQUIVALENCE (NMESH1,NMESHN)
      EQUIVALENCE (MESH1,MESHN)
      INTEGER IBUFFR(400)
      REAL BUFFER(400)
      INTEGER NCHSAVE 
      PARAMETER (NCHSAVE=2*512) 
      INTEGER*4 ICHSAVE(NCHSAVE)
      INTEGER*4 IVRPTR(15)
      CHARACTER*512 OUTSTR,C_FILE, C_NAME, C_SELECT
      CHARACTER C_TIT_ESCAPE*1,C_TIT_SUBSTITUTE*2
      INTEGER N_FILE, N_NAME, N_SELECT
      CHARACTER*8 PXNAME
      CHARACTER*64 INPFMT
      LOGICAL LTDATA, OUTSID(4)
      COMMON /T2COM/ PXNAME, REDUCE, TITX, TITY ,XFRM12, XFRM13, XFRM1
     *4, XFRM23 ,XFRM24, XFRM34 ,XVARSX ,TITSIZ, GRDSYM, GRDSIZ, CIRS
     *IZ, ASIZE, AFLARE ,SMSZDF, ORAXES, EYEDIR, VUEDIR, VUECEN ,VERTC
     *L, EYESEP, SCRD, SCRZ, EYEDIS, EYEPNT ,XYPART, BARSIZ, TIKSIZ, XY
     *ZBAS, TTHETA ,TPHI, FRELBL, IPATRN, NPATRN, PATRN ,SCLPRM, WINDO
     *W, SCREEN, SYMBOL, NOSYMB ,FACTXY, LBLSIZ, SYMSIZ, XYZLIM, WORLD 
     *,RADRMX, RADRMN, RADAMN, RADANG, RADX0, RADY0, XUNUSD ,USRKBD, U
     *SRSCR, PLTFIL ,ITITDT, LENCRD ,INPFMT, GRDTYP, LINWID, LINCOL, L
     *INTEX, TITCON, ITCNTR ,IUNUSD, NXYZ1, NXYZ2 ,LBLCHR, NDIMNS, IBL
     *KTP, IDIMNS ,NMESH1, NMESH2, MESH1, MESH2, MESH3, NFIELD ,IFIELD
     *, NINCR ,IVARBL, IVRPTR ,LINEAR, NONLIN ,NPOINT, LETSET ,MXECH
     *O, LINES, MAXLNS ,AXANG, MESH2D, REDFAC, GRDTEX, OUTTEX, IAXTEX, 
     *TITEX, DSCAL ,OUTSTR, IPROP, IHTEX, IBLINK, IERASE, LABTEX, TICTE
     *X, NXYLIM, PATSZ ,MARGIN, PSCR, ITXPRI, ITXSEC, OREAL, OCPU, CSCR
     *D, OUTSID ,TITLIN, TITINX, TITZ, TITX1, TITY1, LTDATA, NPLOTS, RE
     *VLEV ,LBLFMT, IYEAR, IMONTH, IDAY, ISIGFG ,DATPTS, ERRPTS, DATXM
     *N, DATXMX, DATYMN, DATYMX, DATZMN, DATZMX ,DATSUM, ERRSUM, DATAVE
     *, ERRAVE, DATCEN, ERRCEN, DATSTD, ERRSTD ,NCSETS, NCCOL, NCROW, F
     *MARKER, H2STAT, TITFAC, TITLOC, TITMAR ,TIKFAC, IWINLEV, WINREL, 
     *WINABS, WINLIM ,ICPOIN, LEVREP, IREPCT, SYDIR, GRDIR, NMESH0, EXY
     *ZLIM, IVPTR ,TITLMX, NXYZDEF1, NXYZDEF2, IFILE_CASE, N_CYCLE, ITX
     *_CYCLE ,SYM_CYCLE, PLOT_EXTENT, FILL_ANGLE, FILL_WIDTH, FILL_TEX 
     *,FILL_INDEX ,N_LINES ,DSLOPE ,MAX_SUBST, BARBRK ,I_VORDER,SHADOW
     *TYP,SHADOWTEX
      COMMON /T2SCRT/ BUFFER, IBUFFR, N_FILE,N_NAME,N_SELECT, ICHSAVE
      COMMON /T2_CHAR/ C_TIT_ESCAPE,C_TIT_SUBSTITUTE
      COMMON /T2_SCRT/ C_FILE, C_NAME, C_SELECT
      INTEGER JOUFIL, ERRFIL, OUTFIL, DBGFIL, INPFIL, NINMAX
      PARAMETER (NINMAX=20)
      INTEGER NINP(NINMAX)
      COMMON /T2TRBK/NINP, JOUFIL, ERRFIL, OUTFIL, DBGFIL, INPFIL
      CHARACTER*512 STRNG, STJOU
      LOGICAL LTOKEN
      REAL FLOTNG
      INTEGER INTERP, KEYORD, NSTRNG, MAXSTR, NSTJOU, LSTJOU, NTOKEN
      INTEGER*4 INTEG
      COMMON /TOKENC/ INTERP, INTEG, FLOTNG, KEYORD, NSTRNG, MAXSTR, ST
     *RNG, NSTJOU, LSTJOU, STJOU, LTOKEN, NTOKEN
      INTEGER IOPT,IPARM
      REAL PARM
      CHARACTER*8 QWID(9),QTEX(7),QCOL(8)
      CHARACTER*7 QFONT(3)
      DATA QWID/'VDIM,','DIM,','MEDIUM,','BRIGHT,','VBRIGHT,',
     *'WIDTH6','WIDTH7','WIDTH8','WIDTH9'/
      DATA QCOL/'WHITE,','RED,','GREEN,','BLUE,','YELLOW,','MAGENTA,','C
     *YAN,','BLACK,'/
      DATA QTEX/'DOTTED,','DASHED,','DOTDASH,','SOLID,'  ,'SOLID,','SOLI
     *D,','DAASHED,'/
      DATA QFONT /'SIMPLEX','SIMPLEX','DUPLEX '/
      IF (LTRAP) RETURN
      IERR=0
10780 GOTO (10790,10800,10810,10820,10830,10840,10850,10860,10870,10880,
     *10890,10900,10910),IOPT
10790 CONTINUE
      IF (IPARM.ne.DFTCOL) THEN
      DFTCOL=MIN(MAX(IPARM,1),8)
      CALL UGDEFL(QCOL(DFTCOL),IXX,IXX)
      ENDIF
      GOTO 10782
10800 CONTINUE
      IF (IPARM.ne.DFTTEX) THEN
      DFTTEX=MIN(MAX(IPARM,1),7)
      CALL UGDEFL(QTEX(DFTTEX),IXX,IXX)
      ENDIF
      GOTO 10782
10810 CONTINUE
      IF (IPARM.ne.DFTWID) THEN
      DFTWID=MIN(MAX(IPARM,1),9)
      CALL UGDEFL(QWID(DFTWID),IXX,IXX)
      ENDIF
      GOTO 10782
10830 CONTINUE
      IF (IPARM.NE.DFTFNT) THEN
      DFTFNT=MIN(MAX(IPARM,1),3)
      CALL UGFONT (QFONT(DFTFNT))
      ENDIF
      GOTO 10782
10820 CONTINUE
      DFTQUI=MIN(MAX(IPARM,0),1)
      GOTO 10782
10840 CONTINUE
      IF (IPARM.ne.DFTCOL) THEN
      DFTCOL=MIN(MAX(IPARM,1),8)
      CALL UGDEFL(QCOL(DFTCOL),IXX,IXX)
      ENDIF
      GOTO 10782
10850 CONTINUE
      IF (IPARM.ne.DFTWID) THEN
      DFTWID=MIN(MAX(IPARM,1),9)
      CALL UGDEFL(QWID(DFTWID),IXX,IXX)
      ENDIF
      GOTO 10782
10860 CONTINUE
      DFTSTR=MIN(MAX(IPARM,0),1)
      IF (IPARM.ne.0) THEN
      CALL UGDEFL('SOFTST',IXX,IXX)
      ELSE
      CALL UGDEFL('HARDST',IXX,IXX)
      ENDIF
      GOTO 10782
10870 CONTINUE
      IF (IPARM.ne.DFTPRP) THEN
      DFTPRP=MIN(MAX(IPARM,0),1)
      IF (DFTPRP.ne.0) THEN
      CALL UGDEFL('FIXSIZE',IXX,IXX)
      ELSE
      CALL UGDEFL('NOFXSIZ',IXX,IXX)
      ENDIF
      ENDIF
      GOTO 10782
10880 CONTINUE
      IF (IPARM.ne.DFTBLK) THEN
      DFTBLK=MIN(MAX(IPARM,0),1)
      IF (DFTBLD.ne.0) THEN
      CALL UGDEFL('BLINK',IXX,IXX)
      ELSE
      CALL UGDEFL('STEADY',IXX,IXX)
      ENDIF
      ENDIF
      GOTO 10782
10890 CONTINUE
      LTEMP=IPARM.ne.0
      IF (LTEMP.NEQV.LERAS) CALL TXXMT
      LERAS=LTEMP
      GOTO 10782
10900 CONTINUE
      DFTVEC=MIN(MAX(IPARM,0),1)
      GOTO 10782
10910 CONTINUE
      DFTSEG=MIN(MAX(IPARM,0),1)
      JSEGMN=ISEGMN
      IF (DFTSEG.eq.0) THEN
      ISEGMN=0
      ELSE
      ISEGMN=MAX(DFTSEG,JSEGMN)
      ENDIF
      GOTO 10782
10782 CONTINUE
      END
      SUBROUTINE TXXPLT(X1,Y1,LPEN)
      IMPLICIT NONE
      REAL X1,Y1
      INTEGER LPEN
      EXTERNAL UGXERR
      INTEGER IXX 
      INTEGER PXELWORDS, MAX_QOPN, QOPNSIZ 
      PARAMETER (PXELWORDS=2000)
      PARAMETER (MAX_QOPN=8)
      PARAMETER (QOPNSIZ=200)
      INTEGER IOPEN(10)
      LOGICAL L_IDOPEN(10)
      INTEGER VIRGIN ,ISEGMN ,JSEGMN, DFTSEG, JPROP, IACT
      LOGICAL LCLEAR ,LERAS ,LINTF, LPROP
      REAL DFTANG ,DFTSIZ ,URSIZE, WDOW(4)
      INTEGER DFTWID ,DFTTEX ,DFTCOL ,DFTVEC ,DFTFNT ,DFTBLK ,DFTPRP ,DF
     *TSTR ,DFTQUI ,PXEL(PXELWORDS)
      COMMON /TXCOMD/PXEL ,LCLEAR ,VIRGIN ,ISEGMN ,JSEGMN ,URSIZE ,DFTCO
     *L ,DFTTEX ,DFTWID ,DFTQUI ,DFTFNT ,DFTANG ,DFTSIZ ,DFTVEC ,LERAS ,
     *DFTPRP ,DFTBLK ,DFTSEG ,LINTF ,IOPEN, L_IDOPEN ,JPROP, LPROP, WDOW
     *, IACT
      INTEGER NQOPNF ,NQTXT
      CHARACTER*(QOPNSIZ) QOPNF
      CHARACTER*(QOPNSIZ) QOPN(MAX_QOPN)
      INTEGER NQOPN(MAX_QOPN)
      CHARACTER*80 QTXT
      COMMON/TXCOMV/NQOPN ,QOPN ,NQTXT ,QTXT ,NQOPNF ,QOPNF
      REAL PLIM(4,4),ZSCRN(2),XLLINE,YLLINE,XTLINE,YTLINE,XFRMFC, PAT(2
     *0),PATCUM,PATTOT,PATMOD,CCSCIS(4),DISPL, RESOL(2)
      INTEGER NPTS,IDDEVC,IPAT,NPAT,LMOVE,IROTAX,IROTAF
      COMMON/TXCOM/PLIM,ZSCRN, XLLINE,YLLINE,XTLINE,YTLINE,XFRMFC, IPA
     *T,NPAT,PAT,PATTOT, NPTS,IDDEVC,CCSCIS,LMOVE,IROTAX,DISPL,IROTAF,P
     *ATCUM,PATMOD, RESOL
      COMMON /T2FLGC/ FLAGS(200), LTRAP,LHANDL,LSYERR,LSCREV
      LOGICAL FLAGS, LTRAP,LHANDL,LSYERR,LSCREV(3)
      INTEGER RELFLAG 
      PARAMETER (RELFLAG=151)
      INTEGER IWINLEV 
      INTEGER NWINLEV , MAX_FILL 
      PARAMETER (NWINLEV =4)
      PARAMETER (MAX_FILL=4)
      REAL GRDSYM, GRDSIZ, DATDAT(2,8), H2STAT(12), TITLIN(4), TITFA
     *C(4), TITLOC(4), TITMAR(4), TITLMX(4), TIKFAC, TITINX, TITX1, TIT
     *Y1, TITX, TITY, TITZ, TITSIZ, TITCON(5), REVLEV, REDUCE(5), XFR
     *M12(12), XFRM13(12), XFRM14(12), XFRM23(12), XFRM24(12), XFRM34(6
     *), XVARSX(20), CIRSIZ(2,3), ASIZE, AFLARE, SMSZDF, ORAXES(3), EY
     *EDIR(3), VUEDIR(3), VUECEN(3), VERTCL(3), EYESEP, SCRD, SCRZ, EYE
     *DIS, EYEPNT(3), XYPART(2, 2), BARSIZ(3), BARBRK(3), TIKSIZ(3), XY
     *ZBAS(3), TTHETA, TPHI, FRELBL(4), PATRN(20,30), SCLPRM(10,3), WI
     *NDOW(4), SCREEN(2), SYMBOL, NOSYMB, FACTXY(19), LBLSIZ, SYMSIZ, X
     *YZLIM(3,2), WORLD(3), RADRMX, RADRMN, RADAMN, RADANG, RADX0, RADY
     *0, XUNUSD(6), AXANG(3), REDFAC, DSCAL, PATSZ, MARGIN(4), PSCR(2
     *), OREAL, OCPU, CSCRD, DATPTS, ERRPTS, DATXMN, DATXMX, DATYMN, DA
     *TYMX, DATZMN, DATZMX, DATSUM, ERRSUM, DATAVE, ERRAVE, DATCEN, ERR
     *CEN, DATSTD, ERRSTD, WINREL(2,2,NWINLEV),WINABS(2,2,NWINLEV),WINL
     *IM(2,2), FMARKER(3,8), SYDIR(3), GRDIR(3), EXYZLIM(3,2), DSLOPE(2
     *,2)
      REAL PLOT_EXTENT(2,2),FILL_ANGLE(MAX_FILL),FILL_WIDTH(MAX_FILL)
      INTEGER FILL_INDEX, FILL_TEX(MAX_FILL), N_LINES(6)
      EQUIVALENCE (DATDAT, DATPTS)
      INTEGER MAXREP
      PARAMETER (MAXREP=5)
      INTEGER IPATRN, NPATRN(30), NXYLIM(3,2), NPLOTS, NCSETS, NCCOL, N
     *CROW, IYEAR, IMONTH, IDAY, ISIGFG, ITXPRI, ITXSEC, ITITDT(3), L
     *ENCRD, IPROP, IHTEX, IBLINK, IERASE, ITCNTR, IUNUSD, NXYZ1(3), 
     *NXYZ2(3), LBLFMT(3), LBLCHR(3), NDIMNS(3), IBLKTP, IDIMNS, NMES
     *H0, NMESH1, NMESH2, MESH1, MESH2, MESH3, MESH2D, MESHN(3), NMESHN(
     *2), NFIELD, IFIELD(19), NINCR, NPOINT, IVARBL(19), IVPTR(19), I_
     *VORDER(19,2), LINEAR(4), NONLIN(4), MXECHO, LINES, MAXLNS, USRK
     *BD, USRSCR, PLTFIL, LINWID, LINCOL, LINTEX, ICPOIN(3), IREPCT(MA
     *XREP), LEVREP, GRDTYP, GRDTEX, OUTTEX, IAXTEX, TITEX, LETSET, LAB
     *TEX, TICTEX, SHADOWTYP,SHADOWTEX, NXYZDEF1(10), NXYZDEF2(10), IF
     *ILE_CASE ,MAX_SUBST
      INTEGER MAX_CYCLE
      PARAMETER (MAX_CYCLE=20)
      INTEGER N_CYCLE, ITX_CYCLE(MAX_CYCLE)
      REAL SYM_CYCLE(MAX_CYCLE)
      EQUIVALENCE (NMESH1,NMESHN)
      EQUIVALENCE (MESH1,MESHN)
      INTEGER IBUFFR(400)
      REAL BUFFER(400)
      INTEGER NCHSAVE 
      PARAMETER (NCHSAVE=2*512) 
      INTEGER*4 ICHSAVE(NCHSAVE)
      INTEGER*4 IVRPTR(15)
      CHARACTER*512 OUTSTR,C_FILE, C_NAME, C_SELECT
      CHARACTER C_TIT_ESCAPE*1,C_TIT_SUBSTITUTE*2
      INTEGER N_FILE, N_NAME, N_SELECT
      CHARACTER*8 PXNAME
      CHARACTER*64 INPFMT
      LOGICAL LTDATA, OUTSID(4)
      COMMON /T2COM/ PXNAME, REDUCE, TITX, TITY ,XFRM12, XFRM13, XFRM1
     *4, XFRM23 ,XFRM24, XFRM34 ,XVARSX ,TITSIZ, GRDSYM, GRDSIZ, CIRS
     *IZ, ASIZE, AFLARE ,SMSZDF, ORAXES, EYEDIR, VUEDIR, VUECEN ,VERTC
     *L, EYESEP, SCRD, SCRZ, EYEDIS, EYEPNT ,XYPART, BARSIZ, TIKSIZ, XY
     *ZBAS, TTHETA ,TPHI, FRELBL, IPATRN, NPATRN, PATRN ,SCLPRM, WINDO
     *W, SCREEN, SYMBOL, NOSYMB ,FACTXY, LBLSIZ, SYMSIZ, XYZLIM, WORLD 
     *,RADRMX, RADRMN, RADAMN, RADANG, RADX0, RADY0, XUNUSD ,USRKBD, U
     *SRSCR, PLTFIL ,ITITDT, LENCRD ,INPFMT, GRDTYP, LINWID, LINCOL, L
     *INTEX, TITCON, ITCNTR ,IUNUSD, NXYZ1, NXYZ2 ,LBLCHR, NDIMNS, IBL
     *KTP, IDIMNS ,NMESH1, NMESH2, MESH1, MESH2, MESH3, NFIELD ,IFIELD
     *, NINCR ,IVARBL, IVRPTR ,LINEAR, NONLIN ,NPOINT, LETSET ,MXECH
     *O, LINES, MAXLNS ,AXANG, MESH2D, REDFAC, GRDTEX, OUTTEX, IAXTEX, 
     *TITEX, DSCAL ,OUTSTR, IPROP, IHTEX, IBLINK, IERASE, LABTEX, TICTE
     *X, NXYLIM, PATSZ ,MARGIN, PSCR, ITXPRI, ITXSEC, OREAL, OCPU, CSCR
     *D, OUTSID ,TITLIN, TITINX, TITZ, TITX1, TITY1, LTDATA, NPLOTS, RE
     *VLEV ,LBLFMT, IYEAR, IMONTH, IDAY, ISIGFG ,DATPTS, ERRPTS, DATXM
     *N, DATXMX, DATYMN, DATYMX, DATZMN, DATZMX ,DATSUM, ERRSUM, DATAVE
     *, ERRAVE, DATCEN, ERRCEN, DATSTD, ERRSTD ,NCSETS, NCCOL, NCROW, F
     *MARKER, H2STAT, TITFAC, TITLOC, TITMAR ,TIKFAC, IWINLEV, WINREL, 
     *WINABS, WINLIM ,ICPOIN, LEVREP, IREPCT, SYDIR, GRDIR, NMESH0, EXY
     *ZLIM, IVPTR ,TITLMX, NXYZDEF1, NXYZDEF2, IFILE_CASE, N_CYCLE, ITX
     *_CYCLE ,SYM_CYCLE, PLOT_EXTENT, FILL_ANGLE, FILL_WIDTH, FILL_TEX 
     *,FILL_INDEX ,N_LINES ,DSLOPE ,MAX_SUBST, BARBRK ,I_VORDER,SHADOW
     *TYP,SHADOWTEX
      COMMON /T2SCRT/ BUFFER, IBUFFR, N_FILE,N_NAME,N_SELECT, ICHSAVE
      COMMON /T2_CHAR/ C_TIT_ESCAPE,C_TIT_SUBSTITUTE
      COMMON /T2_SCRT/ C_FILE, C_NAME, C_SELECT
      INTEGER JOUFIL, ERRFIL, OUTFIL, DBGFIL, INPFIL, NINMAX
      PARAMETER (NINMAX=20)
      INTEGER NINP(NINMAX)
      COMMON /T2TRBK/NINP, JOUFIL, ERRFIL, OUTFIL, DBGFIL, INPFIL
      CHARACTER*512 STRNG, STJOU
      LOGICAL LTOKEN
      REAL FLOTNG
      INTEGER INTERP, KEYORD, NSTRNG, MAXSTR, NSTJOU, LSTJOU, NTOKEN
      INTEGER*4 INTEG
      COMMON /TOKENC/ INTERP, INTEG, FLOTNG, KEYORD, NSTRNG, MAXSTR, ST
     *RNG, NSTJOU, LSTJOU, STJOU, LTOKEN, NTOKEN
      REAL X,Y
      IF (LTRAP) RETURN
      FLAGS(1)=.FALSE.
10920 GOTO (10930,10940,10950,10960),IROTAX+1
10930 CONTINUE
      X=X1
      Y=Y1
      GOTO 10922
10940 CONTINUE
      X=Y1
      Y=PLIM(3,4)-X1
      GOTO 10922
10950 CONTINUE
      X=PLIM(3,4)-X1
      Y=PLIM(4,4)-Y1
      GOTO 10922
10960 CONTINUE
      X=PLIM(4,4)-Y1
      Y=X1
      GOTO 10922
10922 CONTINUE
      CALL UGLINE(' ',X,Y,LPEN,PXEL)
      END
      SUBROUTINE TXXSIZ
      IMPLICIT NONE
      INTEGER I, IOP, J
      REAL X,Y,AFF,XWIND,YWIND
      INTEGER IXX 
      INTEGER PXELWORDS, MAX_QOPN, QOPNSIZ 
      PARAMETER (PXELWORDS=2000)
      PARAMETER (MAX_QOPN=8)
      PARAMETER (QOPNSIZ=200)
      INTEGER IOPEN(10)
      LOGICAL L_IDOPEN(10)
      INTEGER VIRGIN ,ISEGMN ,JSEGMN, DFTSEG, JPROP, IACT
      LOGICAL LCLEAR ,LERAS ,LINTF, LPROP
      REAL DFTANG ,DFTSIZ ,URSIZE, WDOW(4)
      INTEGER DFTWID ,DFTTEX ,DFTCOL ,DFTVEC ,DFTFNT ,DFTBLK ,DFTPRP ,DF
     *TSTR ,DFTQUI ,PXEL(PXELWORDS)
      COMMON /TXCOMD/PXEL ,LCLEAR ,VIRGIN ,ISEGMN ,JSEGMN ,URSIZE ,DFTCO
     *L ,DFTTEX ,DFTWID ,DFTQUI ,DFTFNT ,DFTANG ,DFTSIZ ,DFTVEC ,LERAS ,
     *DFTPRP ,DFTBLK ,DFTSEG ,LINTF ,IOPEN, L_IDOPEN ,JPROP, LPROP, WDOW
     *, IACT
      INTEGER NQOPNF ,NQTXT
      CHARACTER*(QOPNSIZ) QOPNF
      CHARACTER*(QOPNSIZ) QOPN(MAX_QOPN)
      INTEGER NQOPN(MAX_QOPN)
      CHARACTER*80 QTXT
      COMMON/TXCOMV/NQOPN ,QOPN ,NQTXT ,QTXT ,NQOPNF ,QOPNF
      REAL PLIM(4,4),ZSCRN(2),XLLINE,YLLINE,XTLINE,YTLINE,XFRMFC, PAT(2
     *0),PATCUM,PATTOT,PATMOD,CCSCIS(4),DISPL, RESOL(2)
      INTEGER NPTS,IDDEVC,IPAT,NPAT,LMOVE,IROTAX,IROTAF
      COMMON/TXCOM/PLIM,ZSCRN, XLLINE,YLLINE,XTLINE,YTLINE,XFRMFC, IPA
     *T,NPAT,PAT,PATTOT, NPTS,IDDEVC,CCSCIS,LMOVE,IROTAX,DISPL,IROTAF,P
     *ATCUM,PATMOD, RESOL
      COMMON /T2FLGC/ FLAGS(200), LTRAP,LHANDL,LSYERR,LSCREV
      LOGICAL FLAGS, LTRAP,LHANDL,LSYERR,LSCREV(3)
      INTEGER RELFLAG 
      PARAMETER (RELFLAG=151)
      INTEGER IWINLEV 
      INTEGER NWINLEV , MAX_FILL 
      PARAMETER (NWINLEV =4)
      PARAMETER (MAX_FILL=4)
      REAL GRDSYM, GRDSIZ, DATDAT(2,8), H2STAT(12), TITLIN(4), TITFA
     *C(4), TITLOC(4), TITMAR(4), TITLMX(4), TIKFAC, TITINX, TITX1, TIT
     *Y1, TITX, TITY, TITZ, TITSIZ, TITCON(5), REVLEV, REDUCE(5), XFR
     *M12(12), XFRM13(12), XFRM14(12), XFRM23(12), XFRM24(12), XFRM34(6
     *), XVARSX(20), CIRSIZ(2,3), ASIZE, AFLARE, SMSZDF, ORAXES(3), EY
     *EDIR(3), VUEDIR(3), VUECEN(3), VERTCL(3), EYESEP, SCRD, SCRZ, EYE
     *DIS, EYEPNT(3), XYPART(2, 2), BARSIZ(3), BARBRK(3), TIKSIZ(3), XY
     *ZBAS(3), TTHETA, TPHI, FRELBL(4), PATRN(20,30), SCLPRM(10,3), WI
     *NDOW(4), SCREEN(2), SYMBOL, NOSYMB, FACTXY(19), LBLSIZ, SYMSIZ, X
     *YZLIM(3,2), WORLD(3), RADRMX, RADRMN, RADAMN, RADANG, RADX0, RADY
     *0, XUNUSD(6), AXANG(3), REDFAC, DSCAL, PATSZ, MARGIN(4), PSCR(2
     *), OREAL, OCPU, CSCRD, DATPTS, ERRPTS, DATXMN, DATXMX, DATYMN, DA
     *TYMX, DATZMN, DATZMX, DATSUM, ERRSUM, DATAVE, ERRAVE, DATCEN, ERR
     *CEN, DATSTD, ERRSTD, WINREL(2,2,NWINLEV),WINABS(2,2,NWINLEV),WINL
     *IM(2,2), FMARKER(3,8), SYDIR(3), GRDIR(3), EXYZLIM(3,2), DSLOPE(2
     *,2)
      REAL PLOT_EXTENT(2,2),FILL_ANGLE(MAX_FILL),FILL_WIDTH(MAX_FILL)
      INTEGER FILL_INDEX, FILL_TEX(MAX_FILL), N_LINES(6)
      EQUIVALENCE (DATDAT, DATPTS)
      INTEGER MAXREP
      PARAMETER (MAXREP=5)
      INTEGER IPATRN, NPATRN(30), NXYLIM(3,2), NPLOTS, NCSETS, NCCOL, N
     *CROW, IYEAR, IMONTH, IDAY, ISIGFG, ITXPRI, ITXSEC, ITITDT(3), L
     *ENCRD, IPROP, IHTEX, IBLINK, IERASE, ITCNTR, IUNUSD, NXYZ1(3), 
     *NXYZ2(3), LBLFMT(3), LBLCHR(3), NDIMNS(3), IBLKTP, IDIMNS, NMES
     *H0, NMESH1, NMESH2, MESH1, MESH2, MESH3, MESH2D, MESHN(3), NMESHN(
     *2), NFIELD, IFIELD(19), NINCR, NPOINT, IVARBL(19), IVPTR(19), I_
     *VORDER(19,2), LINEAR(4), NONLIN(4), MXECHO, LINES, MAXLNS, USRK
     *BD, USRSCR, PLTFIL, LINWID, LINCOL, LINTEX, ICPOIN(3), IREPCT(MA
     *XREP), LEVREP, GRDTYP, GRDTEX, OUTTEX, IAXTEX, TITEX, LETSET, LAB
     *TEX, TICTEX, SHADOWTYP,SHADOWTEX, NXYZDEF1(10), NXYZDEF2(10), IF
     *ILE_CASE ,MAX_SUBST
      INTEGER MAX_CYCLE
      PARAMETER (MAX_CYCLE=20)
      INTEGER N_CYCLE, ITX_CYCLE(MAX_CYCLE)
      REAL SYM_CYCLE(MAX_CYCLE)
      EQUIVALENCE (NMESH1,NMESHN)
      EQUIVALENCE (MESH1,MESHN)
      INTEGER IBUFFR(400)
      REAL BUFFER(400)
      INTEGER NCHSAVE 
      PARAMETER (NCHSAVE=2*512) 
      INTEGER*4 ICHSAVE(NCHSAVE)
      INTEGER*4 IVRPTR(15)
      CHARACTER*512 OUTSTR,C_FILE, C_NAME, C_SELECT
      CHARACTER C_TIT_ESCAPE*1,C_TIT_SUBSTITUTE*2
      INTEGER N_FILE, N_NAME, N_SELECT
      CHARACTER*8 PXNAME
      CHARACTER*64 INPFMT
      LOGICAL LTDATA, OUTSID(4)
      COMMON /T2COM/ PXNAME, REDUCE, TITX, TITY ,XFRM12, XFRM13, XFRM1
     *4, XFRM23 ,XFRM24, XFRM34 ,XVARSX ,TITSIZ, GRDSYM, GRDSIZ, CIRS
     *IZ, ASIZE, AFLARE ,SMSZDF, ORAXES, EYEDIR, VUEDIR, VUECEN ,VERTC
     *L, EYESEP, SCRD, SCRZ, EYEDIS, EYEPNT ,XYPART, BARSIZ, TIKSIZ, XY
     *ZBAS, TTHETA ,TPHI, FRELBL, IPATRN, NPATRN, PATRN ,SCLPRM, WINDO
     *W, SCREEN, SYMBOL, NOSYMB ,FACTXY, LBLSIZ, SYMSIZ, XYZLIM, WORLD 
     *,RADRMX, RADRMN, RADAMN, RADANG, RADX0, RADY0, XUNUSD ,USRKBD, U
     *SRSCR, PLTFIL ,ITITDT, LENCRD ,INPFMT, GRDTYP, LINWID, LINCOL, L
     *INTEX, TITCON, ITCNTR ,IUNUSD, NXYZ1, NXYZ2 ,LBLCHR, NDIMNS, IBL
     *KTP, IDIMNS ,NMESH1, NMESH2, MESH1, MESH2, MESH3, NFIELD ,IFIELD
     *, NINCR ,IVARBL, IVRPTR ,LINEAR, NONLIN ,NPOINT, LETSET ,MXECH
     *O, LINES, MAXLNS ,AXANG, MESH2D, REDFAC, GRDTEX, OUTTEX, IAXTEX, 
     *TITEX, DSCAL ,OUTSTR, IPROP, IHTEX, IBLINK, IERASE, LABTEX, TICTE
     *X, NXYLIM, PATSZ ,MARGIN, PSCR, ITXPRI, ITXSEC, OREAL, OCPU, CSCR
     *D, OUTSID ,TITLIN, TITINX, TITZ, TITX1, TITY1, LTDATA, NPLOTS, RE
     *VLEV ,LBLFMT, IYEAR, IMONTH, IDAY, ISIGFG ,DATPTS, ERRPTS, DATXM
     *N, DATXMX, DATYMN, DATYMX, DATZMN, DATZMX ,DATSUM, ERRSUM, DATAVE
     *, ERRAVE, DATCEN, ERRCEN, DATSTD, ERRSTD ,NCSETS, NCCOL, NCROW, F
     *MARKER, H2STAT, TITFAC, TITLOC, TITMAR ,TIKFAC, IWINLEV, WINREL, 
     *WINABS, WINLIM ,ICPOIN, LEVREP, IREPCT, SYDIR, GRDIR, NMESH0, EXY
     *ZLIM, IVPTR ,TITLMX, NXYZDEF1, NXYZDEF2, IFILE_CASE, N_CYCLE, ITX
     *_CYCLE ,SYM_CYCLE, PLOT_EXTENT, FILL_ANGLE, FILL_WIDTH, FILL_TEX 
     *,FILL_INDEX ,N_LINES ,DSLOPE ,MAX_SUBST, BARBRK ,I_VORDER,SHADOW
     *TYP,SHADOWTEX
      COMMON /T2SCRT/ BUFFER, IBUFFR, N_FILE,N_NAME,N_SELECT, ICHSAVE
      COMMON /T2_CHAR/ C_TIT_ESCAPE,C_TIT_SUBSTITUTE
      COMMON /T2_SCRT/ C_FILE, C_NAME, C_SELECT
      INTEGER JOUFIL, ERRFIL, OUTFIL, DBGFIL, INPFIL, NINMAX
      PARAMETER (NINMAX=20)
      INTEGER NINP(NINMAX)
      COMMON /T2TRBK/NINP, JOUFIL, ERRFIL, OUTFIL, DBGFIL, INPFIL
      CHARACTER*512 STRNG, STJOU
      LOGICAL LTOKEN
      REAL FLOTNG
      INTEGER INTERP, KEYORD, NSTRNG, MAXSTR, NSTJOU, LSTJOU, NTOKEN
      INTEGER*4 INTEG
      COMMON /TOKENC/ INTERP, INTEG, FLOTNG, KEYORD, NSTRNG, MAXSTR, ST
     *RNG, NSTJOU, LSTJOU, STJOU, LTOKEN, NTOKEN
      INTEGER UGIVAL(4)
      REAL UGRVAL(4)
      CHARACTER*1 UGSTR
      CHARACTER*7 QFONT(3)
      CHARACTER*8 QWID(9),QTEX(7),QCOL(8)
      DATA QFONT /'SIMPLEX','SIMPLEX','DUPLEX '/
      DATA QWID/'VDIM,','DIM,','MEDIUM,','BRIGHT,','VBRIGHT',
     *'WIDTH6','WIDTH7','WIDTH8','WIDTH9'/
      DATA QCOL/'WHITE,','RED,','GREEN,','BLUE,','YELLOW,','MAGENTA,','C
     *YAN,','BLACK,'/
      DATA QTEX/'DOTTED,','DASHED,','DOTDASH,','SOLID,'  ,'SOLID,','SOLI
     *D,','DAASHED,'/
      IF (LTRAP) RETURN
      IF (.not.FLAGS(24)) RETURN
      DO 10971 IOP=2,IOPEN(1)+1
      CALL UGSLCT(' ',IOPEN(IOP))
      IF (LCLEAR) THEN
      JSEGMN=DFTSEG
      ISEGMN=DFTSEG
      IF(PXNAME.ne.' ') THEN
      CALL UGPICT('CLEAR,ALIAS='//PXNAME,0)
      ELSE
      CALL UGPICT('CLEAR',0)
      ENDIF
      ENDIF
      IF (IOP .EQ. 2) THEN
      DO 10981 I=1,2
      PSCR(I) = SCREEN(I) + MARGIN(I*2)+MARGIN(I*2-1)
10981 CONTINUE
10982 CONTINUE
      CALL UGDSPC('PUT',PSCR(1+MOD(IROTAX,2)),PSCR(2-MOD(IROTAX,2)),1.0)
     *
      CALL UGINFO('DSPCSIZE',UGSTR,UGIVAL,UGRVAL)
      X=PSCR(1+MOD(IROTAX,2))*UGRVAL(1)/2.54
      Y=PSCR(2-MOD(IROTAX,2))*UGRVAL(2)/2.54
      DO 10991 I=3,4
      PLIM(1+MOD(IROTAX,2),I)=0.0
      PLIM(2-MOD(IROTAX,2),I)=0.0
      PLIM(3+MOD(IROTAX,2),I)=X 
      PLIM(4-MOD(IROTAX,2),I)=Y
10991 CONTINUE
10992 CONTINUE
      ENDIF
      CALL UGDSPC('PUT',X,Y,1.0)
      IF (IOP .EQ. 1) THEN
      CALL UGDSPC('GET',X ,Y ,AFF)
      CALL UGINFO('DSPCSIZE',UGSTR,UGIVAL,UGRVAL)
      XWIND=X*UGRVAL(1)/2.54
      YWIND=Y*UGRVAL(2)/2.54
      CALL UGINFO('DSPCSIZE',UGSTR,UGIVAL,UGRVAL)
      IF (ABS(UGRVAL(1)-2.54).GT.0.02 .OR.ABS(UGRVAL(1)-2.54).GT.0.02) C
     *ALL UGRERR(4,'TXXOPN  ',1)
      ENDIF
10971 CONTINUE
10972 CONTINUE
      DFTSIZ=0
      QTXT=' '
      NQTXT=1
      QTXT=' '
      NQTXT=1
      DFTANG=-90*IROTAX
11000 GOTO (11010,11020,11030,11040),IROTAX+1
11010 CONTINUE
      CALL UGDEFL('ANGLE=0.0',IXX,IXX)
      GOTO 11002
11020 CONTINUE
      CALL UGDEFL('ANGLE=-90.0',IXX,IXX)
      GOTO 11002
11030 CONTINUE
      CALL UGDEFL('ANGLE=180.0',IXX,IXX)
      GOTO 11002
11040 CONTINUE
      CALL UGDEFL('ANGLE=90.0',IXX,IXX)
      GOTO 11002
11002 CONTINUE
      CALL UGDEFL('NORMGN',IXX,IXX)
      IF (DFTPRP.ne.0) THEN
      CALL UGDEFL('FIXSIZE',IXX,IXX)
      ELSE
      CALL UGDEFL('NOFXSIZ',IXX,IXX)
      ENDIF
      CALL UGFONT(QFONT(DFTFNT))
      CALL UGDEFL(QCOL(DFTCOL),IXX,IXX)
      CALL UGDEFL(QWID(DFTWID),IXX,IXX)
      CALL UGDEFL(QTEX(DFTTEX),IXX,IXX)
      LCLEAR = .false.
      END
      SUBROUTINE TX3TXT(XYZ,SIZEIN,UP,TEXT,CASE,ICNTR)
      CHARACTER*(*) TEXT,CASE
      INTEGER NTEXT,NCASE,ICNTR
      REAL XYZ(3),SIZEIN(3),UP(3),ORIENT
      character*13 COPT(2)
      EXTERNAL UGXERR
      INTEGER IXX 
      INTEGER PXELWORDS, MAX_QOPN, QOPNSIZ 
      PARAMETER (PXELWORDS=2000)
      PARAMETER (MAX_QOPN=8)
      PARAMETER (QOPNSIZ=200)
      INTEGER IOPEN(10)
      LOGICAL L_IDOPEN(10)
      INTEGER VIRGIN ,ISEGMN ,JSEGMN, DFTSEG, JPROP, IACT
      LOGICAL LCLEAR ,LERAS ,LINTF, LPROP
      REAL DFTANG ,DFTSIZ ,URSIZE, WDOW(4)
      INTEGER DFTWID ,DFTTEX ,DFTCOL ,DFTVEC ,DFTFNT ,DFTBLK ,DFTPRP ,DF
     *TSTR ,DFTQUI ,PXEL(PXELWORDS)
      COMMON /TXCOMD/PXEL ,LCLEAR ,VIRGIN ,ISEGMN ,JSEGMN ,URSIZE ,DFTCO
     *L ,DFTTEX ,DFTWID ,DFTQUI ,DFTFNT ,DFTANG ,DFTSIZ ,DFTVEC ,LERAS ,
     *DFTPRP ,DFTBLK ,DFTSEG ,LINTF ,IOPEN, L_IDOPEN ,JPROP, LPROP, WDOW
     *, IACT
      INTEGER NQOPNF ,NQTXT
      CHARACTER*(QOPNSIZ) QOPNF
      CHARACTER*(QOPNSIZ) QOPN(MAX_QOPN)
      INTEGER NQOPN(MAX_QOPN)
      CHARACTER*80 QTXT
      COMMON/TXCOMV/NQOPN ,QOPN ,NQTXT ,QTXT ,NQOPNF ,QOPNF
      COMMON /T2FLGC/ FLAGS(200), LTRAP,LHANDL,LSYERR,LSCREV
      LOGICAL FLAGS, LTRAP,LHANDL,LSYERR,LSCREV(3)
      INTEGER RELFLAG 
      PARAMETER (RELFLAG=151)
      INTEGER IWINLEV 
      INTEGER NWINLEV , MAX_FILL 
      PARAMETER (NWINLEV =4)
      PARAMETER (MAX_FILL=4)
      REAL GRDSYM, GRDSIZ, DATDAT(2,8), H2STAT(12), TITLIN(4), TITFA
     *C(4), TITLOC(4), TITMAR(4), TITLMX(4), TIKFAC, TITINX, TITX1, TIT
     *Y1, TITX, TITY, TITZ, TITSIZ, TITCON(5), REVLEV, REDUCE(5), XFR
     *M12(12), XFRM13(12), XFRM14(12), XFRM23(12), XFRM24(12), XFRM34(6
     *), XVARSX(20), CIRSIZ(2,3), ASIZE, AFLARE, SMSZDF, ORAXES(3), EY
     *EDIR(3), VUEDIR(3), VUECEN(3), VERTCL(3), EYESEP, SCRD, SCRZ, EYE
     *DIS, EYEPNT(3), XYPART(2, 2), BARSIZ(3), BARBRK(3), TIKSIZ(3), XY
     *ZBAS(3), TTHETA, TPHI, FRELBL(4), PATRN(20,30), SCLPRM(10,3), WI
     *NDOW(4), SCREEN(2), SYMBOL, NOSYMB, FACTXY(19), LBLSIZ, SYMSIZ, X
     *YZLIM(3,2), WORLD(3), RADRMX, RADRMN, RADAMN, RADANG, RADX0, RADY
     *0, XUNUSD(6), AXANG(3), REDFAC, DSCAL, PATSZ, MARGIN(4), PSCR(2
     *), OREAL, OCPU, CSCRD, DATPTS, ERRPTS, DATXMN, DATXMX, DATYMN, DA
     *TYMX, DATZMN, DATZMX, DATSUM, ERRSUM, DATAVE, ERRAVE, DATCEN, ERR
     *CEN, DATSTD, ERRSTD, WINREL(2,2,NWINLEV),WINABS(2,2,NWINLEV),WINL
     *IM(2,2), FMARKER(3,8), SYDIR(3), GRDIR(3), EXYZLIM(3,2), DSLOPE(2
     *,2)
      REAL PLOT_EXTENT(2,2),FILL_ANGLE(MAX_FILL),FILL_WIDTH(MAX_FILL)
      INTEGER FILL_INDEX, FILL_TEX(MAX_FILL), N_LINES(6)
      EQUIVALENCE (DATDAT, DATPTS)
      INTEGER MAXREP
      PARAMETER (MAXREP=5)
      INTEGER IPATRN, NPATRN(30), NXYLIM(3,2), NPLOTS, NCSETS, NCCOL, N
     *CROW, IYEAR, IMONTH, IDAY, ISIGFG, ITXPRI, ITXSEC, ITITDT(3), L
     *ENCRD, IPROP, IHTEX, IBLINK, IERASE, ITCNTR, IUNUSD, NXYZ1(3), 
     *NXYZ2(3), LBLFMT(3), LBLCHR(3), NDIMNS(3), IBLKTP, IDIMNS, NMES
     *H0, NMESH1, NMESH2, MESH1, MESH2, MESH3, MESH2D, MESHN(3), NMESHN(
     *2), NFIELD, IFIELD(19), NINCR, NPOINT, IVARBL(19), IVPTR(19), I_
     *VORDER(19,2), LINEAR(4), NONLIN(4), MXECHO, LINES, MAXLNS, USRK
     *BD, USRSCR, PLTFIL, LINWID, LINCOL, LINTEX, ICPOIN(3), IREPCT(MA
     *XREP), LEVREP, GRDTYP, GRDTEX, OUTTEX, IAXTEX, TITEX, LETSET, LAB
     *TEX, TICTEX, SHADOWTYP,SHADOWTEX, NXYZDEF1(10), NXYZDEF2(10), IF
     *ILE_CASE ,MAX_SUBST
      INTEGER MAX_CYCLE
      PARAMETER (MAX_CYCLE=20)
      INTEGER N_CYCLE, ITX_CYCLE(MAX_CYCLE)
      REAL SYM_CYCLE(MAX_CYCLE)
      EQUIVALENCE (NMESH1,NMESHN)
      EQUIVALENCE (MESH1,MESHN)
      INTEGER IBUFFR(400)
      REAL BUFFER(400)
      INTEGER NCHSAVE 
      PARAMETER (NCHSAVE=2*512) 
      INTEGER*4 ICHSAVE(NCHSAVE)
      INTEGER*4 IVRPTR(15)
      CHARACTER*512 OUTSTR,C_FILE, C_NAME, C_SELECT
      CHARACTER C_TIT_ESCAPE*1,C_TIT_SUBSTITUTE*2
      INTEGER N_FILE, N_NAME, N_SELECT
      CHARACTER*8 PXNAME
      CHARACTER*64 INPFMT
      LOGICAL LTDATA, OUTSID(4)
      COMMON /T2COM/ PXNAME, REDUCE, TITX, TITY ,XFRM12, XFRM13, XFRM1
     *4, XFRM23 ,XFRM24, XFRM34 ,XVARSX ,TITSIZ, GRDSYM, GRDSIZ, CIRS
     *IZ, ASIZE, AFLARE ,SMSZDF, ORAXES, EYEDIR, VUEDIR, VUECEN ,VERTC
     *L, EYESEP, SCRD, SCRZ, EYEDIS, EYEPNT ,XYPART, BARSIZ, TIKSIZ, XY
     *ZBAS, TTHETA ,TPHI, FRELBL, IPATRN, NPATRN, PATRN ,SCLPRM, WINDO
     *W, SCREEN, SYMBOL, NOSYMB ,FACTXY, LBLSIZ, SYMSIZ, XYZLIM, WORLD 
     *,RADRMX, RADRMN, RADAMN, RADANG, RADX0, RADY0, XUNUSD ,USRKBD, U
     *SRSCR, PLTFIL ,ITITDT, LENCRD ,INPFMT, GRDTYP, LINWID, LINCOL, L
     *INTEX, TITCON, ITCNTR ,IUNUSD, NXYZ1, NXYZ2 ,LBLCHR, NDIMNS, IBL
     *KTP, IDIMNS ,NMESH1, NMESH2, MESH1, MESH2, MESH3, NFIELD ,IFIELD
     *, NINCR ,IVARBL, IVRPTR ,LINEAR, NONLIN ,NPOINT, LETSET ,MXECH
     *O, LINES, MAXLNS ,AXANG, MESH2D, REDFAC, GRDTEX, OUTTEX, IAXTEX, 
     *TITEX, DSCAL ,OUTSTR, IPROP, IHTEX, IBLINK, IERASE, LABTEX, TICTE
     *X, NXYLIM, PATSZ ,MARGIN, PSCR, ITXPRI, ITXSEC, OREAL, OCPU, CSCR
     *D, OUTSID ,TITLIN, TITINX, TITZ, TITX1, TITY1, LTDATA, NPLOTS, RE
     *VLEV ,LBLFMT, IYEAR, IMONTH, IDAY, ISIGFG ,DATPTS, ERRPTS, DATXM
     *N, DATXMX, DATYMN, DATYMX, DATZMN, DATZMX ,DATSUM, ERRSUM, DATAVE
     *, ERRAVE, DATCEN, ERRCEN, DATSTD, ERRSTD ,NCSETS, NCCOL, NCROW, F
     *MARKER, H2STAT, TITFAC, TITLOC, TITMAR ,TIKFAC, IWINLEV, WINREL, 
     *WINABS, WINLIM ,ICPOIN, LEVREP, IREPCT, SYDIR, GRDIR, NMESH0, EXY
     *ZLIM, IVPTR ,TITLMX, NXYZDEF1, NXYZDEF2, IFILE_CASE, N_CYCLE, ITX
     *_CYCLE ,SYM_CYCLE, PLOT_EXTENT, FILL_ANGLE, FILL_WIDTH, FILL_TEX 
     *,FILL_INDEX ,N_LINES ,DSLOPE ,MAX_SUBST, BARBRK ,I_VORDER,SHADOW
     *TYP,SHADOWTEX
      COMMON /T2SCRT/ BUFFER, IBUFFR, N_FILE,N_NAME,N_SELECT, ICHSAVE
      COMMON /T2_CHAR/ C_TIT_ESCAPE,C_TIT_SUBSTITUTE
      COMMON /T2_SCRT/ C_FILE, C_NAME, C_SELECT
      INTEGER JOUFIL, ERRFIL, OUTFIL, DBGFIL, INPFIL, NINMAX
      PARAMETER (NINMAX=20)
      INTEGER NINP(NINMAX)
      COMMON /T2TRBK/NINP, JOUFIL, ERRFIL, OUTFIL, DBGFIL, INPFIL
      CHARACTER*512 STRNG, STJOU
      LOGICAL LTOKEN
      REAL FLOTNG
      INTEGER INTERP, KEYORD, NSTRNG, MAXSTR, NSTJOU, LSTJOU, NTOKEN
      INTEGER*4 INTEG
      COMMON /TOKENC/ INTERP, INTEG, FLOTNG, KEYORD, NSTRNG, MAXSTR, ST
     *RNG, NSTJOU, LSTJOU, STJOU, LTOKEN, NTOKEN
      INTEGER I,J,N,IHIDE
      INTEGER IBUFSZ
      PARAMETER (IBUFSZ=4)
      REAL POS(3,2),T12(3,2),T1(3),T2(3)  ,XY(2,32*IBUFSZ),XY1(2),XY3(2)
     *,SIZE(3)  ,XARRAY(32*IBUFSZ),YARRAY(32*IBUFSZ)
      INTEGER*4 NLONG,BBITS(IBUFSZ+1)  
      DATA COPT/'NOFXSIZ,NEXT,','FIXSIZE,NEXT,'/
      IF (LTRAP) RETURN
      NTEXT=LEN(TEXT)
      IF (NTEXT.eq.0) RETURN
      call td2ugs(text,case)
      CALL T2CWTS(64*4,ITXSAV)
      CALL TXSDEF
      DO 11051 I=1,3
      SIZE(I)=SIZEIN(I)
      POS(I,1)=XYZ(I)
      POS(I,2)=XYZ(I)+SIZE(I)
11051 CONTINUE
11052 CONTINUE
      CALL T2XFRM(3,2,POS,LINEAR,XFRM24,3,T12)
      IF (T12(1,1).GT.T12(1,2)) THEN
      DO 11061 I=1,3
      SIZE(I)=-SIZE(I)
11061 CONTINUE
11062 CONTINUE
      ENDIF
      I=IAND(ICNTR,3)
      IHIDE=2
      IF (IAND(ICNTR,4).ne.0) IHIDE=6
      IF (I.gt.0) THEN
      FAC=TXXCSZ(TEXT,CASE,0.05*I)
      DO 11071 I=1,3
      POS(I,1)=POS(I,1)-FAC*SIZE(I)
11071 CONTINUE
11072 CONTINUE
      ENDIF
      IF (ABS(SIZE(1))+ABS(SIZE(2))+ABS(SIZE(3)).EQ.0.) THEN
      CALL T2XFRM(3,1,POS,LINEAR,XFRM24,2,XY)
      CALL TXTEXT(XY(1,1),XY(2,1),0.,0.,TEXT,CASE)
      ELSE
      CALL T2CROS(UP,SIZE,T1)
      IF (ABS(T1(1))+ABS(T1(2))+ABS(T1(3)).EQ.0.) T1(3)=1.
      CALL T2CROS(SIZE,T1,T2)
      IF (ABS(T2(1))+ABS(T2(2))+ABS(T2(3)).EQ.0.) T2(2)=1.
      S1=0
      S2=0.
      S3=0.
      DO 11081 I=1,3
      S1=S1+SIZE(I)**2
      S2=S2+T2(I)**2
      S3=S3+T1(I)*VUEDIR(I)
11081 CONTINUE
11082 CONTINUE
      FAC=SIGN(SQRT(S1/S2),S3)
      DO 11091 I=1,3
      T2(I)=T2(I)*FAC
11091 CONTINUE
11092 CONTINUE
      FAC=1/0.15
      IDP=DFTPRP+1
      DO 11101 N=1,NTEXT
      IF (LTRAP) GOTO 11110
      CALL UGCTOL(COPT(IDP)(1:7),0.,0.,TEXT(N:N),CASE(N:N),32*IBUFSZ  ,X
     *ARRAY,YARRAY,NLONG,BBITS)
      DO 11121 I=1,NLONG
      DO 11131 J=1,3
      T1(J)=POS(J,1)+  FAC*(SIZE(J)*XARRAY(I)+T2(J)*YARRAY(I))
11131 CONTINUE
11132 CONTINUE
      CALL T2XFRM(3,1,T1,LINEAR,XFRM24,2,XY(1,I))
11121 CONTINUE
11122 CONTINUE
      L=1
      DO 11141 I=1,NLONG
      J=(I+31)/31
      K=MOD((I-1),32)+1
      IF (IAND(BBITS(J),ISHFT(1,K-1)).EQ.0 .or. I .eq. NLONG) THEN
      K=I-L+1
      IF (K .ge. 2) CALL T2_MESH_DRAW(XY(1,L),K,IHIDE)
      L=I+1
      ENDIF
11141 CONTINUE
11142 CONTINUE
      FLAGS(1)=.FALSE.
      CALL UGCTOL(COPT(IDP),0.,0.,TEXT(N:N),CASE(N:N),32*IBUFSZ  ,XARRAY
     *,YARRAY,NL,IDUM)
      DO 11151 J=1,3
      POS(J,1)=POS(J,1)+FAC*(SIZE(J)*XARRAY(1)+T2(J)*YARRAY(1))
11151 CONTINUE
11152 CONTINUE
      FAC=FAC*XARRAY(2)
11101 CONTINUE
11102 CONTINUE
11110 CONTINUE
      CALL T2_MESH_FLUSH
      CALL T2CWTS(ITXSAV,IDUM)
      ENDIF
      END
      SUBROUTINE TXFILLSYM(X,Y,SYM,SIZEIN)
      IMPLICIT NONE
      REAL X,Y,SYM,SIZEIN,SIZE
      CHARACTER*2 TXSYMBOL
      CHARACTER*1 TEXT,CASE
      INTEGER I,J,K,L,I1, I2
      CHARACTER*7 COPT
      EXTERNAL UGXERR
      REAL PLIM(4,4),ZSCRN(2),XLLINE,YLLINE,XTLINE,YTLINE,XFRMFC, PAT(2
     *0),PATCUM,PATTOT,PATMOD,CCSCIS(4),DISPL, RESOL(2)
      INTEGER NPTS,IDDEVC,IPAT,NPAT,LMOVE,IROTAX,IROTAF
      COMMON/TXCOM/PLIM,ZSCRN, XLLINE,YLLINE,XTLINE,YTLINE,XFRMFC, IPA
     *T,NPAT,PAT,PATTOT, NPTS,IDDEVC,CCSCIS,LMOVE,IROTAX,DISPL,IROTAF,P
     *ATCUM,PATMOD, RESOL
      REAL HNONE
      COMMON /T2FLGC/ FLAGS(200), LTRAP,LHANDL,LSYERR,LSCREV
      LOGICAL FLAGS, LTRAP,LHANDL,LSYERR,LSCREV(3)
      INTEGER RELFLAG 
      PARAMETER (RELFLAG=151)
      INTEGER IWINLEV 
      INTEGER NWINLEV , MAX_FILL 
      PARAMETER (NWINLEV =4)
      PARAMETER (MAX_FILL=4)
      REAL GRDSYM, GRDSIZ, DATDAT(2,8), H2STAT(12), TITLIN(4), TITFA
     *C(4), TITLOC(4), TITMAR(4), TITLMX(4), TIKFAC, TITINX, TITX1, TIT
     *Y1, TITX, TITY, TITZ, TITSIZ, TITCON(5), REVLEV, REDUCE(5), XFR
     *M12(12), XFRM13(12), XFRM14(12), XFRM23(12), XFRM24(12), XFRM34(6
     *), XVARSX(20), CIRSIZ(2,3), ASIZE, AFLARE, SMSZDF, ORAXES(3), EY
     *EDIR(3), VUEDIR(3), VUECEN(3), VERTCL(3), EYESEP, SCRD, SCRZ, EYE
     *DIS, EYEPNT(3), XYPART(2, 2), BARSIZ(3), BARBRK(3), TIKSIZ(3), XY
     *ZBAS(3), TTHETA, TPHI, FRELBL(4), PATRN(20,30), SCLPRM(10,3), WI
     *NDOW(4), SCREEN(2), SYMBOL, NOSYMB, FACTXY(19), LBLSIZ, SYMSIZ, X
     *YZLIM(3,2), WORLD(3), RADRMX, RADRMN, RADAMN, RADANG, RADX0, RADY
     *0, XUNUSD(6), AXANG(3), REDFAC, DSCAL, PATSZ, MARGIN(4), PSCR(2
     *), OREAL, OCPU, CSCRD, DATPTS, ERRPTS, DATXMN, DATXMX, DATYMN, DA
     *TYMX, DATZMN, DATZMX, DATSUM, ERRSUM, DATAVE, ERRAVE, DATCEN, ERR
     *CEN, DATSTD, ERRSTD, WINREL(2,2,NWINLEV),WINABS(2,2,NWINLEV),WINL
     *IM(2,2), FMARKER(3,8), SYDIR(3), GRDIR(3), EXYZLIM(3,2), DSLOPE(2
     *,2)
      REAL PLOT_EXTENT(2,2),FILL_ANGLE(MAX_FILL),FILL_WIDTH(MAX_FILL)
      INTEGER FILL_INDEX, FILL_TEX(MAX_FILL), N_LINES(6)
      EQUIVALENCE (DATDAT, DATPTS)
      INTEGER MAXREP
      PARAMETER (MAXREP=5)
      INTEGER IPATRN, NPATRN(30), NXYLIM(3,2), NPLOTS, NCSETS, NCCOL, N
     *CROW, IYEAR, IMONTH, IDAY, ISIGFG, ITXPRI, ITXSEC, ITITDT(3), L
     *ENCRD, IPROP, IHTEX, IBLINK, IERASE, ITCNTR, IUNUSD, NXYZ1(3), 
     *NXYZ2(3), LBLFMT(3), LBLCHR(3), NDIMNS(3), IBLKTP, IDIMNS, NMES
     *H0, NMESH1, NMESH2, MESH1, MESH2, MESH3, MESH2D, MESHN(3), NMESHN(
     *2), NFIELD, IFIELD(19), NINCR, NPOINT, IVARBL(19), IVPTR(19), I_
     *VORDER(19,2), LINEAR(4), NONLIN(4), MXECHO, LINES, MAXLNS, USRK
     *BD, USRSCR, PLTFIL, LINWID, LINCOL, LINTEX, ICPOIN(3), IREPCT(MA
     *XREP), LEVREP, GRDTYP, GRDTEX, OUTTEX, IAXTEX, TITEX, LETSET, LAB
     *TEX, TICTEX, SHADOWTYP,SHADOWTEX, NXYZDEF1(10), NXYZDEF2(10), IF
     *ILE_CASE ,MAX_SUBST
      INTEGER MAX_CYCLE
      PARAMETER (MAX_CYCLE=20)
      INTEGER N_CYCLE, ITX_CYCLE(MAX_CYCLE)
      REAL SYM_CYCLE(MAX_CYCLE)
      EQUIVALENCE (NMESH1,NMESHN)
      EQUIVALENCE (MESH1,MESHN)
      INTEGER IBUFFR(400)
      REAL BUFFER(400)
      INTEGER NCHSAVE 
      PARAMETER (NCHSAVE=2*512) 
      INTEGER*4 ICHSAVE(NCHSAVE)
      INTEGER*4 IVRPTR(15)
      CHARACTER*512 OUTSTR,C_FILE, C_NAME, C_SELECT
      CHARACTER C_TIT_ESCAPE*1,C_TIT_SUBSTITUTE*2
      INTEGER N_FILE, N_NAME, N_SELECT
      CHARACTER*8 PXNAME
      CHARACTER*64 INPFMT
      LOGICAL LTDATA, OUTSID(4)
      COMMON /T2COM/ PXNAME, REDUCE, TITX, TITY ,XFRM12, XFRM13, XFRM1
     *4, XFRM23 ,XFRM24, XFRM34 ,XVARSX ,TITSIZ, GRDSYM, GRDSIZ, CIRS
     *IZ, ASIZE, AFLARE ,SMSZDF, ORAXES, EYEDIR, VUEDIR, VUECEN ,VERTC
     *L, EYESEP, SCRD, SCRZ, EYEDIS, EYEPNT ,XYPART, BARSIZ, TIKSIZ, XY
     *ZBAS, TTHETA ,TPHI, FRELBL, IPATRN, NPATRN, PATRN ,SCLPRM, WINDO
     *W, SCREEN, SYMBOL, NOSYMB ,FACTXY, LBLSIZ, SYMSIZ, XYZLIM, WORLD 
     *,RADRMX, RADRMN, RADAMN, RADANG, RADX0, RADY0, XUNUSD ,USRKBD, U
     *SRSCR, PLTFIL ,ITITDT, LENCRD ,INPFMT, GRDTYP, LINWID, LINCOL, L
     *INTEX, TITCON, ITCNTR ,IUNUSD, NXYZ1, NXYZ2 ,LBLCHR, NDIMNS, IBL
     *KTP, IDIMNS ,NMESH1, NMESH2, MESH1, MESH2, MESH3, NFIELD ,IFIELD
     *, NINCR ,IVARBL, IVRPTR ,LINEAR, NONLIN ,NPOINT, LETSET ,MXECH
     *O, LINES, MAXLNS ,AXANG, MESH2D, REDFAC, GRDTEX, OUTTEX, IAXTEX, 
     *TITEX, DSCAL ,OUTSTR, IPROP, IHTEX, IBLINK, IERASE, LABTEX, TICTE
     *X, NXYLIM, PATSZ ,MARGIN, PSCR, ITXPRI, ITXSEC, OREAL, OCPU, CSCR
     *D, OUTSID ,TITLIN, TITINX, TITZ, TITX1, TITY1, LTDATA, NPLOTS, RE
     *VLEV ,LBLFMT, IYEAR, IMONTH, IDAY, ISIGFG ,DATPTS, ERRPTS, DATXM
     *N, DATXMX, DATYMN, DATYMX, DATZMN, DATZMX ,DATSUM, ERRSUM, DATAVE
     *, ERRAVE, DATCEN, ERRCEN, DATSTD, ERRSTD ,NCSETS, NCCOL, NCROW, F
     *MARKER, H2STAT, TITFAC, TITLOC, TITMAR ,TIKFAC, IWINLEV, WINREL, 
     *WINABS, WINLIM ,ICPOIN, LEVREP, IREPCT, SYDIR, GRDIR, NMESH0, EXY
     *ZLIM, IVPTR ,TITLMX, NXYZDEF1, NXYZDEF2, IFILE_CASE, N_CYCLE, ITX
     *_CYCLE ,SYM_CYCLE, PLOT_EXTENT, FILL_ANGLE, FILL_WIDTH, FILL_TEX 
     *,FILL_INDEX ,N_LINES ,DSLOPE ,MAX_SUBST, BARBRK ,I_VORDER,SHADOW
     *TYP,SHADOWTEX
      COMMON /T2SCRT/ BUFFER, IBUFFR, N_FILE,N_NAME,N_SELECT, ICHSAVE
      COMMON /T2_CHAR/ C_TIT_ESCAPE,C_TIT_SUBSTITUTE
      COMMON /T2_SCRT/ C_FILE, C_NAME, C_SELECT
      INTEGER JOUFIL, ERRFIL, OUTFIL, DBGFIL, INPFIL, NINMAX
      PARAMETER (NINMAX=20)
      INTEGER NINP(NINMAX)
      COMMON /T2TRBK/NINP, JOUFIL, ERRFIL, OUTFIL, DBGFIL, INPFIL
      CHARACTER*512 STRNG, STJOU
      LOGICAL LTOKEN
      REAL FLOTNG
      INTEGER INTERP, KEYORD, NSTRNG, MAXSTR, NSTJOU, LSTJOU, NTOKEN
      INTEGER*4 INTEG
      COMMON /TOKENC/ INTERP, INTEG, FLOTNG, KEYORD, NSTRNG, MAXSTR, ST
     *RNG, NSTJOU, LSTJOU, STJOU, LTOKEN, NTOKEN
      INTEGER IBUFSZ
      PARAMETER (IBUFSZ=4)
      INTEGER ITXSAV,IDUM
      REAL FAC,TXXCSZ
      REAL POS(3,2),T12(3,2),T1(3),T2(3)  ,XY(2,32*IBUFSZ+1),XY1(2),XY3(
     *2)  ,XARRAY(32*IBUFSZ),YARRAY(32*IBUFSZ)
      INTEGER*4 NLONG,BBITS(IBUFSZ+1)  
      INTEGER ISHFT,IAND
      DATA HNONE /-666.666/
      DATA COPT/'FIXSIZE'/
      IF (LTRAP) RETURN
      I=0
      IF(ABS(SYM).lt.65536) I=NINT(ABS(SYM))
      I1=I/256
      I2=I-256*I1
      IF(I1.eq.32.and.I2.eq.32)I1=0
      IF(I1.lt.32.or.I2.lt.32) THEN
      CALL TXDOT(X,Y)
      RETURN
      ENDIF
      CALL SYMTXT(SYM,TXSYMBOL)
      TEXT=TXSYMBOL(1:1)
      CASE=TXSYMBOL(2:2)
      call td2ugs(text,case)
      CALL UGCTOL(COPT,0.,0.,TEXT,CASE,32*IBUFSZ  ,XARRAY,YARRAY,NLONG,B
     *BITS)
      IF (NLONG .eq. 0) THEN
      CALL TXDOT(X,Y)
      RETURN
      ENDIF
      CALL T2CWTS(64*4,ITXSAV)
      CALL TXSDEF
      SIZE = ABS(SIZEIN*XFRMFC*REDUCE(2))
      FAC=ABS(SIZE/0.15)
      DO 11161 I=1,NLONG
      XY(1,I)=FAC*XARRAY(I)+X
      XY(2,I)=FAC*YARRAY(I)+Y
11161 CONTINUE
11162 CONTINUE
      L=1
      DO 11171 I=1,NLONG
      IF (LTRAP) GOTO 11180
      J=(I+31)/31
      K=MOD((I-1),32)+1
      IF (IAND(BBITS(J),ISHFT(1,K-1)).EQ.0 .or. I .eq. NLONG) THEN
      K=I-L+1
      IF (K .ge. 2) THEN
      CALL TXLINX(XY(1,L),K,LINTEX)
      IF (K .gt. 2) CALL TXFILL(XY(1,L),XY(2,1),HNONE,2,K,0)
      ENDIF
      L=I+1
      ENDIF
11171 CONTINUE
11172 CONTINUE
11180 CONTINUE
      CALL T2CWTS(ITXSAV,IDUM)
      END
      SUBROUTINE UGXERR(LEVEL,NAME,INDX)
      IMPLICIT NONE
      INTEGER*4 LEVEL,INDX
      CHARACTER*(*) NAME
      EXTERNAL UGZ001
      COMMON /T2FLGC/ FLAGS(200), LTRAP,LHANDL,LSYERR,LSCREV
      LOGICAL FLAGS, LTRAP,LHANDL,LSYERR,LSCREV(3)
      INTEGER RELFLAG 
      PARAMETER (RELFLAG=151)
      INTEGER IWINLEV 
      INTEGER NWINLEV , MAX_FILL 
      PARAMETER (NWINLEV =4)
      PARAMETER (MAX_FILL=4)
      REAL GRDSYM, GRDSIZ, DATDAT(2,8), H2STAT(12), TITLIN(4), TITFA
     *C(4), TITLOC(4), TITMAR(4), TITLMX(4), TIKFAC, TITINX, TITX1, TIT
     *Y1, TITX, TITY, TITZ, TITSIZ, TITCON(5), REVLEV, REDUCE(5), XFR
     *M12(12), XFRM13(12), XFRM14(12), XFRM23(12), XFRM24(12), XFRM34(6
     *), XVARSX(20), CIRSIZ(2,3), ASIZE, AFLARE, SMSZDF, ORAXES(3), EY
     *EDIR(3), VUEDIR(3), VUECEN(3), VERTCL(3), EYESEP, SCRD, SCRZ, EYE
     *DIS, EYEPNT(3), XYPART(2, 2), BARSIZ(3), BARBRK(3), TIKSIZ(3), XY
     *ZBAS(3), TTHETA, TPHI, FRELBL(4), PATRN(20,30), SCLPRM(10,3), WI
     *NDOW(4), SCREEN(2), SYMBOL, NOSYMB, FACTXY(19), LBLSIZ, SYMSIZ, X
     *YZLIM(3,2), WORLD(3), RADRMX, RADRMN, RADAMN, RADANG, RADX0, RADY
     *0, XUNUSD(6), AXANG(3), REDFAC, DSCAL, PATSZ, MARGIN(4), PSCR(2
     *), OREAL, OCPU, CSCRD, DATPTS, ERRPTS, DATXMN, DATXMX, DATYMN, DA
     *TYMX, DATZMN, DATZMX, DATSUM, ERRSUM, DATAVE, ERRAVE, DATCEN, ERR
     *CEN, DATSTD, ERRSTD, WINREL(2,2,NWINLEV),WINABS(2,2,NWINLEV),WINL
     *IM(2,2), FMARKER(3,8), SYDIR(3), GRDIR(3), EXYZLIM(3,2), DSLOPE(2
     *,2)
      REAL PLOT_EXTENT(2,2),FILL_ANGLE(MAX_FILL),FILL_WIDTH(MAX_FILL)
      INTEGER FILL_INDEX, FILL_TEX(MAX_FILL), N_LINES(6)
      EQUIVALENCE (DATDAT, DATPTS)
      INTEGER MAXREP
      PARAMETER (MAXREP=5)
      INTEGER IPATRN, NPATRN(30), NXYLIM(3,2), NPLOTS, NCSETS, NCCOL, N
     *CROW, IYEAR, IMONTH, IDAY, ISIGFG, ITXPRI, ITXSEC, ITITDT(3), L
     *ENCRD, IPROP, IHTEX, IBLINK, IERASE, ITCNTR, IUNUSD, NXYZ1(3), 
     *NXYZ2(3), LBLFMT(3), LBLCHR(3), NDIMNS(3), IBLKTP, IDIMNS, NMES
     *H0, NMESH1, NMESH2, MESH1, MESH2, MESH3, MESH2D, MESHN(3), NMESHN(
     *2), NFIELD, IFIELD(19), NINCR, NPOINT, IVARBL(19), IVPTR(19), I_
     *VORDER(19,2), LINEAR(4), NONLIN(4), MXECHO, LINES, MAXLNS, USRK
     *BD, USRSCR, PLTFIL, LINWID, LINCOL, LINTEX, ICPOIN(3), IREPCT(MA
     *XREP), LEVREP, GRDTYP, GRDTEX, OUTTEX, IAXTEX, TITEX, LETSET, LAB
     *TEX, TICTEX, SHADOWTYP,SHADOWTEX, NXYZDEF1(10), NXYZDEF2(10), IF
     *ILE_CASE ,MAX_SUBST
      INTEGER MAX_CYCLE
      PARAMETER (MAX_CYCLE=20)
      INTEGER N_CYCLE, ITX_CYCLE(MAX_CYCLE)
      REAL SYM_CYCLE(MAX_CYCLE)
      EQUIVALENCE (NMESH1,NMESHN)
      EQUIVALENCE (MESH1,MESHN)
      INTEGER IBUFFR(400)
      REAL BUFFER(400)
      INTEGER NCHSAVE 
      PARAMETER (NCHSAVE=2*512) 
      INTEGER*4 ICHSAVE(NCHSAVE)
      INTEGER*4 IVRPTR(15)
      CHARACTER*512 OUTSTR,C_FILE, C_NAME, C_SELECT
      CHARACTER C_TIT_ESCAPE*1,C_TIT_SUBSTITUTE*2
      INTEGER N_FILE, N_NAME, N_SELECT
      CHARACTER*8 PXNAME
      CHARACTER*64 INPFMT
      LOGICAL LTDATA, OUTSID(4)
      COMMON /T2COM/ PXNAME, REDUCE, TITX, TITY ,XFRM12, XFRM13, XFRM1
     *4, XFRM23 ,XFRM24, XFRM34 ,XVARSX ,TITSIZ, GRDSYM, GRDSIZ, CIRS
     *IZ, ASIZE, AFLARE ,SMSZDF, ORAXES, EYEDIR, VUEDIR, VUECEN ,VERTC
     *L, EYESEP, SCRD, SCRZ, EYEDIS, EYEPNT ,XYPART, BARSIZ, TIKSIZ, XY
     *ZBAS, TTHETA ,TPHI, FRELBL, IPATRN, NPATRN, PATRN ,SCLPRM, WINDO
     *W, SCREEN, SYMBOL, NOSYMB ,FACTXY, LBLSIZ, SYMSIZ, XYZLIM, WORLD 
     *,RADRMX, RADRMN, RADAMN, RADANG, RADX0, RADY0, XUNUSD ,USRKBD, U
     *SRSCR, PLTFIL ,ITITDT, LENCRD ,INPFMT, GRDTYP, LINWID, LINCOL, L
     *INTEX, TITCON, ITCNTR ,IUNUSD, NXYZ1, NXYZ2 ,LBLCHR, NDIMNS, IBL
     *KTP, IDIMNS ,NMESH1, NMESH2, MESH1, MESH2, MESH3, NFIELD ,IFIELD
     *, NINCR ,IVARBL, IVRPTR ,LINEAR, NONLIN ,NPOINT, LETSET ,MXECH
     *O, LINES, MAXLNS ,AXANG, MESH2D, REDFAC, GRDTEX, OUTTEX, IAXTEX, 
     *TITEX, DSCAL ,OUTSTR, IPROP, IHTEX, IBLINK, IERASE, LABTEX, TICTE
     *X, NXYLIM, PATSZ ,MARGIN, PSCR, ITXPRI, ITXSEC, OREAL, OCPU, CSCR
     *D, OUTSID ,TITLIN, TITINX, TITZ, TITX1, TITY1, LTDATA, NPLOTS, RE
     *VLEV ,LBLFMT, IYEAR, IMONTH, IDAY, ISIGFG ,DATPTS, ERRPTS, DATXM
     *N, DATXMX, DATYMN, DATYMX, DATZMN, DATZMX ,DATSUM, ERRSUM, DATAVE
     *, ERRAVE, DATCEN, ERRCEN, DATSTD, ERRSTD ,NCSETS, NCCOL, NCROW, F
     *MARKER, H2STAT, TITFAC, TITLOC, TITMAR ,TIKFAC, IWINLEV, WINREL, 
     *WINABS, WINLIM ,ICPOIN, LEVREP, IREPCT, SYDIR, GRDIR, NMESH0, EXY
     *ZLIM, IVPTR ,TITLMX, NXYZDEF1, NXYZDEF2, IFILE_CASE, N_CYCLE, ITX
     *_CYCLE ,SYM_CYCLE, PLOT_EXTENT, FILL_ANGLE, FILL_WIDTH, FILL_TEX 
     *,FILL_INDEX ,N_LINES ,DSLOPE ,MAX_SUBST, BARBRK ,I_VORDER,SHADOW
     *TYP,SHADOWTEX
      COMMON /T2SCRT/ BUFFER, IBUFFR, N_FILE,N_NAME,N_SELECT, ICHSAVE
      COMMON /T2_CHAR/ C_TIT_ESCAPE,C_TIT_SUBSTITUTE
      COMMON /T2_SCRT/ C_FILE, C_NAME, C_SELECT
      INTEGER JOUFIL, ERRFIL, OUTFIL, DBGFIL, INPFIL, NINMAX
      PARAMETER (NINMAX=20)
      INTEGER NINP(NINMAX)
      COMMON /T2TRBK/NINP, JOUFIL, ERRFIL, OUTFIL, DBGFIL, INPFIL
      CHARACTER*512 STRNG, STJOU
      LOGICAL LTOKEN
      REAL FLOTNG
      INTEGER INTERP, KEYORD, NSTRNG, MAXSTR, NSTJOU, LSTJOU, NTOKEN
      INTEGER*4 INTEG
      COMMON /TOKENC/ INTERP, INTEG, FLOTNG, KEYORD, NSTRNG, MAXSTR, ST
     *RNG, NSTJOU, LSTJOU, STJOU, LTOKEN, NTOKEN
      INTEGER IXX 
      INTEGER PXELWORDS, MAX_QOPN, QOPNSIZ 
      PARAMETER (PXELWORDS=2000)
      PARAMETER (MAX_QOPN=8)
      PARAMETER (QOPNSIZ=200)
      INTEGER IOPEN(10)
      LOGICAL L_IDOPEN(10)
      INTEGER VIRGIN ,ISEGMN ,JSEGMN, DFTSEG, JPROP, IACT
      LOGICAL LCLEAR ,LERAS ,LINTF, LPROP
      REAL DFTANG ,DFTSIZ ,URSIZE, WDOW(4)
      INTEGER DFTWID ,DFTTEX ,DFTCOL ,DFTVEC ,DFTFNT ,DFTBLK ,DFTPRP ,DF
     *TSTR ,DFTQUI ,PXEL(PXELWORDS)
      COMMON /TXCOMD/PXEL ,LCLEAR ,VIRGIN ,ISEGMN ,JSEGMN ,URSIZE ,DFTCO
     *L ,DFTTEX ,DFTWID ,DFTQUI ,DFTFNT ,DFTANG ,DFTSIZ ,DFTVEC ,LERAS ,
     *DFTPRP ,DFTBLK ,DFTSEG ,LINTF ,IOPEN, L_IDOPEN ,JPROP, LPROP, WDOW
     *, IACT
      INTEGER NQOPNF ,NQTXT
      CHARACTER*(QOPNSIZ) QOPNF
      CHARACTER*(QOPNSIZ) QOPN(MAX_QOPN)
      INTEGER NQOPN(MAX_QOPN)
      CHARACTER*80 QTXT
      COMMON/TXCOMV/NQOPN ,QOPN ,NQTXT ,QTXT ,NQOPNF ,QOPNF
      LOGICAL INTRAC
      INTEGER I ,NCHAR, IOP
      CHARACTER*8 UGOPEN,UGFONT
      DATA UGOPEN,UGFONT/'UGOPEN  ','UGFONT  '/
      IF (INDX.EQ.11) THEN
      IF (LCLEAR) THEN
      JSEGMN=DFTSEG
      ISEGMN=DFTSEG
      IF(PXNAME.ne.' ') THEN
      CALL UGPICT('CLEAR,ALIAS='//PXNAME,0)
      ELSE
      CALL UGPICT('CLEAR',0)
      ENDIF
      LCLEAR = .false.
      ENDIF
      IF (.NOT.LTRAP) THEN
      DO 11191 IOP=1,IOPEN(1)
      CALL UGSLCT(' ',IOPEN(IOP+1))
      IF(LERAS) THEN
      CALL UGWRIT('ERASE',ISEGMN,PXEL)
      ELSE
      CALL UGWRIT(' ',ISEGMN,PXEL)
      ENDIF
      IF(ISEGMN.gt.0) ISEGMN=ISEGMN+1
11191 CONTINUE
11192 CONTINUE
      ENDIF
      CALL UGINIT('CONTINUE',PXEL,PXELWORDS)
      VIRGIN=PXEL(1)
      LEVEL=0
      FLAGS(1)=.FALSE.
      ELSEIF (NAME .eq. 'UGTX07  ' .or. NAME.eq.'DECGIGI ' .or. NAME .eq
     *. 'TAL1590 ' .or. NAME.eq.'UGSIXEL ' .or. NAME .eq. 'QMS1200 ' ) T
     *HEN
      INDX=MIN(MAX(INDX,0),9999)
      ELSEIF (NAME.EQ.UGFONT. AND. INDX.EQ.99) THEN
      LEVEL=2
      ELSEIF (NAME.EQ.UGOPEN) THEN
      WRITE(OUTSTR,11200)QOPN(1)(1:NQOPN(1))
      CALL T2ERR(0,' ',OUTSTR,-3)
11200 FORMAT ('  Device="',A,'"')
      ENDIF
      IF (INTRAC()) LEVEL=MIN(LEVEL,2)
      END
      SUBROUTINE UGZ001
      IMPLICIT NONE
      CALL T2ERR(0,' ','*** ERROR *** Fatal unified graphics error',3)
      END
      SUBROUTINE T2ABCD(BUFFR)
      IMPLICIT NONE
      INTEGER NBUFFR,LENBUF,I,J,K,L,IMIN,ISIZ
      CHARACTER*(*) BUFFR
      CHARACTER*80 STEMP
      NBUFFR=LEN(BUFFR)
      LENBUF=NBUFFR
      I=1
11211 CONTINUE
      J=INDEX(BUFFR(I+1:LENBUF),',')
      IF(J.le.0)GOTO 11212
      K=I+J
      STEMP=BUFFR(I:I+J)
      ISIZ=0
11221 CONTINUE
      L=INDEX(BUFFR(K+1:LENBUF),',')
      IF(L.le.0)GOTO 11222
      IF(STEMP.ge.BUFFR(K:K+L)) THEN
      STEMP=BUFFR(K:K+L)
      IMIN=K
      ISIZ=L
      ENDIF
      K=K+L
      GOTO 11221
11222 CONTINUE
      IF(ISIZ.gt.0) THEN
      K=IMIN
      L=ISIZ
      STEMP=BUFFR(I:I+J)
      BUFFR(I:K+L-J)=BUFFR(I+J:K+L)
      BUFFR(K+L-J:K+L)=STEMP
      J=0
      ENDIF
      I=I+J
      GOTO 11211
11212 CONTINUE
      end
      REAL FUNCTION TXXCSZ(text,case,size)
      IMPLICIT NONE
      REAL X(2),Y(2)
      CHARACTER*(*) text,case
      REAL SIZE
      INTEGER NC,IB
      CHARACTER*13 COPT(2)
      INTEGER IXX 
      INTEGER PXELWORDS, MAX_QOPN, QOPNSIZ 
      PARAMETER (PXELWORDS=2000)
      PARAMETER (MAX_QOPN=8)
      PARAMETER (QOPNSIZ=200)
      INTEGER IOPEN(10)
      LOGICAL L_IDOPEN(10)
      INTEGER VIRGIN ,ISEGMN ,JSEGMN, DFTSEG, JPROP, IACT
      LOGICAL LCLEAR ,LERAS ,LINTF, LPROP
      REAL DFTANG ,DFTSIZ ,URSIZE, WDOW(4)
      INTEGER DFTWID ,DFTTEX ,DFTCOL ,DFTVEC ,DFTFNT ,DFTBLK ,DFTPRP ,DF
     *TSTR ,DFTQUI ,PXEL(PXELWORDS)
      COMMON /TXCOMD/PXEL ,LCLEAR ,VIRGIN ,ISEGMN ,JSEGMN ,URSIZE ,DFTCO
     *L ,DFTTEX ,DFTWID ,DFTQUI ,DFTFNT ,DFTANG ,DFTSIZ ,DFTVEC ,LERAS ,
     *DFTPRP ,DFTBLK ,DFTSEG ,LINTF ,IOPEN, L_IDOPEN ,JPROP, LPROP, WDOW
     *, IACT
      INTEGER NQOPNF ,NQTXT
      CHARACTER*(QOPNSIZ) QOPNF
      CHARACTER*(QOPNSIZ) QOPN(MAX_QOPN)
      INTEGER NQOPN(MAX_QOPN)
      CHARACTER*80 QTXT
      COMMON/TXCOMV/NQOPN ,QOPN ,NQTXT ,QTXT ,NQOPNF ,QOPNF
      character*255 text2,case2
      DATA COPT/'NOFXSIZ,LAST,','FIXSIZE,LAST,'/
      TXXCSZ=len(TEXT)*ABS(SIZE)  *0.5	! phenominological factor ?
      IF (DFTQUI.ne.0) RETURN
      IF (TXXCSZ.eq.0) RETURN
      IF ( case.ne.' ' .or. LPROP .or. (size.gt.0 .and. DFTVEC+DFTPRP.eq
     *.0)) THEN
      text2=text
      case2=case
      call td2ugs(text2(:len(text)),case2(:len(case)))
c     CALL UGCTOL(COPT(DFTPRP+1),0.0,0.0,text,case,1,X,Y,NC,IB)
      CALL UGCTOL(COPT(DFTPRP+1),0.0,0.0,text2(:len(text)),
     -                                   case2(:len(case)),1,X,Y,NC,IB)
      TXXCSZ=ABS(SIZE)*X(1)/0.015
      ENDIF
      END
